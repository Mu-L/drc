(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-53e19f4c"],{"53ca":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));a("a4d3"),a("e01a"),a("d28b"),a("e260"),a("d3b7"),a("3ca3"),a("ddb0");function i(t){return i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}},"79ce":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/conflictLog"}},[t._v("冲突处理")]),a("BreadcrumbItem",{attrs:{to:"/dbBlacklist"}},[t._v("黑名单")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("div",{staticStyle:{padding:"1px 1px"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"16"}},[a("Card",{attrs:{padding:5},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("查询条件")]},proxy:!0}])},[a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"dbFilter"},on:{"on-enter":t.getData},model:{value:t.queryParam.dbFilter,callback:function(e){t.$set(t.queryParam,"dbFilter",e)},expression:"queryParam.dbFilter"}})],1),a("Col",{attrs:{span:"8"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"类型"},on:{"on-change":t.getData},model:{value:t.queryParam.type,callback:function(e){t.$set(t.queryParam,"type",e)},expression:"queryParam.type"}},t._l(t.typeList,(function(e){return a("Option",{key:e.val,attrs:{value:e.val}},[t._v(t._s(e.name))])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"1"}},[a("Button",{attrs:{type:"primary",icon:"ios-search",loading:t.dataLoading},on:{click:t.getData}},[t._v("查询")]),a("Button",{staticStyle:{"margin-top":"20px"},attrs:{icon:"md-refresh",loading:t.dataLoading},on:{click:t.resetParam}},[t._v("重置")])],1)],1),a("br"),a("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[a("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[a("Button",{attrs:{type:"default",icon:"ios-hammer"},on:{click:t.preAdd}},[t._v(" 新增黑名单 ")])],1)],1),a("Table",{attrs:{stripe:"",border:"",columns:t.columns,data:t.tableData},scopedSlots:t._u([{key:"action",fn:function(e){var i=e.row,l=e.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.showDetail(i,l)}}},[t._v(" 详情 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.preUpdate(i,l)}}},[t._v(" 修改 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(e){return t.preDelete(i,l)}}},[t._v(" 删除 ")])]}}])}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:t.total,current:t.current,"page-size-opts":[10,20,50,100],"page-size":10,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(e){t.current=e},"on-change":t.getData,"on-page-size-change":t.handleChangeSize}})],1),a("Modal",{attrs:{title:"确认删除以下黑名单"},on:{"on-ok":t.deleteBlacklist,"on-cancel":t.clearDelete},model:{value:t.deleteModal,callback:function(e){t.deleteModal=e},expression:"deleteModal"}},[a("p",[t._v('黑名单: "'+t._s(t.deleteDbFilter)+'"')])]),a("Modal",{attrs:{width:"900px",title:"黑名单"},model:{value:t.detailModal,callback:function(e){t.detailModal=e},expression:"detailModal"}},[a("div",{attrs:{id:"xmlCode"}},[a("codemirror",{staticClass:"code",attrs:{options:{mode:"text/x-mysql",theme:"ambiance",autofocus:!0,lineWrapping:!0,readOnly:!0,lineNumbers:!0,foldGutter:!0,styleActiveLine:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}},model:{value:t.detail,callback:function(e){t.detail=e},expression:"detail"}})],1)]),a("Modal",{attrs:{title:"黑名单变更",width:"900px"},on:{"on-ok":t.blacklistChange},model:{value:t.createModal,callback:function(e){t.createModal=e},expression:"createModal"}},[a("Form",{staticStyle:{width:"100%"},attrs:{"label-position":"right"}},[a("FormItem",{attrs:{label:"黑名单"}},[a("Input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入黑名单, 支持正则"},model:{value:t.dbFilter,callback:function(e){t.dbFilter=e},expression:"dbFilter"}})],1),a("FormItem",{attrs:{label:"过期时间"}},[a("DatePicker",{attrs:{type:"datetime",editable:!1,clearable:!1,placeholder:"请选择黑名单过期时间"},model:{value:t.dbFilterExpirationTime,callback:function(e){t.dbFilterExpirationTime=e},expression:"dbFilterExpirationTime"}})],1)],1)],1)],1)])],1)},l=[],r=(a("d3b7"),a("53ca")),n=(a("0f7c"),a("ffda"),{name:"dbBlacklist",data:function(){return{columns:[{title:"黑名单(正则)",key:"dbFilter",tooltip:!0},{title:"类型",key:"type",width:150,align:"center",render:function(t,e){var a,i,l=e.row.type;return 0===l?(i="用户配置",a="blue"):1===l?(i="DRC配置",a="green"):2===l?(i="DBA",a="success"):3===l?(i="告警无处理",a="volcano"):4===l?(i="告警无流量",a="volcano"):(i="未知",a="volcano"),t("Tag",{props:{color:a}},i)}},{title:"过期时间",key:"expirationTime",width:180},{title:"修改时间",key:"createTime",width:180},{title:"操作",slot:"action",align:"center",width:200}],total:0,current:1,size:10,tableData:[],deleteModal:!1,isUpdate:!1,createModal:!0==="this.$route.query".createModal||"true"===this.$route.query.createModal,detailModal:!1,detail:"",deleteDbFilter:"",typeList:[{name:"用户配置",val:0},{name:"DRC配置",val:1},{name:"DBA",val:2},{name:"告警无处理",val:3},{name:"告警无流量",val:4}],queryParam:{dbFilter:"",type:null,pageReq:{pageSize:10,pageIndex:1}},blacklistId:0,blacklistType:0,dbFilter:this.$route.query.dbFilter,dbFilterExpirationTime:null,dataLoading:!0}},computed:{},methods:{showModal:function(t){0===t.type?this.getRelatedMha(t):1===t.type&&this.getRelatedMhaReplication(t)},resetParam:function(){this.queryParam={dbFilter:"",type:null,pageReq:{pageSize:10,pageIndex:1}},this.getData()},getData:function(){var t=this,e={dbFilter:this.queryParam.dbFilter,type:this.queryParam.type,pageReq:{pageSize:this.size,pageIndex:this.current}},a=this.flattenObj(e);t.dataLoading=!0,t.axios.get("/api/drc/v2/log/conflict/db/blacklist",{params:a}).then((function(e){var a=e.data,i=e.data.pageReq;1===a.status?t.$Message.error("查询异常: "+a.message):0===a.data.length||0===i.totalCount?(t.total=0,t.current=1,t.tableData=[],t.$Message.warning("查询结果为空")):(t.total=i.totalCount,t.current=i.pageIndex,t.tableData=a.data,t.$Message.success("查询成功"))})).catch((function(e){t.$Message.error("查询异常: "+e)})).finally((function(){t.dataLoading=!1}))},handleChangeSize:function(t){var e=this;this.size=t,this.$nextTick((function(){e.getData()}))},showDetail:function(t,e){this.detail=t.dbFilter,this.detailModal=!0},preUpdate:function(t,e){this.blacklistId=t.id,this.blacklistType=t.type,this.dbFilter=t.dbFilter,this.dbFilterExpirationTime=t.expirationTime,this.isUpdate=!0,this.createModal=!0},preDelete:function(t,e){this.deleteDbFilter=t.dbFilter,this.deleteModal=!0},clearDelete:function(){this.deleteDbFilter=""},deleteBlacklist:function(t,e){var a=this;this.axios.delete("/api/drc/v2/log/conflict/db/blacklist/?dbFilter="+this.deleteDbFilter).then((function(t){0===t.data.status?(a.$Message.success("删除成功"),a.getData()):a.$Message.warning("删除失败 "+t.data.message)}))},preAdd:function(){this.isUpdate=!1,this.dbFilter="",this.dbFilterExpirationTime=null,this.createModal=!0},blacklistChange:function(){this.isUpdate?this.updateBlacklist():this.addBlacklist()},updateBlacklist:function(){var t=this,e=new Date(this.dbFilterExpirationTime).getTime();if(isNaN(e))this.$Message.warning("过期时间为空或格式不正确");else{var a={id:this.blacklistId,type:this.blacklistType,dbFilter:this.dbFilter,expirationTime:e};this.axios.put("/api/drc/v2/log/conflict/db/blacklist",a).then((function(e){0===e.data.status?(t.$Message.success("修改成功"),t.createModal=!1,t.getData()):t.$Message.warning("修改失败 "+e.data.message)}))}},addBlacklist:function(){var t=this,e=new Date(this.dbFilterExpirationTime).getTime();isNaN(e)?this.$Message.warning("过期时间为空或格式不正确"):this.axios.post("/api/drc/v2/log/conflict/db/blacklist/?dbFilter="+this.dbFilter+"&expirationTime="+e).then((function(e){0===e.data.status?(t.$Message.success("新增成功"),t.createModal=!1,t.getData()):t.$Message.warning("新增失败 "+e.data.message)}))},flattenObj:function(t){var e={};for(var a in t)if("object"!==Object(r["a"])(t[a])||Array.isArray(t[a]))e[a]=t[a];else{var i=this.flattenObj(t[a]);for(var l in i)e[a+"."+l]=i[l]}return e}},created:function(){this.getData()}}),s=n,o=(a("c42f"),a("2877")),c=Object(o["a"])(s,i,l,!1,null,"601144c3",null);e["default"]=c.exports},c42f:function(t,e,a){"use strict";a("c633")},c633:function(t,e,a){}}]);
//# sourceMappingURL=chunk-53e19f4c.d42a92bc.js.map