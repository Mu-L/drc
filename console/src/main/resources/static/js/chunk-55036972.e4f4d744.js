(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55036972"],{"14c3":function(e,t,r){var a=r("c6b6"),n=r("9263");e.exports=function(e,t){var r=e.exec;if("function"===typeof r){var o=r.call(e,t);if("object"!==typeof o)throw TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==a(e))throw TypeError("RegExp#exec called on incompatible receiver");return n.call(e,t)}},"159b":function(e,t,r){var a=r("da84"),n=r("fdbc"),o=r("17c2"),i=r("9112");for(var l in n){var s=a[l],c=s&&s.prototype;if(c&&c.forEach!==o)try{i(c,"forEach",o)}catch(u){c.forEach=o}}},"17c2":function(e,t,r){"use strict";var a=r("b727").forEach,n=r("a640"),o=r("ae40"),i=n("forEach"),l=o("forEach");e.exports=i&&l?[].forEach:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}},"1da1":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("d3b7"),r("e6cf");function a(e,t,r,a,n,o,i){try{var l=e[o](i),s=l.value}catch(c){return void r(c)}l.done?t(s):Promise.resolve(s).then(a,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function l(e){a(i,n,o,l,s,"next",e)}function s(e){a(i,n,o,l,s,"throw",e)}l(void 0)}))}}},4160:function(e,t,r){"use strict";var a=r("23e7"),n=r("17c2");a({target:"Array",proto:!0,forced:[].forEach!=n},{forEach:n})},5319:function(e,t,r){"use strict";var a=r("d784"),n=r("825a"),o=r("7b0b"),i=r("50c4"),l=r("a691"),s=r("1d80"),c=r("8aa5"),u=r("14c3"),d=Math.max,f=Math.min,h=Math.floor,g=/\$([$&'`]|\d\d?|<[^>]*>)/g,m=/\$([$&'`]|\d\d?)/g,p=function(e){return void 0===e?e:String(e)};a("replace",2,(function(e,t,r,a){var y=a.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,v=a.REPLACE_KEEPS_$0,b=y?"$":"$0";return[function(r,a){var n=s(this),o=void 0==r?void 0:r[e];return void 0!==o?o.call(r,n,a):t.call(String(n),r,a)},function(e,a){if(!y&&v||"string"===typeof a&&-1===a.indexOf(b)){var o=r(t,e,this,a);if(o.done)return o.value}var s=n(e),h=String(this),g="function"===typeof a;g||(a=String(a));var m=s.global;if(m){var x=s.unicode;s.lastIndex=0}var R=[];while(1){var q=u(s,h);if(null===q)break;if(R.push(q),!m)break;var E=String(q[0]);""===E&&(s.lastIndex=c(h,i(s.lastIndex),x))}for(var P="",S=0,T=0;T<R.length;T++){q=R[T];for(var _=String(q[0]),D=d(f(l(q.index),h.length),0),L=[],k=1;k<q.length;k++)L.push(p(q[k]));var N=q.groups;if(g){var I=[_].concat(L,D,h);void 0!==N&&I.push(N);var $=String(a.apply(void 0,I))}else $=w(_,h,D,L,N,a);D>=S&&(P+=h.slice(S,D)+$,S=D+_.length)}return P+h.slice(S)}];function w(e,r,a,n,i,l){var s=a+e.length,c=n.length,u=m;return void 0!==i&&(i=o(i),u=g),t.call(l,u,(function(t,o){var l;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,a);case"'":return r.slice(s);case"<":l=i[o.slice(1,-1)];break;default:var u=+o;if(0===u)return t;if(u>c){var d=h(u/10);return 0===d?t:d<=c?void 0===n[d-1]?o.charAt(1):n[d-1]+o.charAt(1):t}l=n[u-1]}return void 0===l?"":l}))}}))},"53ca":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("a4d3"),r("e01a"),r("d28b"),r("e260"),r("d3b7"),r("3ca3"),r("ddb0");function a(e){return a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var a=r("1d80"),n=r("5899"),o="["+n+"]",i=RegExp("^"+o+o+"*"),l=RegExp(o+o+"*$"),s=function(e){return function(t){var r=String(a(t));return 1&e&&(r=r.replace(i,"")),2&e&&(r=r.replace(l,"")),r}};e.exports={start:s(1),end:s(2),trim:s(3)}},"61b1":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{padding:"1px 1px"}},[r("Row",{attrs:{gutter:10,align:"middle"}},[r("Col",{attrs:{span:"20"}},[r("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("查询条件")]},proxy:!0}])},[r("Row",{directives:[{name:"show",rawName:"v-show",value:!e.searchMode,expression:"!searchMode"}],attrs:{gutter:10}},[r("Col",{attrs:{span:"2"}},[r("Select",{attrs:{filterable:"",clearable:"",placeholder:"源region"},model:{value:e.queryParam.srcRegion,callback:function(t){e.$set(e.queryParam,"srcRegion",t)},expression:"queryParam.srcRegion"}},e._l(e.regions,(function(t){return r("Option",{key:t.regionName,attrs:{value:t.regionName}},[e._v(" "+e._s(t.regionName)+" ")])})),1)],1),r("Col",{attrs:{span:"2"}},[r("Select",{attrs:{filterable:"",clearable:"",placeholder:"目标region"},model:{value:e.queryParam.dstRegion,callback:function(t){e.$set(e.queryParam,"dstRegion",t)},expression:"queryParam.dstRegion"}},e._l(e.regions,(function(t){return r("Option",{key:t.regionName,attrs:{value:t.regionName}},[e._v(" "+e._s(t.regionName)+" ")])})),1)],1),r("Col",{attrs:{span:"4"}},[r("Input",{attrs:{prefix:"ios-search",placeholder:"库名"},model:{value:e.queryParam.dbName,callback:function(t){e.$set(e.queryParam,"dbName",t)},expression:"queryParam.dbName"}})],1),r("Col",{attrs:{span:"4"}},[r("Input",{attrs:{prefix:"ios-search",placeholder:"表名"},model:{value:e.queryParam.tableName,callback:function(t){e.$set(e.queryParam,"tableName",t)},expression:"queryParam.tableName"}})],1),r("Col",{attrs:{span:"4"}},[r("DatePicker",{attrs:{transfer:!0,type:"datetime",editable:e.editable,clearable:!1,placeholder:"起始日期"},model:{value:e.queryParam.beginHandleTime,callback:function(t){e.$set(e.queryParam,"beginHandleTime",t)},expression:"queryParam.beginHandleTime"}})],1),r("Col",{attrs:{span:"4"}},[r("DatePicker",{attrs:{transfer:!0,type:"datetime",editable:e.editable,confirm:!1,clearable:!1,placeholder:"结束日期"},model:{value:e.queryParam.endHandleTime,callback:function(t){e.$set(e.queryParam,"endHandleTime",t)},expression:"queryParam.endHandleTime"}})],1),r("Col",{attrs:{span:"2"}},[r("Select",{attrs:{filterable:"",clearable:"",placeholder:"日志情况"},model:{value:e.queryParam.brief,callback:function(t){e.$set(e.queryParam,"brief",t)},expression:"queryParam.brief"}},e._l(e.briefOpts,(function(t){return r("Option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.name))])})),1)],1),r("Col",{attrs:{span:"2"}},[r("Select",{attrs:{filterable:"",clearable:"",placeholder:"执行结果"},model:{value:e.queryParam.rowResult,callback:function(t){e.$set(e.queryParam,"rowResult",t)},expression:"queryParam.rowResult"}},e._l(e.resultOpts,(function(t){return r("Option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.name))])})),1)],1)],1),r("Row",{directives:[{name:"show",rawName:"v-show",value:e.searchMode,expression:"searchMode"}],attrs:{gutter:10}},[r("Col",{attrs:{span:"12"}},[r("Input",{attrs:{prefix:"ios-search",placeholder:"事务id"},model:{value:e.queryParam.gtid,callback:function(t){e.$set(e.queryParam,"gtid",t)},expression:"queryParam.gtid"}})],1),r("Col",{attrs:{span:"4"}},[r("DatePicker",{attrs:{type:"datetime",editable:e.editable,clearable:!1,placeholder:"起始日期"},model:{value:e.queryParam.beginHandleTime,callback:function(t){e.$set(e.queryParam,"beginHandleTime",t)},expression:"queryParam.beginHandleTime"}})],1),r("Col",{attrs:{span:"4"}},[r("DatePicker",{attrs:{type:"datetime",editable:e.editable,clearable:!1,placeholder:"结束日期"},model:{value:e.queryParam.endHandleTime,callback:function(t){e.$set(e.queryParam,"endHandleTime",t)},expression:"queryParam.endHandleTime"}})],1),r("Col",{attrs:{span:"4"}},[r("Select",{attrs:{filterable:"",clearable:"",placeholder:"执行结果"},model:{value:e.queryParam.rowResult,callback:function(t){e.$set(e.queryParam,"rowResult",t)},expression:"queryParam.rowResult"}},e._l(e.resultOpts,(function(t){return r("Option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.name))])})),1)],1)],1)],1)],1),r("Col",{attrs:{span:"4"}},[r("Row",{attrs:{gutter:10,align:"middle"}},[r("Button",{attrs:{type:"primary",icon:"ios-search",loading:e.dataLoading},on:{click:e.getTotalData}},[e._v("查询")]),r("i-switch",{staticStyle:{"margin-left":"10px"},attrs:{size:"large"},scopedSlots:e._u([{key:"open",fn:function(){return[r("span",[e._v("模糊匹配")])]},proxy:!0},{key:"close",fn:function(){return[r("span",[e._v("精确匹配")])]},proxy:!0}]),model:{value:e.queryParam.likeSearch,callback:function(t){e.$set(e.queryParam,"likeSearch",t)},expression:"queryParam.likeSearch"}},[e._v("模糊匹配 ")])],1),r("Row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:10,align:"middle"}},[r("Button",{attrs:{icon:"md-refresh"},on:{click:e.resetParam}},[e._v("重置")]),r("i-switch",{staticStyle:{"margin-left":"10px"},attrs:{size:"large"},on:{"on-change":e.searchModeChange},scopedSlots:e._u([{key:"open",fn:function(){return[r("span",[e._v("进阶")])]},proxy:!0},{key:"close",fn:function(){return[r("span",[e._v("进阶")])]},proxy:!0}]),model:{value:e.searchMode,callback:function(t){e.searchMode=t},expression:"searchMode"}},[e._v("进阶 ")])],1)],1)],1),r("br"),r("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[r("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[r("Dropdown",{attrs:{placement:"bottom-start"},scopedSlots:e._u([{key:"list",fn:function(){return[r("DropdownMenu",[r("DropdownItem",{nativeOn:{click:function(t){return e.compareRecords.apply(null,arguments)}}},[e._v("数据比对")]),r("DropdownItem",{nativeOn:{click:function(t){return e.getLogDetails.apply(null,arguments)}}},[e._v("冲突行详情")])],1)]},proxy:!0}])},[r("Button",{attrs:{type:"default",icon:"ios-hammer"}},[e._v(" 批量操作 "),r("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1)],1),r("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[r("Button",{attrs:{type:"default",icon:"md-create"},on:{click:e.dbBlacklist}},[e._v(" 冲突黑名单 ")])],1)],1),r("Table",{ref:"multipleTable",attrs:{border:"",columns:e.columns,data:e.tableData},on:{"on-selection-change":e.changeSelection},scopedSlots:e._u([{key:"action",fn:function(t){var a=t.row,n=t.index;return[r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.getLogDetail1(a,n)}}},[e._v(" 详情 ")]),r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(t){return e.queryTrxLog(a,n)}}},[e._v(" 冲突事务 ")])]}}])}),r("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[e.countLoading?r("div",[e._v(" Total Loading... ")]):r("Page",{attrs:{transfer:!0,total:e.total,current:e.current,"page-size-opts":[10,20,50,100],"page-size":10,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-change":e.getData,"on-page-size-change":e.handleChangeSize}})],1),r("Modal",{attrs:{title:"冲突行详情",width:"1200px",scrollable:!0,draggable:!0},model:{value:e.detailModal,callback:function(t){e.detailModal=t},expression:"detailModal"}},[r("div",{style:{padding:"1px 1px",height:"100%"}},[r("Card",[r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("冲突行提交结果： "),r("Button",{attrs:{loading:e.modalLoading,size:"small",type:0==e.logDetail.result?"success":"error"}},[e._v(" "+e._s(e.logDetail.resultStr)+" ")])],1),r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("冲突行数据一致性比较结果： "),r("Tooltip",{attrs:{content:"数据一致性比对忽略字段过滤的列"}},[r("Button",{attrs:{loading:e.modalLoading,size:"small",type:1==e.logDetail.recordEqual?"success":"warning"}},[e._v(" "+e._s(e.logDetail.diffStr)+" ")])],1)],1),r("Divider"),r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("源机房("+e._s(e.logDetail.srcRegion)+")")]),e._l(e.logDetail.srcRecords,(function(t,a){return r("Card",{key:a},[r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("表名："+e._s(t.tableName)+" "),r("Tooltip",{attrs:{content:1==t.doubleSync?"双向同步":"单向同步"}},[r("Button",{attrs:{size:"small",type:1==t.doubleSync?"success":"primary"}},[e._v(" "+e._s(1==t.doubleSync?"双向同步":"单向同步")+" ")])],1)],1),r("Table",{attrs:{loading:e.modalLoading,size:"small",columns:t.columns,data:t.records,border:""}})],1)})),r("Divider"),r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("目标机房("+e._s(e.logDetail.dstRegion)+")")]),e._l(e.logDetail.dstRecords,(function(t,a){return r("Card",{key:a},[r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("表名："+e._s(t.tableName)+" "),r("Tooltip",{attrs:{content:1==t.doubleSync?"双向同步":"单向同步"}},[r("Button",{attrs:{size:"small",type:1==t.doubleSync?"success":"primary"}},[e._v(" "+e._s(1==t.doubleSync?"双向同步":"单向同步")+" ")])],1)],1),r("Table",{attrs:{loading:e.modalLoading,size:"small",columns:t.columns,data:t.records,border:""}})],1)})),r("Divider"),r("Card",[r("codemirror",{attrs:{options:e.options},model:{value:e.rowData,callback:function(t){e.rowData=t},expression:"rowData"}})],1)],2)],1)]),r("Modal",{attrs:{title:"数据一致性比对结果",width:"800px"},model:{value:e.compareModal,callback:function(t){e.compareModal=t},expression:"compareModal"}},[this.rowLogIds.length>0?r("div",{staticClass:"ivu-list-item-meta-title"},[e._v("存在数据比对不一致的冲突行，点击查询 "),r("Tooltip",{attrs:{content:"冲突行仅限当前页面"}},[r("Button",{attrs:{size:"middle",type:"success"},on:{click:e.getUnEqualRecords}},[e._v("冲突行")])],1)],1):e._e(),r("Table",{attrs:{stripe:"",border:"",loading:e.compareLoading,columns:e.compareData.columns,data:e.compareData.compareRowRecords}})],1)],1)},n=[],o=(r("4160"),r("d81d"),r("4ec9"),r("a9e3"),r("d3b7"),r("ac1f"),r("3ca3"),r("5319"),r("159b"),r("ddb0"),r("53ca")),i=(r("96cf"),r("1da1")),l=r("8f94"),s=(r("0f7c"),r("ffda"),{name:"conflictRowsLog",props:{gtid:String,beginHandleTime:String,endHandleTime:String,searchMode:Boolean},components:{codemirror:l["codemirror"]},data:function(){var e=this;return{compareModal:!1,multiData:[],detailModal:!1,compareEqualLoading:!1,modalLoading:!1,compareLoading:!1,rowLogIds:[],compareData:{compareRowRecords:[],columns:[{title:"表名",key:"tableName"},{title:"比对结果",key:"recordIsEqual",render:function(e,t){var r=t.row,a=r.recordIsEqual?"blue":"warning",n=r.recordIsEqual?"数据一致":"数据不一致";return e("Tag",{props:{color:a}},n)}}]},logDetail:{srcRecords:[],dstRecords:[],srcRegion:"",dstRegion:"",result:null,resultStr:"",hasDiff:null,recordEqual:null,diffStr:"",rowData:""},regions:[],editable:!1,dataLoading:!1,countLoading:!1,queryParam:{srcRegion:this.$route.query.srcRegion,dstRegion:this.$route.query.dstRegion,dbName:this.$route.query.dbName,tableName:this.$route.query.tableName,rowResult:this.$route.query.rowResult?Number(this.$route.query.rowResult):null,brief:this.$route.query.brief?Number(this.$route.query.brief):null,gtid:this.gtid,likeSearch:!0===this.$route.query.likeSearch||"true"===this.$route.query.likeSearch,beginHandleTime:this.$route.query.beginTime?new Date(Number(this.$route.query.beginTime)):this.beginHandleTime,endHandleTime:this.$route.query.endTime?new Date(Number(this.$route.query.endTime)):this.endHandleTime},tableData:[],columns:[{type:"selection",width:60,align:"center"},{title:"同步方向",key:"region",width:160,render:function(e,t){var r=t.row,a="blue",n=r.srcRegion+" -> "+r.dstRegion;return e("Tag",{props:{color:a}},n)}},{title:"表名",key:"tableName",width:250,tooltip:!0,render:function(e,t){var r=t.row,a=r.dbName+"."+r.tableName;return e("div",a)}},{title:"原始sql",key:"rawSql",tooltip:!0},{title:"冲突处理sql",key:"handleSql",tooltip:!0},{title:"提交时间",key:"handleTime",width:180,sortable:!0},{title:"执行结果",key:"rowResult",width:150,align:"center",render:function(e,t){var r=t.row,a=0===r.rowResult?"blue":"volcano",n=0===r.rowResult?"commit":"rollBack";return e("Tag",{props:{color:a}},n)}},{title:"执行结果",key:"rowResultDetail",width:150,align:"center"},{title:"数据是否一致",key:"recordIsEqual",width:150,align:"center",renderHeader:function(t,r){return t("span",[t("span","数据比对"),t("Button",{on:{click:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.compareRecordEqual();case 2:case"end":return t.stop()}}),t)})));function r(){return t.apply(this,arguments)}return r}()},props:{loading:e.compareEqualLoading,size:"small",shape:"circle",type:"default",icon:"md-refresh"}})])},render:function(e,t){var r,a,n=t.row;return!0===n.recordIsEqual?(r="success",a="一致"):!1===n.recordIsEqual&&(r="warning",a="不一致"),e("Tag",{props:{color:r}},a)}},{title:"操作",slot:"action",width:165,align:"center"}],total:0,current:1,size:10,pageSizeOpts:[10,20,50,100],resultOpts:[{name:"commit",val:0},{name:"rollBack",val:1}],briefOpts:[{name:"有日志",val:0},{name:"无日志",val:1}],options:{value:"",mode:"text/x-mysql",theme:"ambiance",lineWrapping:!0,height:100,readOnly:!0,lineNumbers:!0}}},methods:{resetPath:function(){this.searchMode?this.$router.replace({query:{gtid:this.queryParam.gtid,rowResult:this.queryParam.rowResult,beginTime:new Date(this.queryParam.beginHandleTime).getTime(),endTime:new Date(this.queryParam.endHandleTime).getTime()}}):this.$router.replace({query:{srcRegion:this.queryParam.srcRegion,dstRegion:this.queryParam.dstRegion,dbName:this.queryParam.dbName,tableName:this.queryParam.tableName,rowResult:this.queryParam.rowResult,brief:this.queryParam.brief,likeSearch:this.queryParam.likeSearch,beginTime:new Date(this.queryParam.beginHandleTime).getTime(),endTime:new Date(this.queryParam.endHandleTime).getTime()}})},searchModeChange:function(){this.queryParam.gtid=null},compareRecordEqual:function(){var e=this,t=[];0!==this.tableData.length&&(this.tableData.forEach((function(e){return t.push(e.conflictRowsLogId)})),this.compareEqualLoading=!0,this.axios.get("/api/drc/v2/log/conflict/compare?conflictRowLogIds="+t).then((function(t){if(1===t.data.status)e.$Message.error({content:"数据比对失败! "+t.data.message,duration:5});else{var r=t.data.data,a=new Map(r.map((function(e){return[e.rowLogId,e.recordIsEqual]})));e.tableData.forEach((function(e){e.recordIsEqual=a.get(e.conflictRowsLogId)}))}})).finally((function(){e.compareEqualLoading=!1})))},compareRecords:function(){var e=this,t=this.multiData;if(void 0!==t&&null!==t&&0!==t.length){this.compareLoading=!0,this.compareModal=!0;var r=[];t.forEach((function(e){return r.push(e.conflictRowsLogId)})),this.axios.get("/api/drc/v2/log/conflict/records/compare?conflictRowLogIds="+r).then((function(t){if(1===t.data.status)e.compareData.compareRowRecords=[],e.$Message.error({content:"数据比对失败! "+t.data.message,duration:5});else{var r=t.data.data;e.compareData.compareRowRecords=r.recordDetailList,e.rowLogIds=[],r.rowLogIds.forEach((function(t){return e.rowLogIds.push(t)}))}})).finally((function(){e.compareLoading=!1}))}else this.$Message.warning("请勾选！")},getLogDetails:function(){var e=this,t=this.multiData;if(void 0!==t&&null!==t&&0!==t.length){var r=[],a=t[0];t.forEach((function(e){return r.push(e.conflictRowsLogId)})),this.axios.get("/api/drc/v2/log/conflict/rows/check?conflictRowLogIds="+r).then((function(t){if(1===t.data.status)e.$Message.error(t.data.message);else{var n=e.$router.resolve({path:"/conflictLogDetail",query:{queryType:"1",rowLogIds:r,srcRegion:a.srcRegion,dstRegion:a.dstRegion}});window.open(n.href,"_blank")}}))}else this.$Message.warning("请勾选！")},dbBlacklist:function(){var e=this.$router.resolve({path:"/dbBlacklist"});window.open(e.href,"_blank")},changeSelection:function(e){this.multiData=e,console.log(this.multiData)},getLogDetail1:function(e,t){var r=this;this.modalLoading=!0,this.detailModal=!0,this.logDetail.result=e.rowResult,this.logDetail.resultStr=0===e.rowResult?"commit":"rollBack",this.logDetail.srcRegion=e.srcRegion,this.logDetail.dstRegion=e.dstRegion,this.logDetail.srcRecords=[],this.logDetail.dstRecords=[],this.rowData="",this.axios.get("/api/drc/v2/log/conflict/row/record?conflictRowLogId="+e.conflictRowsLogId+"&columnSize=12").then((function(t){if(1===t.data.status)r.$Message.error({content:"查询失败! "+t.data.message,duration:5}),r.logDetail.recordEqual=!1,r.logDetail.diffStr="数据比对失败",r.logDetail.srcRecords=[],r.logDetail.dstRecords=[];else{var a=t.data.data;r.logDetail.recordEqual=a.recordIsEqual,r.logDetail.diffStr=a.recordIsEqual?"数据一致":"数据不一致",r.logDetail.srcRecords=a.srcRecords,r.logDetail.dstRecords=a.dstRecords,r.rowData="/*原始SQL*/\n"+e.rawSql+"\n/*原始SQL处理结果: "+e.rawSqlResult+"*/\n\n/*冲突时行记录*/\n"+e.dstRowRecord+"\n\n/*冲突处理SQL*/\n"+e.handleSql+"\n/*冲突处理SQL处理结果: "+e.handleSqlResult+"*/"}})).finally((function(){r.modalLoading=!1}))},getRegions:function(){var e=this;this.axios.get("/api/drc/v2/meta/regions/all").then((function(t){e.regions=t.data.data}))},queryTrxLog:function(e,t){this.$emit("tabValueChanged","trxLog"),this.$emit("gtidChanged",e.gtid),this.$emit("beginHandleTimeChanged",this.queryParam.beginHandleTime),this.$emit("endHandleTimeChanged",this.queryParam.endHandleTime)},getUnEqualRecords:function(){var e=this;this.multiData=[],this.compareModal=!1,this.dataLoading=!0,this.axios.get("/api/drc/v2/log/conflict/rows/rowLogIds?rowLogIds="+this.rowLogIds).then((function(t){var r=t.data;1===r.status?e.$Message.error("查询失败"):(e.tableData=r.data,e.total=r.data.length,e.current=1,e.tableData=r.data,0===e.total?e.$Message.warning("查询结果为空"):(e.compareRecordEqual(),e.$Message.success("以下冲突行数据对比不一致")))})).finally((function(){e.dataLoading=!1}))},getTotalData:function(){this.getData(),this.getCount()},getCount:function(){var e=this,t=this.queryParam.beginHandleTime,r=this.queryParam.endHandleTime,a=new Date(t).getTime(),n=new Date(r).getTime();if(!isNaN(a)&&!isNaN(n)){console.log("beginTime: "+t),console.log("endTime: "+r);var o={gtid:this.queryParam.gtid,dbName:this.queryParam.dbName,tableName:this.queryParam.tableName,rowResult:this.queryParam.rowResult,srcRegion:this.queryParam.srcRegion,dstRegion:this.queryParam.dstRegion,beginHandleTime:a,endHandleTime:n,likeSearch:this.queryParam.likeSearch,brief:this.queryParam.brief,pageReq:{pageSize:this.size,pageIndex:this.current}};this.countLoading=!0;var i=this.flattenObj(o);this.axios.get("/api/drc/v2/log/conflict/rows/count",{params:i}).then((function(t){var r=t.data;0===r.status&&(e.total=r.data)})).finally((function(){e.countLoading=!1}))}},getData:function(){var e=this;this.resetPath(),this.multiData=[],this.compareData.compareRowRecords=[],this.rowLogIds=[];var t=this.queryParam.beginHandleTime,r=this.queryParam.endHandleTime,a=new Date(t).getTime(),n=new Date(r).getTime();if(isNaN(a)||isNaN(n))this.$Message.warning("请选择时间范围!");else{console.log("beginTime: "+t),console.log("endTime: "+r);var o={gtid:this.queryParam.gtid,dbName:this.queryParam.dbName,tableName:this.queryParam.tableName,rowResult:this.queryParam.rowResult,srcRegion:this.queryParam.srcRegion,dstRegion:this.queryParam.dstRegion,beginHandleTime:a,endHandleTime:n,likeSearch:this.queryParam.likeSearch,brief:this.queryParam.brief,pageReq:{pageSize:this.size,pageIndex:this.current}};console.log("params"),console.log(o);var i=this.flattenObj(o);this.dataLoading=!0,this.axios.get("/api/drc/v2/log/conflict/rows",{params:i}).then((function(t){var r=t.data,a=r.pageReq;1===r.status?e.$Message.error(r.message):0===r.data.length?(e.current=1,e.tableData=r.data,e.$Message.warning("查询结果为空")):(e.current=a.pageIndex,e.tableData=r.data,e.$Message.success("查询成功"),e.compareRecordEqual())})).finally((function(){e.dataLoading=!1}))}},flattenObj:function(e){var t={};for(var r in e)if("object"!==Object(o["a"])(e[r])||Array.isArray(e[r]))t[r]=e[r];else{var a=this.flattenObj(e[r]);for(var n in a)t[r+"."+n]=a[n]}return t},resetParam:function(){this.queryParam={dbName:null,tableName:null,gtId:null,beginHandleTime:new Date((new Date).setSeconds(0,0)-6e5),endHandleTime:new Date((new Date).setSeconds(0,0)+6e4),rowResult:null,srcRegion:null,dstRegion:null},this.rowLogIds=[]},handleChangeSize:function(e){var t=this;this.size=e,this.$nextTick((function(){t.getData()}))}},created:function(){this.getTotalData(),this.getRegions()}}),c=s,u=(r("f889"),r("2877")),d=Object(u["a"])(c,a,n,!1,null,null,null);t["default"]=d.exports},"8aa5":function(e,t,r){"use strict";var a=r("6547").charAt;e.exports=function(e,t,r){return t+(r?a(e,t).length:1)}},9263:function(e,t,r){"use strict";var a=r("ad6d"),n=r("9f7f"),o=RegExp.prototype.exec,i=String.prototype.replace,l=o,s=function(){var e=/a/,t=/b*/g;return o.call(e,"a"),o.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),c=n.UNSUPPORTED_Y||n.BROKEN_CARET,u=void 0!==/()??/.exec("")[1],d=s||u||c;d&&(l=function(e){var t,r,n,l,d=this,f=c&&d.sticky,h=a.call(d),g=d.source,m=0,p=e;return f&&(h=h.replace("y",""),-1===h.indexOf("g")&&(h+="g"),p=String(e).slice(d.lastIndex),d.lastIndex>0&&(!d.multiline||d.multiline&&"\n"!==e[d.lastIndex-1])&&(g="(?: "+g+")",p=" "+p,m++),r=new RegExp("^(?:"+g+")",h)),u&&(r=new RegExp("^"+g+"$(?!\\s)",h)),s&&(t=d.lastIndex),n=o.call(f?r:d,p),f?n?(n.input=n.input.slice(m),n[0]=n[0].slice(m),n.index=d.lastIndex,d.lastIndex+=n[0].length):d.lastIndex=0:s&&n&&(d.lastIndex=d.global?n.index+n[0].length:t),u&&n&&n.length>1&&i.call(n[0],r,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(n[l]=void 0)})),n}),e.exports=l},"96cf":function(e,t,r){var a=function(e){"use strict";var t,r=Object.prototype,a=r.hasOwnProperty,n="function"===typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function s(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,o=Object.create(n.prototype),i=new _(a||[]);return o._invoke=E(e,r,i),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(a){return{type:"throw",arg:a}}}e.wrap=s;var u="suspendedStart",d="suspendedYield",f="executing",h="completed",g={};function m(){}function p(){}function y(){}var v={};v[o]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(D([])));w&&w!==r&&a.call(w,o)&&(v=w);var x=y.prototype=m.prototype=Object.create(v);function R(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function q(e){function t(r,n,o,i){var l=c(e[r],e,n);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"===typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,i)}),(function(e){t("throw",e,o,i)})):Promise.resolve(u).then((function(e){s.value=e,o(s)}),(function(e){return t("throw",e,o,i)}))}i(l.arg)}var r;function n(e,a){function n(){return new Promise((function(r,n){t(e,a,r,n)}))}return r=r?r.then(n,n):n()}this._invoke=n}function E(e,t,r){var a=u;return function(n,o){if(a===f)throw new Error("Generator is already running");if(a===h){if("throw"===n)throw o;return L()}r.method=n,r.arg=o;while(1){var i=r.delegate;if(i){var l=P(i,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===u)throw a=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=f;var s=c(e,t,r);if("normal"===s.type){if(a=r.done?h:d,s.arg===g)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=h,r.method="throw",r.arg=s.arg)}}}function P(e,r){var a=e.iterator[r.method];if(a===t){if(r.delegate=null,"throw"===r.method){if(e.iterator["return"]&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var n=c(a,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,g;var o=n.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function D(e){if(e){var r=e[o];if(r)return r.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function r(){while(++n<e.length)if(a.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:L}}function L(){return{value:t,done:!0}}return p.prototype=x.constructor=y,y.constructor=p,y[l]=p.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},R(q.prototype),q.prototype[i]=function(){return this},e.AsyncIterator=q,e.async=function(t,r,a,n){var o=new q(s(t,r,a,n));return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(x),x[l]="Generator",x[o]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){while(t.length){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=D,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(a,n){return l.type="throw",l.arg=e,r.next=a,n&&(r.method="next",r.arg=t),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],l=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,a){return this.delegate={iterator:D(e),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=a}catch(n){Function("r","regeneratorRuntime = r")(a)}},"9f7f":function(e,t,r){"use strict";var a=r("d039");function n(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=a((function(){var e=n("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=a((function(){var e=n("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},a640:function(e,t,r){"use strict";var a=r("d039");e.exports=function(e,t){var r=[][e];return!!r&&a((function(){r.call(null,t||function(){throw 1},1)}))}},a9e3:function(e,t,r){"use strict";var a=r("83ab"),n=r("da84"),o=r("94ca"),i=r("6eeb"),l=r("5135"),s=r("c6b6"),c=r("7156"),u=r("c04e"),d=r("d039"),f=r("7c73"),h=r("241c").f,g=r("06cf").f,m=r("9bf2").f,p=r("58a8").trim,y="Number",v=n[y],b=v.prototype,w=s(f(b))==y,x=function(e){var t,r,a,n,o,i,l,s,c=u(e,!1);if("string"==typeof c&&c.length>2)if(c=p(c),t=c.charCodeAt(0),43===t||45===t){if(r=c.charCodeAt(2),88===r||120===r)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:a=2,n=49;break;case 79:case 111:a=8,n=55;break;default:return+c}for(o=c.slice(2),i=o.length,l=0;l<i;l++)if(s=o.charCodeAt(l),s<48||s>n)return NaN;return parseInt(o,a)}return+c};if(o(y,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var R,q=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof q&&(w?d((function(){b.valueOf.call(r)})):s(r)!=y)?c(new v(x(t)),r,q):x(t)},E=a?h(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),P=0;E.length>P;P++)l(v,R=E[P])&&!l(q,R)&&m(q,R,g(v,R));q.prototype=b,b.constructor=q,i(n,y,q)}},ac1f:function(e,t,r){"use strict";var a=r("23e7"),n=r("9263");a({target:"RegExp",proto:!0,forced:/./.exec!==n},{exec:n})},d784:function(e,t,r){"use strict";r("ac1f");var a=r("6eeb"),n=r("d039"),o=r("b622"),i=r("9263"),l=r("9112"),s=o("species"),c=!n((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),u=function(){return"$0"==="a".replace(/./,"$0")}(),d=o("replace"),f=function(){return!!/./[d]&&""===/./[d]("a","$0")}(),h=!n((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));e.exports=function(e,t,r,d){var g=o(e),m=!n((function(){var t={};return t[g]=function(){return 7},7!=""[e](t)})),p=m&&!n((function(){var t=!1,r=/a/;return"split"===e&&(r={},r.constructor={},r.constructor[s]=function(){return r},r.flags="",r[g]=/./[g]),r.exec=function(){return t=!0,null},r[g](""),!t}));if(!m||!p||"replace"===e&&(!c||!u||f)||"split"===e&&!h){var y=/./[g],v=r(g,""[e],(function(e,t,r,a,n){return t.exec===i?m&&!n?{done:!0,value:y.call(t,r,a)}:{done:!0,value:e.call(r,t,a)}:{done:!1}}),{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:f}),b=v[0],w=v[1];a(String.prototype,e,b),a(RegExp.prototype,g,2==t?function(e,t){return w.call(e,this,t)}:function(e){return w.call(e,this)})}d&&l(RegExp.prototype[g],"sham",!0)}},d81d:function(e,t,r){"use strict";var a=r("23e7"),n=r("b727").map,o=r("1dde"),i=r("ae40"),l=o("map"),s=i("map");a({target:"Array",proto:!0,forced:!l||!s},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},f057:function(e,t,r){},f889:function(e,t,r){"use strict";r("f057")}}]);
//# sourceMappingURL=chunk-55036972.e4f4d744.js.map