(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d6e2128"],{"159b":function(t,e,a){var r=a("da84"),i=a("fdbc"),n=a("17c2"),o=a("9112");for(var s in i){var c=r[s],l=c&&c.prototype;if(l&&l.forEach!==n)try{o(l,"forEach",n)}catch(u){l.forEach=n}}},"17c2":function(t,e,a){"use strict";var r=a("b727").forEach,i=a("a640"),n=a("ae40"),o=i("forEach"),s=n("forEach");t.exports=o&&s?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},"1da1":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));a("d3b7"),a("e6cf");function r(t,e,a,r,i,n,o){try{var s=t[n](o),c=s.value}catch(l){return void a(l)}s.done?e(c):Promise.resolve(c).then(r,i)}function i(t){return function(){var e=this,a=arguments;return new Promise((function(i,n){var o=t.apply(e,a);function s(t){r(o,i,n,s,c,"next",t)}function c(t){r(o,i,n,s,c,"throw",t)}s(void 0)}))}}},2532:function(t,e,a){"use strict";var r=a("23e7"),i=a("5a34"),n=a("1d80"),o=a("ab13");r({target:"String",proto:!0,forced:!o("includes")},{includes:function(t){return!!~String(n(this)).indexOf(i(t),arguments.length>1?arguments[1]:void 0)}})},4160:function(t,e,a){"use strict";var r=a("23e7"),i=a("17c2");r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},"44e7":function(t,e,a){var r=a("861d"),i=a("c6b6"),n=a("b622"),o=n("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==i(t))}},"4fad":function(t,e,a){var r=a("23e7"),i=a("6f53").entries;r({target:"Object",stat:!0},{entries:function(t){return i(t)}})},"53ca":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d28b"),a("e260"),a("d3b7"),a("3ca3"),a("ddb0");function r(t){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}},"5a34":function(t,e,a){var r=a("44e7");t.exports=function(t){if(r(t))throw TypeError("The method doesn't accept regular expressions");return t}},6062:function(t,e,a){"use strict";var r=a("6d61"),i=a("6566");t.exports=r("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),i)},"6f53":function(t,e,a){var r=a("83ab"),i=a("df75"),n=a("fc6a"),o=a("d1e7").f,s=function(t){return function(e){var a,s=n(e),c=i(s),l=c.length,u=0,p=[];while(l>u)a=c[u++],r&&!o.call(s,a)||p.push(t?[a,s[a]]:s[a]);return p}};t.exports={entries:s(!0),values:s(!1)}},"96cf":function(t,e,a){var r=function(t){"use strict";var e,a=Object.prototype,r=a.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,a,r){var i=e&&e.prototype instanceof m?e:m,n=Object.create(i.prototype),o=new N(r||[]);return n._invoke=R(t,a,o),n}function l(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(r){return{type:"throw",arg:r}}}t.wrap=c;var u="suspendedStart",p="suspendedYield",d="executing",h="completed",f={};function m(){}function g(){}function y(){}var b={};b[n]=function(){return this};var v=Object.getPrototypeOf,x=v&&v(v(_([])));x&&x!==a&&r.call(x,n)&&(b=x);var w=y.prototype=m.prototype=Object.create(b);function M(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function D(t){function e(a,i,n,o){var s=l(t[a],t,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"===typeof u&&r.call(u,"__await")?Promise.resolve(u.__await).then((function(t){e("next",t,n,o)}),(function(t){e("throw",t,n,o)})):Promise.resolve(u).then((function(t){c.value=t,n(c)}),(function(t){return e("throw",t,n,o)}))}o(s.arg)}var a;function i(t,r){function i(){return new Promise((function(a,i){e(t,r,a,i)}))}return a=a?a.then(i,i):i()}this._invoke=i}function R(t,e,a){var r=u;return function(i,n){if(r===d)throw new Error("Generator is already running");if(r===h){if("throw"===i)throw n;return L()}a.method=i,a.arg=n;while(1){var o=a.delegate;if(o){var s=k(o,a);if(s){if(s===f)continue;return s}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(r===u)throw r=h,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);r=d;var c=l(t,e,a);if("normal"===c.type){if(r=a.done?h:p,c.arg===f)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(r=h,a.method="throw",a.arg=c.arg)}}}function k(t,a){var r=t.iterator[a.method];if(r===e){if(a.delegate=null,"throw"===a.method){if(t.iterator["return"]&&(a.method="return",a.arg=e,k(t,a),"throw"===a.method))return f;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var i=l(r,t.iterator,a.arg);if("throw"===i.type)return a.method="throw",a.arg=i.arg,a.delegate=null,f;var n=i.arg;return n?n.done?(a[t.resultName]=n.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,f):n:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,f)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function _(t){if(t){var a=t[n];if(a)return a.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function a(){while(++i<t.length)if(r.call(t,i))return a.value=t[i],a.done=!1,a;return a.value=e,a.done=!0,a};return o.next=o}}return{next:L}}function L(){return{value:e,done:!0}}return g.prototype=w.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},M(D.prototype),D.prototype[o]=function(){return this},t.AsyncIterator=D,t.async=function(e,a,r,i){var n=new D(c(e,a,r,i));return t.isGeneratorFunction(a)?n:n.next().then((function(t){return t.done?t.value:n.next()}))},M(w),w[s]="Generator",w[n]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var a in t)e.push(a);return e.reverse(),function a(){while(e.length){var r=e.pop();if(r in t)return a.value=r,a.done=!1,a}return a.done=!0,a}},t.values=_,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var a in this)"t"===a.charAt(0)&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function i(r,i){return s.type="throw",s.arg=t,a.next=r,i&&(a.method="next",a.arg=e),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=e,n?(this.method="next",this.next=n.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),S(a),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var r=a.completion;if("throw"===r.type){var i=r.arg;S(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,a,r){return this.delegate={iterator:_(t),resultName:a,nextLoc:r},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},"99af":function(t,e,a){"use strict";var r=a("23e7"),i=a("d039"),n=a("e8b5"),o=a("861d"),s=a("7b0b"),c=a("50c4"),l=a("8418"),u=a("65f0"),p=a("1dde"),d=a("b622"),h=a("2d00"),f=d("isConcatSpreadable"),m=9007199254740991,g="Maximum allowed index exceeded",y=h>=51||!i((function(){var t=[];return t[f]=!1,t.concat()[0]!==t})),b=p("concat"),v=function(t){if(!o(t))return!1;var e=t[f];return void 0!==e?!!e:n(t)},x=!y||!b;r({target:"Array",proto:!0,forced:x},{concat:function(t){var e,a,r,i,n,o=s(this),p=u(o,0),d=0;for(e=-1,r=arguments.length;e<r;e++)if(n=-1===e?o:arguments[e],v(n)){if(i=c(n.length),d+i>m)throw TypeError(g);for(a=0;a<i;a++,d++)a in n&&l(p,d,n[a])}else{if(d>=m)throw TypeError(g);l(p,d++,n)}return p.length=d,p}})},"9bf1":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:{path:"/v2/mhaReplications",query:{srcMhaName:this.initInfo.srcMhaName,dstMhaName:this.initInfo.dstMhaName,preciseSearchMode:!0}}}},[t._v("首页 ")]),a("BreadcrumbItem",{attrs:{to:"/v2/mhaDbReplications"}}),a("BreadcrumbItem",{attrs:{to:{path:"/drcV2",query:{step:3,srcMhaName:this.initInfo.srcMhaName,dstMhaName:this.initInfo.dstMhaName,srcDc:this.initInfo.srcDc,dstDc:this.initInfo.dstDc,order:this.initInfo.order}}}},[t._v("DRC-MHA 配置 ")]),a("BreadcrumbItem",[t._v("Db Applier 配置")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("Row",[a("Col",{attrs:{span:"8"}},[a("span",{staticStyle:{"margin-top":"10px",color:"#464c5b","font-weight":"600"}},[t._v(t._s(t.initInfo.srcMhaName)+"("+t._s(t.initInfo.srcDc)+")==>"+t._s(t.initInfo.dstMhaName)+"("+t._s(t.initInfo.dstDc)+")")])])],1),a("Row",{staticStyle:{"margin-top":"20px",background:"#fdfdff",border:"1px solid #e8eaec",display:"flex","justify-content":"flex-start","align-items":"center"}},[a("Col",{staticStyle:{display:"flex",margin:"5px"}},[t.submitted?t._e():a("Button",{staticStyle:{"text-align":"right"},attrs:{loading:t.dataLoading,type:"default"},on:{click:function(e){return t.preBatchUpdate()}}},[t._v(" 批量修改 ")])],1),a("Col",{staticStyle:{display:"flex",margin:"5px"}},[t.submitted?t._e():a("Button",{staticStyle:{"text-align":"right"},attrs:{icon:"md-arrow-up",loading:t.dataLoading,type:"primary"},on:{click:function(e){return t.preSubmit()}}},[t._v("提交 ")])],1),a("Col",{staticStyle:{display:"flex",margin:"5px"}},[t.submitted?t._e():a("Button",{staticStyle:{"margin-left":"1px","text-align":"right"},attrs:{icon:"md-swap",loading:t.dataLoading,type:"primary"},on:{click:function(e){return t.preSwitchAppliers()}}},[t._v(" 一键自动切换 ")])],1),a("Col",{staticStyle:{display:"flex",margin:"5px"}},[a("Dropdown",{attrs:{transfer:!0,placement:"bottom-start",type:"primary"},scopedSlots:t._u([{key:"list",fn:function(){return[a("DropdownMenu",[a("DropdownItem",[t.submitted?t._e():a("Button",{on:{click:function(e){return t.preUpdateRoute()}}},[t._v(" meta路由规则 ")])],1),a("DropdownItem",[t.submitted?t._e():a("Button",{on:{click:function(e){return t.preUpdateMhaRoute()}}},[t._v(" console路由规则 ")])],1)],1)]},proxy:!0}])},[a("Button",{attrs:{type:"default",icon:"ios-hammer"}},[t._v(" 操作 "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1)],1)],1),a("Table",{ref:"multipleTable",staticStyle:{"margin-top":"0px"},attrs:{stripe:"",columns:t.columns,data:t.tableData,loading:t.dataLoading,border:""},on:{"on-selection-change":t.changeSelection},scopedSlots:t._u([{key:"applier",fn:function(e){var r=e.row,i=e.index;return[t.showSelectOptionComponent?a("Select",{key:t.applierShowRefreshCounter,staticStyle:{width:"300px"},attrs:{transfer:!0,multiple:"",placeholder:"选择源集群Applier"},model:{value:t.tableData[i].ips,callback:function(e){t.$set(t.tableData[i],"ips",e)},expression:"tableData[index].ips"}},t._l(t.applierResourceList,(function(e){return a("Option",{key:e.ip,attrs:{value:e.ip}},[t._v(t._s(e.ip)+" —— "+t._s(e.az)+" "+t._s(t.getRole(e.ip,t.currentInstances.get(t.tableData[i].dbName)))+" ")])})),1):t._e(),t.showSelectOptionComponent?a("Button",{staticStyle:{"margin-left":"10px"},attrs:{loading:t.applierDataLoading[i],type:"success",size:"small"},on:{click:function(e){return t.autoConfigApplier(r,i)}}},[t._v("自动录入 ")]):t._e(),t.showSelectOptionComponent?t._e():a("span",[t._v(" "+t._s(t.tableData[i].ips.join(", ")))])]}},{key:"gtidInit",fn:function(e){e.row;var r=e.index;return[a("Input",{staticStyle:{width:"80%"},attrs:{border:!1,placeholder:"请输入binlog拉取位点"},model:{value:t.tableData[r].gtidInit,callback:function(e){t.$set(t.tableData[r],"gtidInit",e)},expression:"tableData[index].gtidInit"}})]}},{key:"concurrency",fn:function(e){e.row;var r=e.index;return[a("InputNumber",{staticStyle:{width:"90%"},attrs:{max:150,min:1,placeholder:""},model:{value:t.tableData[r].concurrency,callback:function(e){t.$set(t.tableData[r],"concurrency",e)},expression:"tableData[index].concurrency"}})]}}])}),a("Modal",{attrs:{title:"请设置 Applier",width:"1200px"},on:{"on-ok":t.batchUpdateAppliers},model:{value:t.batchUpdateModal,callback:function(e){t.batchUpdateModal=e},expression:"batchUpdateModal"}},[a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Form",{attrs:{"label-position":"left","label-width":100}},[a("FormItem",{attrs:{label:"Applier"}},[a("Select",{staticStyle:{width:"250px"},attrs:{transfer:!0,multiple:"",placeholder:"选择源集群Applier"},model:{value:t.target.ips,callback:function(e){t.$set(t.target,"ips",e)},expression:"target.ips"}},t._l(t.applierResourceList,(function(e){return a("Option",{key:e.ip,attrs:{value:e.ip}},[t._v(t._s(e.ip)+" —— "+t._s(e.az)+" ")])})),1)],1),a("FormItem",{attrs:{label:"初始同步位点"}},[a("Input",{staticStyle:{width:"80%"},attrs:{border:!1,placeholder:"请输入binlog拉取位点"},model:{value:t.target.gtid,callback:function(e){t.$set(t.target,"gtid",e)},expression:"target.gtid"}})],1)],1),a("p",[a("span",[t._v("共 ")]),a("span",{staticStyle:{color:"red","font-size":"16px","word-break":"break-all","word-wrap":"break-word"}},[t._v(t._s(this.updateData.length))]),a("span",[t._v(" 行数据")])]),[a("Table",{staticStyle:{"margin-top":"20px"},attrs:{stripe:"",columns:t.updateColumns,data:t.updateData,border:""}})]],2)]),a("Modal",{attrs:{title:"console路由规则配置",width:"1600px",closable:!1,"footer-hide":!0},model:{value:t.mhaRouteModal,callback:function(e){t.mhaRouteModal=e},expression:"mhaRouteModal"}},[a("div",{style:{padding:"1px 1px",height:"100%"}},[a("p",[a("span",{staticStyle:{"margin-top":"10px",color:"#464c5b","font-weight":"600"}},[t._v(t._s(t.initInfo.dstMhaName)+"("+t._s(t.initInfo.dstDc)+")")])]),a("br"),a("p",[a("span",{staticStyle:{"margin-top":"20px",color:"#464c5b","font-weight":"600"}},[t._v("当前关联路由规则")])]),[a("Table",{staticStyle:{"margin-top":"0","margin-bottom":"20px"},attrs:{stripe:"",columns:t.mhaRouteColumns,data:t.mhaRoutes,border:""}})],a("br"),a("p",[a("span",{staticStyle:{"margin-top":"20px",color:"#464c5b","font-weight":"600"}},[t._v("勾选路由规则")])]),[a("Table",{staticStyle:{"margin-top":"0"},attrs:{stripe:"",columns:t.mhaRouteColumns1,data:t.routeData,border:""},on:{"on-selection-change":t.changeMhaRouteSelection}})],a("Row",{staticStyle:{"margin-top":"20px",background:"#fdfdff",display:"flex","justify-content":"flex-start","align-items":"center"}},[a("Col",{staticStyle:{display:"flex",margin:"5px"}},[a("Button",{staticStyle:{"margin-left":"1px","text-align":"right"},attrs:{loading:t.submitMhaRouteLoading},on:{click:function(e){return t.clearMhaRouteModal()}}},[t._v(" 取消 ")])],1),a("Col",{staticStyle:{display:"flex",margin:"5px"}},[a("Button",{staticStyle:{"margin-left":"1px","text-align":"right"},attrs:{loading:t.submitMhaRouteLoading,type:"primary"},on:{click:function(e){return t.submitMhaRoute()}}},[t._v(" 提交 ")])],1)],1)],2)]),a("Modal",{attrs:{title:"meta路由规则配置",width:"1600px",closable:!1,"footer-hide":!0},model:{value:t.routeModal,callback:function(e){t.routeModal=e},expression:"routeModal"}},[a("div",{style:{padding:"1px 1px",height:"100%"}},[a("p",[a("span",{staticStyle:{"margin-top":"10px",color:"#464c5b","font-weight":"600"}},[t._v(t._s(t.initInfo.srcMhaName)+"("+t._s(t.initInfo.srcDc)+")==>"+t._s(t.initInfo.dstMhaName)+"("+t._s(t.initInfo.dstDc)+")")])]),[a("Table",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"},attrs:{stripe:"",columns:t.routeColumns,data:t.routeData,border:""},on:{"on-row-click":t.handleRowClick}})],a("p",[a("span",{staticStyle:{"margin-top":"20px"}},[t._v("共 ")]),a("span",{staticStyle:{color:"red","font-size":"16px","word-break":"break-all","word-wrap":"break-word"}},[t._v(t._s(this.mhaDbData.length))]),a("span",[t._v(" 行数据")])]),[a("Table",{staticStyle:{"margin-top":"0"},attrs:{stripe:"",columns:t.mhaDbColumns,data:t.mhaDbData,border:""},on:{"on-selection-change":t.changeDbRouteSelection}})],a("Row",{staticStyle:{"margin-top":"20px",background:"#fdfdff",display:"flex","justify-content":"flex-start","align-items":"center"}},[a("Col",{staticStyle:{display:"flex",margin:"5px"}},[a("Button",{staticStyle:{"margin-left":"1px","text-align":"right"},attrs:{loading:t.submitLoading},on:{click:function(e){return t.clearRouteModal()}}},[t._v(" 取消 ")])],1),a("Col",{staticStyle:{display:"flex",margin:"5px"}},[a("Button",{staticStyle:{"margin-left":"1px","text-align":"right"},attrs:{loading:t.submitLoading,type:"primary"},on:{click:function(e){return t.submitRoute()}}},[t._v(" 提交 ")])],1)],1)],2)])],1)],1)},i=[],n=(a("a4d3"),a("e01a"),a("d28b"),a("99af"),a("4160"),a("caad"),a("a15b"),a("d81d"),a("4ec9"),a("4fad"),a("d3b7"),a("6062"),a("2532"),a("3ca3"),a("159b"),a("ddb0"),a("2909")),o=(a("96cf"),a("1da1")),s=a("53ca"),c=a("2b0e"),l={name:"tables",data:function(){var t=this;return{selectedRow:null,initInfo:{srcMhaName:"",srcMhaId:0,dstMhaName:"",dbReplicationId:0,multiData:[],srcDc:"",dstDc:"",order:!0},dataLoading:!1,applierDataLoading:[],submitted:!1,applierResourceList:[],batchUpdateModal:!1,routeModal:!1,routeModalLoading:!1,mhaRouteModal:!1,mhaRouteModalLoading:!1,submitMhaRouteLoading:!1,submitLoading:!1,rollbackModal:!1,gtidCheck:{mhaApplied:"",dbApplied:[],mhaTarget:""},mhaApplierInitGtid:null,deleteData:[],filters:[],filterMap:{0:"行过滤",1:"字段过滤"},target:{gtid:"",ips:[]},columns:[{type:"selection",width:60,align:"center"},{title:"库名",key:"dbName",width:200},{title:"Applier",slot:"applier",width:500,renderHeader:function(e,a){return e("span",[e("span","Applier 配置 -- "),e("Button",{props:{type:"success",size:"small"},on:{click:function(){t.batchAutoConfigure()}}},"自动录入")])},filters:[{label:"空",value:null},{label:"非空",value:"not null"}],filterMultiple:!1,filterMethod:function(t,e){return t?e.ips&&e.ips.length>0:!e.ips||0===e.ips.length}},{title:"初始同步位点",slot:"gtidInit"},{title:"并发数",width:200,slot:"concurrency"}],updateColumns:[{title:"库名",key:"dbName",width:200},{title:"applier 配置",key:"applier",width:300,render:function(t,e){var a=e.row,r=a.ips;return null===r||0===r.length?t("Tag",{props:{color:"blue"}},"无"):t("span",a.ips.join(", "))}},{title:"初始同步位点",key:"gtidInit",render:function(t,e){var a=e.row,r=a.gtidInit;return null===r||0===r.length?t("Tag",{props:{color:"blue"}},"无"):t("span",r)}}],mhaRouteColumns1:[{type:"selection",width:60,align:"center"},{title:"BU",key:"routeOrgName",width:80},{title:"Console源端机房",key:"srcDcName"},{title:"Replicator目标端机房",key:"dstDcName"},{title:"源端Proxy",key:"srcProxyUris"},{title:"目标Proxy",key:"dstProxyUris"},{title:"中继Proxy",key:"relayProxyUris"}],mhaRouteColumns:[{title:"BU",key:"routeOrgName",width:80},{title:"Console源端机房",key:"srcDcName"},{title:"Replicator目标端机房",key:"dstDcName"},{title:"源端Proxy",key:"srcProxyUris"},{title:"目标Proxy",key:"dstProxyUris"},{title:"中继Proxy",key:"relayProxyUris"}],routeColumns:[{title:"选择",width:100,align:"center",render:function(e,a){return e("Radio",{props:{value:t.selectedRow===a.row},on:{"on-change":function(){t.selectedRow=a.row}}})}},{title:"BU",key:"routeOrgName",width:80},{title:"Applier源端机房",key:"srcDcName"},{title:"Replicator目标端机房",key:"dstDcName"},{title:"源端Proxy",key:"srcProxyUris"},{title:"目标Proxy",key:"dstProxyUris"},{title:"中继Proxy",key:"relayProxyUris"}],mhaDbColumns:[{type:"selection",width:60,align:"center"},{title:"库名",key:"dbName",width:200},{title:"BU",key:"routeOrgName",width:80},{title:"Applier源端机房",key:"srcDcName"},{title:"Replicator目标端机房",key:"dstDcName"},{title:"源端Proxy",key:"srcProxyUris"},{title:"目标Proxy",key:"dstProxyUris"},{title:"中继Proxy",key:"relayProxyUris"}],dbGtidColumns:[{title:"库名",key:"dbName",width:200},{title:"当前同步位点",key:"gtidInit",render:function(t,e){var a=e.row,r=a.gtidInit;return null===r||0===r.length?t("Tag",{props:{color:"blue"}},"无"):t("span",r)}}],updateData:[],mhaDbData:[],routeData:[],multiDbRouteData:[],multiMhaRoutes:[],mhaRoutes:[],propertiesJson:{},tableData:[],dbApplierDtos:[],currentInstances:new Map,applierShowRefreshCounter:0,total:0,size:5,pageSizeOpts:[5,10,20,100]}},methods:{changeMhaRouteSelection:function(t){this.multiMhaRoutes=t,console.log(this.multiMhaRoutes)},changeDbRouteSelection:function(t){this.multiDbRouteData=t,console.log(this.multiDbRouteData)},clearMhaRouteModal:function(){this.multiMhaRoutes=[],this.mhaRoutes=[],this.routeData=[],this.mhaRouteModal=!1},clearRouteModal:function(){this.selectedRow=null,this.multiDbRouteData=[],this.routeData=[],this.mhaDbData=[],this.routeModal=!1},handleRowClick:function(t){null!=this.selectedRow&&this.selectedRow.id===t.id?this.selectedRow=null:this.selectedRow=t},submitMhaRoute:function(){var t=this;if(0!==this.multiMhaRoutes.length){var e=[];this.multiMhaRoutes.forEach((function(t){return e.push(t.id)}));var a={routeIds:e,mhaName:this.initInfo.dstMhaName};this.submitMhaRouteLoading=!0,this.axios.post("/api/drc/v2/meta/routeMappings/mha",a).then((function(e){1===e.data.status?t.$Message.error("配置路由规则失败: "+e.data.message):t.$Message.success("配置路由规则成功")})).catch((function(e){t.$Message.error("配置路由规则失败: "+e)})).finally((function(){t.getMhaRouteMappings(),t.submitMhaRouteLoading=!1,t.multiMhaRoutes=[]}))}else alert("请选择路由规则!")},submitRoute:function(){var t=this;if(null!==this.selectedRow)if(0!==this.multiDbRouteData.length){var e=[];this.multiDbRouteData.forEach((function(t){return e.push(t.mhaDbReplicationId)}));var a={mhaDbReplicationIds:e,routeId:this.selectedRow.id};this.submitLoading=!0,this.axios.post("/api/drc/v2/meta/routeMappings",a).then((function(e){1===e.data.status?t.$Message.error("配置路由规则失败: "+e.data.message):t.$Message.success("配置路由规则成功")})).catch((function(e){t.$Message.error("配置路由规则失败: "+e)})).finally((function(){t.getRouteMappings(),t.submitLoading=!1,t.multiDbRouteData=[]}))}else alert("请选择db!");else alert("请选择路由规则!")},preUpdateRoute:function(){this.routeModal=!0,this.getRouteMappings(),this.getRoutes(),this.multiDbRouteData=[],this.selectedRow=null},preUpdateMhaRoute:function(){this.mhaRouteModal=!0,this.getMhaRouteMappings(),this.getMhaRoutes(),this.multiMhaRoutes=[]},getRoutes:function(){var t=this;this.axios.get("/api/drc/v2/meta/optionalRoutes?srcDcName="+this.initInfo.dstDc+"&dstDcName="+this.initInfo.srcDc).then((function(e){0===e.data.status?t.routeData=e.data.data:t.$Message.error("获取路由规则失败")}))},getMhaRoutes:function(){var t=this;this.axios.get("/api/drc/v2/meta/optionalRoutes/dstDc?dstDcName="+this.initInfo.dstDc).then((function(e){0===e.data.status?t.routeData=e.data.data:t.$Message.error("获取路由规则失败")}))},getRouteMappings:function(){var t=this;this.axios.get("/api/drc/v2/meta/routeMappings?srcMhaName="+this.initInfo.srcMhaName+"&dstMhaName="+this.initInfo.dstMhaName).then((function(e){0===e.data.status?t.mhaDbData=e.data.data:t.$Message.error("获取db复制链路失败")}))},getMhaRouteMappings:function(){var t=this;this.axios.get("/api/drc/v2/meta/routeMappings/mha?mhaName="+this.initInfo.dstMhaName).then((function(e){0===e.data.status?t.mhaRoutes=e.data.data:t.$Message.error("获取mha关联路由规则失败")}))},getSwitchParams:function(){return[{srcMhaName:this.initInfo.srcMhaName,dstMhaName:this.initInfo.dstMhaName,dbNames:this.dbApplierDtos.map((function(t){return t.dbName}))}]},switchAppliers:function(){var t=this,e=this.getSwitchParams();this.dataLoading=!0,this.axios.post("/api/drc/v2/autoconfig/switchAppliers",e).then((function(e){var a=e.data,r=0===a.status;r?(t.submitted=!0,t.$Message.success("提交成功")):t.$Message.warning("提交失败: "+a.message)})).catch((function(e){t.$Message.error("提交异常: "+e)})).finally((function(){t.$Modal.remove(),t.dataLoading=!1,t.getDbAppliers()}))},getFilterText:function(t){},changeSelection:function(t){this.initInfo.multiData=t,console.log(this.initInfo.multiData)},getRole:function(t,e){if(!e||0===e.length)return"";var a=!0,r=!1,i=void 0;try{for(var n,o=e[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var s=n.value;if(s.ip===t)return" — "+(s.master?"Master":"Slave")}}catch(c){r=!0,i=c}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return""},flattenObj:function(t){var e={};for(var a in t)if("object"!==Object(s["a"])(t[a])||Array.isArray(t[a]))e[a]=t[a];else{var r=this.flattenObj(t[a]);for(var i in r)e[a+"."+i]=r[i]}return e},getFilteredData:function(){return this.$refs.multipleTable.makeDataWithSortAndFilter()},autoConfigApplier:function(t,e){var a=this;c["default"].set(this.applierDataLoading,e,!0),this.axios.get("/api/drc/v2/resource/db/auto",{params:{dstMhaName:this.initInfo.dstMhaName,type:1,selectedIps:t.ips?t.ips.join(","):null}}).then((function(r){t.ips=[],r.data.data.forEach((function(e){return t.ips.push(e.ip)})),c["default"].set(a.tableData,e,t)})).catch((function(t){a.$Message.error("提交异常: "+t)})).finally((function(){c["default"].set(a.applierDataLoading,e,!1)}))},preSubmit:function(){var t=this;this.$Modal.confirm({title:"提交确认",content:"您确定要提交么？",onOk:function(){t.submitDbAppliers()}})},preSwitchAppliers:function(){var t=this;this.$Modal.confirm({title:"自动切换Applier",content:"<p>请确认</p>",loading:!0,onOk:function(){t.switchAppliers()}})},submitDbAppliers:function(){var t=this,e={srcBuildParam:{mhaName:this.initInfo.srcMhaName,dbApplierDtos:[]},dstBuildParam:{mhaName:this.initInfo.dstMhaName,dbApplierDtos:this.getFilteredData(),applierInitGtid:this.gtidCheck.mhaTarget}};this.dataLoading=!0,this.axios.post("/api/drc/v2/config/db/applier",e).then(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(a){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=a.data,i=1!==r.status,!i){e.next=9;break}return t.submitted=!0,t.$Message.success("提交成功"),e.next=7,t.getDbAppliers();case 7:e.next=10;break;case 9:t.$Message.warning("提交失败: "+r.message);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$Message.error("提交异常: "+e)})).finally((function(){t.gtidCheck.mhaTarget=null,t.dataLoading=!1}))},batchAutoConfigure:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.tableData.map((function(e,a){return t.autoConfigApplier(e,a)}));case 1:case"end":return e.stop()}}),e)})))()},getResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/db/all",{params:{srcMhaName:this.initInfo.srcMhaName,dstMhaName:this.initInfo.dstMhaName,type:1}}).then((function(e){t.applierResourceList=e.data.data}))},getDbAppliers:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.dataLoading=!0,t.axios.get("/api/drc/v2/config/mha/dbApplier",{params:{srcMhaName:t.initInfo.srcMhaName,dstMhaName:t.initInfo.dstMhaName}}).then((function(e){1===e.data.status?t.$Message.error("查询 db applier 失败!"):(t.tableData=e.data.data,t.dbApplierDtos=e.data.data,t.applierShowRefreshCounter++,t.getDbApplierInstances())})).finally((function(){t.dataLoading=!1}));case 2:case"end":return e.stop()}}),e)})))()},extractApplierIps:function(){var t=[];return this.dbApplierDtos.forEach((function(e){t=t.concat(e.ips)})),Object(n["a"])(new Set(t))},getDbApplierInstances:function(){var t=this,e=this.extractApplierIps();this.axios.get("/api/drc/v2/remote/resource/dbApplierInstances",{params:{src:this.initInfo.srcMhaName,mhaName:this.initInfo.dstMhaName,ips:e.join(",")}}).then((function(e){1===e.data.status?t.$Message.warning("查询 db applier 实例状态失败"):(t.currentInstances=new Map(Object.entries(e.data.data)),t.applierShowRefreshCounter++)}))},preBatchUpdate:function(){var t=this.$refs.multipleTable.getSelection();void 0!==t&&null!==t&&0!==t.length?(this.batchUpdateModal=!0,this.updateData=t,this.target.ips=[],this.target.gtid=""):this.$Message.warning("请勾选！")},batchUpdateAppliers:function(){var t=this,e=this.$refs.multipleTable.getSelection().map((function(t){return t.dbName}));this.tableData.forEach((function(a){e.includes(a.dbName)&&(a.ips=t.target.ips,t.target.gtid&&(a.gtidInit=t.target.gtid))})),this.$Message.warning("修改成功！共修改"+e.length+"行")},clearDeleteDbReplication:function(t,e){this.deleteData=[],this.batchDeleteModal=!1},deleteDbReplication:function(){var t=this,e=[];this.deleteData.forEach((function(t){return e.push(t.dbReplicationId)})),this.axios.delete("/api/drc/v2/config/dbReplications?dbReplicationIds="+e).then((function(e){1===e.data.status?t.$Message.error("删除失败!"+e.data.message):(t.$Message.success("删除成功!"),t.getDbAppliers(),t.initInfo.multiData=[])}))}},created:function(){var t=this;this.axios.get("/api/drc/v2/permission/meta/mhaReplication/modify").then((function(e){403!==e.data.status?(t.initInfo={srcMhaName:t.$route.query.srcMhaName,srcMhaId:t.$route.query.srcMhaId,dstMhaName:t.$route.query.dstMhaName,applierGroupId:t.$route.query.applierGroupId,srcDc:t.$route.query.srcDc,dstDc:t.$route.query.dstDc,order:t.$route.query.order},t.getResources(),t.getDbAppliers()):t.$router.push("/nopermission")}))},computed:{showSelectOptionComponent:function(){return this.tableData.length<=50}}},u=l,p=a("2877"),d=Object(p["a"])(u,r,i,!1,null,"6ca20903",null);e["default"]=d.exports},a15b:function(t,e,a){"use strict";var r=a("23e7"),i=a("44ad"),n=a("fc6a"),o=a("a640"),s=[].join,c=i!=Object,l=o("join",",");r({target:"Array",proto:!0,forced:c||!l},{join:function(t){return s.call(n(this),void 0===t?",":t)}})},a640:function(t,e,a){"use strict";var r=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&r((function(){a.call(null,e||function(){throw 1},1)}))}},ab13:function(t,e,a){var r=a("b622"),i=r("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[i]=!1,"/./"[t](e)}catch(r){}}return!1}},d81d:function(t,e,a){"use strict";var r=a("23e7"),i=a("b727").map,n=a("1dde"),o=a("ae40"),s=n("map"),c=o("map");r({target:"Array",proto:!0,forced:!s||!c},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-4d6e2128.e4b7cb0a.js.map