{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.array.join.js","webpack:///./node_modules/core-js/modules/es.array.map.js","webpack:///./src/components/v2/mhaMessengers/dbMessengers.vue?ca91","webpack:///src/components/v2/mhaMessengers/dbMessengers.vue","webpack:///./src/components/v2/mhaMessengers/dbMessengers.vue?6a70","webpack:///./src/components/v2/mhaMessengers/dbMessengers.vue"],"names":["$","IndexedObject","toIndexedObject","arrayMethodIsStrict","nativeJoin","join","ES3_STRINGS","Object","STRICT_METHOD","target","proto","forced","separator","call","this","undefined","$map","map","arrayMethodHasSpeciesSupport","arrayMethodUsesToLength","HAS_SPECIES_SUPPORT","USES_TO_LENGTH","callbackfn","arguments","length","render","_vm","_h","$createElement","_c","_self","style","margin","position","attrs","_v","path","query","step","mhaName","initInfo","staticClass","padding","background","zIndex","staticStyle","on","$event","batchAutoConfigure","submitted","_e","dataLoading","submitDbAppliers","height","ref","columns","tableData","changeSelection","scopedSlots","_u","key","fn","row","index","model","value","callback","$$v","$set","expression","_l","item","ip","_s","az","autoConfigApplier","staticRenderFns","component"],"mappings":"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kBAAkBb,EAAKC,MAAU,CAACrC,EAAIS,GAAG,aAAa,CAACyB,IAAI,WAAWC,GAAG,SAASP,GAC7mBA,EAAIQ,IAAd,IACIC,EAAQT,EAAIS,MACtB,MAAO,CAAClC,EAAG,QAAQ,CAACK,MAAM,CAAC,QAAS,EAAM,YAAc,iBAAiB8B,MAAM,CAACC,MAAOvC,EAAI8B,UAAUO,GAAe,SAAEG,SAAS,SAAUC,GAAMzC,EAAI0C,KAAK1C,EAAI8B,UAAUO,GAAQ,WAAYI,IAAME,WAAW,wCAAwC,IAAI,IAAI,IACvPO,EAAkB,G,0FC0CtB,GACA,cACA,gBACA,OACA,UACA,mCAEA,eACA,aACA,uBACA,oBACA,cACA,WACA,QACA,UAEA,SACA,CACA,WACA,aACA,WAEA,CACA,gBACA,gBAEA,CACA,iBACA,kBAGA,kBACA,aACA,QACA,OACA,6BAGA,SACA,4BAEA,4BACA,0BACA,sCAEA,4BACA,yBACA,UACA,oBACA,oBAGA,uBACA,SACA,eACA,wDAMA,cANA,CACA,4BACA,eACA,gBAMA,UAEA,oLACA,4CACA,QACA,8BACA,OACA,0CAEA,kBACA,SACA,4DACA,kCACA,oBACA,0CAZA,IAeA,uCACA,GACA,8BACA,8BAEA,oBACA,qDACA,kBACA,aACA,eACA,GACA,eACA,4BAEA,0CAGA,mBACA,gCAEA,oBACA,qBAGA,kLACA,4GADA,IAGA,mCACA,wFACA,kBACA,oBACA,sCAGA,oCACA,oBACA,qDACA,QACA,iCAGA,kBACA,kBACA,sCAEA,2BAEA,oBACA,qBAGA,uCACA,mBACA,0BAEA,0CACA,KACA,yEACA,6FACA,kBACA,0CAEA,4BACA,kBACA,8BAKA,8BACA,sFACA,qBAIA,YACA,gCAEA,yBACA,wBACA,iBACA,mBATA,qCC/MoX,I,YCOhXC,EAAY,eACd,EACApD,EACAmD,GACA,EACA,KACA,WACA,MAIa,aAAAC,E","file":"js/chunk-45452e14.f35faff7.js","sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = [].join;\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin.call(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n// FF49- issue\nvar USES_TO_LENGTH = arrayMethodUsesToLength('map');\n\n// `Array.prototype.map` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('base-component',[_c('Breadcrumb',{style:({margin: '15px 0 15px 185px', position: 'fixed'})},[_c('BreadcrumbItem',{attrs:{\"to\":\"/home\"}},[_vm._v(\"首页\")]),_c('BreadcrumbItem',{attrs:{\"to\":\"/v2/messengersV2\"}},[_vm._v(\"Messenger 同步\")]),_c('BreadcrumbItem',{attrs:{\"to\":{\n          path: '/v2/buildMessengerV2',query :{\n          step: 3,\n          mhaName: _vm.initInfo.mhaName\n        }\n      }}},[_vm._v(\"Messenger 配置 \")]),_c('BreadcrumbItem',[_vm._v(\"Db messenger\")])],1),_c('Content',{staticClass:\"content\",style:({padding: '10px', background: '#fff', margin: '50px 0 1px 185px', zIndex: '1'})},[_c('Row',[_c('Col',{attrs:{\"span\":\"4\"}},[_c('Button',{staticStyle:{\"margin-top\":\"10px\",\"text-align\":\"right\"},attrs:{\"type\":\"primary\",\"ghost\":\"\"},on:{\"click\":function($event){return _vm.batchAutoConfigure()}}},[_vm._v(\"批量配置 applier \")])],1),_c('Col',{attrs:{\"span\":\"2\"}},[(!_vm.submitted)?_c('Button',{staticStyle:{\"margin-top\":\"10px\",\"text-align\":\"right\"},attrs:{\"loading\":_vm.dataLoading,\"type\":\"primary\",\"ghost\":\"\"},on:{\"click\":function($event){return _vm.submitDbAppliers()}}},[_vm._v(\"提交 \")]):_vm._e()],1)],1),_c('div',{style:({padding: '1px 1px',height: '100%'})},[[_c('Table',{ref:\"multipleTable\",staticStyle:{\"margin-top\":\"20px\"},attrs:{\"stripe\":\"\",\"columns\":_vm.columns,\"data\":_vm.tableData,\"loading\":_vm.dataLoading,\"border\":\"\"},on:{\"on-selection-change\":_vm.changeSelection},scopedSlots:_vm._u([{key:\"applier\",fn:function(ref){\n      var row = ref.row;\n      var index = ref.index;\nreturn [_c('Select',{staticStyle:{\"width\":\"250px\"},attrs:{\"transfer\":true,\"multiple\":\"\",\"placeholder\":\"选择源集群Applier\"},model:{value:(_vm.tableData[index].ips),callback:function ($$v) {_vm.$set(_vm.tableData[index], \"ips\", $$v)},expression:\"tableData[index].ips\"}},_vm._l((_vm.applierResourceList),function(item){return _c('Option',{key:item.ip,attrs:{\"value\":item.ip}},[_vm._v(_vm._s(item.ip)+\" —— \"+_vm._s(item.az)+\" \")])}),1),_c('Button',{staticStyle:{\"margin-left\":\"10px\"},attrs:{\"type\":\"success\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.autoConfigApplier(row, index)}}},[_vm._v(\"自动录入\")])]}},{key:\"gtidInit\",fn:function(ref){\n      var row = ref.row;\n      var index = ref.index;\nreturn [_c('Input',{attrs:{\"border\":false,\"placeholder\":\"请输入binlog拉取位点\"},model:{value:(_vm.tableData[index].gtidInit),callback:function ($$v) {_vm.$set(_vm.tableData[index], \"gtidInit\", $$v)},expression:\"tableData[index].gtidInit\"}})]}}])})]],2)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <base-component>\n<!--    todo by yongnian test-->\n    <Breadcrumb :style=\"{margin: '15px 0 15px 185px', position: 'fixed'}\">\n      <BreadcrumbItem to=\"/home\">首页</BreadcrumbItem>\n      <BreadcrumbItem to=\"/v2/messengersV2\">Messenger 同步</BreadcrumbItem>\n      <BreadcrumbItem :to=\"{\n          path: '/v2/buildMessengerV2',query :{\n          step: 3,\n          mhaName: initInfo.mhaName\n        }\n      }\">Messenger 配置\n      </BreadcrumbItem>\n      <BreadcrumbItem>Db messenger</BreadcrumbItem>\n    </Breadcrumb>\n    <Content class=\"content\" :style=\"{padding: '10px', background: '#fff', margin: '50px 0 1px 185px', zIndex: '1'}\">\n      <Row>\n        <Col span=\"4\">\n          <Button style=\"margin-top: 10px;text-align: right\" type=\"primary\" ghost @click=\"batchAutoConfigure()\">批量配置\n            applier\n          </Button>\n        </Col>\n        <Col span=\"2\">\n          <Button :loading=\"dataLoading\" style=\"margin-top: 10px;text-align: right\" type=\"primary\" ghost v-if=\"!submitted\" @click=\"submitDbAppliers()\">提交\n          </Button>\n        </Col>\n      </Row>\n      <div :style=\"{padding: '1px 1px',height: '100%'}\">\n        <template>\n          <Table style=\"margin-top: 20px\" stripe :columns=\"columns\" :data=\"tableData\" :loading=\"dataLoading\" border ref=\"multipleTable\"\n                 @on-selection-change=\"changeSelection\">\n            <template #applier=\"{row, index}\">\n              <Select :transfer=\"true\" v-model=\"tableData[index].ips\" multiple style=\"width: 250px\" placeholder=\"选择源集群Applier\">\n                <Option v-for=\"item in applierResourceList\" :value=\"item.ip\" :key=\"item.ip\">{{ item.ip }} —— {{\n                    item.az\n                  }}\n                </Option>\n              </Select>\n              <Button type=\"success\" size=\"small\"  style=\"margin-left: 10px\" @click=\"autoConfigApplier(row, index)\">自动录入</Button>\n            </template>\n            <template #gtidInit=\"{row, index}\">\n              <Input v-model=\"tableData[index].gtidInit\" :border=\"false\" placeholder=\"请输入binlog拉取位点\"/>\n            </template>\n          </Table>\n        </template>\n      </div>\n    </Content>\n  </base-component>\n</template>\n\n<script>\n\nimport Vue from 'vue'\n\nexport default {\n  name: 'tables',\n  data () {\n    return {\n      initInfo: {\n        mhaName: this.$route.query.mhaName\n      },\n      dataLoading: false,\n      submitted: false,\n      applierResourceList: [],\n      batchDeleteModal: false,\n      deleteData: [],\n      filterMap: {\n        0: '行过滤',\n        1: '字段过滤'\n      },\n      columns: [\n        {\n          title: '库名',\n          key: 'dbName',\n          width: 200\n        },\n        {\n          title: 'Applier',\n          slot: 'applier'\n        },\n        {\n          title: 'gtidInit',\n          slot: 'gtidInit'\n        }\n      ],\n      propertiesJson: {},\n      tableData: [],\n      total: 0,\n      size: 5,\n      pageSizeOpts: [5, 10, 20, 100]\n    }\n  },\n  methods: {\n    getFilterText (val) {\n    },\n    changeSelection (val) {\n      this.initInfo.multiData = val\n      console.log(this.initInfo.multiData)\n    },\n    buildApplierDto (row) {\n      return this.flattenObj([{\n        ips: row.ips,\n        gtidInit: row.gtidInit,\n        dbName: row.dbName\n      }])\n    },\n    flattenObj (ob) {\n      const result = {}\n      for (const i in ob) {\n        if ((typeof ob[i]) === 'object' && !Array.isArray(ob[i])) {\n          const temp = this.flattenObj(ob[i])\n          for (const j in temp) {\n            result[i + '.' + j] = temp[j]\n          }\n        } else {\n          result[i] = ob[i]\n        }\n      }\n      return result\n    },\n    async autoConfigApplier (row, index) {\n      this.axios.get('/api/drc/v2/resource/db/auto', {\n        params: {\n          dstMhaName: this.initInfo.mhaName,\n          type: 1,\n          selectedIps: row.ips ? row.ips.join(',') : null\n        }\n      }).then(response => {\n        row.ips = []\n        response.data.data.forEach(ip => row.ips.push(ip.ip))\n        Vue.set(this.tableData, index, row)\n        this.tableData[index] = row\n      })\n    },\n\n    submitDbAppliers () {\n      const params = {\n        mhaName: this.initInfo.mhaName,\n        dbApplierDtos: this.tableData\n      }\n      this.dataLoading = true\n      this.axios.post('/api/drc/v2/config/db/messenger', params)\n        .then(response => {\n          const data = response.data\n          const success = data.status !== 1\n          if (success) {\n            this.submitted = true\n            this.$Message.success('提交成功')\n          } else {\n            this.$Message.warning('提交失败: ' + data.message)\n          }\n        })\n        .catch(message => {\n          this.$Message.error('提交异常: ' + message)\n        })\n        .finally(() => {\n          this.dataLoading = false\n        })\n    },\n    async batchAutoConfigure () {\n      this.tableData.map((row, index) => this.autoConfigApplier(row, index))\n    },\n    getResources () {\n      this.axios.get('/api/drc/v2/resource/mha/all?mhaName=' + this.initInfo.mhaName + '&type=1')\n        .then(response => {\n          console.log(response.data)\n          this.applierResourceList = response.data.data\n        })\n    },\n    getDbAppliers () {\n      this.dataLoading = true\n      this.axios.get('/api/drc/v2/config/mha/dbMessenger', {\n        params: {\n          mhaName: this.initInfo.mhaName\n        }\n      }\n      ).then(response => {\n        if (response.data.status === 1) {\n          this.$Message.error('查询 db applier 失败!')\n        } else {\n          this.tableData = response.data.data\n        }\n      }).finally(() => {\n        this.dataLoading = false\n      })\n    },\n    clearDeleteDbReplication (row, index) {\n      this.deleteData = []\n      this.batchDeleteModal = false\n    },\n    deleteDbReplication () {\n      const deleteDbReplicationIds = []\n      this.deleteData.forEach(e => deleteDbReplicationIds.push(e.dbReplicationId))\n      this.axios.delete('/api/drc/v2/config/dbReplications?dbReplicationIds=' + deleteDbReplicationIds).then(res => {\n        if (res.data.status === 1) {\n          this.$Message.error('删除失败!' + res.data.message)\n        } else {\n          this.$Message.success('删除成功!')\n          this.getDbAppliers()\n          this.initInfo.multiData = []\n        }\n      })\n    }\n  },\n  created () {\n    this.axios.get('/api/drc/v2/permission/meta/mhaReplication/modify').then((response) => {\n      if (response.data.status === 403) {\n        this.$router.push('/nopermission')\n        return\n      }\n      this.initInfo = {\n        mhaName: this.$route.query.mhaName\n      }\n      console.log('initInfo:')\n      console.log(this.initInfo)\n      this.getResources()\n      this.getDbAppliers()\n    })\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dbMessengers.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dbMessengers.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./dbMessengers.vue?vue&type=template&id=1db56cce&scoped=true&\"\nimport script from \"./dbMessengers.vue?vue&type=script&lang=js&\"\nexport * from \"./dbMessengers.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1db56cce\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}