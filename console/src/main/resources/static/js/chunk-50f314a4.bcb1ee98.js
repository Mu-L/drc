(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50f314a4","chunk-2d0b1ba6"],{"159b":function(t,e,a){"use strict";var r=a("cfe9"),s=a("fdbc"),n=a("785a"),c=a("17c2"),i=a("9112"),o=function(t){if(t&&t.forEach!==c)try{i(t,"forEach",c)}catch(e){t.forEach=c}};for(var l in s)s[l]&&o(r[l]&&r[l].prototype);o(n)},"17c2":function(t,e,a){"use strict";var r=a("b727").forEach,s=a("a640"),n=s("forEach");t.exports=n?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},"20a3":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.hasResp?e("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:t.status,"show-icon":""}},[t._v(" "+t._s(t.title)+" "),e("span",{attrs:{slot:"desc"},domProps:{innerHTML:t._s(t.message)},slot:"desc"})]):t._e(),e("Form",{ref:"build",staticStyle:{"margin-top":"50px"},attrs:{model:t.build,rules:t.ruleBuild,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源Mha集群名",prop:"srcMhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeSrcMha},model:{value:t.build.srcMhaName,callback:function(e){t.$set(t.build,"srcMhaName",e)},expression:"build.srcMhaName"}})],1),e("FormItem",{attrs:{label:"源集群机房区域",prop:"srcDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:t.changeSrcDc},model:{value:t.build.srcDc,callback:function(e){t.$set(t.build,"srcDc",e)},expression:"build.srcDc"}},t._l(t.build.drcZoneList,(function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{label:"源Mha tag",prop:"srcTag"}},[e("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"选择tag"},on:{"on-create":t.handleCreateTag},model:{value:t.build.srcTag,callback:function(e){t.$set(t.build,"srcTag",e)},expression:"build.srcTag"}},t._l(t.tagList,(function(a){return e("Option",{key:a,attrs:{value:a}},[t._v(t._s(a))])})),1)],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"目标Mha集群名",prop:"dstMhaName"}},[e("Input",{attrs:{placeholder:"请输入目标集群名"},on:{input:t.changeDstMha},model:{value:t.build.dstMhaName,callback:function(e){t.$set(t.build,"dstMhaName",e)},expression:"build.dstMhaName"}})],1),e("FormItem",{attrs:{label:"目标集群机房区域",prop:"dstDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:t.changeDstDc},model:{value:t.build.dstDc,callback:function(e){t.$set(t.build,"dstDc",e)},expression:"build.dstDc"}},t._l(t.build.drcZoneList,(function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{label:"目标Mha tag",prop:"dstTag"}},[e("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"选择tag"},on:{"on-create":t.handleCreateTag},model:{value:t.build.dstTag,callback:function(e){t.$set(t.build,"dstTag",e)},expression:"build.dstTag"}},t._l(t.tagList,(function(a){return e("Option",{key:a,attrs:{value:a}},[t._v(t._s(a))])})),1)],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"BU名",prop:"buName"}},[e("Input",{attrs:{placeholder:"请输入BU名，自动绑定route策略"},on:{input:t.changeBu},model:{value:t.build.buName,callback:function(e){t.$set(t.build,"buName",e)},expression:"build.buName"}})],1),e("FormItem",[e("Button",{on:{click:function(e){return t.handleReset("build")}}},[t._v("重置")]),e("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(e){return t.changeModal("build")}}},[t._v("新建DRC同步集群")]),e("Modal",{attrs:{title:"创建DRC"},on:{"on-ok":function(e){return t.postBuild("build")}},model:{value:t.build.modal,callback:function(e){t.$set(t.build,"modal",e)},expression:"build.modal"}},[e("p",[t._v('确定创建新DRC "'+t._s(t.build.srcMhaName)+"("+t._s(t.build.srcDc)+')" -> "'+t._s(t.build.dstMhaName)+"("+t._s(t.build.dstDc)+')" 吗？')])])],1)],1)],1)},s=[],n=(a("14d9"),{name:"mhaBuild",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,build:{modal:!1,srcMhaName:this.srcMhaName,dstMhaName:this.dstMhaName,buName:"",srcDc:this.srcDc,dstDc:this.dstDc,drcZoneList:this.constant.dcList,srcTag:"COMMON",dstTag:"COMMON"},tagList:this.constant.tagList,ruleBuild:{srcMhaName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],dstMhaName:[{required:!0,message:"目标集群名不能为空",trigger:"blur"}],srcDc:[{required:!0,message:"选择源集群区域",trigger:"change"}],dstDc:[{required:!0,message:"选择目标集群区域",trigger:"change"}],buName:[{required:!0,message:"BU名不能为空",trigger:"blur"}]}}},methods:{postBuild:function(t){var e=this,a=this;a.$refs[t].validate((function(t){t?(e.hasResp=!1,a.axios.post("/api/drc/v2/config/mha",{buName:e.build.buName,srcMhaName:e.build.srcMhaName,dstMhaName:e.build.dstMhaName,srcDc:e.build.srcDc,dstDc:e.build.dstDc,srcTag:e.build.srcTag,dstTag:e.build.dstTag}).then((function(t){a.hasResp=!0,0===t.data.status?(a.status="success",a.title="集群创建完成!",a.message=t.data.message):(a.status="error",a.title="集群创建失败!",a.message=t.data.message)}))):a.$Message.error("仍有必填项未填!")}))},handleReset:function(t){this.$refs[t].resetFields()},changeSrcMha:function(){this.$emit("srcMhaNameChanged",this.build.srcMhaName)},changeDstMha:function(){this.$emit("dstMhaNameChanged",this.build.dstMhaName)},changeSrcDc:function(){this.$emit("srcDcChanged",this.build.srcDc)},changeDstDc:function(){this.$emit("dstDcChanged",this.build.dstDc)},changeBu:function(){this.$emit("buNameChanged",this.build.buName)},changeModal:function(t){var e=this;this.$refs[t].validate((function(t){t?e.build.modal=!0:e.$Message.error("仍有必填项未填!")}))},handleCreateTag:function(t){this.constant.tagList.push(t)}}}),c=n,i=a("2877"),o=Object(i["a"])(c,r,s,!1,null,"5c18aab2",null);e["default"]=o.exports},"408a":function(t,e,a){"use strict";var r=a("e330");t.exports=r(1..valueOf)},"53ca":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d28b"),a("d3b7"),a("3ca3"),a("ddb0");function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}},5899:function(t,e,a){"use strict";t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){"use strict";var r=a("e330"),s=a("1d80"),n=a("577e"),c=a("5899"),i=r("".replace),o=RegExp("^["+c+"]+"),l=RegExp("(^|[^"+c+"])["+c+"]+$"),u=function(t){return function(e){var a=n(s(e));return 1&t&&(a=i(a,o,"")),2&t&&(a=i(a,l,"$1")),a}};t.exports={start:u(1),end:u(2),trim:u(3)}},9163:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("base-component",[e("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[e("BreadcrumbItem",{attrs:{to:{path:"/v2/mhaReplications",query:{srcMhaName:this.clusterPair.srcMhaName,dstMhaName:this.clusterPair.dstMhaName,preciseSearchMode:!0}}}},[t._v("首页 ")]),e("BreadcrumbItem",{attrs:{to:"/v2/mhaDbReplications"}},[t._v("DB 复制链路")]),e("BreadcrumbItem",{attrs:{to:"/drcV2"}},[t._v("DRC-MHA 配置")])],1),e("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[[e("Steps",{staticStyle:{width:"90%","margin-left":"50px","margin-bottom":"15px","margin-top":"50px"},attrs:{current:t.current}},[e("Step",{style:{cursor:"pointer"},attrs:{title:"新建DRC集群",content:"新建同步DRC"},nativeOn:{click:function(e){return t.jumpTo(0)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"mha配置",content:"mha录入db信息"},nativeOn:{click:function(e){return t.jumpTo(1)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"预检测",content:"检测mha配置"},nativeOn:{click:function(e){return t.jumpTo(2)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"建立同步",content:"配置Replicator和Applier实例"},nativeOn:{click:function(e){return t.jumpTo(3)}}})],1)],0===t.current?e("mhaBuild",t._b({on:{srcMhaNameChanged:t.updateSrcMha,dstMhaNameChanged:t.updateDstMha,dstDcChanged:t.updateDstDc,srcDcChanged:t.updateSrcDc}},"mhaBuild",t.clusterPair,!1)):t._e(),1===t.current?e("mha-config-v2",t._b({on:{envChanged:t.updateEnv,srcMhaNameChanged:t.updateSrcMha,dstMhaNameChanged:t.updateDstMha}},"mha-config-v2",t.clusterPair,!1)):t._e(),2===t.current?e("pre-check-v2",t._b({},"pre-check-v2",t.clusterPair,!1)):t._e(),3===t.current?e("drc-build-v2",t._b({on:{envChanged:t.updateEnv,srcMhaNameChanged:t.updateSrcMha,dstMhaNameChanged:t.updateDstMha}},"drc-build-v2",t.clusterPair,!1)):t._e(),e("Divider")],2)],1)},s=[],n=(a("14d9"),a("a9e3"),a("20a3")),c=function(){var t=this,e=t._self._c;return e("div",[t.hasResp?e("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:t.status,"show-icon":""}},[t._v(" "+t._s(t.title)+" "),e("span",{attrs:{slot:"desc"},domProps:{innerHTML:t._s(t.message)},slot:"desc"})]):t._e(),e("Row",[e("i-col",{attrs:{span:"12"}},[e("Form",{ref:"srcMha",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.srcMha,rules:t.ruleMhaMachine,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeSrcMha},model:{value:t.srcMha.mhaName,callback:function(e){t.$set(t.srcMha,"mhaName",e)},expression:"srcMha.mhaName"}})],1),e("FormItem",{attrs:{label:"添加Ip",prop:"ip"}},[e("Input",{attrs:{number:"",placeholder:"请输入录入DB的IP"},model:{value:t.srcMha.ip,callback:function(e){t.$set(t.srcMha,"ip",e)},expression:"srcMha.ip"}})],1),e("FormItem",{attrs:{label:"Port",prop:"port"}},[e("Input",{attrs:{placeholder:"请输入录入DB端口"},model:{value:t.srcMha.port,callback:function(e){t.$set(t.srcMha,"port",e)},expression:"srcMha.port"}})],1),e("FormItem",{attrs:{label:"DB机房",prop:"srcDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择db机房区域"},model:{value:t.srcMha.idc,callback:function(e){t.$set(t.srcMha,"idc",e)},expression:"srcMha.idc"}},t._l(t.selectOption.drcZoneList,(function(a){return e("Option",{key:a.label,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{label:"UUID",prop:"uuid"}},[e("Input",{attrs:{placeholder:"请输入录入DB的uuid"},model:{value:t.srcMha.uuid,callback:function(e){t.$set(t.srcMha,"uuid",e)},expression:"srcMha.uuid"}}),e("Button",{on:{click:t.querySrcMhaUuid}},[t._v("连接查询")]),t.hasTest1?e("span",[e("Icon",{attrs:{type:t.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess1?"green":"red"}}),t._v(" "+t._s(t.testSuccess1?"连接查询成功":"连接查询失败，请手动输入uuid")+" ")],1):t._e()],1),e("FormItem",{attrs:{label:"Master",prop:"master"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否为Master"},model:{value:t.srcMha.master,callback:function(e){t.$set(t.srcMha,"master",e)},expression:"srcMha.master"}},t._l(t.selectOption.isMaster,(function(a){return e("Option",{key:a.key,attrs:{value:a.value}},[t._v(t._s(a.key))])})),1)],1),e("FormItem",[e("Button",{attrs:{type:"primary"},on:{click:function(e){t.preChecksrcMha("srcMha")}}},[t._v("录入DB")]),e("br"),e("br")],1)],1)],1),e("i-col",{attrs:{span:"12"}},[e("Form",{ref:"dstMha",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.dstMha,rules:t.ruleMhaMachine,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"mhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeDstMha},model:{value:t.dstMha.mhaName,callback:function(e){t.$set(t.dstMha,"mhaName",e)},expression:"dstMha.mhaName"}})],1),e("FormItem",{attrs:{label:"添加Ip",prop:"ip"}},[e("Input",{attrs:{placeholder:"请输入录入DB的IP"},model:{value:t.dstMha.ip,callback:function(e){t.$set(t.dstMha,"ip",e)},expression:"dstMha.ip"}})],1),e("FormItem",{attrs:{label:"Port",prop:"port"}},[e("Input",{attrs:{number:"",placeholder:"请输入录入DB端口"},model:{value:t.dstMha.port,callback:function(e){t.$set(t.dstMha,"port",e)},expression:"dstMha.port"}})],1),e("FormItem",{attrs:{label:"DB机房",prop:"dstDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择db机房区域"},model:{value:t.dstMha.idc,callback:function(e){t.$set(t.dstMha,"idc",e)},expression:"dstMha.idc"}},t._l(t.selectOption.drcZoneList,(function(a){return e("Option",{key:a.label,attrs:{boolean:"",value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{label:"UUID",prop:"uuid"}},[e("Input",{attrs:{placeholder:"请输入录入DB的uuid"},model:{value:t.dstMha.uuid,callback:function(e){t.$set(t.dstMha,"uuid",e)},expression:"dstMha.uuid"}}),e("Button",{on:{click:t.queryDstMhaUuid}},[t._v("连接查询")]),t.hasTest2?e("span",[e("Icon",{attrs:{type:t.testSuccess2?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess2?"green":"red"}}),t._v(" "+t._s(t.testSuccess2?"连接查询成功":"连接查询失败，请手动输入uuid")+" ")],1):t._e()],1),e("FormItem",{attrs:{label:"Master",prop:"master"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否为Master"},model:{value:t.dstMha.master,callback:function(e){t.$set(t.dstMha,"master",e)},expression:"dstMha.master"}},t._l(t.selectOption.isMaster,(function(a){return e("Option",{key:a.key,attrs:{value:a.value}},[t._v(t._s(a.key))])})),1)],1),e("FormItem",[e("Button",{attrs:{type:"primary"},on:{click:function(e){t.preCheckdstMha("dstMha")}}},[t._v("录入DB")]),e("br"),e("br")],1)],1)],1)],1),e("Modal",{attrs:{title:"录入左侧Mha Db信息"},on:{"on-ok":t.submitsrcMha},model:{value:t.srcMha.modal,callback:function(e){t.$set(t.srcMha,"modal",e)},expression:"srcMha.modal"}},[e("p",[t._v("Mha: "+t._s(t.srcMha.mhaName)+" ")]),e("p",[t._v(" db信息 [host: "+t._s(t.srcMha.ip)+":"+t._s(t.srcMha.port)+"]")]),e("p",[t._v(" db信息 [isMaster:"+t._s(t.srcMha.master)+"]")]),e("p",[t._v(" db信息 [idc:"+t._s(t.srcMha.idc)+"]")]),e("p",[t._v(" db信息 [uuid:"+t._s(t.srcMha.uuid)+"]")])]),e("Modal",{attrs:{title:"录入右侧Mha Db信息"},on:{"on-ok":t.submitdstMha},model:{value:t.dstMha.modal,callback:function(e){t.$set(t.dstMha,"modal",e)},expression:"dstMha.modal"}},[e("p",[t._v("Mha: "+t._s(t.dstMha.mhaName)+" ")]),e("p",[t._v(" db信息 [host: "+t._s(t.dstMha.ip)+":"+t._s(t.dstMha.port)+"]")]),e("p",[t._v(" db信息 [isMaster:"+t._s(t.dstMha.master)+"]")]),e("p",[t._v(" db信息 [idc:"+t._s(t.dstMha.idc)+"]")]),e("p",[t._v(" db信息 [uuid:"+t._s(t.dstMha.uuid)+"]")])])],1)},i=[],o=(a("d9e2"),a("ac1f"),a("00b4"),{name:"mhaConfig",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String},data:function(){var t=function(t,e,a){if(!/^[0-9]+$/.test(e))return a(new Error("请填写整数port"));a()},e=function(t,e,a){if(!/0|1/.test(e))return a(new Error("请填写整数port"));a()};return{result:"",status:"",title:"",message:"",hasResp:!1,hasTest1:!1,testSuccess1:!1,hasTest2:!1,testSuccess2:!1,srcMha:{modal:!1,mhaName:this.srcMhaName,zoneId:this.srcDc,ip:"",port:"",idc:this.srcDc,uuid:"",master:1},dstMha:{modal:!1,mhaName:this.dstMhaName,zoneId:this.dstDc,ip:"",port:"",idc:this.dstDc,uuid:"",master:1},ruleMhaMachine:{mhaName:[{required:!0,message:"mha集群名不能为空",trigger:"blur"}],ip:[{required:!0,message:"ip不能为空",trigger:"blur"}],port:[{required:!0,validator:t,trigger:"blur"}],idc:[{required:!0,message:"选择db区域",trigger:"blur"}],uuid:[{required:!0,message:"uuid不能为空",trigger:"blur"}],master:[{required:!0,validator:e,trigger:"blur"}]},selectOption:{isMaster:[{key:"Master",value:1},{key:"Slave",value:0}],drcZoneList:this.constant.dcList}}},methods:{changeSrcMha:function(){this.$emit("srcMhaNameChanged",this.srcMha.mhaName)},changeDstMha:function(){this.$emit("dstMhaNameChanged",this.dstMha.mhaName)},querySrcMhaUuid:function(){var t=this,e=this;e.axios.get("/api/drc/v2/mha/uuid?mhaName="+this.srcMha.mhaName+"&ip="+this.srcMha.ip+"&port="+this.srcMha.port+"&master="+this.srcMha.master).then((function(e){t.hasTest1=!0,0===e.data.status?(t.srcMha.uuid=e.data.data,t.testSuccess1=!0):t.testSuccess1=!1}))},queryDstMhaUuid:function(){var t=this,e=this;e.axios.get("/api/drc/v2/mha/uuid?mhaName="+this.dstMha.mhaName+"&ip="+this.dstMha.ip+"&port="+this.dstMha.port+"&master="+this.dstMha.master).then((function(e){t.hasTest2=!0,0===e.data.status?(t.dstMha.uuid=e.data.data,t.testSuccess2=!0):t.testSuccess2=!1}))},preChecksrcMha:function(t){var e=this;this.$refs[t].validate((function(t){t?e.srcMha.modal=!0:e.$Message.error("仍有必填项未填!")}))},submitsrcMha:function(){var t=this,e=this;e.axios.post("/api/drc/v2/mha/machineInfo",{mhaName:this.srcMha.mhaName,master:this.srcMha.master,mySQLInstance:{ip:this.srcMha.ip,port:this.srcMha.port,idc:this.srcMha.idc,uuid:this.srcMha.uuid}}).then((function(a){e.hasResp=!0,0===a.data.status?(e.status="success",e.title="mha:"+t.srcMha.mhaName+"录入db成功!",e.message=a.data.message):(e.status="error",e.title="mha:"+t.srcMha.mhaName+"录入db失败!",e.message=a.data.message)}))},preCheckdstMha:function(t){var e=this;this.$refs[t].validate((function(t){t?e.dstMha.modal=!0:e.$Message.error("仍有必填项未填!")}))},submitdstMha:function(){var t=this,e=this;e.axios.post("/api/drc/v2/mha/machineInfo",{mhaName:this.dstMha.mhaName,master:this.dstMha.master,mySQLInstance:{ip:this.dstMha.ip,port:this.dstMha.port,idc:this.dstMha.idc,uuid:this.dstMha.uuid}}).then((function(a){e.hasResp=!0,0===a.data.status?(e.status="success",e.title="mha:"+t.dstMha.mhaName+"录入db成功!",e.message=a.data.message):(e.status="error",e.title="mha:"+t.dstMha.mhaName+"录入db失败!",e.message=a.data.message)}))}}}),l=o,u=a("2877"),d=Object(u["a"])(l,c,i,!1,null,"5664688c",null),h=d.exports,m=function(){var t=this,e=t._self._c;return e("div",[e("Row",[e("i-col",{attrs:{span:"12"}},[e("Form",{staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.srcMha,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{readonly:"",placeholder:"请输入源集群名"},model:{value:t.srcMha.mhaName,callback:function(e){t.$set(t.srcMha,"mhaName",e)},expression:"srcMha.mhaName"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.checkMySqlConfig(t.srcMha)}}},[t._v("配置校验")])],1)],1)],1),e("FormItem",{attrs:{label:"同步表",prop:"ip"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{placeholder:"支持正则，默认全部"},model:{value:t.srcMha.nameFilter,callback:function(e){t.$set(t.srcMha,"nameFilter",e)},expression:"srcMha.nameFilter"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.checkMySqlTables(t.srcMha)}}},[t._v("表校验")])],1)],1)],1)],1)],1),e("i-col",{attrs:{span:"12"}},[e("Form",{staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.dstMha,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"目标集群名",prop:"dstMhaName"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{readonly:"",placeholder:"请输入源集群名"},model:{value:t.dstMha.mhaName,callback:function(e){t.$set(t.dstMha,"mhaName",e)},expression:"dstMha.mhaName"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.checkMySqlConfig(t.dstMha)}}},[t._v("配置校验")])],1)],1)],1),e("FormItem",{attrs:{label:"同步表",prop:"ip"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{placeholder:"支持正则，默认全部"},model:{value:t.dstMha.nameFilter,callback:function(e){t.$set(t.dstMha,"nameFilter",e)},expression:"dstMha.nameFilter"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.checkMySqlTables(t.dstMha)}}},[t._v("表校验")])],1)],1)],1)],1)],1)],1),e("Modal",{attrs:{title:"预检测结果",width:"900px"},model:{value:t.configCheck.modal,callback:function(e){t.$set(t.configCheck,"modal",e)},expression:"configCheck.modal"}},[e("Form",{staticStyle:{width:"100%"}},[e("FormItem",{attrs:{label:"BINLOG [SHOULD BE: ON]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogMode,callback:function(e){t.$set(t.configCheck,"binlogMode",e)},expression:"configCheck.binlogMode"}})],1),e("FormItem",{attrs:{label:"BINLOG_FORMAT  [SHOULD BE: ROW]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogFormat,callback:function(e){t.$set(t.configCheck,"binlogFormat",e)},expression:"configCheck.binlogFormat"}})],1),e("FormItem",{attrs:{label:"binlogVersion1  [SHOULD BE: OFF]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogVersion1,callback:function(e){t.$set(t.configCheck,"binlogVersion1",e)},expression:"configCheck.binlogVersion1"}})],1),e("FormItem",{attrs:{label:"BTD [SHOULD BE: writeSet]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogTransactionDependency,callback:function(e){t.$set(t.configCheck,"binlogTransactionDependency",e)},expression:"configCheck.binlogTransactionDependency"}})],1),e("FormItem",{attrs:{label:"BinlogRowImage [SHOULD BE: FULL]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogRowImage,callback:function(e){t.$set(t.configCheck,"binlogRowImage",e)},expression:"configCheck.binlogRowImage"}})],1),e("FormItem",{attrs:{label:"BTDHS [SHOULD BE: 100k]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogTransactionDependencyHistorySize,callback:function(e){t.$set(t.configCheck,"binlogTransactionDependencyHistorySize",e)},expression:"configCheck.binlogTransactionDependencyHistorySize"}})],1),e("FormItem",{attrs:{label:"GTID_MODE [SHOULD BE: ON]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.gtidMode,callback:function(e){t.$set(t.configCheck,"gtidMode",e)},expression:"configCheck.gtidMode"}})],1),e("FormItem",{attrs:{label:"DRC系统表数量 [SHOULD BE: 1/2]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.drcTables,callback:function(e){t.$set(t.configCheck,"drcTables",e)},expression:"configCheck.drcTables"}})],1),e("FormItem",{attrs:{label:"自增步长"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.autoIncrementStep,callback:function(e){t.$set(t.configCheck,"autoIncrementStep",e)},expression:"configCheck.autoIncrementStep"}})],1),e("FormItem",{attrs:{label:"自增offSet"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.autoIncrementOffset,callback:function(e){t.$set(t.configCheck,"autoIncrementOffset",e)},expression:"configCheck.autoIncrementOffset"}})],1),e("FormItem",{attrs:{label:"DRC3对帐号 [SHOULD BE: three accounts ready]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.drcAccounts,callback:function(e){t.$set(t.configCheck,"drcAccounts",e)},expression:"configCheck.drcAccounts"}})],1)],1)],1),e("Modal",{attrs:{title:"表检验",width:"1000px"},model:{value:t.tablesCheckModal,callback:function(e){t.tablesCheckModal=e},expression:"tablesCheckModal"}},[e("Card",[e("div",{attrs:{slot:"title"},slot:"title"},[e("span",[t._v("相关表")])]),e("Table",{attrs:{stripe:"",columns:t.columns,data:t.dataWithPage,border:""}}),e("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[e("Page",{attrs:{transfer:!0,total:t.tableData.length,current:t.current,"page-size-opts":t.pageSizeOpts,"page-size":this.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(e){t.current=e},"on-page-size-change":t.handleChangeSize}})],1)],1)],1)],1)},p=[],f=a("2909"),b=(a("fb6a"),{name:"preCheckV2",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String,env:String},data:function(){return{srcMha:{mhaName:this.srcMhaName,nameFilter:""},dstMha:{mhaName:this.dstMhaName,nameFilter:""},configCheck:{binlogMode:"",binlogFormat:"",binlogVersion1:"",binlogTransactionDependency:"",binlogRowImage:"",binlogTransactionDependencyHistorySize:0,gtidMode:"",drcTables:0,autoIncrementStep:0,autoIncrementOffset:0,drcAccounts:"",modal:!1},tablesCheckModal:!1,tableData:[],columns:[{title:"序号",width:75,align:"center",fixed:"left",render:function(t,e){return t("span",e.index+1)}},{title:"库名",key:"schema"},{title:"表名",key:"table"},{title:"无OnUpdate字段",key:"noOnUpdateColumn",width:100,align:"center",render:function(t,e){var a=e.row,r=a.noOnUpdateColumn?"True":"";return t("span",r)}},{title:"无OnUpdate字段索引",key:"noOnUpdateKey",width:100,align:"center",render:function(t,e){var a=e.row,r=a.noOnUpdateKey?"True":"";return t("span",r)}},{title:"无PkUk",key:"noPkUk",width:100,align:"center",render:function(t,e){var a=e.row,r=a.noPkUk?"True":"";return t("span",r)}},{title:"支持Truncate",key:"approveTruncate",width:100,align:"center",render:function(t,e){var a=e.row,r=a.approveTruncate?"True":"";return t("span",r)}},{title:"存在DefaultTime为0",key:"timeDefaultZero",width:100,align:"center",render:function(t,e){var a=e.row,r=a.timeDefaultZero?"True":"";return t("span",r)}},{title:"结果",width:100,align:"center",render:function(t,e){var a=e.row,r=a.noOnUpdateColumn||a.noOnUpdateKey||a.noPkUk||a.approveTruncate||a.timeDefaultZero,s=r?"volcano":"green",n=r?"错误":"正常";return t("Tag",{props:{color:s}},n)}}],total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}},computed:{dataWithPage:function(){var t=this.tableData,e=this.current*this.size-this.size,a=e+this.size;return Object(f["a"])(t).slice(e,a)}},methods:{checkMySqlConfig:function(t){var e=this;this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{size:18}}),t("div","检测中，请稍等...")])}}),this.axios.get("/api/drc/v2/mysql/preCheckMySqlConfig?mha="+t.mhaName).then((function(t){console.log(t);var a=t.data.data;console.log(a),e.configCheck.binlogMode=a.binlogMode,e.configCheck.binlogFormat=a.binlogFormat,e.configCheck.binlogVersion1=a.binlogVersion1,e.configCheck.binlogTransactionDependency=a.binlogTransactionDependency,e.configCheck.binlogRowImage=a.binlogRowImage,e.configCheck.binlogTransactionDependencyHistorySize=a.binlogTransactionDependencyHistorySize,e.configCheck.gtidMode=a.gtidMode,e.configCheck.drcTables=a.drcTables,e.configCheck.autoIncrementStep=a.autoIncrementStep,e.configCheck.autoIncrementOffset=a.autoIncrementOffset,e.configCheck.drcAccounts=a.drcAccounts,e.$Spin.hide(),e.configCheck.modal=!0}))},checkMySqlTables:function(t){var e=this;this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{size:18}}),t("div","检测中，请稍等...")])}}),setTimeout((function(){e.$Spin.hide()}),8e4),this.axios.get("/api/drc/v2/mysql/preCheckMySqlTables?mha="+t.mhaName+"&nameFilter="+t.nameFilter).then((function(t){e.tableData=t.data.data,e.$Spin.hide(),e.tablesCheckModal=!0}))},handleChangeSize:function(t){this.size=t}}}),g=b,M=Object(u["a"])(g,m,p,!1,null,"157db0b6",null),v=M.exports,y=a("471e"),k={components:{mhaBuild:n["default"],mhaConfigV2:h,preCheckV2:v,drcBuildV2:y["a"]},props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String,env:String},data:function(){return{current:0,clusterPair:{srcMhaName:"",dstMhaName:"",env:"",srcDc:"",dstDc:""}}},methods:{jumpTo:function(t){this.current=t,this.hasResp=!1},next:function(){this.current=this.current+1,this.hasResp=!1},prev:function(){this.current=this.current-1,this.hasResp=!1},updateSrcMha:function(t){this.clusterPair.srcMhaName=t},updateDstMha:function(t){this.clusterPair.dstMhaName=t},updateSrcDc:function(t){this.clusterPair.srcDc=t},updateDstDc:function(t){this.clusterPair.dstDc=t},updateEnv:function(t){this.clusterPair.env=t}},created:function(){var t=this;this.axios.get("/api/drc/v2/permission/meta/mhaReplication/modify").then((function(e){if(403!==e.data.status){var a=t.$route.query.step;"undefined"===typeof a?console.log("curStep undefined, do nothing"):t.jumpTo(Number(a));var r=t.$route.query.order;null==r?(console.log("order is null, do nothing"),t.clusterPair.srcMhaName=t.$route.query.srcMhaName,t.clusterPair.dstMhaName=t.$route.query.dstMhaName,t.clusterPair.srcDc=t.$route.query.srcDc,t.clusterPair.dstDc=t.$route.query.dstDc):r?(t.clusterPair.srcMhaName=t.$route.query.srcMhaName,t.clusterPair.dstMhaName=t.$route.query.dstMhaName,t.clusterPair.srcDc=t.$route.query.srcDc,t.clusterPair.dstDc=t.$route.query.dstDc):(t.clusterPair.srcMhaName=t.$route.query.dstMhaName,t.clusterPair.dstMhaName=t.$route.query.srcMhaName)}else t.$router.push("/nopermission")}))}},S=k,N=Object(u["a"])(S,r,s,!1,null,"72e723de",null);e["default"]=N.exports},a15b:function(t,e,a){"use strict";var r=a("23e7"),s=a("e330"),n=a("44ad"),c=a("fc6a"),i=a("a640"),o=s([].join),l=n!==Object,u=l||!i("join",",");r({target:"Array",proto:!0,forced:u},{join:function(t){return o(c(this),void 0===t?",":t)}})},a640:function(t,e,a){"use strict";var r=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&r((function(){a.call(null,e||function(){return 1},1)}))}},a9e3:function(t,e,a){"use strict";var r=a("23e7"),s=a("c430"),n=a("83ab"),c=a("cfe9"),i=a("428f"),o=a("e330"),l=a("94ca"),u=a("1a2d"),d=a("7156"),h=a("3a9b"),m=a("d9b5"),p=a("c04e"),f=a("d039"),b=a("241c").f,g=a("06cf").f,M=a("9bf2").f,v=a("408a"),y=a("58a8").trim,k="Number",S=c[k],N=i[k],D=S.prototype,I=c.TypeError,C=o("".slice),x=o("".charCodeAt),_=function(t){var e=p(t,"number");return"bigint"==typeof e?e:w(e)},w=function(t){var e,a,r,s,n,c,i,o,l=p(t,"number");if(m(l))throw new I("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=y(l),e=x(l,0),43===e||45===e){if(a=x(l,2),88===a||120===a)return NaN}else if(48===e){switch(x(l,1)){case 66:case 98:r=2,s=49;break;case 79:case 111:r=8,s=55;break;default:return+l}for(n=C(l,2),c=n.length,i=0;i<c;i++)if(o=x(n,i),o<48||o>s)return NaN;return parseInt(n,r)}return+l},T=l(k,!S(" 0o1")||!S("0b1")||S("+0x1")),$=function(t){return h(D,t)&&f((function(){v(t)}))},F=function(t){var e=arguments.length<1?0:S(_(t));return $(this)?d(Object(e),this,F):e};F.prototype=D,T&&!s&&(D.constructor=F),r({global:!0,constructor:!0,wrap:!0,forced:T},{Number:F});var O=function(t,e){for(var a,r=n?b(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),s=0;r.length>s;s++)u(e,a=r[s])&&!u(t,a)&&M(t,a,g(e,a))};s&&N&&O(i[k],N),(T||s)&&O(i[k],S)},b85c:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));a("a4d3"),a("e01a"),a("d28b"),a("d9e2"),a("d3b7"),a("3ca3"),a("ddb0");var r=a("06c5");function s(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=Object(r["a"])(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,o=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){o=!0,c=t},f:function(){try{i||null==a["return"]||a["return"]()}finally{if(o)throw c}}}}}}]);
//# sourceMappingURL=chunk-50f314a4.bcb1ee98.js.map