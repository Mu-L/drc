(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-45623684"],{"28ee":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("base-component",[n("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[n("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),n("BreadcrumbItem",{attrs:{to:{path:"/accessV2",query:{step:3,clustername:this.commonInfo.srcMha,newclustername:this.commonInfo.destMha,order:this.commonInfo.order}}}},[t._v("DRC配置")]),n("BreadcrumbItem",{attrs:{to:{path:"/tables",query:{srcMha:t.commonInfo.srcMha,srcMhaId:t.commonInfo.srcMhaId,destMha:t.commonInfo.destMha,applierGroupId:t.commonInfo.applierGroupId,srcDc:t.commonInfo.srcDc,destDc:t.commonInfo.destDc,order:t.commonInfo.order}}}},[t._v("同步表")]),n("BreadcrumbItem",[t._v("配置流程")])],1),n("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[n("span",{staticStyle:{"margin-top":"10px",color:"#464c5b","font-weight":"600"}},[t._v(t._s(t.commonInfo.srcMha)+"("+t._s(t.commonInfo.srcDc)+")==>"+t._s(t.commonInfo.destMha)+"("+t._s(t.commonInfo.destDc)+")")]),[n("Steps",{staticStyle:{width:"90%","margin-left":"50px","margin-bottom":"15px","margin-top":"50px"},attrs:{current:t.currentStep}},[n("Step",{style:{cursor:"pointer"},attrs:{title:"配置表",content:"添加同步表"},nativeOn:{click:function(e){return t.jumpTo(0)}}}),n("Step",{style:{cursor:"pointer"},attrs:{title:"表映射",content:"配置表映射(非必要）"},nativeOn:{click:function(e){return t.jumpTo(1)}}}),n("Step",{style:{cursor:"pointer"},attrs:{title:"字段映射",content:"配置字段映射(非必要）"},nativeOn:{click:function(e){return t.jumpTo(2)}}}),n("Step",{style:{cursor:"pointer"},attrs:{title:"行过滤",content:"配置行过滤（非必要）"},nativeOn:{click:function(e){return t.jumpTo(3)}}}),n("Step",{style:{cursor:"pointer"},attrs:{title:"字段过滤",content:"配置字段过滤(非必要）"},nativeOn:{click:function(e){return t.jumpTo(4)}}}),n("Step",{style:{cursor:"pointer"},attrs:{title:"完成",content:"完成该表同步配置"},nativeOn:{click:function(e){return t.jumpTo(5)}}})],1)],n("Card",{attrs:{"dis-hover":""}},[n("Row",[n("Col",{attrs:{span:"10"}},[n("Card",[n("div",{attrs:{slot:"title"},slot:"title"},[n("span",[t._v("相关表")])]),n("Table",{attrs:{stripe:"",columns:t.nameFilterCheck.columns,data:t.dataWithPage,border:""}}),n("div",[n("Page",{attrs:{transfer:!0,total:t.commonInfo.tableData.length,current:t.nameFilterCheck.current,"page-size-opts":t.nameFilterCheck.pageSizeOpts,"page-size":this.nameFilterCheck.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(e){return t.$set(t.nameFilterCheck,"current",e)},"on-page-size-change":t.handleChangeSize}})],1)],1)],1),n("Col",{attrs:{span:"14"}},[n("Card",[0===t.currentStep?n("div",[n("div",{attrs:{slot:"title"},slot:"title"},[n("span",[t._v("库表配置")])]),n("Form",{ref:"commonInfo",attrs:{model:t.commonInfo,rules:t.ruleInline,"label-width":100}},[n("FormItem",{staticStyle:{width:"350px"},attrs:{prop:"namespace",label:"库名"}},[n("Input",{attrs:{type:"text",placeholder:"请输入库名（支持正则）"},model:{value:t.commonInfo.namespace,callback:function(e){t.$set(t.commonInfo,"namespace",e)},expression:"commonInfo.namespace"}})],1),n("FormItem",{staticStyle:{width:"350px"},attrs:{prop:"name",label:"表名"}},[n("Input",{attrs:{type:"text",placeholder:"请输入表名（支持正则）"},model:{value:t.commonInfo.name,callback:function(e){t.$set(t.commonInfo,"name",e)},expression:"commonInfo.name"}})],1),n("FormItem",[n("Row",[n("Col",{attrs:{span:"10"}},[n("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success"},on:{click:t.checkMysqlTablesInSrcMha}},[t._v("校验")])],1),n("Col",{attrs:{span:"8"}},[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("commonInfo")}}},[t._v("保存")])],1)],1)],1)],1)],1):t._e(),1===t.currentStep?n("table-mapping-config",t._b({},"table-mapping-config",t.commonInfo,!1)):t._e(),2===t.currentStep?n("columns-mapping-config",t._b({},"columns-mapping-config",t.commonInfo,!1)):t._e(),3===t.currentStep?n("rows-filter-config",t._b({},"rows-filter-config",t.commonInfo,!1)):t._e(),4===t.currentStep?n("columns-filter-config",t._b({},"columns-filter-config",t.commonInfo,!1)):t._e(),5===t.currentStep?n("complete",t._b({},"complete",t.commonInfo,!1)):t._e()],1)],1),n("Divider"),n("div",{staticStyle:{padding:"1px 1px",height:"100px","margin-top":"75px"}},[n("div",[t.currentStep>0?n("Button",{staticStyle:{position:"absolute",left:"465px"},attrs:{type:"primary"},on:{click:t.prev}},[t._v(" 上一步 ")]):t._e(),t.currentStep<5?n("Button",{staticStyle:{position:"absolute",left:"790px"},attrs:{type:"primary"},on:{click:t.next}},[t._v(" 下一步 ")]):t._e()],1)])],1)],1)],2)],1)},a=[],r=(n("fb6a"),n("b0c0"),n("a9e3"),n("2909")),i=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"text-align":"center"}},[n("h3",[t._v("表映射配置暂未迁移，请使用老方式！")])])}],c={name:"tableMappingConfig",props:{srcMha:String,destMha:String,applierGroupId:Number,srcDc:String,destDc:String,dataMediaId:Number,namespace:String,name:String,tableData:Array},data:function(){return{}},methods:{handleSubmit:function(){},submitConfig:function(){}}},l=c,m=n("2877"),u=Object(m["a"])(l,i,s,!1,null,"6a54377d",null),d=u.exports,p=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"text-align":"center"}},[n("h3",[t._v("暂不支持字段映射！")])])}],f={name:"columnsMappingConfig",props:{srcMha:String,destMha:String,applierGroupId:Number,srcDc:String,destDc:String,dataMediaId:Number,namespace:String,name:String,tableData:Array},data:function(){return{}},methods:{handleSubmit:function(){},submitConfig:function(){}}},g=f,I=Object(m["a"])(g,p,h,!1,null,"0c59dde0",null),b=I.exports,S=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},C=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"text-align":"center"}},[n("h3",[t._v("行过滤配置暂未迁移，请使用老方式！")])])}],v={name:"rowsFilterConfig",props:{srcMha:String,destMha:String,applierGroupId:Number,srcDc:String,destDc:String,dataMediaId:Number,namespace:String,name:String,tableData:Array},data:function(){return{}},methods:{handleSubmit:function(){},submitConfig:function(){}}},y=v,M=Object(m["a"])(y,S,C,!1,null,"60264f48",null),F=M.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Card",{attrs:{"dis-hover":""}},[n("div",{attrs:{slot:"title"},slot:"title"},[n("span",[t._v("字段过滤配置")])]),n("Form",{ref:"columnsFilterConfig",staticStyle:{"margin-top":"10px"},attrs:{model:t.columnsFilterConfig,"label-width":100}},[n("FormItem",{attrs:{label:"库名"}},[n("Input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:this.namespace,callback:function(e){t.$set(this,"namespace",e)},expression:"this.namespace"}})],1),n("FormItem",{attrs:{label:"表名"}},[n("Input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:this.name,callback:function(e){t.$set(this,"name",e)},expression:"this.name"}})],1),n("FormItem",{attrs:{label:"模式"}},[n("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择行过滤模式"},model:{value:t.columnsFilterConfig.mode,callback:function(e){t.$set(t.columnsFilterConfig,"mode",e)},expression:"columnsFilterConfig.mode"}},t._l(t.modesForChose,(function(e){return n("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),n("FormItem",{attrs:{label:"字段"}},[n("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"选择相关的字段"},on:{"on-create":t.handleCreateColumn},model:{value:t.columnsFilterConfig.columns,callback:function(e){t.$set(t.columnsFilterConfig,"columns",e)},expression:"columnsFilterConfig.columns"}},t._l(t.columnsForChose,(function(e){return n("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),n("FormItem",[n("Row",[n("Col",{attrs:{span:"10"}},[n("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"error"},on:{click:t.deleteConfig}},[t._v("删除")])],1),n("Col",{attrs:{span:"8"}},[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("tableInfo")}}},[t._v("保存")])],1)],1)],1)],1)],1)],1)},x=[],k={name:"columnsFilterConfig",props:{srcMha:String,destMha:String,applierGroupId:Number,srcDc:String,destDc:String,dataMediaId:Number,namespace:String,name:String,tableData:Array},data:function(){return{columnsFilterConfig:{id:0,mode:"",columns:[]},modesForChose:["exclude","include","regex"],columnsForChose:[]}},methods:{handleSubmit:function(){this.submitConfig()},submitConfig:function(){this.axios.post("/api/drc/v1/dataMedia/columnsFilterConfig",{id:this.columnsFilterConfig.id,dataMediaId:this.dataMediaId,mode:this.columnsFilterConfig.mode,columns:this.columnsFilterConfig.columns}).then((function(t){1===t.data.status?alert("提交失败!"):alert("提交成功！")}))},deleteConfig:function(){var t=this;this.axios.delete("/api/drc/v1/dataMedia/columnsFilterConfig/"+this.columnsFilterConfig.id).then((function(e){1===e.data.status?alert("删除失败!"+e.data.data):(t.getConfig(),t.getCommonColumns(),alert("删除成功！"))}))},getConfig:function(){var t=this;console.log(this.applierGroupId),this.axios.get("/api/drc/v1/dataMedia/columnsFilterConfig?dataMediaId="+this.dataMediaId).then((function(e){if(1===e.data.status)alert("查询字段过滤配置失败!");else{var n=e.data.data;null==n||(t.columnsFilterConfig.id=n.id,t.columnsFilterConfig.mode=n.mode,t.columnsForChose=n.columns,t.columnsFilterConfig.columns=n.columns)}}))},getCommonColumns:function(){var t=this;console.log("/api/drc/v1/build/rowsFilter/commonColumns?&mhaName="+this.srcMha+"&namespace="+this.namespace+"&name="+this.name),this.axios.get("/api/drc/v1/build/rowsFilter/commonColumns?&mhaName="+this.srcMha+"&namespace="+this.namespace+"&name="+this.name).then((function(e){1===e.data.status?alert("查询公共列名失败，请手动添加！"+e.data.data):(console.log(e.data.data),t.columnsForChose=e.data.data,0===t.columnsForChose.length&&alert("查询无公共字段！"))}))},handleCreateColumn:function(t){this.contains(this.columnsForChose,t)?alert("已有项禁止创建"):""!==t&&void 0!==t&&null!==t?this.columnsForChose.push(t):alert("字段不能为空")},contains:function(t,e){var n=t.length;while(n--)if(t[n]===e)return!0;return!1}},created:function(){this.getConfig(),this.getCommonColumns()}},w=k,D=Object(m["a"])(w,_,x,!1,null,"ff17fe4a",null),$=D.exports,q=n("62f8"),z={name:"configFlow",components:{tableMappingConfig:d,columnsMappingConfig:b,rowsFilterConfig:F,columnsFilterConfig:$,complete:q["a"]},data:function(){return{currentStep:0,commonInfo:{srcMha:"",srcMhaId:0,destMha:"",applierGroupId:0,srcDc:"",destDc:"",order:!0,dataMediaId:0,namespace:"",name:"",tableData:[]},ruleInline:{namespace:[{required:!0,message:"Please fill in the schema",trigger:"blur"}],name:[{required:!0,message:"Please fill in the table.",trigger:"blur"}]},nameFilterCheck:{columns:[{title:"序号",width:75,align:"center",fixed:"left",render:function(t,e){return t("span",e.index+1)}},{title:"库名",key:"schema",resizable:!0},{title:"表名",key:"table",resizable:!0},{title:"结果",align:"center",render:function(t,e){var n=e.row,o="ok"!==n.res?"volcano":"green",a=n.res;return t("Tag",{props:{color:o}},a)}}],total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}}},methods:{jumpTo:function(t){this.currentStep=t},next:function(){this.currentStep=this.currentStep+1},prev:function(){this.currentStep=this.currentStep-1},handleSubmit:function(){this.commonInfo.dataMediaId,this.submitConfig()},submitConfig:function(){var t=this;console.log(this.commonInfo),this.axios.post("/api/drc/v1/dataMedia/dataMediaConfig",{id:this.commonInfo.dataMediaId,applierGroupId:this.commonInfo.applierGroupId,namespace:this.commonInfo.namespace,name:this.commonInfo.name,type:0,dataMediaSourceId:this.commonInfo.srcMhaId}).then((function(e){1===e.data.status?alert("提交失败!"):(t.commonInfo.dataMediaId=e.data.data,alert("提交成功！"))}))},checkMysqlTablesInSrcMha:function(){this.checkMySqlTables(this.commonInfo.srcMha,this.commonInfo.namespace+"\\."+this.commonInfo.name)},checkMySqlTables:function(t,e){var n=this;console.log("nameFilter:"+e),null==e&&(e=""),this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{size:18}}),t("div","检测中，请稍等...")])}}),setTimeout((function(){n.$Spin.hide()}),8e4),console.log("/api/drc/v1/build/preCheckMySqlTables?mha="+t+"&nameFilter="+e),this.axios.get("/api/drc/v1/build/preCheckMySqlTables?mha="+t+"&nameFilter="+e).then((function(t){n.commonInfo.tableData=t.data.data,n.$Spin.hide()}))},handleChangeSize:function(t){this.size=t}},computed:{dataWithPage:function(){var t=this.commonInfo.tableData,e=this.nameFilterCheck.current*this.nameFilterCheck.size-this.nameFilterCheck.size,n=e+this.nameFilterCheck.size;return Object(r["a"])(t).slice(e,n)}},created:function(){var t=this.$route.query.step;null==t?console.log("curStep is null, do nothing"):this.jumpTo(Number(t)),this.commonInfo={srcMha:this.$route.query.srcMha,srcMhaId:this.$route.query.srcMhaId,destMha:this.$route.query.destMha,applierGroupId:this.$route.query.applierGroupId,srcDc:this.$route.query.srcDc,destDc:this.$route.query.destDc,order:this.$route.query.order,dataMediaId:this.$route.query.dataMediaId,namespace:this.$route.query.namespace,name:this.$route.query.name,tableData:[]},""!==this.commonInfo.namespace&&""!==this.commonInfo.name&&this.checkMysqlTablesInSrcMha(),console.log("commonInfo"),console.log(this.commonInfo)}},T=z,O=Object(m["a"])(T,o,a,!1,null,"0dd213d1",null);e["default"]=O.exports},b0c0:function(t,e,n){var o=n("83ab"),a=n("9bf2").f,r=Function.prototype,i=r.toString,s=/^\s*function ([^ (]*)/,c="name";o&&!(c in r)&&a(r,c,{configurable:!0,get:function(){try{return i.call(this).match(s)[1]}catch(t){return""}}})}}]);
//# sourceMappingURL=chunk-45623684.22c87503.js.map