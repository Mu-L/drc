(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22238a"],{ce4f:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("Tabs",{model:{value:t.tabValue,callback:function(e){t.tabValue=e},expression:"tabValue"}},[a("TabPane",{attrs:{label:"冲突行",name:"rowsLog"}},[t.refresh?a("conflict-rows-log",{attrs:{gtid:t.gtid},on:{tabValueChanged:t.updateTabValue,gtidChanged:t.updateGtid}}):t._e()],1),a("TabPane",{attrs:{label:"冲突事务",name:"trxLog"}},[t.refresh?t._e():a("conflict-trx-log",{attrs:{gtid:t.gtid},on:{tabValueChanged:t.updateTabValue,gtidChanged:t.updateGtid}})],1)],1)],1)],1)},n=[],l=a("61b1"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"1px 1px"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"22"}},[a("Card",{attrs:{padding:5},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("查询条件")]},proxy:!0}])},[a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"8"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"事务id"},on:{"on-enter":t.getTrxData},model:{value:t.queryParam.gtid,callback:function(e){t.$set(t.queryParam,"gtid",e)},expression:"queryParam.gtid"}})],1),a("Col",{attrs:{span:"4"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"源MHA"},on:{"on-enter":t.getTrxData},model:{value:t.queryParam.srcMhaName,callback:function(e){t.$set(t.queryParam,"srcMhaName",e)},expression:"queryParam.srcMhaName"}})],1),a("Col",{attrs:{span:"4"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"目标MHA"},on:{"on-enter":t.getTrxData},model:{value:t.queryParam.dstMhaName,callback:function(e){t.$set(t.queryParam,"dstMhaName",e)},expression:"queryParam.dstMhaName"}})],1),a("Col",{attrs:{span:"3"}},[a("DatePicker",{attrs:{type:"date",editable:t.editable,format:"yyyy-MM-dd",placeholder:"起始日期"},model:{value:t.queryParam.beginHandleTime,callback:function(e){t.$set(t.queryParam,"beginHandleTime",e)},expression:"queryParam.beginHandleTime"}})],1),a("Col",{attrs:{span:"3"}},[a("DatePicker",{attrs:{type:"date",editable:t.editable,placeholder:"结束日期"},model:{value:t.queryParam.endHandleTime,callback:function(e){t.$set(t.queryParam,"endHandleTime",e)},expression:"queryParam.endHandleTime"}})],1),a("Col",{attrs:{span:"2"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"执行结果"},on:{"on-change":t.getTrxData},model:{value:t.queryParam.trxResult,callback:function(e){t.$set(t.queryParam,"trxResult",e)},expression:"queryParam.trxResult"}},t._l(t.resultOpts,(function(e){return a("Option",{key:e.val,attrs:{value:e.val}},[t._v(t._s(e.name))])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"1"}},[a("Button",{attrs:{type:"primary",icon:"ios-search",loading:t.dataLoading},on:{click:t.getTrxData}},[t._v("查询")]),a("Button",{staticStyle:{"margin-top":"20px"},attrs:{icon:"md-refresh"},on:{click:t.resetParam}},[t._v("重置 ")])],1)],1),a("br"),a("Table",{attrs:{stripe:"",border:"",columns:t.columns,data:t.tableData},scopedSlots:t._u([{key:"action",fn:function(e){var r=e.row,n=e.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.queryRowsLog(r,n)}}},[t._v(" 冲突行 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.getLogDetail(r,n)}}},[t._v(" 详情 ")])]}}])}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:t.total,current:t.current,"page-size-opts":[10,20,50,100],"page-size":10,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(e){t.current=e},"on-change":t.getTrxData,"on-page-size-change":t.handleChangeSize}})],1)],1)},s=[],o=(a("d3b7"),a("53ca")),u={name:"conflictTrxLog",props:{gtid:String},data:function(){return{editable:!1,clearable:!1,dataLoading:!1,queryParam:{srcMhaName:null,dstMhaName:null,gtid:this.gtid,beginHandleTime:null,endHandleTime:null,trxResult:null},tableData:[],columns:[{title:"事务ID",key:"gtid",tooltip:!0},{title:"源MHA",key:"srcMhaName",width:200},{title:"目标MHA",key:"dstMhaName",width:200},{title:"事务影响行数",key:"trxRowsNum",width:150,sortable:!0},{title:"冲突行数",key:"cflRowsNum",width:150,sortable:!0},{title:"事务提交时间",key:"handleTime",width:200,sortable:!0},{title:"执行结果",key:"trxResult",width:150,align:"center",render:function(t,e){var a=e.row,r=0===a.trxResult?"blue":"volcano",n=0===a.trxResult?"commit":"rollBack";return t("Tag",{props:{color:r}},n)}},{title:"操作",slot:"action",width:150,align:"center"}],total:0,current:1,size:10,pageSizeOpts:[10,20,50,100],resultOpts:[{name:"commit",val:0},{name:"rollBack",val:1}]}},methods:{getTrxData:function(){var t=this,e=this.queryParam.beginHandleTime,a=this.queryParam.endHandleTime,r=null===e||isNaN(e)?null:new Date(e).getTime(),n=null===a||isNaN(a)?null:new Date(a).getTime();console.log("beginTime: "+e),console.log("endTime: "+a);var l={gtId:this.queryParam.gtid,srcMhaName:this.queryParam.srcMhaName,dstMhaName:this.queryParam.dstMhaName,trxResult:this.queryParam.trxResult,pageReq:{pageSize:this.size,pageIndex:this.current}};isNaN(r)||(l.beginHandleTime=r),isNaN(n)||null===n||(l.endHandleTime=n+864e5-1);var i=this.flattenObj(l);this.dataLoading=!0,this.axios.get("/api/drc/v2/log/conflict/trx",{params:i}).then((function(e){var a=e.data,r=a.pageReq;1===a.status?t.$Message.error("查询失败"):0===a.data.length||0===r.totalCount?(t.total=0,t.current=1,t.tableData=a.data,t.$Message.warning("查询结果为空")):(t.total=r.totalCount,t.current=r.pageIndex,t.tableData=a.data,t.$Message.success("查询成功"))})).finally((function(){t.dataLoading=!1}))},flattenObj:function(t){var e={};for(var a in t)if("object"!==Object(o["a"])(t[a])||Array.isArray(t[a]))e[a]=t[a];else{var r=this.flattenObj(t[a]);for(var n in r)e[a+"."+n]=r[n]}return e},resetParam:function(){this.queryParam={srcMhaName:null,dstMhaName:null,gtid:null,beginHandleTime:null,endHandleTime:null,trxResult:null}},queryRowsLog:function(t,e){this.$emit("tabValueChanged","rowsLog"),this.$emit("gtidChanged",t.gtid),this.tabVal="rowsLog"},getLogDetail:function(t,e){this.$router.push({path:"/conflictLogDetail",query:{conflictTrxLogId:t.conflictTrxLogId}})},handleChangeSize:function(t){var e=this;this.size=t,this.$nextTick((function(){e.getTrxData()}))}},created:function(){this.getTrxData()}},c=u,d=a("2877"),g=Object(d["a"])(c,i,s,!1,null,"647add98",null),m=g.exports,h={components:{conflictRowsLog:l["default"],conflictTrxLog:m},name:"conflictLog",data:function(){return{tabValue:"rowsLog",gtid:null,refresh:!0}},watch:{tabValue:function(t,e){this.refresh="trxLog"===e}},methods:{jump:function(t){this.tabValue=t},updateTabValue:function(t){this.tabValue=t},updateGtid:function(t){this.gtid=t}}},p=h,f=Object(d["a"])(p,r,n,!1,null,"58f7eecf",null);e["default"]=f.exports}}]);
//# sourceMappingURL=chunk-2d22238a.35cab89c.js.map