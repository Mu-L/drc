(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ed8404c","chunk-39ef8bd8"],{"159b":function(t,e,r){var a=r("da84"),o=r("fdbc"),i=r("17c2"),s=r("9112");for(var n in o){var l=a[n],c=l&&l.prototype;if(c&&c.forEach!==i)try{s(c,"forEach",i)}catch(d){c.forEach=i}}},"17c2":function(t,e,r){"use strict";var a=r("b727").forEach,o=r("a640"),i=r("ae40"),s=o("forEach"),n=i("forEach");t.exports=s&&n?[].forEach:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}},"27bb":function(t,e,r){},4160:function(t,e,r){"use strict";var a=r("23e7"),o=r("17c2");a({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},7358:function(t,e,r){"use strict";r("d2da")},"7ab6":function(t,e,r){"use strict";r("27bb")},a15b:function(t,e,r){"use strict";var a=r("23e7"),o=r("44ad"),i=r("fc6a"),s=r("a640"),n=[].join,l=o!=Object,c=s("join",",");a({target:"Array",proto:!0,forced:l||!c},{join:function(t){return n.call(i(this),void 0===t?",":t)}})},a640:function(t,e,r){"use strict";var a=r("d039");t.exports=function(t,e){var r=[][t];return!!r&&a((function(){r.call(null,e||function(){throw 1},1)}))}},d2da:function(t,e,r){},d7e3:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("codemirror",{attrs:{options:t.options},model:{value:t.rowData,callback:function(e){t.rowData=e},expression:"rowData"}})],1)},o=[],i=r("8f94"),s=(r("0f7c"),r("ffda"),{name:"conflictRowsLogDetail",props:{rowData:String},components:{codemirror:i["codemirror"]},data:function(){return{options:{value:"",mode:"text/x-mysql",theme:"ambiance",lineWrapping:!0,height:100,readOnly:!0,lineNumbers:!0}}}}),n=s,l=(r("7358"),r("2877")),c=Object(l["a"])(n,a,o,!1,null,null,null);e["default"]=c.exports},ece4:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("base-component",{attrs:{isFather:t.isFather,subMenuName:["1"],fatherMenu:t.fatherMenu}},[r("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[r("BreadcrumbItem",{attrs:{to:"/conflictLog"}},[t._v("冲突行")]),r("BreadcrumbItem",{attrs:{to:"/conflictApproval"}},[t._v("冲突审批")]),r("BreadcrumbItem",[t._v("冲突详情")])],1),r("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[r("div",{style:{padding:"1px 1px",height:"100%"}},[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[t._v(" 自动冲突处理结果 ")]),"0"===t.queryType?r("div",{staticClass:"ivu-list-item-meta-title"},[t._v("事务提交结果： "),r("Button",{attrs:{loading:t.logTableLoading,size:"small",type:0==t.trxLog.trxResult?"success":"error"}},[t._v(" "+t._s(t.trxLog.trxResultStr)+" ")])],1):t._e(),r("div",{staticClass:"ivu-list-item-meta-title"},[t._v("所有机房当前冲突行记录： "),r("Tooltip",{attrs:{content:"数据一致性比对忽略字段过滤的列"}},[r("Button",{attrs:{loading:t.recordLoading,size:"small",type:1==t.trxLog.recordEqual?"success":"warning"},on:{click:t.getRecords}},[t._v(t._s(t.trxLog.diffStr))])],1)],1),r("Divider"),r("div",{staticClass:"ivu-list-item-meta-title"},[t._v("源机房("+t._s(t.trxLog.srcRegion)+")")]),t._l(t.srcRecords,(function(e,a){return r("Card",{key:a},[r("div",{staticClass:"ivu-list-item-meta-title"},[t._v("表名："+t._s(e.tableName)+" "),r("Tooltip",{attrs:{content:1==e.doubleSync?"双向同步":"单向同步"}},[r("Button",{attrs:{size:"small",type:1==e.doubleSync?"success":"primary"}},[t._v(" "+t._s(1==e.doubleSync?"双向同步":"单向同步")+" ")])],1)],1),r("Table",{attrs:{size:"small",columns:e.columns,data:e.records,border:""}})],1)})),r("Divider"),r("div",{staticClass:"ivu-list-item-meta-title"},[t._v("目标机房("+t._s(t.trxLog.dstRegion)+")")]),t._l(t.dstRecords,(function(e,a){return r("Card",{key:a},[r("div",{staticClass:"ivu-list-item-meta-title"},[t._v("表名："+t._s(e.tableName)+" "),r("Tooltip",{attrs:{content:1==e.doubleSync?"双向同步":"单向同步"}},[r("Button",{attrs:{size:"small",type:1==e.doubleSync?"success":"primary"}},[t._v(" "+t._s(1==e.doubleSync?"双向同步":"单向同步")+" ")])],1)],1),r("Table",{attrs:{size:"small",columns:e.columns,data:e.records,border:""}})],1)}))],2),r("Divider"),r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[t._v(" DRC冲突处理流程 ")]),r("Table",{ref:"multipleTable",attrs:{stripe:"",loading:t.logTableLoading,columns:t.trxLog.columns,data:t.dataWithPage},on:{"on-selection-change":t.changeSelection}}),r("div",[r("Page",{attrs:{transfer:!0,total:t.trxLog.tableData.length,current:t.trxLog.current,"page-size-opts":t.trxLog.pageSizeOpts,"page-size":this.trxLog.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(e){return t.$set(t.trxLog,"current",e)},"on-page-size-change":t.handleChangeSize}})],1)],1),r("Divider"),r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[t._v(" 选择冲突行自动冲突处理 ")]),r("p",[t._v("写入region")]),r("Row",{attrs:{gutter:10}},[r("Col",{attrs:{span:"3"}},[r("Select",{attrs:{filterable:"",clearable:"",placeholder:"选择写入region"},model:{value:t.writeSide,callback:function(e){t.writeSide=e},expression:"writeSide"}},t._l(t.regionOpt,(function(e){return r("Option",{key:e.key,attrs:{value:e.key}},[t._v(t._s(e.val))])})),1)],1),r("Col",{attrs:{span:"4"}},["2"!==t.queryType?r("Button",{attrs:{loading:t.sqlLoading,size:"middle",type:"success"},on:{click:t.generateHandleSql}},[t._v("生成SQL")]):t._e()],1),r("Col",{attrs:{span:"4"}},["2"===t.queryType?r("a",{attrs:{target:"_blank",href:this.approvalDetailUrl}},[t._v("审批链接")]):t._e()])],1),r("br"),r("div",{attrs:{loading:t.sqlLoading}},[r("codemirror",{attrs:{options:t.options},model:{value:t.handleSql,callback:function(e){t.handleSql=e},expression:"handleSql"}})],1),r("br"),"2"!==t.queryType?r("Button",{attrs:{loading:t.approvalLoading,size:"middle",type:"primary"},on:{click:t.generateApproval}},[t._v("提交审批")]):t._e(),t.showExecute?r("Button",{attrs:{disabled:"true"===t.disabled,loading:t.executeLoading,size:"middle",type:"primary"},on:{click:t.executeApproval}},[t._v("执行SQL")]):t._e()],1),r("Divider")],1)])],1)},o=[],i=(r("4160"),r("a15b"),r("fb6a"),r("d3b7"),r("159b"),r("2909")),s=r("d7e3"),n=r("8f94"),l=(r("0f7c"),r("ffda"),{name:"conflictLogDetail",props:{rowData:String},components:{codemirror:n["codemirror"]},data:function(){return{disabled:"",executeLoading:!1,showExecute:!1,approvalDetailUrl:"",approvalLoading:!1,handleSql:"",handleSqlList:[],showHandleSql:!1,multiData:[],sqlLoading:!1,writeSide:0,regionOpt:[],queryType:0,byRowLogIds:!1,rowLogIds:[],conflictTrxLogId:0,recordLoading:!1,logTableLoading:!1,approvalId:0,srcRecords:[],dstRecords:[],srcTable:{data:[],columns:[]},dstTable:{data:[],columns:[]},trxLog:{srcRegion:"",dstRegion:"",trxResult:null,trxResultStr:"",hasDiff:null,recordEqual:null,diffStr:"",tableData:[],columns:[{type:"selection",width:40,align:"center"},{type:"expand",width:40,render:function(t,e){var r=e.row;return t(s["default"],{props:{rowData:"/*原始SQL*/\n"+r.rawSql+"\n/*原始SQL处理结果: "+r.rawSqlResult+"*/\n\n/*冲突时行记录*/\n"+r.dstRowRecord+"\n\n/*冲突处理SQL*/\n"+r.handleSql+"\n/*冲突处理SQL处理结果: "+r.handleSqlResult+"*/"}})}},{title:"执行顺序",key:"rowId",width:100},{title:"表名",key:"tableName",width:250,tooltip:!0,render:function(t,e){var r=e.row,a=r.dbName+"."+r.tableName;return t("div",a)}},{title:"原始sql",key:"rawSql",tooltip:!0},{title:"处理结果",key:"rowResult",width:120,align:"center",render:function(t,e){var r=e.row,a=0===r.rowResult?"blue":"volcano",o=0===r.rowResult?"commit":"rollback";return t("Tag",{props:{color:a}},o)}}],total:0,current:1,size:10,pageSizeOpts:[10,20,50,100]},options:{value:"",mode:"text/x-mysql",theme:"ambiance",lineWrapping:!0,height:100,readOnly:!0,lineNumbers:!0}}},methods:{executeApproval:function(){var t=this;this.executeLoading=!0,this.axios.post("/api/drc/v2/log/approval/execute?approvalId="+this.approvalId).then((function(e){1===e.data.status?t.$Message.error("SQL执行失败! "+e.data.message):(t.$Message.success("SQL执行成功!"),t.disabled="true",t.getRecords())})).finally((function(){t.executeLoading=!1}))},getHandleSql:function(){var t=this;this.axios.get("/api/drc/v2/log/approval/detail?approvalId="+this.approvalId).then((function(e){if(1===e.data.status)t.$Message.error("查询冲突自动处理SQL失败!");else{var r=e.data;t.handleSqlList=r.data;var a=[];r.data.forEach((function(t){return a.push(t.autoHandleSql)})),t.handleSql=a.join("\n")}})).finally((function(){t.logTableLoading=!1}))},generateApproval:function(){var t=this;if(0!==this.handleSqlList.length){this.approvalLoading=!0;var e=[];this.handleSqlList.forEach((function(t){var r={rowLogId:t.rowLogId,handleSql:t.autoHandleSql};e.push(r)})),this.axios.post("/api/drc/v2/log/approval/create",{writeSide:this.writeSide,handleSqlDtos:e}).then((function(e){1===e.data.status?t.$Message.error("提交审批单失败！"):t.$Message.success("提交审批单成功")})).finally((function(){t.approvalLoading=!1}))}else this.$Message.warning("未生成SQL！")},generateHandleSql:function(){var t=this,e=this.multiData;if(void 0!==e&&null!==e&&0!==e.length){var r=[];e.forEach((function(t){return r.push(t.rowLogId)})),this.sqlLoading=!0,this.handleSql="",this.axios.post("/api/drc/v2/log/conflict/rows/handleSql",{writeSide:this.writeSide,rowLogIds:r}).then((function(e){var r=e.data;if(0===r.status){t.handleSqlList=r.data;var a=[];r.data.forEach((function(t){return a.push(t.autoHandleSql)})),t.handleSql=a.join("\n")}else t.$Message.error("自动生成SQL失败: "+r.message)})).finally((function(){t.sqlLoading=!1}))}else this.$Message.warning("请勾选！")},handleSpan:function(t){t.row,t.column,t.rowIndex;var e=t.columnIndex;if(0===e)return[0,0]},handleChangeSize:function(t){this.trxLog.size=t},getTrxLogDetail:function(){var t=this;this.logTableLoading=!0,this.axios.get("/api/drc/v2/log/conflict/detail?conflictTrxLogId="+this.conflictTrxLogId).then((function(e){if(1===e.data.status)t.$Message.error("查询冲突详情失败!");else{var r=e.data.data;t.trxLog.srcRegion=r.srcRegion,t.trxLog.dstRegion=r.dstRegion,t.trxLog.trxResult=r.trxResult,t.trxLog.trxResultStr=0===r.trxResult?"commit":"rollback",t.trxLog.tableData=r.rowsLogDetailViews,t.regionOpt=[{key:0,val:t.trxLog.dstRegion},{key:1,val:t.trxLog.srcRegion}]}})).finally((function(){t.logTableLoading=!1}))},getTrxLogDetail1:function(){var t=this;this.logTableLoading=!0,this.axios.get("/api/drc/v2/log/conflict/rows/detail?conflictRowLogIds="+this.rowLogIds).then((function(e){if(1===e.data.status)t.$Message.error("查询冲突详情失败!");else{var r=e.data.data;t.trxLog.srcRegion=r.srcRegion,t.trxLog.dstRegion=r.dstRegion,t.trxLog.trxResult=r.trxResult,t.trxLog.trxResultStr=0===r.trxResult?"commit":"rollback",t.trxLog.tableData=r.rowsLogDetailViews,t.regionOpt=[{key:0,val:t.trxLog.dstRegion},{key:1,val:t.trxLog.srcRegion}]}})).finally((function(){t.logTableLoading=!1}))},getTrxLogDetail2:function(){var t=this;this.logTableLoading=!0,this.axios.get("/api/drc/v2/log/approval/rows/detail?approvalId="+this.approvalId).then((function(e){if(1===e.data.status)t.$Message.error("查询冲突详情失败!");else{var r=e.data.data;t.trxLog.srcRegion=r.srcRegion,t.trxLog.dstRegion=r.dstRegion,t.trxLog.trxResult=r.trxResult,t.trxLog.trxResultStr=0===r.trxResult?"commit":"rollback",t.trxLog.tableData=r.rowsLogDetailViews,t.regionOpt=[{key:0,val:t.trxLog.dstRegion},{key:1,val:t.trxLog.srcRegion}]}})).finally((function(){t.logTableLoading=!1}))},getWriteSide:function(){var t=this;this.axios.get("/api/drc/v2/log/approval/writeSide?approvalId="+this.approvalId).then((function(e){1===e.data.status?t.$Message.error("查询写入region失败!"):t.writeSide=e.data.data}))},getTrxRecords:function(){var t=this;this.recordLoading=!0,this.axios.get("/api/drc/v2/log/conflict/records?conflictTrxLogId="+this.conflictTrxLogId+"&columnSize=12").then((function(e){if(1===e.data.status)t.trxLog.diffStr="数据比对失败";else{var r=e.data.data;t.trxLog.recordEqual=r.recordIsEqual,t.trxLog.diffStr=r.recordIsEqual?"数据一致":"数据不一致",t.srcRecords=r.srcRecords,t.dstRecords=r.dstRecords}})).finally((function(){t.recordLoading=!1}))},getTrxRecords1:function(){var t=this;this.recordLoading=!0,this.axios.get("/api/drc/v2/log/conflict/rows/records?conflictRowLogIds="+this.rowLogIds).then((function(e){if(1===e.data.status)t.trxLog.diffStr="数据比对失败";else{var r=e.data.data;t.trxLog.recordEqual=r.recordIsEqual,t.trxLog.diffStr=r.recordIsEqual?"数据一致":"数据不一致",t.srcRecords=r.srcRecords,t.dstRecords=r.dstRecords}})).finally((function(){t.recordLoading=!1}))},getTrxRecords2:function(){var t=this;this.recordLoading=!0,this.axios.get("/api/drc/v2/log/approval/rows/records?approvalId="+this.approvalId).then((function(e){if(1===e.data.status)t.trxLog.diffStr="数据比对失败";else{var r=e.data.data;t.trxLog.recordEqual=r.recordIsEqual,t.trxLog.diffStr=r.recordIsEqual?"数据一致":"数据不一致",t.srcRecords=r.srcRecords,t.dstRecords=r.dstRecords}})).finally((function(){t.recordLoading=!1}))},getRecords:function(){"0"===this.queryType?this.getTrxRecords():"1"===this.queryType?this.getTrxRecords1():"2"===this.queryType&&this.getTrxRecords2()},changeSelection:function(t){this.multiData=t}},computed:{dataWithPage:function(){var t=this.trxLog.tableData,e=this.trxLog.current*this.trxLog.size-this.trxLog.size,r=e+this.trxLog.size;return Object(i["a"])(t).slice(e,r)}},created:function(){this.conflictTrxLogId=this.$route.query.conflictTrxLogId,this.queryType=this.$route.query.queryType,this.approvalDetailUrl=this.$route.query.approvalDetailUrl,this.rowLogIds=this.$route.query.rowLogIds,this.approvalId=this.$route.query.approvalId,"0"===this.queryType?(this.getTrxLogDetail(),this.getTrxRecords()):"1"===this.queryType?(this.getTrxLogDetail1(),this.getTrxRecords1()):"2"===this.queryType&&(this.showExecute=this.$route.query.showExecute,this.disabled=this.$route.query.disabled,this.getWriteSide(),this.getTrxLogDetail2(),this.getTrxRecords2(),this.getHandleSql())}}),c=l,d=(r("7ab6"),r("2877")),u=Object(d["a"])(c,a,o,!1,null,null,null);e["default"]=u.exports},fb6a:function(t,e,r){"use strict";var a=r("23e7"),o=r("861d"),i=r("e8b5"),s=r("23cb"),n=r("50c4"),l=r("fc6a"),c=r("8418"),d=r("b622"),u=r("1dde"),g=r("ae40"),p=u("slice"),h=g("slice",{ACCESSORS:!0,0:0,1:2}),f=d("species"),v=[].slice,x=Math.max;a({target:"Array",proto:!0,forced:!p||!h},{slice:function(t,e){var r,a,d,u=l(this),g=n(u.length),p=s(t,g),h=s(void 0===e?g:e,g);if(i(u)&&(r=u.constructor,"function"!=typeof r||r!==Array&&!i(r.prototype)?o(r)&&(r=r[f],null===r&&(r=void 0)):r=void 0,r===Array||void 0===r))return v.call(u,p,h);for(a=new(void 0===r?Array:r)(x(h-p,0)),d=0;p<h;p++,d++)p in u&&c(a,d,u[p]);return a.length=d,a}})}}]);
//# sourceMappingURL=chunk-3ed8404c.3dcca27a.js.map