(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b1141b1"],{"471e":function(t,a,e){"use strict";var r=function(){var t=this,a=t._self._c;return a("div",[t.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:t.status,"show-icon":""}},[t._v(" "+t._s(t.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:t._s(t.message)},slot:"desc"})]):t._e(),a("Row",[a("i-col",{attrs:{span:"12"}},[a("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.srcBuildParam,rules:t.ruleDrc,"label-width":200}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"srcMhaName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeSrcMha},model:{value:t.srcBuildParam.mhaName,callback:function(a){t.$set(t.srcBuildParam,"mhaName",a)},expression:"srcBuildParam.mhaName"}})],1),a("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[a("Select",{key:t.replicatorInstanceInfo.src,staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"选择源集群Replicator"},model:{value:t.srcBuildParam.replicatorIps,callback:function(a){t.$set(t.srcBuildParam,"replicatorIps",a)},expression:"srcBuildParam.replicatorIps"}},t._l(t.replicatorList.src,(function(e){return a("Option",{key:e.ip,attrs:{value:e.ip}},[t._v(t._s(e.ip)+" — "+t._s(e.az)+" "+t._s(t.getRole(e.ip,t.replicatorInstanceInfo.src))+" ")])})),1),t._v("   "),a("Button",{attrs:{type:"success"},on:{click:t.autoConfigSrcReplicator}},[t._v("自动录入")])],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始拉取位点R"}},[a("Input",{attrs:{placeholder:"变更replicator机器时,请输入binlog拉取位点"},model:{value:t.srcBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.srcBuildParam,"replicatorInitGtid",a)},expression:"srcBuildParam.replicatorInitGtid"}}),a("Row",[a("Col",{attrs:{span:"12"}},[a("Button",{on:{click:t.querySrcMhaMachineGtid}},[t._v("查询mha位点")]),t.hasTest1?a("span",[a("Icon",{attrs:{type:t.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess1?"green":"red"}}),t._v(" "+t._s(t.testSuccess1?"查询实时位点成功":"连接查询失败")+" ")],1):t._e()],1),a("Col",{attrs:{span:"12"}},[a("Button",{attrs:{type:"success"},on:{click:t.querySrcMhaGtidCheckRes}},[t._v("位点校验")])],1)],1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"同步配置"}},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.getSrcDbReplications}},[t._v("同步表管理")])],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"DB Applier 配置"}},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.getSrcDbApplierReplications}},[t._v("Db Applier 管理")])],1)],1)],1),a("i-col",{attrs:{span:"12"}},[a("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.dstBuildParam,rules:t.ruleDrc,"label-width":200}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"目标集群名",prop:"dstMhaName"}},[a("Input",{attrs:{placeholder:"请输入目标集群名"},on:{input:t.changeDstMha},model:{value:t.dstBuildParam.mhaName,callback:function(a){t.$set(t.dstBuildParam,"mhaName",a)},expression:"dstBuildParam.mhaName"}})],1),a("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[a("Select",{key:t.replicatorInstanceInfo.dst,staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"选择目标集群Replicator"},model:{value:t.dstBuildParam.replicatorIps,callback:function(a){t.$set(t.dstBuildParam,"replicatorIps",a)},expression:"dstBuildParam.replicatorIps"}},t._l(t.replicatorList.dst,(function(e){return a("Option",{key:e.ip,attrs:{value:e.ip}},[t._v(t._s(e.ip)+" — "+t._s(e.az)+" "+t._s(t.getRole(e.ip,t.replicatorInstanceInfo.dst))+" ")])})),1),t._v("   "),a("Button",{attrs:{type:"success"},on:{click:t.autoConfigDstReplicator}},[t._v("自动录入")])],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始拉取位点R"}},[a("Input",{attrs:{placeholder:"变更replicator机器时,请输入binlog拉取位点"},model:{value:t.dstBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.dstBuildParam,"replicatorInitGtid",a)},expression:"dstBuildParam.replicatorInitGtid"}}),a("Row",[a("Col",{attrs:{span:"12"}},[a("Button",{on:{click:t.queryDstMhaMachineGtid}},[t._v("查询mha位点")]),t.hasTest2?a("span",[a("Icon",{attrs:{type:t.testSuccess2?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess2?"green":"red"}}),t._v(" "+t._s(t.testSuccess2?"查询实时位点成功":"连接查询失败")+" ")],1):t._e()],1),a("Col",{attrs:{span:"12"}},[a("Button",{attrs:{type:"success"},on:{click:t.queryDstMhaGtidCheckRes}},[t._v("位点校验")])],1)],1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"同步配置"}},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.getDstDbReplications}},[t._v("同步表管理")])],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"DB Applier 配置"}},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.getDstDbApplierReplications}},[t._v("Db Applier 管理")])],1)],1)],1)],1),a("Form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":250}},[a("FormItem",[a("br"),a("Button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(a){t.preCheckConfigure()}}},[t._v("提交")])],1),a("Modal",{attrs:{title:"确认配置信息",width:"900px"},on:{"on-ok":t.submitConfig},model:{value:t.reviewModal,callback:function(a){t.reviewModal=a},expression:"reviewModal"}},[a("Row",{attrs:{gutter:5}},[a("i-col",{attrs:{span:"12"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"源集群名"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.mhaName,callback:function(a){t.$set(t.srcBuildParam,"mhaName",a)},expression:"srcBuildParam.mhaName"}})],1),a("FormItem",{attrs:{label:"源集群端Replicator"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.replicatorIps,callback:function(a){t.$set(t.srcBuildParam,"replicatorIps",a)},expression:"srcBuildParam.replicatorIps"}})],1),a("FormItem",{attrs:{label:"源集群端R位点"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.srcBuildParam,"replicatorInitGtid",a)},expression:"srcBuildParam.replicatorInitGtid"}})],1)],1)],1),a("i-col",{attrs:{span:"12"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"目标集群名"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.mhaName,callback:function(a){t.$set(t.dstBuildParam,"mhaName",a)},expression:"dstBuildParam.mhaName"}})],1),a("FormItem",{attrs:{label:"目标集群端Replicator"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.replicatorIps,callback:function(a){t.$set(t.dstBuildParam,"replicatorIps",a)},expression:"dstBuildParam.replicatorIps"}})],1),a("FormItem",{attrs:{label:"目标集群端R位点"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.dstBuildParam,"replicatorInitGtid",a)},expression:"dstBuildParam.replicatorInitGtid"}})],1)],1)],1)],1)],1),a("Modal",{attrs:{title:"配置结果",width:"1200px"},model:{value:t.resultModal,callback:function(a){t.resultModal=a},expression:"resultModal"}},[a("Form",{staticStyle:{width:"100%"}},[a("FormItem",{attrs:{label:"集群配置"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.result,callback:function(a){t.result=a},expression:"result"}})],1)],1)],1),a("Modal",{attrs:{title:"gitd位点校验结果",width:"900px"},model:{value:t.gtidCheck.modal,callback:function(a){t.$set(t.gtidCheck,"modal",a)},expression:"gtidCheck.modal"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"校验结果"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.legal,callback:function(a){t.$set(t.gtidCheck.resVo,"legal",a)},expression:"gtidCheck.resVo.legal"}})],1),a("FormItem",{attrs:{label:"当前Mha"}},[a("Input",{attrs:{autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.mha,callback:function(a){t.$set(t.gtidCheck.resVo,"mha",a)},expression:"gtidCheck.resVo.mha"}})],1),a("FormItem",{attrs:{label:"配置位点"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.configGtid,callback:function(a){t.$set(t.gtidCheck.resVo,"configGtid",a)},expression:"gtidCheck.resVo.configGtid"}})],1),a("FormItem",{attrs:{label:"purgedGtid"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.purgedGtid,callback:function(a){t.$set(t.gtidCheck.resVo,"purgedGtid",a)},expression:"gtidCheck.resVo.purgedGtid"}})],1)],1)],1)],1)],1)},s=[],i=e("b85c"),c=e("53ca"),l=e("2909"),o=(e("a15b"),e("14d9"),e("fb6a"),e("d3b7"),e("159b"),{name:"drcBuildV2",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String,env:String},data:function(){return{result:"",status:"",title:"",message:"",hasResp:!1,hasTest1:!1,testSuccess1:!1,hasTest2:!1,testSuccess2:!1,reviewModal:!1,resultModal:!1,replicatorList:{src:[],dst:[]},srcBuildParam:{mhaName:this.srcMhaName,replicatorIps:[],replicatorInitGtid:""},srcBuildData:{dbApplierDtos:[]},dstBuildParam:{mhaName:this.dstMhaName,replicatorIps:[],replicatorInitGtid:""},replicatorInstanceInfo:{src:[],dst:[]},dstBuildData:{dbApplierDtos:[]},gtidCheck:{modal:!1,resVo:{mha:"",legal:"",configGtid:"",purgedGtid:""}},ruleDrc:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}],replicator:[{required:!0,message:"replicator不能为空",trigger:"blur"}],applier:[{required:!0,message:"applier不能为空",trigger:"blur"}]}}},computed:{dataWithPage:function(){var t=this.nameFilterCheck.tableData,a=this.nameFilterCheck.current*this.nameFilterCheck.size-this.nameFilterCheck.size,e=a+this.nameFilterCheck.size;return Object(l["a"])(t).slice(a,e)}},methods:{flattenObj:function(t){var a={};for(var e in t)if("object"!==Object(c["a"])(t[e])||Array.isArray(t[e]))a[e]=t[e];else{var r=this.flattenObj(t[e]);for(var s in r)a[e+"."+s]=r[s]}return a},autoConfigSrcReplicator:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.srcBuildParam.mhaName+"&type=0&selectedIps="+this.srcBuildParam.replicatorIps).then((function(a){console.log(a.data),t.srcBuildParam.replicatorIps=[],a.data.data.forEach((function(a){return t.srcBuildParam.replicatorIps.push(a.ip)}))}))},autoConfigDstReplicator:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.dstBuildParam.mhaName+"&type=0&selectedIps="+this.dstBuildParam.replicatorIps).then((function(a){console.log(a.data),t.dstBuildParam.replicatorIps=[],a.data.data.forEach((function(a){return t.dstBuildParam.replicatorIps.push(a.ip)}))}))},getSrcMhaResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.srcBuildParam.mhaName+"&type=0").then((function(a){console.log(a.data),t.replicatorList.src=a.data.data}))},getDstMhaResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.dstBuildParam.mhaName+"&type=0").then((function(a){console.log(a.data),t.replicatorList.dst=a.data.data}))},getSrcMhaReplicatorsInUse:function(){var t=this;this.axios.get("/api/drc/v2/mha/replicator?mhaName="+this.srcBuildParam.mhaName).then((function(a){t.srcBuildParam.replicatorIps=a.data.data,t.getReplicatorInstances(!0)}))},getDstMhaReplicatorsInUse:function(){var t=this;this.axios.get("/api/drc/v2/mha/replicator?mhaName="+this.dstBuildParam.mhaName).then((function(a){console.log(a.data),t.dstBuildParam.replicatorIps=a.data.data,t.getReplicatorInstances(!1)}))},getReplicatorInstances:function(t){var a=this,e=t?this.srcBuildParam:this.dstBuildParam;this.axios.get("/api/drc/v2/remote/resource/replicatorInstances",{params:{mhaName:e.mhaName,ips:e.replicatorIps.join(",")}}).then((function(e){var r=e.data.data;console.log("replicator instance: ",r),t?a.replicatorInstanceInfo.src=r:a.replicatorInstanceInfo.dst=r}))},getMhaDbAppliersInUse:function(){var t=this;this.axios.get("/api/drc/v2/config/mha/dbApplier?srcMhaName="+this.dstBuildParam.mhaName+"&dstMhaName="+this.srcBuildParam.mhaName).then((function(a){console.log(a.data),t.srcBuildData.dbApplierDtos=a.data.data})),this.axios.get("/api/drc/v2/config/mha/dbApplier?srcMhaName="+this.srcBuildParam.mhaName+"&dstMhaName="+this.dstBuildParam.mhaName).then((function(a){console.log(a.data),t.dstBuildData.dbApplierDtos=a.data.data}))},querySrcMhaMachineGtid:function(){var t=this,a=this;a.axios.get("/api/drc/v2/mha/gtid/executed?mha="+this.srcBuildParam.mhaName).then((function(a){t.hasTest1=!0,0===a.data.status?(t.srcBuildParam.replicatorInitGtid=a.data.data,t.testSuccess1=!0):t.testSuccess1=!1}))},querySrcMhaGtidCheckRes:function(){var t=this;if(null!=this.srcBuildParam.replicatorInitGtid&&""!==this.srcBuildParam.replicatorInitGtid){var a=this;a.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+this.srcBuildParam.mhaName+"&configGtid="+this.srcBuildParam.replicatorInitGtid).then((function(a){0===a.data.status?(t.gtidCheck.resVo={mha:t.srcBuildParam.mhaName,legal:!0===a.data.data.legal?"合理位点":"binlog已经被purge",configGtid:t.srcBuildParam.replicatorInitGtid,purgedGtid:a.data.data.purgedGtid},t.gtidCheck.modal=!0):alert("位点校验失败!")}))}else alert("位点为空！")},queryDstMhaMachineGtid:function(){var t=this,a=this;a.axios.get("/api/drc/v2/mha/gtid/executed?mha="+this.dstBuildParam.mhaName).then((function(a){t.hasTest2=!0,0===a.data.status?(t.dstBuildParam.replicatorInitGtid=a.data.data,t.testSuccess2=!0):t.testSuccess2=!1}))},getRole:function(t,a){if(!a||0===a.length)return"";var e,r=Object(i["a"])(a);try{for(r.s();!(e=r.n()).done;){var s=e.value;if(s.ip===t)return" — "+(s.master?"Master":"Slave")}}catch(c){r.e(c)}finally{r.f()}return""},queryDstMhaGtidCheckRes:function(){var t=this;if(null!=this.dstBuildParam.replicatorInitGtid&&""!==this.dstBuildParam.replicatorInitGtid){var a=this;a.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+this.dstBuildParam.mhaName+"&configGtid="+this.dstBuildParam.replicatorInitGtid).then((function(a){0===a.data.status?(t.gtidCheck.resVo={mha:t.dstBuildParam.mhaName,legal:!0===a.data.data.legal?"合理位点":"binlog已经被purge",configGtid:t.dstBuildParam.replicatorInitGtid,purgedGtid:a.data.data.purgedGtid},t.gtidCheck.modal=!0):alert("位点校验失败!")}))}else alert("位点为空！")},getSrcDc:function(){var t=this;this.axios.get("/api/drc/v2/mha/dc?mhaName="+this.srcBuildParam.mhaName).then((function(a){t.srcDc=a.data.data}))},getDstDc:function(){var t=this;this.axios.get("/api/drc/v2/mha/dc?mhaName="+this.dstBuildParam.mhaName).then((function(a){t.dstDc=a.data.data}))},changeSrcMha:function(){this.$emit("srcMhaNameChanged",this.srcBuildParam.mhaName),this.getSrcMhaResources(),this.getSrcMhaReplicatorsInUse(),this.getMhaDbAppliersInUse(),this.getSrcDc()},changeDstMha:function(){this.$emit("dstMhaNameChanged",this.dstBuildParam.mhaName),this.getDstMhaResources(),this.getDstMhaReplicatorsInUse(),this.getMhaDbAppliersInUse(),this.getDstDc()},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(t){var a=this;this.$refs[t].validate((function(t){t?a.drc.reviewModal=!0:a.$Message.error("仍有必填项未填!")}))},preCheckConfigure:function(){this.reviewModal=!0},reviewConfigure:function(){this.drc.reviewModal=!0},submitConfig:function(){var t=this,a=this;this.axios.post("/api/drc/v2/config/",{srcBuildParam:this.srcBuildParam,dstBuildParam:this.dstBuildParam}).then((function(e){console.log(e.data),a.result=e.data,a.reviewModal=!1,a.resultModal=!0,t.refresh()}))},getSrcDbReplications:function(){this.$router.push({path:"/dbTables",query:{srcMhaName:this.dstBuildParam.mhaName,dstMhaName:this.srcBuildParam.mhaName,srcDc:this.dstDc,dstDc:this.srcDc,order:!0}})},getDstDbReplications:function(){this.$router.push({path:"/dbTables",query:{srcMhaName:this.srcBuildParam.mhaName,dstMhaName:this.dstBuildParam.mhaName,srcDc:this.srcDc,dstDc:this.dstDc,order:!0}})},getSrcDbApplierReplications:function(){this.$router.push({path:"/dbAppliers",query:{srcMhaName:this.dstBuildParam.mhaName,dstMhaName:this.srcBuildParam.mhaName,srcDc:this.dstDc,dstDc:this.srcDc,order:!0}})},getDstDbApplierReplications:function(){this.$router.push({path:"/dbAppliers",query:{srcMhaName:this.srcBuildParam.mhaName,dstMhaName:this.dstBuildParam.mhaName,srcDc:this.srcDc,dstDc:this.dstDc,order:!0}})},handleChangeSize:function(t){this.size=t},hasAppliers:function(t){var a,e=Object(i["a"])(t);try{for(e.s();!(a=e.n()).done;){var r=a.value;if(r.ips&&r.ips.length>0)return!0}}catch(s){e.e(s)}finally{e.f()}return!1},refresh:function(){this.getSrcMhaReplicatorsInUse(),this.getDstMhaReplicatorsInUse(),this.getMhaDbAppliersInUse(),this.getSrcDc(),this.getDstDc()}},created:function(){this.getSrcMhaResources(),this.getDstMhaResources(),this.refresh()}}),n=o,d=(e("807f"),e("2877")),m=Object(d["a"])(n,r,s,!1,null,"64534762",null);a["a"]=m.exports},"609e":function(t,a,e){},"807f":function(t,a,e){"use strict";e("609e")}}]);
//# sourceMappingURL=chunk-6b1141b1.1e8f254c.js.map