(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-709f5171"],{"7c0c":function(t,e,s){"use strict";s("cff6")},c3fb:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("base-component",{attrs:{isFather:t.isFather,subMenuName:["1"],fatherMenu:t.fatherMenu}},[s("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[s("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),s("BreadcrumbItem",{attrs:{to:"/monitor"}},[t._v("冲突日志")]),s("BreadcrumbItem",[t._v("当前结果及自助处理")])],1),s("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[s("div",{style:{padding:"1px 1px",height:"100%"}},[s("Card",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v(" 自动冲突处理结果 ")]),1===t.getConflictLogStatus?s("div",{staticClass:"ivu-list-item-meta-title"},[t._v(" getCurrentConflictLog occur exception ")]):t._e(),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("事务提交结果： "),s("Tag",{attrs:{color:t.lastResult==t.commit?t.success:t.error,size:"medium"}},[t._v(t._s(t.lastResult))])],1),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("所有机房当前冲突事务记录： "),s("Tag",{attrs:{color:0==t.isDiffTransaction?t.success:t.error,size:"medium"}},[t._v(t._s(t.diffTransaction))])],1),s("Divider"),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("源机房当前值("+t._s(t.srcDc)+")")]),t._l(t.srcTableItems,(function(t,e){return s("Table",{key:e,staticStyle:{"margin-top":"20px"},attrs:{columns:t.column,data:t.record,size:"small"}})})),s("Divider"),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("目标机房当前值("+t._s(t.destDc)+")")]),t._l(t.destTableItems,(function(t,e){return s("Table",{key:e,staticStyle:{"margin-top":"20px"},attrs:{columns:t.column,data:t.record,size:"small"}})}))],2),s("Divider"),s("Collapse",[s("div",{on:{click:function(e){return t.refreshEditor()}}},[s("Panel",{attrs:{name:"1"},on:{click:t.refreshEditor}},[t._v(" 自动冲突处理流程 "),s("div",{attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("原SQL")]),s("codemirror",{ref:"cm1",attrs:{options:t.cmOptions},model:{value:t.rawSqlList,callback:function(e){t.rawSqlList=e},expression:"rawSqlList"}}),s("Divider"),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("原SQL处理结果")]),s("codemirror",{ref:"cm2",attrs:{options:t.cmOptions},model:{value:t.rawSqlExecutedResultList,callback:function(e){t.rawSqlExecutedResultList=e},expression:"rawSqlExecutedResultList"}}),s("Divider"),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("冲突时Record")]),s("codemirror",{ref:"cm3",attrs:{options:t.cmOptions},model:{value:t.destCurrentRecordList,callback:function(e){t.destCurrentRecordList=e},expression:"destCurrentRecordList"}}),s("Divider"),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("冲突处理SQL")]),s("codemirror",{ref:"cm4",attrs:{options:t.cmOptions},model:{value:t.conflictHandleSqlList,callback:function(e){t.conflictHandleSqlList=e},expression:"conflictHandleSqlList"}}),s("Divider"),s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("冲突处理SQL结果")]),s("codemirror",{ref:"cm5",attrs:{options:t.cmOptions},model:{value:t.conflictHandleSqlExecutedResultList,callback:function(e){t.conflictHandleSqlExecutedResultList=e},expression:"conflictHandleSqlExecutedResultList"}})],1)])],1)]),s("Divider"),s("Card",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v(" 冲突自助处理 ")]),s("Form",[s("FormItem",[s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("源机房("+t._s(t.srcDc)+")")])]),s("FormItem",{attrs:{label:"操作SQL"}},[s("codemirror",{attrs:{options:t.operateCmOptions},model:{value:t.operateCode1,callback:function(e){t.operateCode1=e},expression:"operateCode1"}})],1)],1),s("Button",{style:{marginLeft:"1000px"},attrs:{type:"primary"},on:{click:t.SubmitSrcSql}},[t._v(" 提交 ")]),s("Divider"),s("Form",[s("FormItem",[s("div",{staticClass:"ivu-list-item-meta-title"},[t._v("目标机房("+t._s(t.destDc)+")")])]),s("FormItem",{attrs:{label:"操作SQL"}},[s("codemirror",{attrs:{options:t.operateCmOptions},model:{value:t.operateCode2,callback:function(e){t.operateCode2=e},expression:"operateCode2"}})],1),s("Button",{style:{marginLeft:"1000px"},attrs:{type:"primary"},on:{click:t.SubmitDestSql}},[t._v(" 提交 ")]),s("Divider")],1)],1),s("Modal",{attrs:{title:"执行SQL",width:"1000px"},on:{"on-ok":t.okSubmitSrcSql,"on-cancel":t.cancelSubmitSrcSql},model:{value:this.submitSrcSql,callback:function(e){t.$set(this,"submitSrcSql",e)},expression:"this.submitSrcSql"}},[s("Form",[s("FormItem",{attrs:{label:"执行机房"}},[s("Tag",{attrs:{color:"blue"}},[t._v(t._s(t.srcDc))])],1),s("FormItem",{attrs:{label:"执行SQL"}},[s("codemirror",{ref:"submitSrcSqlEditor",attrs:{options:t.cmOptions},model:{value:t.operateCode1,callback:function(e){t.operateCode1=e},expression:"operateCode1"}})],1)],1)],1),s("Modal",{attrs:{title:"执行SQL",width:"1000px"},on:{"on-ok":t.okSubmitDestSql,"on-cancel":t.cancelSubmitDestSql},model:{value:this.submitDestSql,callback:function(e){t.$set(this,"submitDestSql",e)},expression:"this.submitDestSql"}},[s("Form",[s("FormItem",{attrs:{label:"执行机房"}},[s("Tag",{attrs:{color:"blue"}},[t._v(t._s(t.destDc))])],1),s("FormItem",{attrs:{label:"执行SQL"}},[s("codemirror",{ref:"submitDestSqlEditor",attrs:{options:t.cmOptions},model:{value:t.operateCode2,callback:function(e){t.operateCode2=e},expression:"operateCode2"}})],1)],1)],1),s("Modal",{attrs:{title:"执行结果",width:"1000px"},on:{"on-ok":t.okSubmitResult,"on-cancel":t.okSubmitResult},model:{value:this.submitResult,callback:function(e){t.$set(this,"submitResult",e)},expression:"this.submitResult"}},[s("Form",[s("FormItem",{attrs:{label:"执行结果"}},[s("Alert",{attrs:{type:this.operationStatus,"show-icon":""}},[t._v("执行结果："+t._s(this.operationMsg))])],1)],1)],1)],1)])],1)},i=[],r=s("c7eb"),o=s("1da1"),c=s("8f94"),l=(s("0f7c"),s("ffda"),{name:"hadleConflict",components:{codemirror:c["codemirror"]},data:function(){return{getConflictLogStatus:"",isDiffTransaction:!0,diffTransaction:"",collapse:"1",srcTableItems:[],destTableItems:[],commit:"commit",success:"success",error:"error",isFather:!0,fatherMenu:"/monitor",operationStatus:"",operationMsg:"",submitResult:!1,submitSrcSql:!1,submitDestSql:!1,rawSqlList:"",rawSqlExecutedResultList:"",destCurrentRecordList:"",conflictHandleSqlList:"",conflictHandleSqlExecutedResultList:"",lastResult:"",srcDc:"",destDc:"",srcMhaName:"",destMhaName:"",curSrcRecord:"",curDestRecord:"",operateCode1:"",operateCode2:"",cmOptions:{value:"",mode:"text/x-mysql",theme:"ambiance",lineWrapping:!0,height:100,readOnly:!0,lineNumbers:!0,autoRefresh:!0},operateCmOptions:{value:"",mode:"text/x-mysql",theme:"ambiance",lineWrapping:!0,autoRefresh:!0}}},methods:{getCurrentRecord:function(){var t=this;this.axios.get("/api/drc/v1/logs/record/conflicts/"+this.$route.query.id).then((function(e){1===e.data.status?t.getConflictLogStatus=1:(t.getConflictLogStatus=0,console.log("test record data"),console.log(e),t.rawSqlList=e.data.data.rawSqlList,t.rawSqlExecutedResultList=e.data.data.rawSqlExecutedResultList,t.destCurrentRecordList=e.data.data.destCurrentRecordList,t.conflictHandleSqlList=e.data.data.conflictHandleSqlList,t.conflictHandleSqlExecutedResultList=e.data.data.conflictHandleSqlExecutedResultList,t.lastResult=e.data.data.lastResult,t.srcDc=e.data.data.srcDc,t.destDc=e.data.data.destDc,t.srcMhaName=e.data.data.srcMhaName,t.destMhaName=e.data.data.destMhaName,t.curSrcRecord=e.data.data.srcRecord,t.curDestRecord=e.data.data.destRecord,t.srcTableItems=e.data.data.srcTableItems,t.destTableItems=e.data.data.destTableItems,t.isDiffTransaction=e.data.data.diffTransaction,t.diffTransaction=!0===e.data.data.diffTransaction?"数据不一致":"数据一致",console.log("test column"),console.log(t.destTableItems[0].column))}))},SubmitSrcSql:function(){var t=this;setTimeout((function(){t.$refs.submitSrcSqlEditor.codemirror.refresh()}),1),this.submitSrcSql=!0},okSubmitSrcSql:function(){var t=this;return Object(o["a"])(Object(r["a"])().mark((function e(){var s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=t,e.next=3,t.$axios.post("/api/drc/v1/logs/record/conflicts/update",{userName:sessionStorage.getItem("userName"),mhaName0:t.srcMhaName,mhaName1:t.destMhaName,sql:t.operateCode1}).then((function(t){s.operationMsg=t.data.message,1===t.data.status?s.operationStatus="error":s.operationStatus="success"}));case 3:t.submitResult=!0;case 4:case"end":return e.stop()}}),e)})))()},cancelSubmitSrcSql:function(){this.submitSrcSql=!1},okSubmitResult:function(){this.submitResult=!1,this.submitSrcSql=!1,this.submitDestSql=!1,this.operationMsg="",this.operationStatus=""},SubmitDestSql:function(){var t=this;setTimeout((function(){t.$refs.submitDestSqlEditor.codemirror.refresh()}),1),this.submitDestSql=!0},okSubmitDestSql:function(){var t=this;return Object(o["a"])(Object(r["a"])().mark((function e(){var s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=t,e.next=3,t.$axios.post("/api/drc/v1/logs/record/conflicts/update",{userName:sessionStorage.getItem("userName"),mhaName0:t.destMhaName,mhaName1:t.srcMhaName,sql:t.operateCode2}).then((function(t){s.operationMsg=t.data.message,1===t.data.status?s.operationStatus="error":s.operationStatus="success"}));case 3:t.submitResult=!0;case 4:case"end":return e.stop()}}),e)})))()},cancelSubmitDestSql:function(){this.submitDestSql=!1},refreshEditor:function(){var t=this;setTimeout((function(){t.$refs.cm1.codemirror.refresh(),t.$refs.cm2.codemirror.refresh(),t.$refs.cm3.codemirror.refresh(),t.$refs.cm4.codemirror.refresh(),t.$refs.cm5.codemirror.refresh()}),10),console.log("hello code mirror")}},created:function(){this.getCurrentRecord()}}),n=l,u=(s("7c0c"),s("2877")),d=Object(u["a"])(n,a,i,!1,null,null,null);e["default"]=d.exports},cff6:function(t,e,s){}}]);
//# sourceMappingURL=chunk-709f5171.5030befa.js.map