(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-887dcb02"],{"04de":function(e,t,a){"use strict";a("772e")},"6a95":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Row",[a("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.drc,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"集群名",prop:"mhaName"}},[a("Input",{attrs:{readonly:"",placeholder:"请输入集群名"},model:{value:e.drc.mhaName,callback:function(t){e.$set(e.drc,"mhaName",t)},expression:"drc.mhaName"}})],1),a("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[a("Select",{staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"选择Replicator"},model:{value:e.drc.replicators,callback:function(t){e.$set(e.drc,"replicators",t)},expression:"drc.replicators"}},e._l(e.drc.replicatorList,(function(t){return a("Option",{key:t.ip,attrs:{value:t.ip}},[e._v(e._s(t.ip)+" — "+e._s(t.az)+" "+e._s(e.getRole(t.ip,e.drc.currentInstances.replicator))+" ")])})),1),e._v("   "),a("Button",{attrs:{type:"success"},on:{click:e.autoConfigReplicator}},[e._v("自动录入")])],1),e.showMhaApplierConfig()?a("FormItem",{attrs:{label:"选择Messenger",prop:"messenger"}},[a("Select",{staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"选择集群Messenger"},model:{value:e.drc.messengers,callback:function(t){e.$set(e.drc,"messengers",t)},expression:"drc.messengers"}},e._l(e.drc.messengerList,(function(t){return a("Option",{key:t.ip,attrs:{value:t.ip}},[e._v(e._s(t.ip)+" ["+e._s(1===t.type?"A":7===t.type?"M":"")+"] — "+e._s(t.az)+" "+e._s(e.getRole(t.ip,e.drc.currentInstances.messenger))+" ")])})),1),e._v("   "),a("Button",{attrs:{type:"success"},on:{click:e.autoConfigMessenger}},[e._v("自动录入")])],1):e._e(),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始拉取位点R"}},[a("Input",{attrs:{placeholder:"变更replicator机器时，请输入binlog拉取位点"},model:{value:e.drc.rGtidExecuted,callback:function(t){e.$set(e.drc,"rGtidExecuted",t)},expression:"drc.rGtidExecuted"}}),a("Row",[a("Col",{attrs:{span:"12"}},[a("Button",{on:{click:e.queryMhaMachineGtid}},[e._v("查询mha位点")]),e.hasTest1?a("span",[a("Icon",{attrs:{type:e.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:e.testSuccess1?"green":"red"}}),e._v(" "+e._s(e.testSuccess1?"查询实时位点成功":"连接查询失败")+" ")],1):e._e()],1),a("Col",{attrs:{span:"12"}},[a("Button",{attrs:{type:"success"},on:{click:e.queryMhaGtidCheckRes}},[e._v("位点校验")])],1)],1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"mq配置"}},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:e.goToMqConfigs}},[e._v("mq配置")])],1),e.showDbMhaApplierConfig()?a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"DB Applier 配置"}},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:e.getMhaDbMessenger}},[e._v("Db Applier 管理")])],1):e._e(),e.showMhaApplierConfig()?a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始同步位点A"}},[a("Input",{attrs:{placeholder:"请输入DRC同步起始位点"},model:{value:e.drc.aGtidExecuted,callback:function(t){e.$set(e.drc,"aGtidExecuted",t)},expression:"drc.aGtidExecuted"}})],1):e._e()],1)],1),a("Form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":250}},[a("FormItem",[a("Row",[a("Col",{attrs:{span:"6"}},[a("Button",{on:{click:function(t){return e.handleReset("drc1")}}},[e._v("重置")])],1),a("Col",{attrs:{span:"6"}},[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.preCheckConfigure()}}},[e._v("提交")])],1)],1)],1),a("Modal",{attrs:{title:"确认配置信息",width:"900px"},on:{"on-ok":e.submitConfig},model:{value:e.drc.reviewModal,callback:function(t){e.$set(e.drc,"reviewModal",t)},expression:"drc.reviewModal"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"集群名"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.mhaName,callback:function(t){e.$set(e.drc,"mhaName",t)},expression:"drc.mhaName"}})],1),a("FormItem",{attrs:{label:"集群Replicator"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.replicators,callback:function(t){e.$set(e.drc,"replicators",t)},expression:"drc.replicators"}})],1),a("FormItem",{attrs:{label:"集群Messenger"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.messengers,callback:function(t){e.$set(e.drc,"messengers",t)},expression:"drc.messengers"}})],1),a("FormItem",{attrs:{label:"新增Replicator的新增binlog拉取位点"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.rGtidExecuted,callback:function(t){e.$set(e.drc,"rGtidExecuted",t)},expression:"drc.rGtidExecuted"}})],1),a("FormItem",{attrs:{label:"Messenger集群的起始位点"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.drc.aGtidExecuted,callback:function(t){e.$set(e.drc,"aGtidExecuted",t)},expression:"drc.aGtidExecuted"}})],1)],1)],1),a("Modal",{attrs:{title:"配置结果",width:"1200px"},model:{value:e.drc.resultModal,callback:function(t){e.$set(e.drc,"resultModal",t)},expression:"drc.resultModal"}},[a("Form",{staticStyle:{width:"100%"}},[a("FormItem",{attrs:{label:"集群配置"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}})],1)],1)],1),a("Modal",{attrs:{title:"存在一对多共用运行配置请确认",width:"900px"},on:{"on-ok":e.reviewConfigure},model:{value:e.drc.warnModal,callback:function(t){e.$set(e.drc,"warnModal",t)},expression:"drc.warnModal"}},[a("label",{staticStyle:{color:"black"}},[e._v("共用replicator配置的集群: ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.drc.conflictMha,expression:"drc.conflictMha"}],domProps:{value:e.drc.conflictMha},on:{input:function(t){t.target.composing||e.$set(e.drc,"conflictMha",t.target.value)}}}),a("Divider"),a("div",[a("p",{staticStyle:{color:"red"}},[e._v("线上一对多replicator配置")]),a("ul",e._l(e.drc.replicators.share,(function(t){return a("ol",{key:t},[e._v(e._s(t))])})),0)]),a("Divider"),a("div",[a("p",{staticStyle:{color:"black"}},[e._v("修改后replicator配置")]),a("ul",e._l(e.drc.replicators.conflictCurrent,(function(t){return a("ol",{key:t},[e._v(e._s(t))])})),0)])],1),a("Modal",{attrs:{title:"gitd位点校验结果",width:"900px"},model:{value:e.gtidCheck.modal,callback:function(t){e.$set(e.gtidCheck,"modal",t)},expression:"gtidCheck.modal"}},[a("Form",{staticStyle:{width:"80%"}},[a("FormItem",{attrs:{label:"校验结果"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.legal,callback:function(t){e.$set(e.gtidCheck.resVo,"legal",t)},expression:"gtidCheck.resVo.legal"}})],1),a("FormItem",{attrs:{label:"当前Mha"}},[a("Input",{attrs:{autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.mha,callback:function(t){e.$set(e.gtidCheck.resVo,"mha",t)},expression:"gtidCheck.resVo.mha"}})],1),a("FormItem",{attrs:{label:"配置位点"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.configGtid,callback:function(t){e.$set(e.gtidCheck.resVo,"configGtid",t)},expression:"gtidCheck.resVo.configGtid"}})],1),a("FormItem",{attrs:{label:"purgedGtid"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.purgedGtid,callback:function(t){e.$set(e.gtidCheck.resVo,"purgedGtid",t)},expression:"gtidCheck.resVo.purgedGtid"}})],1)],1)],1)],1)],1)},n=[],o=a("b85c"),i=a("c7eb"),s=a("1da1"),c=(a("7db0"),a("a15b"),a("d3b7"),a("159b"),{name:"drcMqConfig",props:{mhaName:String,dc:String},data:function(){return{hasTest1:!1,testSuccess1:!1,result:!1,gtidCheck:{modal:!1,resVo:{mha:"",legal:"",configGtid:"",purgedGtid:""}},drc:{reviewModal:!1,warnModal:!1,mhaName:this.mhaName,rGtidExecuted:"",aGtidExecuted:"",replicators:{},messengers:[],currentInstances:{messenger:[],replicator:[]},replicatorList:{},messengerList:[],dbMessengerSwitch:!1,dbMessengerList:[]}}},methods:{autoConfigReplicator:function(){var e=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.drc.mhaName+"&type=0&selectedIps="+this.drc.replicators).then((function(t){console.log(t.data),e.drc.replicators=[],t.data.data.forEach((function(t){return e.drc.replicators.push(t.ip)}))}))},autoConfigMessenger:function(){var e=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.drc.mhaName+"&type=7&selectedIps="+this.drc.messengers).then((function(t){console.log(t.data),e.drc.messengers=[],t.data.data.forEach((function(t){return e.drc.messengers.push(t.ip)}))}))},getResources:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.drc.messengerList=[],e.axios.get("/api/drc/v2/resource/mha/all?mhaName="+e.drc.mhaName+"&type=0").then((function(t){console.log(t.data),e.drc.replicatorList=t.data.data})),t.next=4,e.axios.get("/api/drc/v2/resource/mha/all?mhaName="+e.drc.mhaName+"&type=7").then((function(t){var a=t.data.data;a.forEach((function(t){var a=e.drc.messengerList.find((function(e){return e.ip===t.ip}));a||e.drc.messengerList.push(t)}))}));case 4:e.axios.get("/api/drc/v2/config/mha/dbMessenger?mhaName="+e.drc.mhaName+"&type=1").then((function(t){e.drc.dbMessengerList=t.data.data}));case 5:case"end":return t.stop()}}),t)})))()},refreshReplicatorInstances:function(){var e=this;this.axios.get("/api/drc/v2/remote/resource/replicatorInstances",{params:{mhaName:this.drc.mhaName,ips:this.drc.replicators.join(",")}}).then((function(t){var a=t.data.data;console.log("replicator instance: ",a),e.drc.currentInstances.replicator=a}))},refreshMessengerInstances:function(){var e=this;this.axios.get("/api/drc/v2/remote/resource/messengerInstances",{params:{mhaName:this.drc.mhaName,ips:this.drc.messengers.join(",")}}).then((function(t){var a=t.data.data;console.log("messenger instance: ",a),e.drc.currentInstances.messenger=a}))},getResourcesInUse:function(){var e=this;this.axios.get("/api/drc/v2/mha/replicator",{params:{mhaName:this.drc.mhaName}}).then((function(t){console.log(e.drc.mhaName+" replicators "+t.data.data),e.drc.replicators=[],t.data.data.forEach((function(t){return e.drc.replicators.push(t)})),e.refreshReplicatorInstances()})),this.axios.get("/api/drc/v2/mha/messenger",{params:{mhaName:this.drc.mhaName}}).then((function(t){var a=t.data.data;console.log(e.drc.mhaName+" messengers "+a),e.drc.messengers=a.ips,e.drc.aGtidExecuted=a.gtidInit,e.refreshMessengerInstances()}))},goToMqConfigs:function(){console.log("go to change mq config for "+this.drc.mhaName),this.$router.push({path:"/v2/mqConfigs",query:{mhaName:this.drc.mhaName}})},getMhaDbMessenger:function(){this.$router.push({path:"/dbMessengers",query:{mhaName:this.drc.mhaName}})},handleReset:function(e){this.$refs[e].resetFields()},preCheckConfigure:function(){var e=this,t={mhaName:this.drc.mhaName,replicatorIps:this.drc.replicators.join(","),messengerIps:this.drc.messengers.join(",")};console.log(t),this.axios.get("/api/drc/v2/mha/replicatorIps/check",{params:t}).then((function(t){var a=t.data.data;0===a.status?e.drc.reviewModal=!0:1===a.status?(e.drc.replicators.share=a.workingReplicatorIps,e.drc.replicators.conflictCurrent=e.drc.replicators,e.drc.conflictMha=a.conflictMha,e.drc.warnModal=!0):window.alert("config preCheck fail")}))},queryMhaMachineGtid:function(){var e=this;this.hasTest1=!1,this.drc.rGtidExecuted="";var t=this;console.log("/api/drc/v2/mha/gtid/executed?mha="+this.drc.mhaName),t.axios.get("/api/drc/v2/mha/gtid/executed?mha="+this.drc.mhaName).then((function(t){e.hasTest1=!0,0===t.data.status?(e.drc.rGtidExecuted=t.data.data,e.testSuccess1=!0):(e.testSuccess1=!1,e.$Message.warning("查询位点失败: "+t.data.message))})).catch((function(t){e.$Message.error("查询位点异常: "+t)}))},queryMhaGtidCheckRes:function(){var e=this;if(null!=this.drc.rGtidExecuted&&""!==this.drc.rGtidExecuted){var t=this;console.log("/api/drc/v2/mha/gtid/checkResult?mha="+this.drc.mhaName+"&configGtid="+this.drc.rGtidExecuted),t.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+this.drc.mhaName+"&configGtid="+this.drc.rGtidExecuted).then((function(t){0===t.data.status?(e.gtidCheck.resVo={mha:e.drc.mhaName,legal:!0===t.data.data.legal?"合理位点":"binlog已经被purge",configGtid:e.drc.rGtidExecuted,purgedGtid:t.data.data.purgedGtid},e.gtidCheck.modal=!0):console.log("api fail:/api/drc/v2/mha/gtid/checkResult?mha="+e.drc.mhaName+"&configGtid="+e.drc.rGtidExecuted)})).catch((function(t){e.$Message.error("校验位点异常: "+t)}))}else this.$Message.warning("位点为空！")},showDbMhaApplierConfig:function(){return this.drc.dbMessengerSwitch||this.hasAppliers(this.drc.dbMessengerList)},showMhaApplierConfig:function(){return!0},getRole:function(e,t){if(!t||0===t.length)return"";var a,r=Object(o["a"])(t);try{for(r.s();!(a=r.n()).done;){var n=a.value;if(n.ip===e)return" — "+(n.master?"Master":"Slave")}}catch(i){r.e(i)}finally{r.f()}return""},hasAppliers:function(e){var t,a=Object(o["a"])(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(r.ips&&r.ips.length>0)return!0}}catch(n){a.e(n)}finally{a.f()}return!1},submitConfig:function(){var e=this,t=this;this.axios.post("/api/drc/v2/config/messenger/submitConfig",{mhaName:this.drc.mhaName,replicatorIps:this.drc.replicators,messengerIps:this.drc.messengers,aGtidExecuted:this.drc.aGtidExecuted,rGtidExecuted:this.drc.rGtidExecuted}).then((function(a){console.log(a.data),1!==a.data.status?(t.result=a.data.data,t.drc.reviewModal=!1,t.drc.resultModal=!0):e.$Message.warning({content:"提交失败："+a.data.message,duration:10})})).catch((function(t){e.$Message.error({content:"提交异常: "+t,duration:10})}))},reviewConfigure:function(){this.drc.reviewModal=!0}},created:function(){this.getResources(),this.getResourcesInUse()}}),l=c,d=a("2877"),m=Object(d["a"])(l,r,n,!1,null,"5fc58892",null);t["a"]=m.exports},"772e":function(e,t,a){},"7db0":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").find,o=a("44d2"),i=a("ae40"),s="find",c=!0,l=i(s);s in[]&&Array(1)[s]((function(){c=!1})),r({target:"Array",proto:!0,forced:c||!l},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},ad63:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/v2/dbMqBuildV2"}},[e._v("DB粒度 Mq")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 111px 185px",zIndex:"1"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"18"}},[a("Form",{staticStyle:{"margin-right":"20px","margin-top":"10px"},attrs:{model:e.formItem,"label-width":100}},[a("FormItem",{attrs:{label:"数据库",required:!0}},[a("Select",{attrs:{filterable:"",disabled:!!e.meta.fixDb,placeholder:"请搜索数据库信息","remote-method":e.getExistDb,loading:e.dataLoading},on:{"on-change":e.selectDb},model:{value:e.meta.dbName,callback:function(t){e.$set(e.meta,"dbName",t)},expression:"meta.dbName"}},e._l(e.meta.dbOptions,(function(t,r){return a("Option",{key:r,attrs:{value:t.dbName}},[e._v(e._s(t.dbName))])})),1)],1),a("FormItem",{attrs:{label:"同步方向",required:!0}},[a("RadioGroup",{attrs:{"button-style":"solid"},on:{"on-change":e.afterSelectExistReplication},model:{value:e.selectedExistReplication,callback:function(t){e.selectedExistReplication=t},expression:"selectedExistReplication"}},e._l(e.meta.existReplicationRegionOptions,(function(t){return a("Radio",{key:t.srcRegionName,attrs:{label:t.srcRegionName,border:""}},[e._v(" "+e._s(t.srcRegionName)+" ")])})),1),a("Button",{attrs:{type:"primary",icon:"md-add",ghost:""},on:{click:e.goToCreateReplication}},[e._v("新增")]),a("Modal",{attrs:{width:"1200px","footer-hide":!0,title:"创建同步"},model:{value:e.createModal.open,callback:function(t){e.$set(e.createModal,"open",t)},expression:"createModal.open"}},[e.createModal.open?a("mha-preview",{attrs:{"db-name":e.meta.dbName,"replication-type":1,"exist-replication-region-options":e.meta.existReplicationRegionOptions},on:{updated:e.selectDb}}):e._e()],1)],1),a("Divider",{attrs:{orientation:"left"}},[e._v("消息投递配置")]),a("Card",{staticStyle:{width:"100%"}},[a("mq-tables",{attrs:{"table-data":e.drcConfig.logicTableSummaryDtos,"data-loading":e.configDataLoading,"src-region":e.meta.srcRegionName,"dst-region":e.meta.dstRegionName,"db-name":e.meta.dbName,"db-names":e.drcConfig.dbNames},on:{updated:e.getDrcConfig}})],1),a("Divider",{attrs:{orientation:"left"}},[e._v("DB")]),a("Card",{staticStyle:{width:"100%"}},[e.drcConfig.mhaMqDtos?a("mha-mq-panel",{attrs:{"mha-mq-dtos":e.drcConfig.mhaMqDtos},on:{updated:e.getDrcConfig}}):e._e()],1)],1)],1)],1)],1)],1)},n=[],o=a("53ca"),i=a("c7eb"),s=a("1da1"),c=(a("d3b7"),a("ac1f"),a("5319"),a("498a"),a("7d78")),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Table",{ref:"multipleTable",staticStyle:{"margin-top":"20px"},attrs:{stripe:"",columns:e.columns,data:e.tableData,loading:e.dataLoading,border:""},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.row,n=t.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goToUpdateConfig(r,n)}}},[e._v("修改 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(t){return e.goToDeleteConfig(r,n)}}},[e._v("删除 ")])]}}])}),a("br"),a("Button",{attrs:{type:"success",icon:"md-add"},on:{click:e.goToInsertConfig}},[e._v(" 新增 ")]),a("Modal",{attrs:{width:"1200px","footer-hide":!0,title:e.actionTitle},model:{value:e.editModal.open,callback:function(t){e.$set(e.editModal,"open",t)},expression:"editModal.open"}},[e.editModal.open?a("db-mq-config",{ref:"dbReplicationConfigComponent",attrs:{"config-data":e.selectedRow,"src-region":e.srcRegion,"dst-region":e.srcRegion,"db-names":e.dbNames,"form-action":e.action},on:{finished:e.finishConfig}}):e._e()],1)],1)},d=[],m=(a("4ec9"),a("3ca3"),a("ddb0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"13"}},[a("Form",{staticStyle:{"margin-right":"20px","margin-top":"10px"},attrs:{model:e.formItem,disabled:"delete"===e.formAction,"label-width":100}},[e.alertInfo.show?a("Alert",{attrs:{type:"warning","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),e.alertInfo.successShow?a("Alert",{attrs:{type:"success","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),a("FormItem",{attrs:{label:"部门"}},[a("Select",{attrs:{filterable:"",placeholder:"选择部门"},model:{value:e.formItem.bu,callback:function(t){e.$set(e.formItem,"bu",t)},expression:"formItem.bu"}},e._l(e.formItem.constants.buForChosen,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("FormItem",{attrs:{prop:"dbName",label:"库名",required:!0}},[a("Input",{attrs:{type:"textarea",autosize:!0,readonly:!0,border:!1,placeholder:"请输入库名（支持正则）"},model:{value:e.formItem.dbName,callback:function(t){e.$set(e.formItem,"dbName",t)},expression:"formItem.dbName"}})],1),a("FormItem",{attrs:{label:"同步表",required:!0}},[a("Input",{attrs:{placeholder:"请输入正则表达式"},on:{"on-keydown":function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"]))return null;t.preventDefault()},"on-blur":e.afterEnterTableName},model:{value:e.formItem.tableName,callback:function(t){e.$set(e.formItem,"tableName",t)},expression:"formItem.tableName"}})],1),a("FormItem",{attrs:{label:"MQ主题"}},[a("Input",{staticStyle:{width:"350px"},attrs:{placeholder:"请输入自定义Topic"},on:{"on-blur":e.refreshTopicBu},model:{value:e.formItem.topic,callback:function(t){e.$set(e.formItem,"topic",t)},expression:"formItem.topic"}})],1),a("FormItem",{attrs:{label:"有序消息"}},[a("i-switch",{attrs:{size:"large"},scopedSlots:e._u([{key:"open",fn:function(){return[a("span",[e._v("On")])]},proxy:!0},{key:"close",fn:function(){return[a("span",[e._v("Off")])]},proxy:!0}]),model:{value:e.formItem.switch.order,callback:function(t){e.$set(e.formItem.switch,"order",t)},expression:"formItem.switch.order"}})],1),e.formItem.switch.order?a("Card",{staticStyle:{"margin-left":"100px"},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"md-settings"}}),e._v(" 有序消息字段 "),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{icon:"ios-refresh",size:"small",type:"primary",loading:e.commonColumnLoading},on:{click:e.getCommonColumns}},[e._v("获取公共字段 ")])]},proxy:!0}],null,!1,4117777808)},[a("FormItem",{attrs:{label:"字段"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"选择有序相关字段"},on:{"on-create":e.handleCreateColumn},model:{value:e.formItem.orderKey,callback:function(t){e.$set(e.formItem,"orderKey",t)},expression:"formItem.orderKey"}},e._l(e.formItem.constants.columnsForChose,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1)],1):e._e()],1)],1),a("Col",{attrs:{span:"11"}},[a("db-tables-preview",{attrs:{"src-region-name":e.srcRegion,"dst-region-name":null,"db-name":e.formItem.dbName,"table-names":e.formItem.tableName,mode:e.formItem.buildMode,"replication-type":Number(1)}})],1)],1),a("Divider"),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{type:e.buttonTypeMap.get(e.formAction),loading:e.dataLoading||e.commonColumnLoading},on:{click:e.submitAll}},[e._v(e._s(e.buttonTextMap.get(e.formAction))+" ")])],1)}),u=[],p=a("2909"),h=(a("caad"),a("a15b"),a("fb6a"),a("b0c0"),a("2532"),a("efa3")),f={components:{DbTablesPreview:h["a"]},FORM_ACTION_OPTION:{CREATE:"create",EDIT:"edit",DELETE:"delete"},name:"dbMqConfig",props:{configData:{},srcRegion:String,dstRegion:String,dbNames:Array,formAction:String},emits:["finished"],data:function(){return{meta:{rowsFilterId:null,colsFilterId:null,dbReplicationIds:[],originLogicTableConfig:{}},formItem:{bu:null,buildMode:2,dbName:null,tableName:null,topic:null,orderKey:null,switch:{order:!1},constants:{columnsForChose:[],buForChosen:[]}},checkTableDataList:[],table:{dbMhaTableLoading:!1,dbMhaTableColumn:[{title:"DB名",key:"dbName"},{title:"源集群",key:"srcMhaName",render:function(e,t){var a=t.row,r=a.srcMha;if(null!=r)return e("div",[e("span",r.name),e("span",{style:{float:"right",color:"#ababab"}},r.regionName+"("+r.dcName+")")])}},{title:"目标集群",key:"dstMhaName",render:function(e,t){var a=t.row,r=a.dstMha;if(null!=r)return e("div",[e("span",r.name),e("span",{style:{float:"right",color:"#ababab"}},r.regionName+"("+r.dcName+")")])}}],dbMhaTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]},dbTableLoading:!1,dbTableColumn:[{title:"序号",width:75,align:"center",fixed:"left",render:function(e,t){return e("span",t.index+1)}},{title:"库名",key:"schema",resizable:!0},{title:"表名",key:"table",resizable:!0},{title:"结果",align:"center",render:function(e,t){var a=t.row,r="ok"!==a.res?"volcano":"green",n=a.res;return e("Tag",{props:{color:r}},n)}}],dbTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}},alertInfo:{show:!1,successShow:!1,title:null,message:null},buttonTextMap:new Map([["create","新增 MQ投递"],["edit","更新 MQ投递"],["delete","删除 MQ投递"]]),buttonTypeMap:new Map([["create","success"],["edit","primary"],["delete","error"]]),dataLoading:!1,successSubmit:!1,commonColumnLoading:!1}},methods:{getParams:function(){var e={};return e.buName=this.formItem.buName,e.tag=this.formItem.tag,e.mode=this.formItem.buildMode,e.srcRegionName=this.srcRegion,e.replicationType=1,this.gtidConfigurable&&(e.gtidInit=this.formItem.gtidInit),e.tblsFilterDetail={tableNames:this.formItem.tableName},e.dbName=this.formItem.dbName,e},getEditParams:function(){var e={};return e.dbReplicationIds=this.meta.dbReplicationIds,e.dbNames=this.dbNames,e.srcRegionName=this.srcRegion,e.logicTableConfig={logicTable:this.formItem.tableName,dstLogicTable:this.formItem.topic},e.originLogicTableConfig=this.meta.originLogicTableConfig,e.mqConfig={bu:this.formItem.bu,mqType:"qmq",serialization:"json",persistent:!1,order:this.formItem.switch.order,orderKey:""===this.formItem.switch.orderKey?null:this.formItem.orderKey},console.log(e),e},getCommonColumns:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.getParams(),e.formItem.constants.columnsForChose=[],e.commonColumnLoading=!0,t.next=5,e.axios.get("/api/drc/v2/autoconfig/commonColumns",{params:e.flattenObj(a)}).then((function(t){1===t.data.status?e.$Message.error("查询公共列名失败，请手动添加："+t.data.message):(e.formItem.constants.columnsForChose=t.data.data,e.$Message.info("查询公共列名数："+t.data.data.length))})).catch((function(t){e.$Message.error("查询公共列名异常: "+t)})).finally((function(){e.commonColumnLoading=!1}));case 5:case"end":return t.stop()}}),t)})))()},handleCreateColumn:function(e){this.contains(this.formItem.constants.columnsForChose,e)?alert("已有项禁止创建"):""!==e&&void 0!==e&&null!==e?this.formItem.constants.columnsForChose.push(e):alert("字段不能为空")},refreshTopicBu:function(){this.formItem.topic&&(this.formItem.bu=this.formItem.topic.split(".")[0])},afterEnterTableName:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getTableInfo();case 2:case"end":return t.stop()}}),t)})))()},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var r=this.flattenObj(e[a]);for(var n in r)t[a+"."+n]=r[n]}return t},refresh:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.formItem.dbName=e.dbNames.join(","),e.configData?(console.log("edit panel ",JSON.stringify(e.configData)),e.formItem.tableName=e.configData.config.logicTable,e.formItem.topic=e.configData.config.dstLogicTable,e.formItem.orderKey=e.configData.orderKey,e.formItem.switch.order=e.configData.order,e.refreshTopicBu(),e.getCommonColumns(),e.meta.dbReplicationIds=e.configData.dbReplicationIds,e.meta.originLogicTableConfig=e.configData.config,e.meta.originMyConfig=e.configData.config):console.log("insert new config");case 2:case"end":return t.stop()}}),t)})))()},getBuListFromQmq:function(){var e=this;this.axios.get("/api/drc/v2/messenger/qmq/bus").then((function(t){1===t.data.status?window.alert("从查询qmq 部门信息失败!"):e.formItem.constants.buForChosen=t.data.data}))},submitAll:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,a.alertInfo.show=!1,a.alertInfo.successShow=!1,a.successSubmit=!1,r=e.getEditParams(),a.dataLoading=!0,t.next=8,a.axios.post("/api/drc/v2/autoconfig/dbMq/"+e.formAction,r).then((function(e){var t=e.data,r=0===t.status;r?(a.$Message.success("提交成功"),a.successSubmit=!0,a.alertInfo.successShow=!0,a.alertInfo.message=null,a.alertInfo.title="提交成功",a.$emit("finished")):(a.$Message.warning("提交失败: "+t.message),a.alertInfo.show=!0,a.alertInfo.title="提交失败",a.alertInfo.message=t.message)})).catch((function(e){a.$Message.error("提交异常: "+e)})).finally((function(){a.dataLoading=!1}));case 8:case"end":return t.stop()}}),t)})))()},rowsFilterCreateParamInit:function(){return{mode:1,drcStrategyId:2000000002,routeStrategyId:0,udlColumns:[],columns:[],context:"",illegalArgument:!1,fetchMode:0}},columnsFilterCreateParamInit:function(){return{mode:null,columns:[]}}},computed:{preCheckTablePage:function(){var e=this.checkTableDataList,t=this.table.dbTablePage.current*this.table.dbTablePage.size-this.table.dbTablePage.size,a=t+this.table.dbTablePage.size;return Object(p["a"])(e).slice(t,a)},useTripUdlOrUidMode:function(){return[this.formItem.constants.rowsFilter.filterMode.TRIP_UDL,this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID].includes(this.formItem.rowsFilterCreateParam.mode)},hasUdlColumn:function(){return 0!==this.formItem.rowsFilterCreateParam.udlColumns.length},fillContextByRegion:function(){return this.formItem.rowsFilterCreateParam.fetchMode===this.formItem.constants.rowsFilter.fetchMode.RPC},hasUidColumn:function(){return 0!==this.formItem.rowsFilterCreateParam.columns.length},showUdlConfigDetail:function(){return this.formItem.rowsFilterCreateParam.mode===this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID||this.hasUdlLegalConfig||!this.hasUidLegalConfig},showUidConfigDetail:function(){return this.formItem.rowsFilterCreateParam.mode===this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID||this.hasUidLegalConfig||!this.hasUdlLegalConfig},hasUdlLegalConfig:function(){return 0!==this.formItem.rowsFilterCreateParam.udlColumns.length&&null!=this.formItem.rowsFilterCreateParam.drcStrategyId&&this.formItem.rowsFilterCreateParam.drcStrategyId>0},hasUidLegalConfig:function(){return this.hasUidColumn}},created:function(){this.getBuListFromQmq(),this.refresh()}},g=f,b=a("2877"),v=Object(b["a"])(g,m,u,!1,null,"5740dbc0",null),x=v.exports,w={name:"mqTables",components:{DbMqConfig:x},props:{dbName:String,dbNames:Array,srcRegion:String,dstRegion:String,tableData:Array,dataLoading:Boolean},emits:["updated"],data:function(){return{selectedRow:{},action:null,actionTitleMap:new Map([["create","新增 MQ投递配置"],["edit","更新 MQ投递配置"],["delete","⚠️删除 MQ投递配置"]]),editModal:{open:!1},columns:[{title:"序号",width:75,align:"center",fixed:"left",render:function(e,t){return e("span",t.index+1)}},{title:"表名",key:"config.logicTable",render:function(e,t){var a=t.row.config;return e("span",a.logicTable)}},{title:"主题",key:"topic",render:function(e,t){var a=t.row.config;return e("span",a.dstLogicTable)}},{title:"有序",key:"order",width:100,render:function(e,t){var a=t.row,r="blue",n=a.order?"有序":"无序";return e("Tag",{props:{color:r}},n)}},{title:"有序相关字段",key:"orderKey"},{title:"操作",slot:"action",align:"center",fixed:"right"}]}},methods:{goToInsertConfig:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.selectedRow=null,e.action=x.FORM_ACTION_OPTION.CREATE,e.editModal.open=!0;case 3:case"end":return t.stop()}}),t)})))()},goToUpdateConfig:function(e,t){var a=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a.selectedRow=e,a.action=x.FORM_ACTION_OPTION.EDIT,a.editModal.open=!0;case 3:case"end":return t.stop()}}),t)})))()},goToDeleteConfig:function(e,t){var a=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a.selectedRow=e,a.action=x.FORM_ACTION_OPTION.DELETE,a.editModal.open=!0;case 3:case"end":return t.stop()}}),t)})))()},finishConfig:function(){this.selectedRow=null,this.editModal.open=!1,this.$emit("updated")}},computed:{actionTitle:function(){return this.actionTitleMap.get(this.action)}},created:function(){}},M=w,y=Object(b["a"])(M,l,d,!1,null,"0a816a41",null),I=y.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Collapse",{model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.mhaMqDtos,(function(t,r){return a("Panel",{key:t.srcMha.name+"-> mq",attrs:{name:String(r)},scopedSlots:e._u([{key:"content",fn:function(){return[a("Button",{staticStyle:{"margin-bottom":"10px"},attrs:{icon:"ios-open-outline"},on:{click:function(t){return e.openModal(r)}}},[e._v(" 打开详情")]),a("mha-db-mq-panel",{attrs:{"mha-mq-dtos":t}}),a("Modal",{attrs:{width:"1500px","footer-hide":!0},model:{value:e.openDetailModal[r],callback:function(t){e.$set(e.openDetailModal,r,t)},expression:"openDetailModal[index]"}},[e.openDetailModal[r]?a("drc-mq-config",{ref:"dbReplicationConfigComponent",refInFor:!0,attrs:{"mha-name":t.srcMha.name,dc:t.srcMha.dcName}}):e._e()],1)]},proxy:!0}],null,!0)},[e._v(" "+e._s(t.srcMha.name+" ------ "+[t.mhaDbReplications.length]+"DB")+" ")])})),1),a("br"),a("Button",{attrs:{type:"primary",icon:"md-sync"},on:{click:e.goToSwitchMessengers}},[e._v(" 切换Messenger生效配置 ")]),a("br")],1)},R=[],k=(a("cb29"),a("d81d"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.mhaMqDtos.mhaMessengerDto?e._e():a("Table",{attrs:{stripe:"",border:"",columns:e.columns,data:e.mhaDbReplications}}),e.mhaMqDtos.mhaMessengerDto?a("Table",{attrs:{stripe:"",border:"",columns:e.mhaColumns,data:[e.mhaMqDtos]}}):e._e()],1)}),N=[],D=(a("4de4"),a("a3b8")),_=a.n(D),O={name:"mhaDbMqPanel",props:{mhaMqDtos:{}},data:function(){var e=this;return{mhaDbReplications:this.mhaMqDtos.mhaDbReplications,value:["1"],delayDataLoading:!1,columns:[{title:"类型",width:80,render:function(t,a){var r=a.row,n="none",o="error",i=!1;switch(r.transmissionType){case"simplex":n="单",o="info";break;case"duplex":n="双",o="success";break;default:n="无",i=!0;break}return t("Button",{props:{type:o,size:"small",disabled:i},on:{click:function(){e.showModal(r)}}},n)}},{title:"延迟",key:"drcStatus",width:100,align:"center",renderHeader:function(t,a){return t("span",[t("span","延迟"),e.replicationIds&&0!==e.replicationIds.length&&t("Button",{on:{click:function(){var t=Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMhaMessengerDelay();case 2:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}()},props:{loading:e.delayDataLoading,size:"small",shape:"circle",type:"default",icon:"md-refresh"}})])},render:function(e,t){var a,r,n=t.row;return!0===n.drcStatus?null!=n.delay?(r=_()(n.delay,{compact:!0}),a=n.delay>1e4?"warning":"success"):(r="已接入",a="blue"):(r="未接入",a="default"),e("Tag",{props:{color:a}},r)}},{title:"DB 名",key:"srcDbName",render:function(e,t){return e("p",t.row.src.dbName)}},{title:"messenger",key:"srcDbName",render:function(e,t){return e("p",t.row.dbMessengerDto?t.row.dbMessengerDto.ips.join(", "):null)}}],mhaColumns:[{title:"延迟",key:"drcStatus",width:100,align:"center",renderHeader:function(t,a){return t("span",[t("span","延迟"),e.mhaMqDtos.mhaMessengerDto.ips&&t("Button",{on:{click:function(){var t=Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMhaMessengerDelay();case 2:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}()},props:{loading:e.delayDataLoading,size:"small",shape:"circle",type:"default",icon:"md-refresh"}})])},render:function(e,t){var a,r,n=t.row;return n.mhaMessengerDto.ips?null!=n.delay?(r=_()(n.delay,{compact:!0}),a=n.delay>1e4?"warning":"success"):(r="已接入",a="blue"):(r="未接入",a="default"),e("Tag",{props:{color:a}},r)}},{title:"类型",width:100,key:"",render:function(e,t){return e("p","mha 同步")}},{title:"DB 名",key:"srcDbName",render:function(e,t){return e("p",t.row.mhaDbReplications.map((function(e){return e.src.dbName})).join(","))}},{title:"messenger",key:"",render:function(e,t){return e("p",t.row.mhaMessengerDto.ips.join(","))}},{title:"initGtid",key:"",render:function(e,t){return e("p",t.row.mhaMessengerDto.gtidInit)}}]}},methods:{showModal:function(e){this.$Message.info("还未上线，敬请期待")},getMhaMessengerDelay:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.delayDataLoading=!0,e.axios.post("/api/drc/v2/messenger/delay",{mhas:[e.mhaMqDtos.srcMha.name],dbs:e.mhaMqDtos.mhaDbReplications.map((function(e){return e.src.dbName}))}).then((function(t){var a=t.data.data[0].delayInfoDto.delay;e.$set(e.mhaMqDtos,"delay",a)})).catch((function(e){console.log(e)})).finally((function(){e.delayDataLoading=!1}));case 2:case"end":return t.stop()}}),t)})))()}},computed:{replicationIds:function(){return this.mhaDbReplications.filter((function(e){return!0===e.drcStatus})).map((function(e){return e.id})).join(",")}},created:function(){this.getMhaMessengerDelay()}},T=O,S=Object(b["a"])(T,k,N,!1,null,"74db8a0d",null),j=S.exports,$=a("6a95"),q={name:"mhaMqPanel",components:{DrcMqConfig:$["a"],MhaDbMqPanel:j},props:{mhaMqDtos:Array},emits:["updated"],data:function(){return{value:[],openDetailModal:[],dataLoading:!1}},methods:{openModal:function(e){this.$set(this.openDetailModal,e,!0)},goToSwitchMessengers:function(){var e=this;this.$Modal.confirm({title:"切换Messenger",content:"<p>请确认</p>",loading:!0,onOk:function(){e.switchMessengers()}})},switchMessengers:function(){var e=this,t=this.getSwitchParams();console.log(t),this.dataLoading=!0,this.axios.post("/api/drc/v2/autoconfig/switchMessengers",t).then((function(t){var a=t.data,r=0===a.status;r?e.$Message.success("提交成功"):e.$Message.warning("提交失败: "+a.message)})).catch((function(t){e.$Message.error("提交异常: "+t)})).finally((function(){e.$Modal.remove(),e.dataLoading=!1,e.$emit("updated")}))},getSwitchParams:function(){return this.mhaMqDtos.map((function(e){return{srcMhaName:e.srcMha.name,dbNames:e.mhaDbReplications.map((function(e){return e.src.dbName}))}}))}},created:function(){console.log("mhaMqDtos",this.mhaMqDtos),this.openDetailModal=Array(this.mhaMqDtos.length).fill(!1),1===this.mhaMqDtos.length&&(this.value=["0"])}},E=q,F=Object(b["a"])(E,C,R,!1,null,"8f02f32c",null),L=F.exports,G={components:{MhaMqPanel:L,MqTables:I,MhaPreview:c["a"]},data:function(){return{createModal:{open:!1},dataLoading:!1,configDataLoading:!1,selectedExistReplication:this.$route.query.srcRegionName,formItem:{srcRegionName:null,dstRegionName:null},drcConfig:{},meta:{dbName:this.$route.query.dbName,srcRegionName:this.$route.query.srcRegionName,dstRegionName:this.$route.query.dstRegionName,fixDb:this.$route.query.fixDb,regionOptions:[],dbOptions:[],existReplicationRegionOptions:[]}}},methods:{getParams:function(){var e={};return e.dbName=this.meta.dbName,e.srcRegionName=this.meta.srcRegionName,e.dstRegionName=this.meta.dstRegionName,e},getExistDb:function(e){var t=this;return Object(s["a"])(Object(i["a"])().mark((function a(){var r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!(null===e||null===e.length||e.length<=0)){a.next=2;break}return a.abrupt("return",[]);case 2:return r=t,r.dataLoading=!0,a.next=6,r.axios.get("/api/drc/v2/autoconfig/getExistDb",{params:{dbName:e}}).then((function(e){var t=e.data.data;t?r.meta.dbOptions=t:r.$Message.warning("查询DB失败")})).catch((function(e){r.$Message.error("查询DB异常: "+e)})).finally((function(){r.dataLoading=!1}));case 6:case"end":return a.stop()}}),a)})))()},selectDb:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getExistReplicationRegionOptions();case 2:return t.next=4,e.getDrcConfig();case 4:case"end":return t.stop()}}),t)})))()},getDrcConfig:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.createModal.open=!1,e.resetPath(),a=e.getParams(),e.drcConfig={},a.dbName){t.next=7;break}return e.$Message.warning("请先填写数据库"),t.abrupt("return");case 7:if(a.srcRegionName){t.next=9;break}return t.abrupt("return");case 9:return e.configDataLoading=!0,t.next=12,e.axios.get("/api/drc/v2/autoconfig/getDbMqConfig",{params:{dbName:a.dbName,srcRegionName:a.srcRegionName}}).then((function(t){var a=t.data.data,r=a&&0===t.data.status;r?(e.drcConfig=a,e.$Message.success("查询DRC配置成功 ")):e.$Message.warning("查询失败："+t.data.message)})).catch((function(t){e.$Message.error("查询异常: "+t)})).finally((function(){e.configDataLoading=!1}));case 12:case"end":return t.stop()}}),t)})))()},afterSelectExistReplication:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("afterSelectExistReplication ",e.selectedExistReplication),e.meta.srcRegionName=e.selectedExistReplication.trim(),e.getDrcConfig();case 3:case"end":return t.stop()}}),t)})))()},getExistReplicationRegionOptions:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,a.dataLoading=!0,a.meta.existReplicationRegionOptions=[],r=e.getParams(),t.next=6,a.axios.get("/api/drc/v2/autoconfig/getExistDbMqConfigDcOption",{params:{dbName:r.dbName}}).then((function(e){var t=e.data.data,r=t&&0===e.data.status;r?(a.meta.existReplicationRegionOptions=t,a.meta.existReplicationRegionOptions.length>0&&a.$Message.success("查询到 "+a.meta.existReplicationRegionOptions.length+" 个可选同步方向")):(a.meta.srcRegionName=null,a.meta.dstRegionName=null,a.$Message.warning("查询可选地域失败"))})).catch((function(e){a.$Message.error("查询可选地域失败: "+e)})).finally((function(){a.dataLoading=!1}));case 6:case"end":return t.stop()}}),t)})))()},goToCreateReplication:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.createModal.open=!0;case 1:case"end":return t.stop()}}),t)})))()},resetPath:function(){this.$router.replace({query:{dbName:this.meta.dbName,srcRegionName:this.meta.srcRegionName,dstRegionName:this.meta.dstRegionName,fixDb:this.meta.fixDb}}).catch((function(){}))},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var r=this.flattenObj(e[a]);for(var n in r)t[a+"."+n]=r[n]}return t}},computed:{},created:function(){var e=this;this.axios.get("/api/drc/v2/permission/meta/mhaReplication/modify").then((function(t){403!==t.data.status?e.meta.dbName&&(e.getExistReplicationRegionOptions(),e.getDrcConfig()):e.$router.push("/nopermission")}))}},P=G,B=(a("04de"),Object(b["a"])(P,r,n,!1,null,null,null));t["default"]=B.exports}}]);
//# sourceMappingURL=chunk-887dcb02.6d478135.js.map