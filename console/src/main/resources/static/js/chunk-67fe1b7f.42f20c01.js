(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67fe1b7f"],{"1b6a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",[e._v("Mha 集群")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("div",{staticStyle:{padding:"1px 1px"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"16"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"24"}},[a("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("查询条件")]},proxy:!0}])},[a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"10"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"集群名↵"},on:{"on-enter":function(t){return e.getData()}},model:{value:e.mhaQuery.mhaName,callback:function(t){e.$set(e.mhaQuery,"mhaName",t)},expression:"mhaQuery.mhaName"}})],1),a("Col",{attrs:{span:"8"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"DB名↵"},on:{"on-enter":function(t){return e.getData()}},model:{value:e.mhaQuery.dbName,callback:function(t){e.$set(e.mhaQuery,"dbName",t)},expression:"mhaQuery.dbName"}})],1),a("Col",{attrs:{span:"6"}},[a("Select",{attrs:{filterable:"",prefix:"ios-pin",clearable:"",placeholder:"地域"},on:{"on-change":function(t){return e.getData()}},model:{value:e.mhaQuery.regionName,callback:function(t){e.$set(e.mhaQuery,"regionName",t)},expression:"mhaQuery.regionName"}},e._l(e.regions,(function(t){return a("Option",{key:t.regionName,attrs:{value:t.regionName}},[e._v(e._s(t.regionName)+" ")])})),1)],1)],1)],1)],1)],1)],1),a("Col",{attrs:{span:"4"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Button",{attrs:{type:"primary",icon:"ios-search",loading:e.dataLoading},on:{click:function(t){return e.getData()}}},[e._v("查询")])],1),a("Row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:10,align:"middle"}},[a("Button",{attrs:{icon:"md-refresh",loading:e.dataLoading},on:{click:e.resetParam}},[e._v("重置")])],1)],1)],1),a("br"),a("Table",{attrs:{loading:e.dataLoading,stripe:"",columns:e.columns,data:e.dataWithPage,border:""},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.row,n=t.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(t){return e.checkConfig(r,n)}}},[e._v("查看 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goToLink(r,n)}}},[e._v("修改")])]}}])}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:e.total,current:e.current,"page-size-opts":[20,50,100],"page-size":20,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-change":e.getData,"on-page-size-change":e.handleChangeSize}})],1)],1),a("Drawer",{attrs:{title:"DRC配置",width:"80",closable:!0},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" 查看详情 "),a("div",{staticStyle:{float:"right","margin-right":"100px"}},[e._v(" 自动换行 "),a("i-switch",{model:{value:e.cluster.drawer.lineWrap,callback:function(t){e.$set(e.cluster.drawer,"lineWrap",t)},expression:"cluster.drawer.lineWrap"}}),e._v(" 黑夜模式 "),a("i-switch",{model:{value:e.cluster.drawer.darkMode,callback:function(t){e.$set(e.cluster.drawer,"darkMode",t)},expression:"cluster.drawer.darkMode"}})],1)]},proxy:!0}]),model:{value:e.cluster.drawer.show,callback:function(t){e.$set(e.cluster.drawer,"show",t)},expression:"cluster.drawer.show"}},[a("div",{attrs:{id:"xmlCode"}},[a("codemirror",{staticClass:"code",attrs:{options:{mode:"xml",theme:e.cluster.drawer.darkMode?"monokai":"default",autofocus:!0,lineWrapping:e.cluster.drawer.lineWrap,readOnly:!0,lineNumbers:!0,foldGutter:!0,styleActiveLine:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}},model:{value:e.cluster.drawer.data,callback:function(t){e.$set(e.cluster.drawer,"data",t)},expression:"cluster.drawer.data"}})],1)])],1)],1)},n=[],o=(a("fb6a"),a("d3b7"),a("53ca")),i=a("2909"),s=(a("7a7a"),a("d5e0"),a("697e"),a("cbc8"),{name:"mha",data:function(){var e=this;return{cluster:{modal:{remove:!1,show:!1,data:""},drawer:{lineWrap:!1,darkMode:!0,show:!1,data:""},mhaToBeRemoved:""},mhaQuery:{mhaName:null,dbName:null,regionName:null},dbNames:null,mha:{name:this.$route.query.mhaName,buId:null,regionId:null},total:0,current:1,size:20,pageSizeOpts:[20,50,100],tableData:[],bus:[],regions:[],switchOneInfo:{},columns:[{title:"序号",width:75,align:"center",render:function(t,a){return t("span",a.index+1+(e.current-1)*e.size)}},{title:"集群名",key:"mhaName"},{title:"监控",key:"monitorSwitch",width:200,align:"center",render:function(t,a){var r=a.row;return t("i-switch",{props:{size:"large",value:1===r.monitorSwitch,beforeChange:e.handleBeforeChange},scopedSlots:{open:function(){return t("span","开启")},close:function(){return t("span","关闭")}},on:{"on-change":function(){e.switchMonitor(r)}},nativeOn:{mousedown:function(){e.switchOneInfo={monitorSwitch:r.monitorSwitch}}}})}},{title:"操作",slot:"action",align:"center"}],dataLoading:!1}},computed:{dataWithPage:function(){var e=this.tableData,t=this.current*this.size-this.size,a=t+this.size;return Object(i["a"])(e).slice(t,a)}},methods:{getRegions:function(){var e=this;this.axios.get("/api/drc/v2/meta/regions/all").then((function(t){e.regions=t.data.data}))},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var r=this.flattenObj(e[a]);for(var n in r)t[a+"."+n]=r[n]}return t},resetParam:function(){this.mhaQuery={mhaName:null,dbName:null,regionName:null},this.getData()},getParams:function(){var e={mhaName:this.mhaQuery.mhaName,dbName:this.mhaQuery.dbName,regionName:this.mhaQuery.regionName,pageReq:{pageSize:this.size,pageIndex:this.current}};return this.flattenObj(e)},getData:function(){var e=this;this.dataLoading=!0;var t=this.getParams();this.axios.get("/api/drc/v2/mha/",{params:t}).then((function(t){var a=t.data,r=a.pageReq;1===a.status?e.$Message.error("查询失败"):0===a.data.length||0===r.totalCount?(e.total=0,e.current=1,e.tableData=a.data,e.$Message.warning("查询结果为空")):(e.total=r.totalCount,e.current=r.pageIndex,e.tableData=a.data,e.$Message.success("查询成功"))})).finally((function(){e.dataLoading=!1}))},handleChangeSize:function(e){var t=this;this.size=e,this.$nextTick((function(){t.getData()}))},goToLink:function(e,t){console.log("go to change messenger config for "+e.mhaName);var a=this.$router.resolve({path:"/mha/replicatorConfig",query:{mhaName:e.mhaName}});window.open(a.href,"_blank")},checkConfig:function(e,t){var a=this;console.log(e.mhaName),this.dataLoading=!0,this.axios.get("/api/drc/v2/meta/queryConfig/mha",{params:{mhaName:e.mhaName}}).then((function(e){1!==e.data.status?(a.cluster.drawer.data=e.data.data,a.cluster.drawer.show=!0,a.$Message.success("查询成功")):a.$Message.error("查询失败："+e.message)})).catch((function(e){a.$Message.error("查询异常: "+e)})).finally((function(){a.dataLoading=!1}))},handleBeforeChange:function(){var e=this;return console.log("handleBeforeChange:",this.switchOneInfo),new Promise((function(t){e.$Modal.confirm({title:"切换确认",content:"您确认要切换开关状态吗？",onOk:function(){t()}})}))},switchMonitor:function(e){var t=0===e.monitorSwitch?"on":"off";this.switchMonitors(e.mhaName,t)},switchMonitors:function(e,t){var a=this;console.log(e),this.axios.post("/api/drc/v2/monitor/switch/"+e+"/"+t).then((function(e){0===e.data.status?(console.log(t),"on"===t?a.$Message.success("监控开启成功"):a.$Message.success("监控关闭成功")):a.$Message.warning("监控操作失败"),a.getData()}))}},created:function(){this.getRegions(),this.getData()}}),c=s,l=(a("5c11"),a("2877")),u=Object(l["a"])(c,r,n,!1,null,"35ed46ed",null);t["default"]=u.exports},"25f0":function(e,t,a){"use strict";var r=a("6eeb"),n=a("825a"),o=a("d039"),i=a("ad6d"),s="toString",c=RegExp.prototype,l=c[s],u=o((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),d=l.name!=s;(u||d)&&r(RegExp.prototype,s,(function(){var e=n(this),t=String(e.source),a=e.flags,r=String(void 0===a&&e instanceof RegExp&&!("flags"in c)?i.call(e):a);return"/"+t+"/"+r}),{unsafe:!0})},2909:function(e,t,a){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}a.d(t,"a",(function(){return i}));a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("e260"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0");function n(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(e){return r(e)||n(e)||o()}},"4df4":function(e,t,a){"use strict";var r=a("0366"),n=a("7b0b"),o=a("9bdd"),i=a("e95a"),s=a("50c4"),c=a("8418"),l=a("35a1");e.exports=function(e){var t,a,u,d,h,f,g=n(e),m="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,w=void 0!==v,b=l(g),y=0;if(w&&(v=r(v,p>2?arguments[2]:void 0,2)),void 0==b||m==Array&&i(b))for(t=s(g.length),a=new m(t);t>y;y++)f=w?v(g[y],y):g[y],c(a,y,f);else for(d=b.call(g),h=d.next,a=new m;!(u=h.call(d)).done;y++)f=w?o(d,v,[u.value,y],!0):u.value,c(a,y,f);return a.length=y,a}},"5c11":function(e,t,a){"use strict";a("707a")},"707a":function(e,t,a){},8418:function(e,t,a){"use strict";var r=a("c04e"),n=a("9bf2"),o=a("5c6c");e.exports=function(e,t,a){var i=r(t);i in e?n.f(e,i,o(0,a)):e[i]=a}},a630:function(e,t,a){var r=a("23e7"),n=a("4df4"),o=a("1c7e"),i=!o((function(e){Array.from(e)}));r({target:"Array",stat:!0,forced:i},{from:n})},fb6a:function(e,t,a){"use strict";var r=a("23e7"),n=a("861d"),o=a("e8b5"),i=a("23cb"),s=a("50c4"),c=a("fc6a"),l=a("8418"),u=a("b622"),d=a("1dde"),h=a("ae40"),f=d("slice"),g=h("slice",{ACCESSORS:!0,0:0,1:2}),m=u("species"),p=[].slice,v=Math.max;r({target:"Array",proto:!0,forced:!f||!g},{slice:function(e,t){var a,r,u,d=c(this),h=s(d.length),f=i(e,h),g=i(void 0===t?h:t,h);if(o(d)&&(a=d.constructor,"function"!=typeof a||a!==Array&&!o(a.prototype)?n(a)&&(a=a[m],null===a&&(a=void 0)):a=void 0,a===Array||void 0===a))return p.call(d,f,g);for(r=new(void 0===a?Array:a)(v(g-f,0)),u=0;f<g;f++,u++)f in d&&l(r,u,d[f]);return r.length=u,r}})}}]);
//# sourceMappingURL=chunk-67fe1b7f.42f20c01.js.map