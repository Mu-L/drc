(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-080c042a"],{2532:function(e,t,a){"use strict";var n=a("23e7"),r=a("5a34"),i=a("1d80"),o=a("ab13");n({target:"String",proto:!0,forced:!o("includes")},{includes:function(e){return!!~String(i(this)).indexOf(r(e),arguments.length>1?arguments[1]:void 0)}})},3835:function(e,t,a){"use strict";function n(e){if(Array.isArray(e))return e}a.d(t,"a",(function(){return s}));a("a4d3"),a("e01a"),a("d28b"),a("e260"),a("d3b7"),a("3ca3"),a("ddb0");function r(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,i,o,s=[],l=!0,c=!1;try{if(i=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;l=!1}else for(;!(l=(n=i.call(a)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=a["return"]&&(o=a["return"](),Object(o)!==o))return}finally{if(c)throw r}}return s}}var i=a("06c5");function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){return n(e)||r(e,t)||Object(i["a"])(e,t)||o()}},"44e7":function(e,t,a){var n=a("861d"),r=a("c6b6"),i=a("b622"),o=i("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==r(e))}},"5a34":function(e,t,a){var n=a("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},"7d78":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Row",[e.alertInfo.show?a("Alert",{attrs:{type:"warning","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),e.alertInfo.successShow?a("Alert",{attrs:{type:"success","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),e.replicationType===e.meta.replicationType.DB_TO_DB?a("div",[a("Col",{attrs:{span:"12"}},[a("Row",{staticStyle:{"margin-right":"20px"}},[a("Divider",[e._v("1. 选择同步方向")]),a("Col",{attrs:{span:"11"}},[a("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"ios-pin"}}),e._v(" 源 region ")]},proxy:!0}],null,!1,2156775476)},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.srcRegionName,callback:function(t){e.$set(e.formItem,"srcRegionName",t)},expression:"formItem.srcRegionName"}},e._l(e.meta.regionOptions,(function(t){return a("Option",{key:t,attrs:{value:t,label:t}},[e._v(" "+e._s(t)+" ")])})),1)],1)],1),a("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[a("Button",{attrs:{size:"small",shape:"circle",type:"default",loading:e.dataLoading},on:{click:e.getRegionOptions}},[e._v(" -> ")])],1),a("Col",{attrs:{span:"11"}},[a("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"ios-pin"}}),e._v(" 目标 region ")]},proxy:!0}],null,!1,4278622733)},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.dstRegionName,callback:function(t){e.$set(e.formItem,"dstRegionName",t)},expression:"formItem.dstRegionName"}},e._l(e.meta.regionOptions,(function(t){return a("Option",{key:t,attrs:{value:t,label:t}},[e._v(" "+e._s(t)+" ")])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"12"}},[a("Row",[a("Divider",[e._v("2. 预览：同步集群")]),a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.table.dbMhaTableLoading},on:{click:e.getDalInfo}},[e._v(" 检查同步集群 ")]),a("Table",{attrs:{size:"small",loading:e.table.dbMhaTableLoading,stripe:"",columns:e.table.dbMhaTableColumn,data:e.preCheckMhaReplicationPage,border:""}}),a("div",[a("Page",{attrs:{transfer:!0,total:e.previewDataList.length,current:e.table.dbMhaTablePage.current,"page-size-opts":e.table.dbMhaTablePage.pageSizeOpts,"page-size":e.table.dbMhaTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbMhaTablePage,"current",t)},"on-page-size-change":function(t){e.table.dbMhaTablePage.size=t}}})],1)],1)],1)],1):e._e(),e.replicationType===e.meta.replicationType.DB_TO_MQ?a("div",[a("Col",{attrs:{span:"12"}},[a("Row",{staticStyle:{"margin-right":"20px"}},[a("Divider",[e._v("1. 选择消息投递Region")]),a("Col",{attrs:{span:"24"}},[a("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"ios-pin"}}),e._v(" 源 region "),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{size:"small",shape:"circle",type:"default",loading:e.dataLoading},on:{click:e.getRegionOptions}},[e._v("刷新 ")])]},proxy:!0}],null,!1,1193028979)},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.srcRegionName,callback:function(t){e.$set(e.formItem,"srcRegionName",t)},expression:"formItem.srcRegionName"}},e._l(e.meta.regionOptions,(function(t){return a("Option",{key:t,attrs:{value:t,label:t}},[e._v(" "+e._s(t)+" ")])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"12"}},[a("Row",[a("Divider",[e._v("2. 预览：消息投递集群")]),a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.table.dbMhaTableLoading},on:{click:e.getDalInfo}},[e._v(" 检查同步集群 ")]),a("Table",{attrs:{size:"small",loading:e.table.dbMhaTableLoading,stripe:"",columns:e.table.dbMhaMqTableColumn,data:e.preCheckMhaReplicationPage,border:""}}),a("div",[a("Page",{attrs:{transfer:!0,total:e.previewDataList.length,current:e.table.dbMhaTablePage.current,"page-size-opts":e.table.dbMhaTablePage.pageSizeOpts,"page-size":e.table.dbMhaTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbMhaTablePage,"current",t)},"on-page-size-change":function(t){e.table.dbMhaTablePage.size=t}}})],1)],1)],1)],1):e._e()],1),a("Divider"),a("Button",{attrs:{loading:e.dataLoading,type:"primary"},on:{click:e.createReplication}},[e._v("提交")])],1)},r=[],i=a("2909"),o=a("c7eb"),s=a("1da1"),l=(a("fb6a"),a("b0c0"),a("a9e3"),a("d3b7"),{name:"mhaPreview",components:{},props:{replicationType:Number,dbName:String,existReplicationRegionOptions:Array},emits:["updated"],data:function(){return{meta:{regionOptions:[],existReplicationRegionOptions:[],replicationType:{DB_TO_DB:0,DB_TO_MQ:1}},alertInfo:{show:!1,successShow:!1,title:null,message:null},formItem:{srcRegionName:null,dstRegionName:null},dataLoading:!1,constants:{DAL_CLUSTER_MODE:1},previewDataList:[],table:{dbMhaTableLoading:!1,dbMhaTableColumn:[{title:"DB名",key:"dbName"},{title:"源集群",key:"srcMhaName",render:function(e,t){var a=t.row,n=a.srcMha;if(null!=n)return e("div",[e("span",n.name),e("span",{style:{float:"right",color:"#ababab"}},n.regionName+"("+n.dcName+")")])}},{title:"目标集群",key:"dstMhaName",render:function(e,t){var a=t.row,n=a.dstMha;if(null!=n)return e("div",[e("span",n.name),e("span",{style:{float:"right",color:"#ababab"}},n.regionName+"("+n.dcName+")")])}}],dbMhaMqTableColumn:[{title:"DB名",key:"dbName"},{title:"源集群",key:"srcMhaName",render:function(e,t){var a=t.row,n=a.srcMha;if(null!=n)return e("div",[e("span",n.name),e("span",{style:{float:"right",color:"#ababab"}},n.regionName+"("+n.dcName+")")])}}],dbMhaTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}}}},methods:{getRegionOptions:function(){var e=this;return Object(s["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dataLoading=!0,e.meta.regionOptions=[],t.next=4,e.axios.get("/api/drc/v2/autoconfig/regionOptions",{params:{mode:e.constants.DAL_CLUSTER_MODE,dbName:e.dbName}}).then((function(t){var a=t.data.data,n=a&&0===t.data.status;n?(e.meta.regionOptions=a,-1===a.indexOf(e.formItem.srcRegionName)&&(e.formItem.srcRegionName=null),-1===a.indexOf(e.formItem.dstRegionName)&&(e.formItem.dstRegionName=null)):(e.formItem.srcRegionName=null,e.formItem.dstRegionName=null,e.$Message.warning("查询可选地域失败"))})).catch((function(t){e.$Message.error("查询可选地域失败: "+t)})).finally((function(){e.dataLoading=!1}));case 4:case"end":return t.stop()}}),t)})))()},getDalInfo:function(){var e=this;return Object(s["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.previewDataList=[],e.table.dbMhaTablePage.current=1,e.table.dbMhaTableLoading=!0,t.next=5,e.axios.get("/api/drc/v2/autoconfig/preCheck",{params:{mode:e.constants.DAL_CLUSTER_MODE,dbName:e.dbName,srcRegionName:e.formItem.srcRegionName,replicationType:e.replicationType}}).then((function(t){var a=t.data.data,n=a&&0===t.data.status;n?(e.previewDataList=a,console.log("total: "+e.previewDataList.length),e.$Message.success("同步集群检测成功, 共找到 "+a.length+" 个DB")):e.$Message.warning("同步集群检测失败："+t.data.message)})).catch((function(t){e.$Message.error("查询dalcluster异常: "+t)})).finally((function(){e.table.dbMhaTableLoading=!1}));case 5:case"end":return t.stop()}}),t)})))()},createReplication:function(){var e=this;return Object(s["a"])(Object(o["a"])().mark((function t(){var a,n;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={srcRegionName:e.formItem.srcRegionName,dstRegionName:e.formItem.dstRegionName,dbName:e.dbName,replicationType:e.replicationType},e.alertInfo.show=!1,e.alertInfo.successShow=!1,e.dataLoading=!0,n=e.replicationType===e.meta.replicationType.DB_TO_MQ?"mhaDbReplicationForMq":"mhaDbReplication",t.next=7,e.axios.post("/api/drc/v2/autoconfig/"+n+"/create",a).then((function(t){var a=t.data,n=0===a.status;n?(e.alertInfo.successShow=!0,e.alertInfo.message=null,e.alertInfo.title="提交成功",e.$emit("updated")):(e.alertInfo.show=!0,e.alertInfo.title="提交失败",e.alertInfo.message=a.message,e.$Message.warning("提交失败: "+a.message))})).catch((function(t){e.$Message.error("提交异常: "+t)})).finally((function(){e.dataLoading=!1}));case 7:case"end":return t.stop()}}),t)})))()},afterSwitchRegion:function(){return Object(s["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},computed:{preCheckMhaReplicationPage:function(){var e=this.previewDataList,t=this.table.dbMhaTablePage.current*this.table.dbMhaTablePage.size-this.table.dbMhaTablePage.size,a=t+this.table.dbMhaTablePage.size;return Object(i["a"])(e).slice(t,a)}},created:function(){this.getRegionOptions()}}),c=l,b=a("2877"),u=Object(b["a"])(c,n,r,!1,null,"6cd96bcc",null);t["a"]=u.exports},"81d5":function(e,t,a){"use strict";var n=a("7b0b"),r=a("23cb"),i=a("50c4");e.exports=function(e){var t=n(this),a=i(t.length),o=arguments.length,s=r(o>1?arguments[1]:void 0,a),l=o>2?arguments[2]:void 0,c=void 0===l?a:r(l,a);while(c>s)t[s++]=e;return t}},ab13:function(e,t,a){var n=a("b622"),r=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[r]=!1,"/./"[e](t)}catch(n){}}return!1}},cb29:function(e,t,a){var n=a("23e7"),r=a("81d5"),i=a("44d2");n({target:"Array",proto:!0},{fill:r}),i("fill")},efa3:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Divider",{staticStyle:{"margin-top":"50px"}},[e._v("预览：同步表")]),a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.dbTableLoading},on:{click:e.getTableInfo}},[e._v(" 检查同步表 ")]),a("Table",{attrs:{size:"small",loading:e.dbTableLoading,stripe:"",columns:e.table.dbTableColumn,data:e.preCheckTablePage,border:""}}),a("div",[a("Page",{attrs:{transfer:!0,total:e.checkTableDataList.length,current:e.table.dbTablePage.current,"page-size-opts":e.table.dbTablePage.pageSizeOpts,"page-size":e.table.dbTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbTablePage,"current",t)},"on-change":function(t){e.table.dbTablePage.current=t},"on-page-size-change":function(t){e.table.dbTablePage.size=t}}})],1)],1)},r=[],i=a("2909"),o=a("53ca"),s=a("c7eb"),l=a("3835"),c=a("b85c"),b=a("1da1"),u=(a("fb6a"),a("a9e3"),a("d3b7"),a("498a"),a("ddb0"),{name:"dbTablesPreview",props:{mode:Number,dbName:String,srcRegionName:String,dstRegionName:String,tableNames:String,replicationType:Number},emits:["updated"],data:function(){return{checkTableDataList:[],dbTableLoading:!1,table:{dbTableColumn:[{title:"序",width:50,key:"indexForShow"},{title:"库名",key:"schema",resizable:!0},{title:"表名",key:"table",resizable:!0},{title:"结果",align:"center",render:function(e,t){var a=t.row,n="ok"!==a.res?"volcano":"green",r=a.res;return e("Tag",{props:{color:n}},r)}}],dbTablePage:{total:0,current:1,size:10,pageSizeOpts:[5,10,20,100]}}}},methods:{getTableInfo:function(){var e=this;return Object(b["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.checkTableDataList=[],e.table.dbTablePage.current=1,1!==e.mode){t.next=8;break}if(e.dalClusterName){t.next=6;break}return e.$Message.warning("请先填写 dalcluster"),t.abrupt("return");case 6:t.next=11;break;case 8:if(e.dbName){t.next=11;break}return e.$Message.warning("请先填写数据库"),t.abrupt("return");case 11:if(e.srcRegionName&&(0!==e.replicationType||e.dstRegionName)){t.next=14;break}return e.$Message.warning("请先填写同步方向"),t.abrupt("return");case 14:if(e.tableNames){t.next=17;break}return e.$Message.warning("请先填写表名"),t.abrupt("return");case 17:return e.dbTableLoading=!0,t.next=20,e.axios.get("/api/drc/v2/autoconfig/preCheckTable",{params:e.flattenObj({mode:e.mode,dbName:e.dbName,srcRegionName:e.srcRegionName,dstRegionName:e.dstRegionName,replicationType:e.replicationType,tblsFilterDetail:{tableNames:e.tableNames}})}).then((function(t){var a=t.data.data;if(a){var n,r=Object(c["a"])(a.entries());try{for(r.s();!(n=r.n()).done;){var i=Object(l["a"])(n.value,2),o=i[0],s=i[1];s.indexForShow=o}}catch(b){r.e(b)}finally{r.f()}e.checkTableDataList=a,e.$Message.success("同步表检测成功, 共找到 "+a.length+" 个表")}else e.$Message.warning("同步表检测失败："+t.data.message)})).catch((function(t){e.$Message.error("查询dalcluster异常: "+t)})).finally((function(){e.dbTableLoading=!1}));case 20:case"end":return t.stop()}}),t)})))()},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var n=this.flattenObj(e[a]);for(var r in n)t[a+"."+r]=n[r]}return t}},computed:{preCheckTablePage:function(){var e=this.checkTableDataList,t=(this.table.dbTablePage.current-1)*this.table.dbTablePage.size,a=t+this.table.dbTablePage.size;return Object(i["a"])(e).slice(t,a)}},created:function(){this.tableNames&&this.tableNames.trim().length>0&&this.getTableInfo()}}),d=u,g=a("2877"),p=Object(g["a"])(d,n,r,!1,null,"647b2baf",null);t["a"]=p.exports}}]);
//# sourceMappingURL=chunk-080c042a.f2a6928d.js.map