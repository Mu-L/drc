(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1796c57e"],{"159b":function(t,e,a){"use strict";var r=a("cfe9"),c=a("fdbc"),o=a("785a"),i=a("17c2"),s=a("9112"),d=function(t){if(t&&t.forEach!==i)try{s(t,"forEach",i)}catch(e){t.forEach=i}};for(var l in c)c[l]&&d(r[l]&&r[l].prototype);d(o)},"17c2":function(t,e,a){"use strict";var r=a("b727").forEach,c=a("a640"),o=c("forEach");t.exports=o?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},a15b:function(t,e,a){"use strict";var r=a("23e7"),c=a("e330"),o=a("44ad"),i=a("fc6a"),s=a("a640"),d=c([].join),l=o!==Object,n=l||!s("join",",");r({target:"Array",proto:!0,forced:n},{join:function(t){return d(i(this),void 0===t?",":t)}})},a640:function(t,e,a){"use strict";var r=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&r((function(){a.call(null,e||function(){return 1},1)}))}},a9e1:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("base-component",[e("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[e("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),e("BreadcrumbItem",{attrs:{to:"/mha"}},[t._v("Mha 集群")]),e("BreadcrumbItem",[t._v("Replicator配置")])],1),e("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[e("div",[e("Row",[e("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.drc,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"集群名",prop:"mhaName"}},[e("Input",{attrs:{readonly:"",placeholder:"请输入集群名"},model:{value:t.drc.mhaName,callback:function(e){t.$set(t.drc,"mhaName",e)},expression:"drc.mhaName"}})],1),e("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[e("Select",{staticStyle:{width:"250px"},attrs:{multiple:"",placeholder:"选择Replicator"},model:{value:t.drc.replicators,callback:function(e){t.$set(t.drc,"replicators",e)},expression:"drc.replicators"}},t._l(t.drc.replicatorList,(function(a){return e("Option",{key:a.ip,attrs:{value:a.ip}},[t._v(t._s(a.ip)+" —— "+t._s(a.az)+" ")])})),1),t._v("   "),e("Button",{attrs:{type:"success"},on:{click:t.autoConfigReplicator}},[t._v("自动录入")])],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始拉取位点R"}},[e("Input",{attrs:{placeholder:"变更replicator机器时，请输入binlog拉取位点"},model:{value:t.drc.rGtidExecuted,callback:function(e){t.$set(t.drc,"rGtidExecuted",e)},expression:"drc.rGtidExecuted"}}),e("Row",[e("Col",{attrs:{span:"12"}},[e("Button",{on:{click:t.queryMhaMachineGtid}},[t._v("查询mha位点")]),t.hasTest1?e("span",[e("Icon",{attrs:{type:t.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess1?"green":"red"}}),t._v(" "+t._s(t.testSuccess1?"查询实时位点成功":"连接查询失败")+" ")],1):t._e()],1),e("Col",{attrs:{span:"12"}},[e("Button",{attrs:{type:"success"},on:{click:t.queryMhaGtidCheckRes}},[t._v("位点校验")])],1)],1)],1)],1)],1),e("Form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":250}},[e("FormItem",[e("Row",[e("Col",{attrs:{span:"6"}},[e("Button",{on:{click:function(e){return t.handleReset("drc")}}},[t._v("重置")])],1),e("Col",{attrs:{span:"6"}},[e("Button",{attrs:{type:"primary"},on:{click:function(e){t.preCheckConfigure()}}},[t._v("提交")])],1)],1)],1),e("Modal",{attrs:{title:"确认配置信息",width:"900px"},on:{"on-ok":t.submitReplicatorConfig},model:{value:t.drc.reviewModal,callback:function(e){t.$set(t.drc,"reviewModal",e)},expression:"drc.reviewModal"}},[e("Form",{staticStyle:{width:"80%"}},[e("FormItem",{attrs:{label:"集群名"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.drc.mhaName,callback:function(e){t.$set(t.drc,"mhaName",e)},expression:"drc.mhaName"}})],1),e("FormItem",{attrs:{label:"集群Replicator"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.drc.replicators,callback:function(e){t.$set(t.drc,"replicators",e)},expression:"drc.replicators"}})],1),e("FormItem",{attrs:{label:"新增Replicator的新增binlog拉取位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.drc.rGtidExecuted,callback:function(e){t.$set(t.drc,"rGtidExecuted",e)},expression:"drc.rGtidExecuted"}})],1)],1)],1),e("Modal",{attrs:{title:"配置结果",width:"1200px"},model:{value:t.drc.resultModal,callback:function(e){t.$set(t.drc,"resultModal",e)},expression:"drc.resultModal"}},[e("Form",{staticStyle:{width:"100%"}},[e("FormItem",{attrs:{label:"集群配置"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.result,callback:function(e){t.result=e},expression:"result"}})],1)],1)],1),e("Modal",{attrs:{title:"存在一对多共用运行配置请确认",width:"900px"},on:{"on-ok":t.reviewConfigure},model:{value:t.drc.warnModal,callback:function(e){t.$set(t.drc,"warnModal",e)},expression:"drc.warnModal"}},[e("label",{staticStyle:{color:"black"}},[t._v("共用replicator配置的集群: ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.drc.conflictMha,expression:"drc.conflictMha"}],domProps:{value:t.drc.conflictMha},on:{input:function(e){e.target.composing||t.$set(t.drc,"conflictMha",e.target.value)}}}),e("Divider"),e("div",[e("p",{staticStyle:{color:"red"}},[t._v("线上一对多replicator配置")]),e("ul",t._l(t.drc.replicators.share,(function(a){return e("ol",{key:a},[t._v(t._s(a))])})),0)]),e("Divider"),e("div",[e("p",{staticStyle:{color:"black"}},[t._v("修改后replicator配置")]),e("ul",t._l(t.drc.replicators.conflictCurrent,(function(a){return e("ol",{key:a},[t._v(t._s(a))])})),0)])],1),e("Modal",{attrs:{title:"gitd位点校验结果",width:"900px"},model:{value:t.gtidCheck.modal,callback:function(e){t.$set(t.gtidCheck,"modal",e)},expression:"gtidCheck.modal"}},[e("Form",{staticStyle:{width:"80%"}},[e("FormItem",{attrs:{label:"校验结果"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.legal,callback:function(e){t.$set(t.gtidCheck.resVo,"legal",e)},expression:"gtidCheck.resVo.legal"}})],1),e("FormItem",{attrs:{label:"当前Mha"}},[e("Input",{attrs:{autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.mha,callback:function(e){t.$set(t.gtidCheck.resVo,"mha",e)},expression:"gtidCheck.resVo.mha"}})],1),e("FormItem",{attrs:{label:"配置位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.configGtid,callback:function(e){t.$set(t.gtidCheck.resVo,"configGtid",e)},expression:"gtidCheck.resVo.configGtid"}})],1),e("FormItem",{attrs:{label:"purgedGtid"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.purgedGtid,callback:function(e){t.$set(t.gtidCheck.resVo,"purgedGtid",e)},expression:"gtidCheck.resVo.purgedGtid"}})],1)],1)],1)],1)],1)])],1)},c=[],o=(a("a15b"),a("14d9"),a("d3b7"),a("159b"),{name:"replicatorConfig.vue",data:function(){return{hasTest1:!1,testSuccess1:!1,result:!1,gtidCheck:{modal:!1,resVo:{mha:"",legal:"",configGtid:"",purgedGtid:""}},drc:{reviewModal:!1,warnModal:!1,mhaName:this.$route.query.mhaName,rGtidExecuted:"",replicators:{},replicatorList:{}}}},methods:{autoConfigReplicator:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.drc.mhaName+"&type=0&selectedIps="+this.drc.replicators).then((function(e){console.log(e.data),t.drc.replicators=[],e.data.data.forEach((function(e){return t.drc.replicators.push(e.ip)}))}))},getResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.drc.mhaName+"&type=0").then((function(e){console.log(e.data),t.drc.replicatorList=e.data.data}))},getResourcesInUse:function(){var t=this;this.axios.get("/api/drc/v2/mha/replicator",{params:{mhaName:this.drc.mhaName}}).then((function(e){console.log(t.drc.mhaName+" replicators "+e.data.data),t.drc.replicators=[],e.data.data.forEach((function(e){return t.drc.replicators.push(e)}))}))},handleReset:function(t){this.$refs[t].resetFields()},preCheckConfigure:function(){var t=this,e={mhaName:this.drc.mhaName,replicatorIps:this.drc.replicators.join(",")};console.log(e),this.axios.get("/api/drc/v2/mha/replicatorIps/check",{params:e}).then((function(e){var a=e.data.data;0===a.status?t.drc.reviewModal=!0:1===a.status?(t.drc.replicators.share=a.workingReplicatorIps,t.drc.replicators.conflictCurrent=t.drc.replicators,t.drc.conflictMha=a.conflictMha,t.drc.warnModal=!0):window.alert("config preCheck fail")}))},queryMhaMachineGtid:function(){var t=this;this.hasTest1=!1,this.drc.rGtidExecuted="";var e=this;console.log("/api/drc/v2/mha/gtid/executed?mha="+this.drc.mhaName),e.axios.get("/api/drc/v2/mha/gtid/executed?mha="+this.drc.mhaName).then((function(e){t.hasTest1=!0,0===e.data.status?(t.drc.rGtidExecuted=e.data.data,t.testSuccess1=!0):(t.testSuccess1=!1,t.$Message.warning("查询位点失败: "+e.data.message))})).catch((function(e){t.$Message.error("查询位点异常: "+e)}))},queryMhaGtidCheckRes:function(){var t=this;if(null!=this.drc.rGtidExecuted&&""!==this.drc.rGtidExecuted){var e=this;console.log("/api/drc/v2/mha/gtid/checkResult?mha="+this.drc.mhaName+"&configGtid="+this.drc.rGtidExecuted),e.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+this.drc.mhaName+"&configGtid="+this.drc.rGtidExecuted).then((function(e){0===e.data.status?(t.gtidCheck.resVo={mha:t.drc.mhaName,legal:!0===e.data.data.legal?"合理位点":"binlog已经被purge",configGtid:t.drc.rGtidExecuted,purgedGtid:e.data.data.purgedGtid},t.gtidCheck.modal=!0):console.log("api fail:/api/drc/v2/mha/gtid/checkResult?mha="+t.drc.mhaName+"&configGtid="+t.drc.rGtidExecuted)})).catch((function(e){t.$Message.error("校验位点异常: "+e)}))}else this.$Message.warning("位点为空！")},submitReplicatorConfig:function(){var t=this,e=this;this.axios.post("/api/drc/v2/config/mha/replicator",{mhaName:this.drc.mhaName,replicatorIps:this.drc.replicators,rGtidExecuted:this.drc.rGtidExecuted}).then((function(a){console.log(a.data),1!==a.data.status?(e.result=a.data.data,e.drc.reviewModal=!1,e.drc.resultModal=!0):t.$Message.warning({content:"提交失败："+a.data.message,duration:10})})).catch((function(e){t.$Message.error({content:"提交异常: "+e,duration:10})}))},reviewConfigure:function(){this.drc.reviewModal=!0}},created:function(){this.getResources(),this.getResourcesInUse()}}),i=o,s=a("2877"),d=Object(s["a"])(i,r,c,!1,null,"4d14e87c",null);e["default"]=d.exports}}]);
//# sourceMappingURL=chunk-1796c57e.dfec1f09.js.map