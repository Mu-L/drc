(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e06c703"],{"057f":function(e,t,a){var n=a("fc6a"),i=a("241c").f,r={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],l=function(e){try{return i(e)}catch(t){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==r.call(e)?l(e):i(n(e))}},"25f0":function(e,t,a){"use strict";var n=a("6eeb"),i=a("825a"),r=a("d039"),o=a("ad6d"),l="toString",s=RegExp.prototype,c=s[l],u=r((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),h=c.name!=l;(u||h)&&n(RegExp.prototype,l,(function(){var e=i(this),t=String(e.source),a=e.flags,n=String(void 0===a&&e instanceof RegExp&&!("flags"in s)?o.call(e):a);return"/"+t+"/"+n}),{unsafe:!0})},2909:function(e,t,a){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}a.d(t,"a",(function(){return o}));a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("e260"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0");function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){return n(e)||i(e)||r()}},"3ca3":function(e,t,a){"use strict";var n=a("6547").charAt,i=a("69f3"),r=a("7dd0"),o="String Iterator",l=i.set,s=i.getterFor(o);r(String,"String",(function(e){l(this,{type:o,string:String(e),index:0})}),(function(){var e,t=s(this),a=t.string,i=t.index;return i>=a.length?{value:void 0,done:!0}:(e=n(a,i),t.index+=e.length,{value:e,done:!1})}))},"4df4":function(e,t,a){"use strict";var n=a("0366"),i=a("7b0b"),r=a("9bdd"),o=a("e95a"),l=a("50c4"),s=a("8418"),c=a("35a1");e.exports=function(e){var t,a,u,h,d,p,m=i(e),f="function"==typeof this?this:Array,b=arguments.length,g=b>1?arguments[1]:void 0,M=void 0!==g,v=c(m),y=0;if(M&&(g=n(g,b>2?arguments[2]:void 0,2)),void 0==v||f==Array&&o(v))for(t=l(m.length),a=new f(t);t>y;y++)p=M?g(m[y],y):m[y],s(a,y,p);else for(h=v.call(m),d=h.next,a=new f;!(u=d.call(h)).done;y++)p=M?r(h,g,[u.value,y],!0):u.value,s(a,y,p);return a.length=y,a}},6547:function(e,t,a){var n=a("a691"),i=a("1d80"),r=function(e){return function(t,a){var r,o,l=String(i(t)),s=n(a),c=l.length;return s<0||s>=c?e?"":void 0:(r=l.charCodeAt(s),r<55296||r>56319||s+1===c||(o=l.charCodeAt(s+1))<56320||o>57343?e?l.charAt(s):r:e?l.slice(s,s+2):o-56320+(r-55296<<10)+65536)}};e.exports={codeAt:r(!1),charAt:r(!0)}},"746f":function(e,t,a){var n=a("428f"),i=a("5135"),r=a("e538"),o=a("9bf2").f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||o(t,e,{value:r.f(e)})}},"76b5":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/accessV2"}},[e._v("DRC配置")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[[a("Steps",{staticStyle:{width:"90%","margin-left":"50px","margin-bottom":"15px","margin-top":"50px"},attrs:{current:e.current}},[a("Step",{style:{cursor:"pointer"},attrs:{title:"新建DRC集群",content:"新建同步DRC"},nativeOn:{click:function(t){return e.jumpTo(0)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"mha配置",content:"mha录入db信息"},nativeOn:{click:function(t){return e.jumpTo(1)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"预检测",content:"检测mha配置"},nativeOn:{click:function(t){return e.jumpTo(2)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"建立同步",content:"配置Replicator和Applier实例"},nativeOn:{click:function(t){return e.jumpTo(3)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"完成",content:"已完成DRC接入"},nativeOn:{click:function(t){return e.jumpTo(4)}}})],1)],0===e.current?a("buildV2",e._b({on:{oldClusterChanged:e.updateOldCluster,newClusterChanged:e.updateNewCluster,newDrcZoneChanged:e.updateNewZone,oldDrcZoneChanged:e.updateOldZone}},"buildV2",e.clusterPair,!1)):e._e(),1===e.current?a("mhaConfig",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOldCluster,newClusterChanged:e.updateNewCluster}},"mhaConfig",e.clusterPair,!1)):e._e(),2===e.current?a("preCheck",e._b({},"preCheck",e.clusterPair,!1)):e._e(),3===e.current?a("drc",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOldCluster,newClusterChanged:e.updateNewCluster}},"drc",e.clusterPair,!1)):e._e(),4===e.current?a("complete"):e._e(),a("Divider"),a("div",{staticStyle:{padding:"1px 1px",height:"100px","margin-top":"75px"}},[a("div",[e.current>0?a("Button",{staticStyle:{position:"absolute",left:"465px"},attrs:{type:"primary"},on:{click:e.prev}},[e._v(" 上一步 ")]):e._e(),e.current<4?a("Button",{staticStyle:{position:"absolute",left:"790px"},attrs:{type:"primary"},on:{click:e.next}},[e._v(" 下一步 ")]):e._e()],1)])],2)],1)},i=[],r=(a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"build",staticStyle:{"margin-top":"50px"},attrs:{model:e.build,rules:e.ruleBuild,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源Mha集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOldMha},model:{value:e.build.oldClusterName,callback:function(t){e.$set(e.build,"oldClusterName",t)},expression:"build.oldClusterName"}})],1),a("FormItem",{attrs:{label:"源集群机房区域",prop:"oldDrcZone"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:e.changeOldZone},model:{value:e.build.oldDrcZone,callback:function(t){e.$set(e.build,"oldDrcZone",t)},expression:"build.oldDrcZone"}},e._l(e.build.drcZoneList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新Mha集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},on:{input:e.changeNewMha},model:{value:e.build.newClusterName,callback:function(t){e.$set(e.build,"newClusterName",t)},expression:"build.newClusterName"}})],1),a("FormItem",{attrs:{label:"新集群机房区域",prop:"newDrcZone"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:e.changeNewZone},model:{value:e.build.newDrcZone,callback:function(t){e.$set(e.build,"newDrcZone",t)},expression:"build.newDrcZone"}},e._l(e.build.drcZoneList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"BU名",prop:"bu"}},[a("Input",{attrs:{placeholder:"请输入BU名，自动绑定route策略"},on:{input:e.changeBu},model:{value:e.build.bu,callback:function(t){e.$set(e.build,"bu",t)},expression:"build.bu"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"DAL Cluster名",prop:"dalclustername"}},[a("Input",{attrs:{placeholder:"请输入DAL Cluster名"},on:{input:e.changeDalClusterName},model:{value:e.build.dalclustername,callback:function(t){e.$set(e.build,"dalclustername",t)},expression:"build.dalclustername"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"appid",prop:"appid"}},[a("Input",{attrs:{placeholder:"请输入appid"},on:{input:e.changeAppId},model:{value:e.build.appid,callback:function(t){e.$set(e.build,"appid",t)},expression:"build.appid"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("build")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("build")}}},[e._v("新建DRC同步集群")]),a("Modal",{attrs:{title:"创建DRC"},on:{"on-ok":function(t){return e.postBuild("build")}},model:{value:e.build.modal,callback:function(t){e.$set(e.build,"modal",t)},expression:"build.modal"}},[a("p",[e._v('确定创建新DRC "'+e._s(e.build.oldClusterName+e.build.newClusterName)+'" 吗？并且设置BU/DAL Cluster/appid为 "'+e._s(e.build.bu)+'"/"'+e._s(e.build.dalclustername)+'"/"'+e._s(e.build.appid)+'"')])])],1)],1)],1)}),o=[],l={name:"buildV2",props:{oldClusterName:String,newClusterName:String,oldDrcZone:String,newDrcZone:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,build:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,bu:"",dalclustername:"",appid:"",oldDrcZone:this.oldDrcZone,newDrcZone:this.newDrcZone,drcZoneList:[{value:"shaoy",label:"上海欧阳"},{value:"shaxy",label:"上海新源"},{value:"sharb",label:"上海日版"},{value:"shajq",label:"上海金桥"},{value:"shafq",label:"上海福泉"},{value:"shajz",label:"上海金钟"},{value:"ntgxh",label:"南通星湖大道"},{value:"ntgxy",label:"ntgxy"},{value:"fraaws",label:"法兰克福AWS"},{value:"shali",label:"上海阿里"},{value:"sinibuaws",label:"IBU-VPC"},{value:"sinibualiyun",label:"IBU-VPC(aliyun)"},{value:"sinaws",label:"新加坡AWS"}]},ruleBuild:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],oldDrcZone:[{required:!0,message:"选择源集群区域",trigger:"change"}],newDrcZone:[{required:!0,message:"选择新集群区域",trigger:"change"}],bu:[{required:!0,message:"BU名不能为空",trigger:"blur"}],dalclustername:[{required:!0,message:"DAL Cluster名不能为空",trigger:"blur"}],appid:[{required:!0,message:"cluster appid不能为空",trigger:"blur"}]}}},methods:{postBuild:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.hasResp=!1,a.axios.post("/api/drc/v1/access/mha/standalone",{buName:t.build.bu,dalClusterName:t.build.dalclustername,appid:t.build.appid,originalMha:t.build.oldClusterName,originalMhaDc:t.build.oldDrcZone,newBuiltMha:t.build.newClusterName,newBuiltMhaDc:t.build.newDrcZone}).then((function(e){a.hasResp=!0,0===e.data.status?(a.status="success",a.title="集群创建完成!",a.message=e.data.message):(a.status="error",a.title="集群创建失败!",a.message=e.data.message)}))):a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeOldMha:function(){this.$emit("oldClusterChanged",this.build.oldClusterName)},changeNewMha:function(){this.$emit("newClusterChanged",this.build.newClusterName)},changeOldZone:function(){this.$emit("oldDrcZoneChanged",this.build.oldDrcZone)},changeNewZone:function(){this.$emit("newDrcZoneChanged",this.build.newDrcZone)},changeBu:function(){this.$emit("buChanged",this.build.bu)},changeDalClusterName:function(){this.$emit("dalclusternameChanged",this.build.dalclustername)},changeAppId:function(){this.$emit("appidChanged",this.build.appid)},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.build.modal=!0:t.$Message.error("仍有必填项未填!")}))}}},s=l,c=a("2877"),u=Object(c["a"])(s,r,o,!1,null,"d476aaa2",null),h=u.exports,d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Row",[a("i-col",{attrs:{span:"12"}},[a("Form",{ref:"oldMhaMachine",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.oldMhaMachine,rules:e.ruleMhaMachine,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOldMha},model:{value:e.oldMhaMachine.mhaName,callback:function(t){e.$set(e.oldMhaMachine,"mhaName",t)},expression:"oldMhaMachine.mhaName"}})],1),a("FormItem",{attrs:{label:"添加Ip",prop:"ip"}},[a("Input",{attrs:{number:"",placeholder:"请输入录入DB的IP"},model:{value:e.oldMhaMachine.ip,callback:function(t){e.$set(e.oldMhaMachine,"ip",t)},expression:"oldMhaMachine.ip"}})],1),a("FormItem",{attrs:{label:"Port",prop:"port"}},[a("Input",{attrs:{placeholder:"请输入录入DB端口"},model:{value:e.oldMhaMachine.port,callback:function(t){e.$set(e.oldMhaMachine,"port",t)},expression:"oldMhaMachine.port"}})],1),a("FormItem",{attrs:{label:"DB机房",prop:"idc"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择db机房区域"},model:{value:e.oldMhaMachine.idc,callback:function(t){e.$set(e.oldMhaMachine,"idc",t)},expression:"oldMhaMachine.idc"}},e._l(e.selectOption.drcZoneList,(function(t){return a("Option",{key:t.key,attrs:{value:t.value}},[e._v(e._s(t.key))])})),1)],1),a("FormItem",{attrs:{label:"UUID",prop:"uuid"}},[a("Input",{attrs:{placeholder:"请输入录入DB的uuid"},model:{value:e.oldMhaMachine.uuid,callback:function(t){e.$set(e.oldMhaMachine,"uuid",t)},expression:"oldMhaMachine.uuid"}}),a("Button",{on:{click:e.queryOldMhaMachineUuid}},[e._v("连接查询")]),e.hasTest1?a("span",[a("Icon",{attrs:{type:e.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:e.testSuccess1?"green":"red"}}),e._v(" "+e._s(e.testSuccess1?"连接查询成功":"连接查询失败，请手动输入uuid")+" ")],1):e._e()],1),a("FormItem",{attrs:{label:"Master",prop:"master"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否为Master"},model:{value:e.oldMhaMachine.master,callback:function(t){e.$set(e.oldMhaMachine,"master",t)},expression:"oldMhaMachine.master"}},e._l(e.selectOption.isMaster,(function(t){return a("Option",{key:t.key,attrs:{value:t.value}},[e._v(e._s(t.key))])})),1)],1),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.preCheckOldMhaMachine("oldMhaMachine")}}},[e._v("录入DB")]),a("br"),a("br")],1)],1)],1),a("i-col",{attrs:{span:"12"}},[a("Form",{ref:"newMhaMachine",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.newMhaMachine,rules:e.ruleMhaMachine,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"mhaName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeNewMha},model:{value:e.newMhaMachine.mhaName,callback:function(t){e.$set(e.newMhaMachine,"mhaName",t)},expression:"newMhaMachine.mhaName"}})],1),a("FormItem",{attrs:{label:"添加Ip",prop:"ip"}},[a("Input",{attrs:{placeholder:"请输入录入DB的IP"},model:{value:e.newMhaMachine.ip,callback:function(t){e.$set(e.newMhaMachine,"ip",t)},expression:"newMhaMachine.ip"}})],1),a("FormItem",{attrs:{label:"Port",prop:"port"}},[a("Input",{attrs:{number:"",placeholder:"请输入录入DB端口"},model:{value:e.newMhaMachine.port,callback:function(t){e.$set(e.newMhaMachine,"port",t)},expression:"newMhaMachine.port"}})],1),a("FormItem",{attrs:{label:"DB机房",prop:"idc"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择db机房区域"},model:{value:e.newMhaMachine.idc,callback:function(t){e.$set(e.newMhaMachine,"idc",t)},expression:"newMhaMachine.idc"}},e._l(e.selectOption.drcZoneList,(function(t){return a("Option",{key:t.key,attrs:{boolean:"",value:t.value}},[e._v(e._s(t.key))])})),1)],1),a("FormItem",{attrs:{label:"UUID",prop:"uuid"}},[a("Input",{attrs:{placeholder:"请输入录入DB的uuid"},model:{value:e.newMhaMachine.uuid,callback:function(t){e.$set(e.newMhaMachine,"uuid",t)},expression:"newMhaMachine.uuid"}}),a("Button",{on:{click:e.queryNewMhaMachineUuid}},[e._v("连接查询")]),e.hasTest2?a("span",[a("Icon",{attrs:{type:e.testSuccess2?"ios-checkmark-circle":"ios-close-circle",color:e.testSuccess2?"green":"red"}}),e._v(" "+e._s(e.testSuccess2?"连接查询成功":"连接查询失败，请手动输入uuid")+" ")],1):e._e()],1),a("FormItem",{attrs:{label:"Master",prop:"master"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否为Master"},model:{value:e.newMhaMachine.master,callback:function(t){e.$set(e.newMhaMachine,"master",t)},expression:"newMhaMachine.master"}},e._l(e.selectOption.isMaster,(function(t){return a("Option",{key:t.key,attrs:{value:t.value}},[e._v(e._s(t.key))])})),1)],1),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.preCheckNewMhaMachine("newMhaMachine")}}},[e._v("录入DB")]),a("br"),a("br")],1)],1)],1)],1),a("Modal",{attrs:{title:"录入左侧Mha Db信息"},on:{"on-ok":e.submitOldMhaMachine},model:{value:e.oldMhaMachine.modal,callback:function(t){e.$set(e.oldMhaMachine,"modal",t)},expression:"oldMhaMachine.modal"}},[a("p",[e._v("Mha: "+e._s(e.oldMhaMachine.mhaName)+" ")]),a("p",[e._v(" db信息 [host: "+e._s(e.oldMhaMachine.ip)+":"+e._s(e.oldMhaMachine.port)+"]")]),a("p",[e._v(" db信息 [isMaster:"+e._s(e.oldMhaMachine.master)+"]")]),a("p",[e._v(" db信息 [idc:"+e._s(e.oldMhaMachine.idc)+"]")]),a("p",[e._v(" db信息 [uuid:"+e._s(e.oldMhaMachine.uuid)+"]")])]),a("Modal",{attrs:{title:"录入右侧Mha Db信息"},on:{"on-ok":e.submitNewMhaMachine},model:{value:e.newMhaMachine.modal,callback:function(t){e.$set(e.newMhaMachine,"modal",t)},expression:"newMhaMachine.modal"}},[a("p",[e._v("Mha: "+e._s(e.newMhaMachine.mhaName)+" ")]),a("p",[e._v(" db信息 [host: "+e._s(e.newMhaMachine.ip)+":"+e._s(e.newMhaMachine.port)+"]")]),a("p",[e._v(" db信息 [isMaster:"+e._s(e.newMhaMachine.master)+"]")]),a("p",[e._v(" db信息 [idc:"+e._s(e.newMhaMachine.idc)+"]")]),a("p",[e._v(" db信息 [uuid:"+e._s(e.newMhaMachine.uuid)+"]")])])],1)},p=[],m={name:"mhaConfig",props:{oldClusterName:String,newClusterName:String,oldDrcZone:String,newDrcZone:String},data:function(){var e=function(e,t,a){if(!/^[0-9]+$/.test(t))return a(new Error("请填写整数port"));a()},t=function(e,t,a){if(!/0|1/.test(t))return a(new Error("请填写整数port"));a()};return{result:"",status:"",title:"",message:"",hasResp:!1,hasTest1:!1,testSuccess1:!1,hasTest2:!1,testSuccess2:!1,oldMhaMachine:{modal:!1,mhaName:this.oldClusterName,zoneId:this.oldDrcZone,ip:"",port:"",idc:this.oldDrcZone,uuid:"",master:1},newMhaMachine:{modal:!1,mhaName:this.newClusterName,zoneId:this.newDrcZone,ip:"",port:"",idc:this.newDrcZone,uuid:"",master:1},ruleMhaMachine:{mhaName:[{required:!0,message:"mha集群名不能为空",trigger:"blur"}],ip:[{required:!0,message:"ip不能为空",trigger:"blur"}],port:[{required:!0,validator:e,trigger:"blur"}],idc:[{required:!0,message:"选择db区域",trigger:"blur"}],uuid:[{required:!0,message:"uuid不能为空",trigger:"blur"}],master:[{required:!0,validator:t,trigger:"blur"}]},selectOption:{isMaster:[{key:"Master",value:1},{key:"Slave",value:0}],drcZoneList:[{value:"shaoy",key:"上海欧阳"},{value:"shaxy",key:"上海新源"},{value:"sharb",key:"上海日版"},{value:"shajq",key:"上海金桥"},{value:"shafq",key:"上海福泉"},{value:"shajz",key:"上海金钟"},{value:"ntgxh",key:"南通星湖大道"},{value:"ntgxy",label:"ntgxy"},{value:"fraaws",key:"法兰克福AWS"},{value:"shali",key:"上海阿里"},{value:"sinibuaws",key:"IBU-VPC"},{value:"sinibualiyun",label:"IBU-VPC(aliyun)"},{value:"sinaws",key:"新加坡AWS"}]}}},methods:{changeOldMha:function(){this.$emit("oldClusterChanged",this.oldMhaMachine.mhaName)},changeNewMha:function(){this.$emit("newClusterChanged",this.newMhaMachine.mhaName)},queryOldMhaMachineUuid:function(){var e=this,t=this;console.log("/api/drc/v1/mha/uuid/"+this.oldMhaMachine.mhaName+","+this.newMhaMachine.mhaName+"/"+this.oldMhaMachine.ip+"/"+this.oldMhaMachine.port+"/"+this.oldMhaMachine.master),t.axios.get("/api/drc/v1/mha/uuid/"+this.oldMhaMachine.mhaName+","+this.newMhaMachine.mhaName+"/"+this.oldMhaMachine.ip+"/"+this.oldMhaMachine.port+"/"+this.oldMhaMachine.master).then((function(t){e.hasTest1=!0,0===t.data.status?(e.oldMhaMachine.uuid=t.data.data,e.testSuccess1=!0):e.testSuccess1=!1}))},queryNewMhaMachineUuid:function(){var e=this,t=this;t.axios.get("/api/drc/v1/mha/uuid/"+this.oldMhaMachine.mhaName+","+this.newMhaMachine.mhaName+"/"+this.newMhaMachine.ip+"/"+this.newMhaMachine.port+"/"+this.oldMhaMachine.master).then((function(t){e.hasTest2=!0,0===t.data.status?(e.newMhaMachine.uuid=t.data.data,e.testSuccess2=!0):e.testSuccess2=!1}))},preCheckOldMhaMachine:function(e){var t=this;this.$refs[e].validate((function(e){e?t.oldMhaMachine.modal=!0:t.$Message.error("仍有必填项未填!")}))},submitOldMhaMachine:function(){var e=this,t=this;t.axios.post("/api/drc/v1/access/mha/machineInfo",{mhaName:this.oldMhaMachine.mhaName,master:this.oldMhaMachine.master,mySQLInstance:{ip:this.oldMhaMachine.ip,port:this.oldMhaMachine.port,idc:this.oldMhaMachine.idc,uuid:this.oldMhaMachine.uuid}}).then((function(a){t.hasResp=!0,0===a.data.status?(t.status="success",t.title="mha:"+e.oldMhaMachine.mhaName+"录入db成功!",t.message=a.data.message):(t.status="error",t.title="mha:"+e.oldMhaMachine.mhaName+"录入db失败!",t.message=a.data.message)}))},preCheckNewMhaMachine:function(e){var t=this;this.$refs[e].validate((function(e){e?t.newMhaMachine.modal=!0:t.$Message.error("仍有必填项未填!")}))},submitNewMhaMachine:function(){var e=this,t=this;t.axios.post("/api/drc/v1/access/mha/machineInfo",{mhaName:this.newMhaMachine.mhaName,master:this.newMhaMachine.master,mySQLInstance:{ip:this.newMhaMachine.ip,port:this.newMhaMachine.port,idc:this.newMhaMachine.idc,uuid:this.newMhaMachine.uuid}}).then((function(a){t.hasResp=!0,0===a.data.status?(t.status="success",t.title="mha:"+e.newMhaMachine.mhaName+"录入db成功!",t.message=a.data.message):(t.status="error",t.title="mha:"+e.newMhaMachine.mhaName+"录入db失败!",t.message=a.data.message)}))}}},f=m,b=Object(c["a"])(f,d,p,!1,null,"07ae9460",null),g=b.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Row",[a("i-col",{attrs:{span:"12"}},[a("Form",{staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.oldMha,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[a("Row",[a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{readonly:"",placeholder:"请输入源集群名"},model:{value:e.oldMha.mhaName,callback:function(t){e.$set(e.oldMha,"mhaName",t)},expression:"oldMha.mhaName"}})],1),a("Col",{attrs:{span:"5"}},[a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(t){return e.checkMySqlConfig(e.oldMha)}}},[e._v("配置校验")])],1)],1)],1),a("FormItem",{attrs:{label:"相关表",prop:"ip"}},[a("Row",[a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{placeholder:"请输入同步相关表"},model:{value:e.oldMha.nameFilter,callback:function(t){e.$set(e.oldMha,"nameFilter",t)},expression:"oldMha.nameFilter"}})],1),a("Col",{attrs:{span:"5"}},[a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(t){return e.checkMySqlTables(e.oldMha)}}},[e._v("表校验")])],1)],1)],1)],1)],1),a("i-col",{attrs:{span:"12"}},[a("Form",{staticStyle:{float:"left","margin-top":"50px"},attrs:{model:e.newMha,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[a("Row",[a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{readonly:"",placeholder:"请输入源集群名"},model:{value:e.newMha.mhaName,callback:function(t){e.$set(e.newMha,"mhaName",t)},expression:"newMha.mhaName"}})],1),a("Col",{attrs:{span:"5"}},[a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(t){return e.checkMySqlConfig(e.newMha)}}},[e._v("配置校验")])],1)],1)],1),a("FormItem",{attrs:{label:"相关表",prop:"ip"}},[a("Row",[a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{placeholder:"请输入同步相关表"},model:{value:e.newMha.nameFilter,callback:function(t){e.$set(e.newMha,"nameFilter",t)},expression:"newMha.nameFilter"}})],1),a("Col",{attrs:{span:"5"}},[a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(t){return e.checkMySqlTables(e.newMha)}}},[e._v("表校验")])],1)],1)],1)],1)],1)],1),a("Modal",{attrs:{title:"预检测结果",width:"900px"},model:{value:e.configCheck.modal,callback:function(t){e.$set(e.configCheck,"modal",t)},expression:"configCheck.modal"}},[a("Form",{staticStyle:{width:"100%"}},[a("FormItem",{attrs:{label:"BINLOG [SHOULD BE: ON]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.binlogMode,callback:function(t){e.$set(e.configCheck,"binlogMode",t)},expression:"configCheck.binlogMode"}})],1),a("FormItem",{attrs:{label:"BINLOG_FORMAT  [SHOULD BE: ROW]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.binlogFormat,callback:function(t){e.$set(e.configCheck,"binlogFormat",t)},expression:"configCheck.binlogFormat"}})],1),a("FormItem",{attrs:{label:"binlogVersion1  [SHOULD BE: OFF]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.binlogVersion1,callback:function(t){e.$set(e.configCheck,"binlogVersion1",t)},expression:"configCheck.binlogVersion1"}})],1),a("FormItem",{attrs:{label:"BTDT [SHOULD BE: writeSet]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.binlogTransactionDependency,callback:function(t){e.$set(e.configCheck,"binlogTransactionDependency",t)},expression:"configCheck.binlogTransactionDependency"}})],1),a("FormItem",{attrs:{label:"GTID_MODE [SHOULD BE: ON]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.gtidMode,callback:function(t){e.$set(e.configCheck,"gtidMode",t)},expression:"configCheck.gtidMode"}})],1),a("FormItem",{attrs:{label:"DRC系统表数量 [SHOULD BE: 1/2]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.drcTables,callback:function(t){e.$set(e.configCheck,"drcTables",t)},expression:"configCheck.drcTables"}})],1),a("FormItem",{attrs:{label:"自增步长"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.autoIncrementStep,callback:function(t){e.$set(e.configCheck,"autoIncrementStep",t)},expression:"configCheck.autoIncrementStep"}})],1),a("FormItem",{attrs:{label:"自增offSet"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.autoIncrementOffset,callback:function(t){e.$set(e.configCheck,"autoIncrementOffset",t)},expression:"configCheck.autoIncrementOffset"}})],1),a("FormItem",{attrs:{label:"DRC3对帐号 [SHOULD BE: three accounts ready]"}},[a("Input",{attrs:{readonly:""},model:{value:e.configCheck.drcAccounts,callback:function(t){e.$set(e.configCheck,"drcAccounts",t)},expression:"configCheck.drcAccounts"}})],1)],1)],1),a("Modal",{attrs:{title:"表检验",width:"900px"},model:{value:e.tablesCheckModal,callback:function(t){e.tablesCheckModal=t},expression:"tablesCheckModal"}},[a("Card",[a("div",{attrs:{slot:"title"},slot:"title"},[a("span",[e._v("相关表")])]),a("Table",{attrs:{stripe:"",columns:e.columns,data:e.dataWithPage,border:""}}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:e.tableData.length,current:e.current,"page-size-opts":e.pageSizeOpts,"page-size":this.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-page-size-change":e.handleChangeSize}})],1)],1)],1)],1)},v=[],y=(a("fb6a"),a("2909")),w={name:"preCheck",props:{oldClusterName:String,newClusterName:String,oldDrcZone:String,newDrcZone:String},data:function(){return{oldMha:{mhaName:this.oldClusterName,nameFilter:""},newMha:{mhaName:this.newClusterName,nameFilter:""},configCheck:{binlogMode:"",binlogFormat:"",binlogVersion1:"",binlogTransactionDependency:"",gtidMode:"",drcTables:0,autoIncrementStep:0,autoIncrementOffset:0,drcAccounts:"",modal:!1},tablesCheckModal:!1,tableData:[],columns:[{title:"序号",width:75,align:"center",fixed:"left",render:function(e,t){return e("span",t.index+1)}},{title:"库名",key:"schema"},{title:"表名",key:"table"},{title:"无OnUpdate字段",key:"noOnUpdateColumn",sortable:!0},{title:"无OnUpdate字段索引",key:"noOnUpdateKey",sortable:!0},{title:"无PkUk",key:"noPkUk",sortable:!0},{title:"支持Truncate",key:"approveTruncate",sortable:!0},{title:"存在DefaultTime为0",key:"timeDefaultZero",sortable:!0}],total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}},computed:{dataWithPage:function(){var e=this.tableData,t=this.current*this.size-this.size,a=t+this.size;return Object(y["a"])(e).slice(t,a)}},methods:{checkMySqlConfig:function(e){var t=this;this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","检测中，请稍等...")])}}),this.axios.get("/api/drc/v1/build/preCheckMySqlConfig?mha="+e.mhaName).then((function(e){console.log(e);var a=e.data.data;console.log(a),t.configCheck.binlogMode=a.binlogMode,t.configCheck.binlogFormat=a.binlogFormat,t.configCheck.binlogVersion1=a.binlogVersion1,t.configCheck.binlogTransactionDependency=a.binlogTransactionDependency,t.configCheck.gtidMode=a.gtidMode,t.configCheck.drcTables=a.drcTables,t.configCheck.autoIncrementStep=a.autoIncrementStep,t.configCheck.autoIncrementOffset=a.autoIncrementOffset,t.configCheck.drcAccounts=a.drcAccounts,t.$Spin.hide(),t.configCheck.modal=!0}))},checkMySqlTables:function(e){var t=this;this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","检测中，请稍等...")])}}),setTimeout((function(){t.$Spin.hide()}),8e4),this.axios.get("/api/drc/v1/build/preCheckMySqlTables?mha="+e.mhaName+"&nameFilter="+e.nameFilter).then((function(e){t.tableData=e.data.data,t.$Spin.hide(),t.tablesCheckModal=!0}))},handleChangeSize:function(e){this.size=e}}},C=w,k=Object(c["a"])(C,M,v,!1,null,"d4194a96",null),S=k.exports,x=a("39ba"),N=a("e537"),I={components:{buildV2:h,mhaConfig:g,preCheck:S,drc:x["a"],complete:N["a"]},data:function(){return{current:0,clusterPair:{oldClusterName:this.$route.query.clustername,newClusterName:this.$route.query.newclustername,env:"",oldDrcZone:"",newDrcZone:""}}},methods:{jumpTo:function(e){this.current=e,this.hasResp=!1},next:function(){this.current=this.current+1,this.hasResp=!1},prev:function(){this.current=this.current-1,this.hasResp=!1},updateOldCluster:function(e){this.clusterPair.oldClusterName=e},updateNewCluster:function(e){this.clusterPair.newClusterName=e},updateOldZone:function(e){this.clusterPair.oldDrcZone=e},updateNewZone:function(e){this.clusterPair.newDrcZone=e},updateEnv:function(e){this.clusterPair.env=e}},created:function(){var e=this.$route.query.step;"undefined"===typeof e?console.log("curStep undefined, do nothing"):this.jumpTo(Number(e))}},_=I,D=Object(c["a"])(_,n,i,!1,null,"05571539",null);t["default"]=D.exports},8418:function(e,t,a){"use strict";var n=a("c04e"),i=a("9bf2"),r=a("5c6c");e.exports=function(e,t,a){var o=n(t);o in e?i.f(e,o,r(0,a)):e[o]=a}},a4d3:function(e,t,a){"use strict";var n=a("23e7"),i=a("da84"),r=a("d066"),o=a("c430"),l=a("83ab"),s=a("4930"),c=a("fdbf"),u=a("d039"),h=a("5135"),d=a("e8b5"),p=a("861d"),m=a("825a"),f=a("7b0b"),b=a("fc6a"),g=a("c04e"),M=a("5c6c"),v=a("7c73"),y=a("df75"),w=a("241c"),C=a("057f"),k=a("7418"),S=a("06cf"),x=a("9bf2"),N=a("d1e7"),I=a("9112"),_=a("6eeb"),D=a("5692"),O=a("f772"),$=a("d012"),F=a("90e3"),B=a("b622"),Z=a("e538"),T=a("746f"),A=a("d44e"),R=a("69f3"),P=a("b727").forEach,q=O("hidden"),j="Symbol",U="prototype",E=B("toPrimitive"),L=R.set,z=R.getterFor(j),V=Object[U],H=i.Symbol,W=r("JSON","stringify"),J=S.f,G=x.f,Q=C.f,K=N.f,X=D("symbols"),Y=D("op-symbols"),ee=D("string-to-symbol-registry"),te=D("symbol-to-string-registry"),ae=D("wks"),ne=i.QObject,ie=!ne||!ne[U]||!ne[U].findChild,re=l&&u((function(){return 7!=v(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(e,t,a){var n=J(V,t);n&&delete V[t],G(e,t,a),n&&e!==V&&G(V,t,n)}:G,oe=function(e,t){var a=X[e]=v(H[U]);return L(a,{type:j,tag:e,description:t}),l||(a.description=t),a},le=c?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof H},se=function(e,t,a){e===V&&se(Y,t,a),m(e);var n=g(t,!0);return m(a),h(X,n)?(a.enumerable?(h(e,q)&&e[q][n]&&(e[q][n]=!1),a=v(a,{enumerable:M(0,!1)})):(h(e,q)||G(e,q,M(1,{})),e[q][n]=!0),re(e,n,a)):G(e,n,a)},ce=function(e,t){m(e);var a=b(t),n=y(a).concat(me(a));return P(n,(function(t){l&&!he.call(a,t)||se(e,t,a[t])})),e},ue=function(e,t){return void 0===t?v(e):ce(v(e),t)},he=function(e){var t=g(e,!0),a=K.call(this,t);return!(this===V&&h(X,t)&&!h(Y,t))&&(!(a||!h(this,t)||!h(X,t)||h(this,q)&&this[q][t])||a)},de=function(e,t){var a=b(e),n=g(t,!0);if(a!==V||!h(X,n)||h(Y,n)){var i=J(a,n);return!i||!h(X,n)||h(a,q)&&a[q][n]||(i.enumerable=!0),i}},pe=function(e){var t=Q(b(e)),a=[];return P(t,(function(e){h(X,e)||h($,e)||a.push(e)})),a},me=function(e){var t=e===V,a=Q(t?Y:b(e)),n=[];return P(a,(function(e){!h(X,e)||t&&!h(V,e)||n.push(X[e])})),n};if(s||(H=function(){if(this instanceof H)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=F(e),a=function(e){this===V&&a.call(Y,e),h(this,q)&&h(this[q],t)&&(this[q][t]=!1),re(this,t,M(1,e))};return l&&ie&&re(V,t,{configurable:!0,set:a}),oe(t,e)},_(H[U],"toString",(function(){return z(this).tag})),_(H,"withoutSetter",(function(e){return oe(F(e),e)})),N.f=he,x.f=se,S.f=de,w.f=C.f=pe,k.f=me,Z.f=function(e){return oe(B(e),e)},l&&(G(H[U],"description",{configurable:!0,get:function(){return z(this).description}}),o||_(V,"propertyIsEnumerable",he,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!s,sham:!s},{Symbol:H}),P(y(ae),(function(e){T(e)})),n({target:j,stat:!0,forced:!s},{for:function(e){var t=String(e);if(h(ee,t))return ee[t];var a=H(t);return ee[t]=a,te[a]=t,a},keyFor:function(e){if(!le(e))throw TypeError(e+" is not a symbol");if(h(te,e))return te[e]},useSetter:function(){ie=!0},useSimple:function(){ie=!1}}),n({target:"Object",stat:!0,forced:!s,sham:!l},{create:ue,defineProperty:se,defineProperties:ce,getOwnPropertyDescriptor:de}),n({target:"Object",stat:!0,forced:!s},{getOwnPropertyNames:pe,getOwnPropertySymbols:me}),n({target:"Object",stat:!0,forced:u((function(){k.f(1)}))},{getOwnPropertySymbols:function(e){return k.f(f(e))}}),W){var fe=!s||u((function(){var e=H();return"[null]"!=W([e])||"{}"!=W({a:e})||"{}"!=W(Object(e))}));n({target:"JSON",stat:!0,forced:fe},{stringify:function(e,t,a){var n,i=[e],r=1;while(arguments.length>r)i.push(arguments[r++]);if(n=t,(p(t)||void 0!==e)&&!le(e))return d(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!le(t))return t}),i[1]=t,W.apply(null,i)}})}H[U][E]||I(H[U],E,H[U].valueOf),A(H,j),$[q]=!0},a630:function(e,t,a){var n=a("23e7"),i=a("4df4"),r=a("1c7e"),o=!r((function(e){Array.from(e)}));n({target:"Array",stat:!0,forced:o},{from:i})},ad6d:function(e,t,a){"use strict";var n=a("825a");e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},d28b:function(e,t,a){var n=a("746f");n("iterator")},ddb0:function(e,t,a){var n=a("da84"),i=a("fdbc"),r=a("e260"),o=a("9112"),l=a("b622"),s=l("iterator"),c=l("toStringTag"),u=r.values;for(var h in i){var d=n[h],p=d&&d.prototype;if(p){if(p[s]!==u)try{o(p,s,u)}catch(f){p[s]=u}if(p[c]||o(p,c,h),i[h])for(var m in r)if(p[m]!==r[m])try{o(p,m,r[m])}catch(f){p[m]=r[m]}}}},e01a:function(e,t,a){"use strict";var n=a("23e7"),i=a("83ab"),r=a("da84"),o=a("5135"),l=a("861d"),s=a("9bf2").f,c=a("e893"),u=r.Symbol;if(i&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var h={},d=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof d?new u(e):void 0===e?u():u(e);return""===e&&(h[t]=!0),t};c(d,u);var p=d.prototype=u.prototype;p.constructor=d;var m=p.toString,f="Symbol(test)"==String(u("test")),b=/^Symbol\((.*)\)[^)]+$/;s(p,"description",{configurable:!0,get:function(){var e=l(this)?this.valueOf():this,t=m.call(e);if(o(h,e))return"";var a=f?t.slice(7,-1):t.replace(b,"$1");return""===a?void 0:a}}),n({global:!0,forced:!0},{Symbol:d})}},e538:function(e,t,a){var n=a("b622");t.f=n},fb6a:function(e,t,a){"use strict";var n=a("23e7"),i=a("861d"),r=a("e8b5"),o=a("23cb"),l=a("50c4"),s=a("fc6a"),c=a("8418"),u=a("b622"),h=a("1dde"),d=a("ae40"),p=h("slice"),m=d("slice",{ACCESSORS:!0,0:0,1:2}),f=u("species"),b=[].slice,g=Math.max;n({target:"Array",proto:!0,forced:!p||!m},{slice:function(e,t){var a,n,u,h=s(this),d=l(h.length),p=o(e,d),m=o(void 0===t?d:t,d);if(r(h)&&(a=h.constructor,"function"!=typeof a||a!==Array&&!r(a.prototype)?i(a)&&(a=a[f],null===a&&(a=void 0)):a=void 0,a===Array||void 0===a))return b.call(h,p,m);for(n=new(void 0===a?Array:a)(g(m-p,0)),u=0;p<m;p++,u++)p in h&&c(n,u,h[p]);return n.length=u,n}})}}]);
//# sourceMappingURL=chunk-5e06c703.58ba0eeb.js.map