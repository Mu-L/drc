(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ad1e4036"],{"25f0":function(e,t,a){"use strict";var n=a("6eeb"),r=a("825a"),o=a("d039"),s=a("ad6d"),i="toString",c=RegExp.prototype,l=c[i],u=o((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),d=l.name!=i;(u||d)&&n(RegExp.prototype,i,(function(){var e=r(this),t=String(e.source),a=e.flags,n=String(void 0===a&&e instanceof RegExp&&!("flags"in c)?s.call(e):a);return"/"+t+"/"+n}),{unsafe:!0})},2909:function(e,t,a){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}a.d(t,"a",(function(){return s}));a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("e260"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0");function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function s(e){return n(e)||r(e)||o()}},"3b13":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",[e._v("Messenger 集群")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("div",{staticStyle:{padding:"1px 1px"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"2"}},[a("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("DB 相关")]},proxy:!0}])},[a("Input",{attrs:{prefix:"ios-search",placeholder:"DB 名↵"},on:{"on-enter":function(t){return e.getAllMessengerVos()}},model:{value:e.dbNames,callback:function(t){e.dbNames=t},expression:"dbNames"}})],1)],1),a("Col",{attrs:{span:"16"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"24"}},[a("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("相关 MHA")]},proxy:!0}])},[a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"14"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"集群名↵"},on:{"on-enter":function(t){return e.getAllMessengerVos()}},model:{value:e.mha.name,callback:function(t){e.$set(e.mha,"name",t)},expression:"mha.name"}})],1),a("Col",{attrs:{span:"5"}},[a("Select",{attrs:{filterable:"",prefix:"ios-home",clearable:"",placeholder:"部门"},on:{"on-change":function(t){return e.getAllMessengerVos()}},model:{value:e.mha.buId,callback:function(t){e.$set(e.mha,"buId",t)},expression:"mha.buId"}},e._l(e.bus,(function(t){return a("Option",{key:t.buName,attrs:{value:t.id}},[e._v(e._s(t.buName))])})),1)],1),a("Col",{attrs:{span:"5"}},[a("Select",{attrs:{filterable:"",prefix:"ios-pin",clearable:"",placeholder:"地域"},on:{"on-change":function(t){return e.getAllMessengerVos()}},model:{value:e.mha.regionId,callback:function(t){e.$set(e.mha,"regionId",t)},expression:"mha.regionId"}},e._l(e.regions,(function(t){return a("Option",{key:t.regionName,attrs:{value:t.id}},[e._v(e._s(t.regionName)+" ")])})),1)],1)],1)],1)],1)],1)],1),a("Col",{attrs:{span:"4"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Button",{attrs:{type:"primary",icon:"ios-search",loading:e.dataLoading},on:{click:function(t){return e.getAllMessengerVos()}}},[e._v("查询")])],1),a("Row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:10,align:"middle"}},[a("Button",{attrs:{icon:"md-refresh",loading:e.dataLoading},on:{click:e.resetParam}},[e._v("重置")])],1)],1)],1),a("br"),a("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[a("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[a("Dropdown",{attrs:{placement:"bottom-start"},scopedSlots:e._u([{key:"list",fn:function(){return[a("DropdownMenu",[a("DropdownItem",{nativeOn:{click:function(t){return function(){e.$router.push({path:"/v2/buildMessengerV2"})}.apply(null,arguments)}}},[e._v("新建Messenger配置")])],1)]},proxy:!0}])},[a("Button",{attrs:{type:"default",icon:"ios-hammer"}},[e._v(" 新建配置 "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1)],1)],1),a("Table",{attrs:{loading:e.dataLoading,stripe:"",columns:e.columns,data:e.dataWithPage,border:""},scopedSlots:e._u([{key:"action",fn:function(t){var n=t.row,r=t.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(t){return e.checkConfig(n,r)}}},[e._v("查看 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goToLink(n,r)}}},[e._v("修改")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(t){return e.previewRemoveConfig(n,r)}}},[e._v(" 删除 ")])]}}])}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:e.total,current:e.current,"page-size":e.size,"page-size-opts":[1e3],"show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-page-size-change":e.handleChangeSize}})],1)],1),a("Drawer",{attrs:{title:"DRC配置",width:"80",closable:!0},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" 查看详情 "),a("div",{staticStyle:{float:"right","margin-right":"100px"}},[e._v(" 自动换行 "),a("i-switch",{model:{value:e.cluster.drawer.lineWrap,callback:function(t){e.$set(e.cluster.drawer,"lineWrap",t)},expression:"cluster.drawer.lineWrap"}}),e._v(" 黑夜模式 "),a("i-switch",{model:{value:e.cluster.drawer.darkMode,callback:function(t){e.$set(e.cluster.drawer,"darkMode",t)},expression:"cluster.drawer.darkMode"}})],1)]},proxy:!0}]),model:{value:e.cluster.drawer.show,callback:function(t){e.$set(e.cluster.drawer,"show",t)},expression:"cluster.drawer.show"}},[a("div",{attrs:{id:"xmlCode"}},[a("codemirror",{staticClass:"code",attrs:{options:{mode:"xml",theme:e.cluster.drawer.darkMode?"monokai":"default",autofocus:!0,lineWrapping:e.cluster.drawer.lineWrap,readOnly:!0,lineNumbers:!0,foldGutter:!0,styleActiveLine:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}},model:{value:e.cluster.drawer.data,callback:function(t){e.$set(e.cluster.drawer,"data",t)},expression:"cluster.drawer.data"}})],1)]),a("Modal",{attrs:{title:"删除DRC配置",width:"1200px"},on:{"on-ok":e.removeConfig,"on-cancel":e.clearRemoveConfig},model:{value:e.cluster.modal.remove,callback:function(t){e.$set(e.cluster.modal,"remove",t)},expression:"cluster.modal.remove"}},[a("Form",{staticStyle:{width:"100%"}},[a("FormItem",{attrs:{label:"确认删除改Messenger吗？"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.cluster.config,callback:function(t){e.$set(e.cluster,"config",t)},expression:"cluster.config"}})],1)],1)],1)],1)],1)},r=[],o=(a("fb6a"),a("d3b7"),a("53ca")),s=a("2909"),i=(a("7a7a"),a("d5e0"),a("697e"),a("cbc8"),{name:"messengers",data:function(){var e=this;return{cluster:{modal:{remove:!1,show:!1,data:""},drawer:{lineWrap:!1,darkMode:!0,show:!1,data:""},mhaToBeRemoved:""},dbNames:null,mha:{name:this.$route.query.mhaName,buId:null,regionId:null},total:0,current:1,size:1e3,tableData:[],bus:[],regions:[],switchOneInfo:{},columns:[{title:"序号",width:75,align:"center",render:function(t,a){return t("span",a.index+1+(e.current-1)*e.size)}},{title:"集群名",key:"mhaName"},{title:"部门",key:"bu",width:100,render:function(e,t){var a=t.row,n="blue",r=a.bu;return e("Tag",{props:{color:n}},r)}},{title:"监控",key:"monitorSwitch",width:100,align:"center",render:function(t,a){var n=a.row;return t("i-switch",{props:{size:"large",value:1===n.monitorSwitch,beforeChange:e.handleBeforeChange},scopedSlots:{open:function(){return t("span","开启")},close:function(){return t("span","关闭")}},on:{"on-change":function(){e.switchMonitor(n)}},nativeOn:{mousedown:function(){e.switchOneInfo={monitorSwitch:n.monitorSwitch}}}})}},{title:"操作",slot:"action",align:"center"}],dataLoading:!1}},computed:{dataWithPage:function(){var e=this.tableData,t=this.current*this.size-this.size,a=t+this.size;return Object(s["a"])(e).slice(t,a)}},methods:{getBus:function(){var e=this;this.axios.get("/api/drc/v2/meta/bus/all").then((function(t){e.bus=t.data.data}))},getRegions:function(){var e=this;this.axios.get("/api/drc/v2/meta/regions/all").then((function(t){e.regions=t.data.data}))},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var n=this.flattenObj(e[a]);for(var r in n)t[a+"."+r]=n[r]}return t},resetParam:function(){this.mha={name:null,buId:null,regionId:null},this.dbNames=null,this.getAllMessengerVos()},getParams:function(){var e={mha:this.mha,dbNames:this.dbNames};return this.flattenObj(e)},getAllMessengerVos:function(){var e=this;this.dataLoading=!0;var t=this.getParams();this.axios.get("/api/drc/v2/messenger/query",{params:t}).then((function(t){1!==t.data.status?(e.tableData=t.data.data,e.total=e.tableData.length,e.$Message.success("查询成功")):e.$Message.error("查询失败："+t.message)})).catch((function(t){e.$Message.error("查询异常: "+t)})).finally((function(){e.dataLoading=!1}))},handleChangeSize:function(e){this.size=e},goToLink:function(e,t){console.log("go to change messenger config for "+e.mhaName),this.$router.push({path:"/v2/buildMessengerV2",query:{step:"3",mhaName:e.mhaName}})},checkConfig:function(e,t){var a=this;console.log(e.mhaName),this.dataLoading=!0,this.axios.get("/api/drc/v2/meta/queryConfig/mhaMessenger",{params:{mhaName:e.mhaName}}).then((function(e){1!==e.data.status?(a.cluster.drawer.data=e.data.data,a.cluster.drawer.show=!0,a.$Message.success("查询成功")):a.$Message.error("查询失败："+e.message)})).catch((function(e){a.$Message.error("查询异常: "+e)})).finally((function(){a.dataLoading=!1}))},previewRemoveConfig:function(e,t){var a=this;this.cluster.mhaToBeRemoved=e.mhaName,console.log(e.mhaName),this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.get("/api/drc/v2/meta/queryConfig/mhaMessenger",{params:{mhaName:e.mhaName}}).then((function(e){var t=e.data.data;console.log(t),a.cluster.config=t,a.$Spin.hide(),a.cluster.modal.remove=!0}))},removeConfig:function(){var e=this;console.log("mhaToBeRemoved",this.cluster.mhaToBeRemoved),this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.delete("/api/drc/v2/messenger/deleteMha/?mhaName="+this.cluster.mhaToBeRemoved).then((function(t){0===t.data.status?location.reload():alert("删除失败: "+t.data.message),e.$Spin.hide()})),this.clearRemoveConfig()},clearRemoveConfig:function(){this.cluster.mhaToBeRemoved=""},handleBeforeChange:function(){var e=this;return console.log("handleBeforeChange:",this.switchOneInfo),new Promise((function(t){e.$Modal.confirm({title:"切换确认",content:"您确认要切换开关状态吗？",onOk:function(){t()}})}))},switchMonitor:function(e){var t=0===e.monitorSwitch?"on":"off";this.switchMonitors(e.mhaName,t)},switchMonitors:function(e,t){var a=this;console.log(e),this.axios.post("/api/drc/v2/monitor/switch/"+e+"/"+t).then((function(e){0===e.data.status?(console.log(t),"on"===t?a.$Message.success("监控开启成功"):a.$Message.success("监控关闭成功")):a.$Message.warning("监控操作失败"),a.getAllMessengerVos()}))}},created:function(){this.getRegions(),this.getBus(),this.getAllMessengerVos()}}),c=i,l=(a("affc"),a("2877")),u=Object(l["a"])(c,n,r,!1,null,"5aec8740",null);t["default"]=u.exports},"4df4":function(e,t,a){"use strict";var n=a("0366"),r=a("7b0b"),o=a("9bdd"),s=a("e95a"),i=a("50c4"),c=a("8418"),l=a("35a1");e.exports=function(e){var t,a,u,d,f,m,h=r(e),g="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,b=void 0!==v,w=l(h),y=0;if(b&&(v=n(v,p>2?arguments[2]:void 0,2)),void 0==w||g==Array&&s(w))for(t=i(h.length),a=new g(t);t>y;y++)m=b?v(h[y],y):h[y],c(a,y,m);else for(d=w.call(h),f=d.next,a=new g;!(u=f.call(d)).done;y++)m=b?o(d,v,[u.value,y],!0):u.value,c(a,y,m);return a.length=y,a}},8418:function(e,t,a){"use strict";var n=a("c04e"),r=a("9bf2"),o=a("5c6c");e.exports=function(e,t,a){var s=n(t);s in e?r.f(e,s,o(0,a)):e[s]=a}},"94de":function(e,t,a){},a630:function(e,t,a){var n=a("23e7"),r=a("4df4"),o=a("1c7e"),s=!o((function(e){Array.from(e)}));n({target:"Array",stat:!0,forced:s},{from:r})},ad6d:function(e,t,a){"use strict";var n=a("825a");e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},affc:function(e,t,a){"use strict";a("94de")},fb6a:function(e,t,a){"use strict";var n=a("23e7"),r=a("861d"),o=a("e8b5"),s=a("23cb"),i=a("50c4"),c=a("fc6a"),l=a("8418"),u=a("b622"),d=a("1dde"),f=a("ae40"),m=d("slice"),h=f("slice",{ACCESSORS:!0,0:0,1:2}),g=u("species"),p=[].slice,v=Math.max;n({target:"Array",proto:!0,forced:!m||!h},{slice:function(e,t){var a,n,u,d=c(this),f=i(d.length),m=s(e,f),h=s(void 0===t?f:t,f);if(o(d)&&(a=d.constructor,"function"!=typeof a||a!==Array&&!o(a.prototype)?r(a)&&(a=a[g],null===a&&(a=void 0)):a=void 0,a===Array||void 0===a))return p.call(d,m,h);for(n=new(void 0===a?Array:a)(v(h-m,0)),u=0;m<h;m++,u++)m in d&&l(n,u,d[m]);return n.length=u,n}})}}]);
//# sourceMappingURL=chunk-ad1e4036.4593ea2d.js.map