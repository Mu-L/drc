(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-15c3eb72"],{"93f4":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/access"}},[e._v("搭建DRC")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[[a("Steps",{staticStyle:{width:"90%","margin-left":"50px","margin-bottom":"15px","margin-top":"50px"},attrs:{current:e.current}},[a("Step",{style:{cursor:"pointer"},attrs:{title:"新建集群",content:"新建复制集群"},nativeOn:{click:function(t){return e.jumpTo(0)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"断开复制",content:"查看复制状态/断开复制连接"},nativeOn:{click:function(t){return e.jumpTo(1)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"生成分机房域名",content:"生成新/源集群两侧域名"},nativeOn:{click:function(t){return e.jumpTo(2)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"建立双向复制",content:"配置Replicator和Applier建立集群双向复制"},nativeOn:{click:function(t){return e.jumpTo(3)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"录入DalCluster",content:"新集群db录入dal cluster"},nativeOn:{click:function(t){return e.jumpTo(4)}}}),a("Step",{style:{cursor:"pointer"},attrs:{title:"完成",content:"已完成DRC接入"},nativeOn:{click:function(t){return e.jumpTo(5)}}})],1)],0===e.current?a("build",e._b({on:{oldClusterChanged:e.updateOld,newClusterChanged:e.updateNew,newDrcZoneChanged:e.updateZone}},"build",e.clusterPair,!1)):e._e(),1===e.current?a("copy",e._b({on:{oldClusterChanged:e.updateOld}},"copy",e.clusterPair,!1)):e._e(),2===e.current?a("dns",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOld}},"dns",e.clusterPair,!1)):e._e(),3===e.current?a("drc",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOld}},"drc",e.clusterPair,!1)):e._e(),4===e.current?a("dal",e._b({on:{envChanged:e.updateEnv,oldClusterChanged:e.updateOld}},"dal",e.clusterPair,!1)):e._e(),5===e.current?a("complete"):e._e(),a("Divider"),a("div",{staticStyle:{padding:"1px 1px",height:"100px","margin-top":"75px"}},[a("div",[e.current>0?a("Button",{staticStyle:{position:"absolute",left:"465px"},attrs:{type:"primary"},on:{click:e.prev}},[e._v(" 上一步 ")]):e._e(),e.current<5?a("Button",{staticStyle:{position:"absolute",left:"790px"},attrs:{type:"primary"},on:{click:e.next}},[e._v(" 下一步 ")]):e._e()],1)])],2)],1)},l=[],n=(a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"build",staticStyle:{"margin-top":"50px"},attrs:{model:e.build,rules:e.ruleBuild,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.build.oldClusterName,callback:function(t){e.$set(e.build,"oldClusterName",t)},expression:"build.oldClusterName"}})],1),a("FormItem",{attrs:{label:"生成新集群机房区域",prop:"drcZone"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:e.changeNewZone},model:{value:e.build.drcZone,callback:function(t){e.$set(e.build,"drcZone",t)},expression:"build.drcZone"}},e._l(e.build.drcZoneList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"BU名",prop:"bu"}},[a("Input",{attrs:{placeholder:"请输入BU名"},on:{input:e.changeBu},model:{value:e.build.bu,callback:function(t){e.$set(e.build,"bu",t)},expression:"build.bu"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"DAL Cluster名",prop:"dalclustername"}},[a("Input",{attrs:{placeholder:"请输入DAL Cluster名"},on:{input:e.changeDalClusterName},model:{value:e.build.dalclustername,callback:function(t){e.$set(e.build,"dalclustername",t)},expression:"build.dalclustername"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"appid",prop:"appid"}},[a("Input",{attrs:{placeholder:"请输入appid"},on:{input:e.changeAppId},model:{value:e.build.appid,callback:function(t){e.$set(e.build,"appid",t)},expression:"build.appid"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("build")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("build")}}},[e._v("新建集群")]),a("Modal",{attrs:{title:"创建新集群"},on:{"on-ok":function(t){return e.postBuild("build")}},model:{value:e.build.modal,callback:function(t){e.$set(e.build,"modal",t)},expression:"build.modal"}},[a("p",[e._v('确定创建新集群 "'+e._s(e.build.oldClusterName+e.build.drcZone)+'" 吗？并且设置BU/DAL Cluster/appid为 "'+e._s(e.build.bu)+'"/"'+e._s(e.build.dalclustername)+'"/"'+e._s(e.build.appid)+'"')])])],1)],1)],1)}),r=[],i={name:"build",props:{oldClusterName:String,newClusterName:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,build:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,bu:"",dalclustername:"",appid:"",drcZone:"",drcZoneList:[{value:"shaoy",label:"上海欧阳"},{value:"shaxy",label:"上海新源"},{value:"sharb",label:"上海日版"},{value:"shajq",label:"上海金桥"},{value:"shafq",label:"上海福泉"},{value:"shajz",label:"上海金钟"},{value:"ntgxh",label:"南通星湖大道"},{value:"fraaws",label:"法兰克福AWS"},{value:"shali",label:"上海阿里"},{value:"sinibuaws",label:"IBU-VPC"},{value:"sinaws",label:"新加坡AWS"}]},ruleBuild:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],drcZone:[{required:!0,message:"选择新建集群区域",trigger:"change"}],bu:[{required:!0,message:"BU名不能为空",trigger:"blur"}],dalclustername:[{required:!0,message:"DAL Cluster名不能为空",trigger:"blur"}],appid:[{required:!0,message:"cluster appid不能为空",trigger:"blur"}]}}},methods:{postBuild:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.start(),t.hasResp=!1,a.axios.post("/api/drc/v1/access/mhaV2",{clustername:t.build.oldClusterName,drczone:t.build.drcZone,bu:t.build.bu,dalclustername:t.build.dalclustername,appid:t.build.appid}).then((function(e){a.hasResp=!0,"T"===e.data.data.status?(a.status="success",a.title="集群创建完成!",a.message="新集群名为："+e.data.data.drcCluster,a.$emit("newClusterChanged",e.data.data.drcCluster)):"W"===e.data.data.status?(a.status="establishing",t.title="集群创建中..."):(a.status="error",a.title="集群创建失败!"),t.finish()}))):a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeOld:function(){this.$emit("oldClusterChanged",this.build.oldClusterName)},changeNewZone:function(){this.$emit("newDrcZoneChanged",this.build.drcZone)},changeBu:function(){this.$emit("buChanged",this.build.bu)},changeDalClusterName:function(){this.$emit("dalclusternameChanged",this.build.dalclustername)},changeAppId:function(){this.$emit("appidChanged",this.build.appid)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.build.modal=!0:t.$Message.error("仍有必填项未填!")}))}}},d=i,o=a("2877"),u=Object(o["a"])(d,n,r,!1,null,"01b4e0b0",null),c=u.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"copy",staticStyle:{"margin-top":"50px"},attrs:{model:e.copy,rules:e.ruleCopy,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.copy.oldClusterName,callback:function(t){e.$set(e.copy,"oldClusterName",t)},expression:"copy.oldClusterName"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},model:{value:e.copy.newClusterName,callback:function(t){e.$set(e.copy,"newClusterName",t)},expression:"copy.newClusterName"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("copy")}}},[e._v("重置")]),a("br"),a("br"),a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.checkCopy("copy")}}},[e._v("复制状态检测")]),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{type:"error",disabled:e.disabledDisconnect},on:{click:function(t){return e.changeModal("copy")}}},[e._v("断开复制")]),a("Modal",{attrs:{title:"断开复制"},on:{"on-ok":function(t){return e.disconnect("copy")}},model:{value:e.copy.modal,callback:function(t){e.$set(e.copy,"modal",t)},expression:"copy.modal"}},[a("p",[e._v("确定断开复制连接吗？")])])],1)],1)],1)},p=[],h={name:"copy",props:{oldClusterName:String,newClusterName:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,disabledDisconnect:!0,copy:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName},ruleCopy:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}]}}},methods:{checkCopy:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.start(),a.hasResp=!1,a.axios.post("/api/drc/v1/access/copystatus",{OriginalCluster:t.copy.oldClusterName,DrcCluster:t.copy.newClusterName,rplswitch:0}).then((function(e){a.hasResp=!0,"T"===e.data.data.status?(a.disabledDisconnect=!1,a.status="success",a.title="复制状态正常!"):(a.disabledDisconnect=!0,a.status="error",a.title="复制状态异常!"),a.message=e.data.data.message,t.finish()}))):a.$Message.error("仍有必填项未填!")}))},disconnect:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?(t.start(),a.hasResp=!1,a.axios.post("/api/drc/v1/access/copystatus",{OriginalCluster:t.copy.oldClusterName,DrcCluster:t.copy.newClusterName,rplswitch:1}).then((function(e){a.hasResp=!0,"T"===e.data.data.status?(a.status="success",a.title="断开复制成功!"):(a.status="error",a.title="断开复制失败!"),a.message=e.data.data.message,t.finish()}))):a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeOld:function(){this.$emit("oldClusterChanged",this.copy.oldClusterName)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.copy.modal=!0:t.$Message.error("仍有必填项未填!")}))}}},b=h,g=Object(o["a"])(b,m,p,!1,null,"3d271e1a",null),f=g.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"dns",staticStyle:{"margin-top":"50px"},attrs:{model:e.dns,rules:e.ruleDns,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.dns.oldClusterName,callback:function(t){e.$set(e.dns,"oldClusterName",t)},expression:"dns.oldClusterName"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},model:{value:e.dns.newClusterName,callback:function(t){e.$set(e.dns,"newClusterName",t)},expression:"dns.newClusterName"}})],1),a("FormItem",{attrs:{label:"选择环境",prop:"env"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择环境"},on:{input:function(t){e.changeEnv(),e.getAllDbs()}},model:{value:e.dns.env,callback:function(t){e.$set(e.dns,"env",t)},expression:"dns.env"}},e._l(e.dns.envList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"700px"},attrs:{label:"选择DB"}},[a("div",[a("Table",{ref:"selection",attrs:{"highlight-row":"",border:"",columns:e.dns.columns,data:e.dns.dbNames},on:{"on-selection-change":e.changeSelection},model:{value:e.dns.selectedDbs,callback:function(t){e.$set(e.dns,"selectedDbs",t)},expression:"dns.selectedDbs"}})],1)]),a("FormItem",{attrs:{label:"需要读域名",prop:"needread"}},[a("i-switch",{model:{value:e.dns.needread,callback:function(t){e.$set(e.dns,"needread",t)},expression:"dns.needread"}})],1),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("dns")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("dns")}}},[e._v("确定提交")]),a("Modal",{attrs:{title:"生成分机房域名"},on:{"on-ok":function(t){return e.postDns("dns")}},model:{value:e.dns.modal,callback:function(t){e.$set(e.dns,"modal",t)},expression:"dns.modal"}},[a("p",[e._v('确定在 "'+e._s(e.dns.oldClusterName)+'" 和 "'+e._s(e.dns.newClusterName)+'" 集群中生成带区域信息的域名吗？')])])],1)],1)],1)},C=[],N=(a("4160"),a("d81d"),a("b0c0"),a("159b"),{name:"dns",props:{oldClusterName:String,newClusterName:String,env:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,dns:{modal:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,env:this.env,needread:!1,columns:[{type:"selection",width:60,align:"center"},{title:"DB名",key:"name"}],dbNames:[],selectedDbs:[],envList:[{value:"product",label:"PRODUCT"},{value:"fat",label:"FAT"},{value:"lpt",label:"LPT"},{value:"uat",label:"UAT"}]},ruleDns:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}]}}},methods:{postDns:function(e){var t=this,a=this;a.$refs[e].validate((function(e){if(e){t.start();var s=t.dns.selectedDbs.map((function(e){return e.name}));a.hasResp=!1,a.title="部署DNS成功!",a.status="success",a.message="",a.axios.post("/api/drc/v1/access/dns",{cluster:t.dns.oldClusterName,dbnames:String(s),env:t.dns.env,needread:t.dns.needread?1:0}).then((function(e){a.hasResp=!0,e.data.data.success?a.message+="DNS部署成功！<br/>集群名："+t.dns.oldClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>":(a.status="error",a.title="部署DNS失败!",a.message+="DNS部署失败！<br/>集群名："+t.dns.oldClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>"),t.finish()})),a.axios.post("/api/drc/v1/access/dns",{cluster:t.dns.newClusterName,dbnames:String(s),env:t.dns.env,needread:t.dns.needread?1:0}).then((function(e){a.hasResp=!0,e.data.data.success?a.message+="DNS部署成功！<br/>集群名："+t.dns.newClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>":(a.status="error",a.title="部署DNS失败!",a.message+="DNS部署失败！<br/>集群名："+t.dns.newClusterName+"<br/>提示信息："+e.data.data.content+"<hr/>"),t.finish()}))}else a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeEnv:function(){this.$emit("envChanged",this.dns.env),this.getAllDbs()},getAllDbs:function(){var e=this;this.axios.get("/api/drc/v1/mha/dbnames/cluster/"+this.dns.oldClusterName+"/env/"+this.dns.env).then((function(t){console.log(t.data),e.dns.dbNames=[],t.data.data.forEach((function(t){return e.dns.dbNames.push({name:t})}))}))},changeSelection:function(){this.dns.selectedDbs=this.$refs.selection.getSelection()},changeOld:function(){this.getAllDbs(),this.$emit("oldClusterChanged",this.dns.oldClusterName)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e){var t=this;this.$refs[e].validate((function(e){e?t.dns.modal=!0:t.$Message.error("仍有必填项未填!")}))}},created:function(){this.getAllDbs()}}),y=N,w=Object(o["a"])(y,v,C,!1,null,"59591dc0",null),x=w.exports,S=a("39ba"),_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.hasResp?a("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:e.status,"show-icon":""}},[e._v(" "+e._s(e.title)+" "),a("span",{attrs:{slot:"desc"},domProps:{innerHTML:e._s(e.message)},slot:"desc"})]):e._e(),a("Form",{ref:"dal",staticStyle:{"margin-top":"50px"},attrs:{model:e.dal,rules:e.ruleDal,"label-width":250}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"oldClusterName"}},[a("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:e.changeOld},model:{value:e.dal.oldClusterName,callback:function(t){e.$set(e.dal,"oldClusterName",t)},expression:"dal.oldClusterName"}})],1),a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"newClusterName"}},[a("Input",{attrs:{placeholder:"请输入新集群名"},model:{value:e.dal.newClusterName,callback:function(t){e.$set(e.dal,"newClusterName",t)},expression:"dal.newClusterName"}})],1),a("FormItem",{attrs:{label:"新集群机房区域",prop:"drcZone"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:e.getAllDbs},model:{value:e.dal.drcZone,callback:function(t){e.$set(e.dal,"drcZone",t)},expression:"dal.drcZone"}},e._l(e.dal.drcZoneList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{attrs:{label:"选择环境",prop:"env"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择环境"},on:{input:e.changeEnv},model:{value:e.dal.env,callback:function(t){e.$set(e.dal,"env",t)},expression:"dal.env"}},e._l(e.dal.envList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),a("FormItem",{staticStyle:{width:"90%"},attrs:{label:"选择DAL集群"}},[a("div",[a("Table",{ref:"selection",attrs:{"highlight-row":"",border:"",columns:e.dal.columns,data:e.dal.dbNames},on:{"on-selection-change":e.changeSelection},scopedSlots:e._u([{key:"status",fn:function(t){var s=t.index;return[a("Tag",{attrs:{size:"large",color:e.dal.dbNames[s].status?"success":"default"}},[e._v(e._s(e.dal.dbNames[s].status?"已录入":"未录入"))])]}},{key:"is",fn:function(t){var s=t.index;return[a("Tag",{attrs:{size:"large",color:e.dal.dbNames[s].isShard?"warning":"primary"}},[e._v(e._s(e.dal.dbNames[s].isShard?"是":"否"))])]}},{key:"no",fn:function(t){var s=t.index;return[a("Tag",{attrs:{size:"large",color:"default"}},[e._v(e._s(e.dal.dbNames[s].shardStartNo))])]}}]),model:{value:e.dal.selectedDbs,callback:function(t){e.$set(e.dal,"selectedDbs",t)},expression:"dal.selectedDbs"}})],1)]),a("FormItem",[a("Button",{on:{click:function(t){return e.handleReset("dal")}}},[e._v("重置")]),a("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){return e.changeModal("dal",1)}}},[e._v("新集群录入DAL Cluster")]),a("Modal",{attrs:{title:"录入DAL集群"},on:{"on-ok":function(t){return e.postDal("dal","instance")}},model:{value:e.dal.modal1,callback:function(t){e.$set(e.dal,"modal1",t)},expression:"dal.modal1"}},[a("p",[e._v("确定将所有已选的db录入dal cluster吗？")])])],1)],1)],1)},$=[],D={name:"dal",props:{oldClusterName:String,newClusterName:String,env:String,newDrcZone:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,dal:{modal1:!1,modal2:!1,modal3:!1,oldClusterName:this.oldClusterName,newClusterName:this.newClusterName,env:this.env,drcZone:this.newDrcZone,columns:[{type:"selection",width:60,align:"center"},{title:"DB",minWidth:150,key:"name"},{title:"Dal Cluster",minWidth:150,key:"dalName"},{title:"录入状态",width:110,slot:"status"},{title:"是否分片",width:100,slot:"is"},{title:"分片起始",width:100,slot:"no"}],dbNames:[],envList:[{value:"product",label:"PRODUCT"},{value:"fat",label:"FAT"},{value:"lpt",label:"LPT"},{value:"uat",label:"UAT"}],drcZoneList:[{value:"shaoy",label:"上海欧阳"},{value:"shaxy",label:"上海新源"},{value:"sharb",label:"上海日版"},{value:"shajq",label:"上海金桥"},{value:"shafq",label:"上海福泉"},{value:"shajz",label:"上海金钟"},{value:"ntgxh",label:"南通星湖大道"},{value:"fraaws",label:"法兰克福AWS"},{value:"shali",label:"上海阿里"},{value:"sinibuaws",label:"IBU-VPC"},{value:"sinaws",label:"新加坡AWS"}]},ruleDal:{dalClusterName:[{required:!0,message:"DAL集群名不能为空",trigger:"blur"}],oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}],drcZone:[{required:!0,message:"选择新建集群区域",trigger:"change"}]}}},methods:{postDal:function(e,t){var a=this,s=this;s.$refs[e].validate((function(e){e?function(){a.start();var e=a.dal.selectedDbs;s.hasResp=!1,s.message="",s.title="录入成功!",s.status="success";for(var l=function(l){s.axios.post("/api/drc/v1/access/clusters/env/"+s.dal.env+"/goal/"+t,{dalclustername:e[l].dalName,dbname:e[l].name,basedbname:e[l].basedbname,clustername:s.dal.newClusterName,isshard:e[l].isShard,shardstartno:e[l].isShard?parseInt(e[l].shardStartNo):0}).then((function(n){s.hasResp=!0,n.data.data.success?"instance"===t?s.message+="DAL集群录入成功！<br/>集群名："+s.dal.newClusterName+":"+e[l].dalName+"<br/>提示信息："+n.data.data.message+"<hr/>":"user"===t&&(s.message+="用户录入成功！<br/>集群名："+s.dal.newClusterName+":"+e[l].dalName+"<br/>提示信息："+n.data.data.message+"<hr/>"):(s.title="失败!",s.status="error","instance"===t?s.message+="DAL集群录入失败！<br/>集群名："+s.dal.newClusterName+":"+e[l].dalName+"<br/>提示信息："+n.data.data.message+"<hr/>":"user"===t&&(s.message+="用户录入失败！<br/>集群名："+s.dal.newClusterName+":"+e[l].dalName+"<br/>提示信息："+n.data.data.message+"<hr/>")),a.finish()}))},n=0;n<e.length;n++)l(n)}():s.$Message.error("仍有必填项未填!")}))},release:function(e){var t=this,a=this;a.$refs[e].validate((function(e){e?function(){t.start();var e=t.dal.selectedDbs;a.hasResp=!1,a.status="success",a.title="发布DAL集群成功!",a.message="";for(var s=function(s){a.axios.post("/api/drc/v1/access/clusters/clustername/"+e[s].dalName+"/env/"+a.dal.env+"/releases").then((function(l){a.hasResp=!0,200===l.data.data.status?a.message+="发布成功！<br/>集群名："+e[s].dalName+"<br/>提示信息："+l.data.data.message+"<hr/>":(a.status="error",a.title="发布DAL集群失败!",a.message+="发布失败！<br/>集群名："+e[s].dalName+"<br/>提示信息："+l.data.data.message+"<hr/>"),t.finish()}))},l=0;l<e.length;l++)s(l)}():a.$Message.error("仍有必填项未填!")}))},handleReset:function(e){this.$refs[e].resetFields()},changeEnv:function(){this.$emit("envChanged",this.dal.env),this.getAllDbs()},getAllDbs:function(){var e=this;this.axios.get("/api/drc/v1/mha/dbnames/dalnames/cluster/"+this.dal.oldClusterName+"/env/"+this.dal.env+"/zoneId/"+this.dal.drcZone).then((function(t){console.log(t.data),e.dal.dbNames=[],t.data.data.forEach((function(t){return e.dal.dbNames.push({name:t.dbname,basedbname:t.basedbname,dalName:t.dalname,isShard:t.isshard,shardStartNo:t.shardstartno,status:t.status})}))}))},changeSelection:function(){this.dal.selectedDbs=this.$refs.selection.getSelection()},changeOld:function(){this.getAllDbs(),this.$emit("oldClusterChanged",this.dal.oldClusterName)},changeIsShard:function(e){this.dal.dbNames[e].isshard||(this.dal.dbNames[e].shardStartNo=0)},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(e,t){var a=this;this.$refs[e].validate((function(e){if(e)switch(t){case 1:a.dal.modal1=!0;break;case 2:a.dal.modal2=!0;break;case 3:a.dal.modal3=!0;break}else a.$Message.error("仍有必填项未填!")}))}},created:function(){this.getAllDbs()}},k=D,I=Object(o["a"])(k,_,$,!1,null,"38aecb2e",null),A=I.exports,L=a("e537"),R={components:{build:c,copy:f,drc:S["a"],dns:x,dal:A,complete:L["a"]},data:function(){return{current:0,clusterPair:{oldClusterName:this.$route.query.clustername,newClusterName:this.$route.query.newclustername,env:"",oldZoneId:this.$route.query.zoneId,newDrcZone:""}}},methods:{jumpTo:function(e){this.current=e,this.hasResp=!1},next:function(){this.current=this.current+1,this.hasResp=!1},prev:function(){this.current=this.current-1,this.hasResp=!1},updateOld:function(e){this.clusterPair.oldClusterName=e},updateNew:function(e){this.clusterPair.newClusterName=e},updateZone:function(e){this.clusterPair.newDrcZone=e},updateEnv:function(e){this.clusterPair.env=e}},created:function(){var e=this.$route.query.step;"undefined"===typeof e?console.log("curStep undefined, do nothing"):this.jumpTo(Number(e))}},O=R,F=Object(o["a"])(O,s,l,!1,null,"629545d4",null);t["default"]=F.exports},b0c0:function(e,t,a){var s=a("83ab"),l=a("9bf2").f,n=Function.prototype,r=n.toString,i=/^\s*function ([^ (]*)/,d="name";!s||d in n||l(n,d,{configurable:!0,get:function(){try{return r.call(this).match(i)[1]}catch(e){return""}}})},d81d:function(e,t,a){"use strict";var s=a("23e7"),l=a("b727").map,n=a("1dde"),r=a("ae40"),i=n("map"),d=r("map");s({target:"Array",proto:!0,forced:!i||!d},{map:function(e){return l(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-15c3eb72.2f07d8a0.js.map