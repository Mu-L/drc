(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-867755aa","chunk-2d0f00cd"],{"27da":function(t,a,e){},3719:function(t,a,e){"use strict";e("27da")},"53ca":function(t,a,e){"use strict";e.d(a,"a",(function(){return s}));e("a4d3"),e("e01a"),e("d28b"),e("e260"),e("d3b7"),e("3ca3"),e("ddb0");function s(t){return s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}},"63a3":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("base-component",[e("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[e("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),e("BreadcrumbItem",{attrs:{to:"/drcV2"}},[t._v("DRC配置V2")])],1),e("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 1px 185px",zIndex:"1",top:"500px"}},[[e("Steps",{staticStyle:{width:"90%","margin-left":"50px","margin-bottom":"15px","margin-top":"50px"},attrs:{current:t.current}},[e("Step",{style:{cursor:"pointer"},attrs:{title:"新建DRC集群",content:"新建同步DRC"},nativeOn:{click:function(a){return t.jumpTo(0)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"mha配置",content:"mha录入db信息"},nativeOn:{click:function(a){return t.jumpTo(1)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"预检测",content:"检测mha配置"},nativeOn:{click:function(a){return t.jumpTo(2)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"建立同步",content:"配置Replicator和Applier实例"},nativeOn:{click:function(a){return t.jumpTo(3)}}}),e("Step",{style:{cursor:"pointer"},attrs:{title:"完成",content:"已完成DRC接入"},nativeOn:{click:function(a){return t.jumpTo(4)}}})],1)],0===t.current?e("mhaBuild",t._b({on:{srcMhaNameChanged:t.updateSrcMha,dstMhaNameChanged:t.updateDstMha,dstDcChanged:t.updateDstDc,srcDcChanged:t.updateSrcDc}},"mhaBuild",t.clusterPair,!1)):t._e(),1===t.current?e("mha-config-v2",t._b({on:{envChanged:t.updateEnv,srcMhaNameChanged:t.updateSrcMha,dstMhaNameChanged:t.updateDstMha}},"mha-config-v2",t.clusterPair,!1)):t._e(),2===t.current?e("pre-check-v2",t._b({},"pre-check-v2",t.clusterPair,!1)):t._e(),3===t.current?e("drc-build-v2",t._b({on:{envChanged:t.updateEnv,srcMhaNameChanged:t.updateSrcMha,dstMhaNameChanged:t.updateDstMha}},"drc-build-v2",t.clusterPair,!1)):t._e(),4===t.current?e("complete"):t._e(),e("Divider"),e("div",{staticStyle:{padding:"1px 1px",height:"100px","margin-top":"75px"}},[e("div",[t.current>0?e("Button",{staticStyle:{position:"absolute",left:"465px"},attrs:{type:"primary"},on:{click:t.prev}},[t._v(" 上一步 ")]):t._e(),t.current<4?e("Button",{staticStyle:{position:"absolute",left:"790px"},attrs:{type:"primary"},on:{click:t.next}},[t._v(" 下一步 ")]):t._e()],1)])],2)],1)},r=[],i=(e("a9e3"),e("9b5c")),c=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[t.hasResp?e("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:t.status,"show-icon":""}},[t._v(" "+t._s(t.title)+" "),e("span",{attrs:{slot:"desc"},domProps:{innerHTML:t._s(t.message)},slot:"desc"})]):t._e(),e("Row",[e("i-col",{attrs:{span:"12"}},[e("Form",{ref:"srcMha",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.srcMha,rules:t.ruleMhaMachine,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeSrcMha},model:{value:t.srcMha.mhaName,callback:function(a){t.$set(t.srcMha,"mhaName",a)},expression:"srcMha.mhaName"}})],1),e("FormItem",{attrs:{label:"添加Ip",prop:"ip"}},[e("Input",{attrs:{number:"",placeholder:"请输入录入DB的IP"},model:{value:t.srcMha.ip,callback:function(a){t.$set(t.srcMha,"ip",a)},expression:"srcMha.ip"}})],1),e("FormItem",{attrs:{label:"Port",prop:"port"}},[e("Input",{attrs:{placeholder:"请输入录入DB端口"},model:{value:t.srcMha.port,callback:function(a){t.$set(t.srcMha,"port",a)},expression:"srcMha.port"}})],1),e("FormItem",{attrs:{label:"DB机房",prop:"srcDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择db机房区域"},model:{value:t.srcMha.idc,callback:function(a){t.$set(t.srcMha,"idc",a)},expression:"srcMha.idc"}},t._l(t.selectOption.drcZoneList,(function(a){return e("Option",{key:a.label,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{label:"UUID",prop:"uuid"}},[e("Input",{attrs:{placeholder:"请输入录入DB的uuid"},model:{value:t.srcMha.uuid,callback:function(a){t.$set(t.srcMha,"uuid",a)},expression:"srcMha.uuid"}}),e("Button",{on:{click:t.querySrcMhaUuid}},[t._v("连接查询")]),t.hasTest1?e("span",[e("Icon",{attrs:{type:t.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess1?"green":"red"}}),t._v(" "+t._s(t.testSuccess1?"连接查询成功":"连接查询失败，请手动输入uuid")+" ")],1):t._e()],1),e("FormItem",{attrs:{label:"Master",prop:"master"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否为Master"},model:{value:t.srcMha.master,callback:function(a){t.$set(t.srcMha,"master",a)},expression:"srcMha.master"}},t._l(t.selectOption.isMaster,(function(a){return e("Option",{key:a.key,attrs:{value:a.value}},[t._v(t._s(a.key))])})),1)],1),e("FormItem",[e("Button",{attrs:{type:"primary"},on:{click:function(a){t.preChecksrcMha("srcMha")}}},[t._v("录入DB")]),e("br"),e("br")],1)],1)],1),e("i-col",{attrs:{span:"12"}},[e("Form",{ref:"dstMha",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.dstMha,rules:t.ruleMhaMachine,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新集群名",prop:"mhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeDstMha},model:{value:t.dstMha.mhaName,callback:function(a){t.$set(t.dstMha,"mhaName",a)},expression:"dstMha.mhaName"}})],1),e("FormItem",{attrs:{label:"添加Ip",prop:"ip"}},[e("Input",{attrs:{placeholder:"请输入录入DB的IP"},model:{value:t.dstMha.ip,callback:function(a){t.$set(t.dstMha,"ip",a)},expression:"dstMha.ip"}})],1),e("FormItem",{attrs:{label:"Port",prop:"port"}},[e("Input",{attrs:{number:"",placeholder:"请输入录入DB端口"},model:{value:t.dstMha.port,callback:function(a){t.$set(t.dstMha,"port",a)},expression:"dstMha.port"}})],1),e("FormItem",{attrs:{label:"DB机房",prop:"dstDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择db机房区域"},model:{value:t.dstMha.idc,callback:function(a){t.$set(t.dstMha,"idc",a)},expression:"dstMha.idc"}},t._l(t.selectOption.drcZoneList,(function(a){return e("Option",{key:a.label,attrs:{boolean:"",value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{label:"UUID",prop:"uuid"}},[e("Input",{attrs:{placeholder:"请输入录入DB的uuid"},model:{value:t.dstMha.uuid,callback:function(a){t.$set(t.dstMha,"uuid",a)},expression:"dstMha.uuid"}}),e("Button",{on:{click:t.queryDstMhaUuid}},[t._v("连接查询")]),t.hasTest2?e("span",[e("Icon",{attrs:{type:t.testSuccess2?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess2?"green":"red"}}),t._v(" "+t._s(t.testSuccess2?"连接查询成功":"连接查询失败，请手动输入uuid")+" ")],1):t._e()],1),e("FormItem",{attrs:{label:"Master",prop:"master"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否为Master"},model:{value:t.dstMha.master,callback:function(a){t.$set(t.dstMha,"master",a)},expression:"dstMha.master"}},t._l(t.selectOption.isMaster,(function(a){return e("Option",{key:a.key,attrs:{value:a.value}},[t._v(t._s(a.key))])})),1)],1),e("FormItem",[e("Button",{attrs:{type:"primary"},on:{click:function(a){t.preCheckdstMha("dstMha")}}},[t._v("录入DB")]),e("br"),e("br")],1)],1)],1)],1),e("Modal",{attrs:{title:"录入左侧Mha Db信息"},on:{"on-ok":t.submitsrcMha},model:{value:t.srcMha.modal,callback:function(a){t.$set(t.srcMha,"modal",a)},expression:"srcMha.modal"}},[e("p",[t._v("Mha: "+t._s(t.srcMha.mhaName)+" ")]),e("p",[t._v(" db信息 [host: "+t._s(t.srcMha.ip)+":"+t._s(t.srcMha.port)+"]")]),e("p",[t._v(" db信息 [isMaster:"+t._s(t.srcMha.master)+"]")]),e("p",[t._v(" db信息 [idc:"+t._s(t.srcMha.idc)+"]")]),e("p",[t._v(" db信息 [uuid:"+t._s(t.srcMha.uuid)+"]")])]),e("Modal",{attrs:{title:"录入右侧Mha Db信息"},on:{"on-ok":t.submitdstMha},model:{value:t.dstMha.modal,callback:function(a){t.$set(t.dstMha,"modal",a)},expression:"dstMha.modal"}},[e("p",[t._v("Mha: "+t._s(t.dstMha.mhaName)+" ")]),e("p",[t._v(" db信息 [host: "+t._s(t.dstMha.ip)+":"+t._s(t.dstMha.port)+"]")]),e("p",[t._v(" db信息 [isMaster:"+t._s(t.dstMha.master)+"]")]),e("p",[t._v(" db信息 [idc:"+t._s(t.dstMha.idc)+"]")]),e("p",[t._v(" db信息 [uuid:"+t._s(t.dstMha.uuid)+"]")])])],1)},l=[],n={name:"mhaConfig",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String},data:function(){var t=function(t,a,e){if(!/^[0-9]+$/.test(a))return e(new Error("请填写整数port"));e()},a=function(t,a,e){if(!/0|1/.test(a))return e(new Error("请填写整数port"));e()};return{result:"",status:"",title:"",message:"",hasResp:!1,hasTest1:!1,testSuccess1:!1,hasTest2:!1,testSuccess2:!1,srcMha:{modal:!1,mhaName:this.srcMhaName,zoneId:this.srcDc,ip:"",port:"",idc:this.srcDc,uuid:"",master:1},dstMha:{modal:!1,mhaName:this.dstMhaName,zoneId:this.dstDc,ip:"",port:"",idc:this.dstDc,uuid:"",master:1},ruleMhaMachine:{mhaName:[{required:!0,message:"mha集群名不能为空",trigger:"blur"}],ip:[{required:!0,message:"ip不能为空",trigger:"blur"}],port:[{required:!0,validator:t,trigger:"blur"}],idc:[{required:!0,message:"选择db区域",trigger:"blur"}],uuid:[{required:!0,message:"uuid不能为空",trigger:"blur"}],master:[{required:!0,validator:a,trigger:"blur"}]},selectOption:{isMaster:[{key:"Master",value:1},{key:"Slave",value:0}],drcZoneList:this.constant.dcList}}},methods:{changeSrcMha:function(){this.$emit("srcMhaNameChanged",this.srcMha.mhaName)},changeDstMha:function(){this.$emit("dstMhaNameChanged",this.dstMha.mhaName)},querySrcMhaUuid:function(){var t=this,a=this;a.axios.get("/api/drc/v2/mha/uuid?mhaName="+this.srcMha.mhaName+"&ip="+this.srcMha.ip+"&port="+this.srcMha.port+"&master="+this.srcMha.master).then((function(a){t.hasTest1=!0,0===a.data.status?(t.srcMha.uuid=a.data.data,t.testSuccess1=!0):t.testSuccess1=!1}))},queryDstMhaUuid:function(){var t=this,a=this;a.axios.get("/api/drc/v2/mha/uuid?mhaName="+this.dstMha.mhaName+"&ip="+this.dstMha.ip+"&port="+this.dstMha.port+"&master="+this.dstMha.master).then((function(a){t.hasTest2=!0,0===a.data.status?(t.dstMha.uuid=a.data.data,t.testSuccess2=!0):t.testSuccess2=!1}))},preChecksrcMha:function(t){var a=this;this.$refs[t].validate((function(t){t?a.srcMha.modal=!0:a.$Message.error("仍有必填项未填!")}))},submitsrcMha:function(){var t=this,a=this;a.axios.post("/api/drc/v2/mha/machineInfo",{mhaName:this.srcMha.mhaName,master:this.srcMha.master,mySQLInstance:{ip:this.srcMha.ip,port:this.srcMha.port,idc:this.srcMha.idc,uuid:this.srcMha.uuid}}).then((function(e){a.hasResp=!0,0===e.data.status?(a.status="success",a.title="mha:"+t.srcMha.mhaName+"录入db成功!",a.message=e.data.message):(a.status="error",a.title="mha:"+t.srcMha.mhaName+"录入db失败!",a.message=e.data.message)}))},preCheckdstMha:function(t){var a=this;this.$refs[t].validate((function(t){t?a.dstMha.modal=!0:a.$Message.error("仍有必填项未填!")}))},submitdstMha:function(){var t=this,a=this;a.axios.post("/api/drc/v2/mha/machineInfo",{mhaName:this.dstMha.mhaName,master:this.dstMha.master,mySQLInstance:{ip:this.dstMha.ip,port:this.dstMha.port,idc:this.dstMha.idc,uuid:this.dstMha.uuid}}).then((function(e){a.hasResp=!0,0===e.data.status?(a.status="success",a.title="mha:"+t.dstMha.mhaName+"录入db成功!",a.message=e.data.message):(a.status="error",a.title="mha:"+t.dstMha.mhaName+"录入db失败!",a.message=e.data.message)}))}}},o=n,d=e("2877"),u=Object(d["a"])(o,c,l,!1,null,"43d488b7",null),h=u.exports,m=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("Row",[e("i-col",{attrs:{span:"12"}},[e("Form",{staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.srcMha,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"mhaName"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{readonly:"",placeholder:"请输入源集群名"},model:{value:t.srcMha.mhaName,callback:function(a){t.$set(t.srcMha,"mhaName",a)},expression:"srcMha.mhaName"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(a){return t.checkMySqlConfig(t.srcMha)}}},[t._v("配置校验")])],1)],1)],1),e("FormItem",{attrs:{label:"同步表",prop:"ip"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{placeholder:"支持正则，默认全部"},model:{value:t.srcMha.nameFilter,callback:function(a){t.$set(t.srcMha,"nameFilter",a)},expression:"srcMha.nameFilter"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(a){return t.checkMySqlTables(t.srcMha)}}},[t._v("表校验")])],1)],1)],1)],1)],1),e("i-col",{attrs:{span:"12"}},[e("Form",{staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.dstMha,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"目标集群名",prop:"dstMhaName"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{readonly:"",placeholder:"请输入源集群名"},model:{value:t.dstMha.mhaName,callback:function(a){t.$set(t.dstMha,"mhaName",a)},expression:"dstMha.mhaName"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(a){return t.checkMySqlConfig(t.dstMha)}}},[t._v("配置校验")])],1)],1)],1),e("FormItem",{attrs:{label:"同步表",prop:"ip"}},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{attrs:{placeholder:"支持正则，默认全部"},model:{value:t.dstMha.nameFilter,callback:function(a){t.$set(t.dstMha,"nameFilter",a)},expression:"dstMha.nameFilter"}})],1),e("Col",{attrs:{span:"5"}},[e("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(a){return t.checkMySqlTables(t.dstMha)}}},[t._v("表校验")])],1)],1)],1)],1)],1)],1),e("Modal",{attrs:{title:"预检测结果",width:"900px"},model:{value:t.configCheck.modal,callback:function(a){t.$set(t.configCheck,"modal",a)},expression:"configCheck.modal"}},[e("Form",{staticStyle:{width:"100%"}},[e("FormItem",{attrs:{label:"BINLOG [SHOULD BE: ON]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogMode,callback:function(a){t.$set(t.configCheck,"binlogMode",a)},expression:"configCheck.binlogMode"}})],1),e("FormItem",{attrs:{label:"BINLOG_FORMAT  [SHOULD BE: ROW]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogFormat,callback:function(a){t.$set(t.configCheck,"binlogFormat",a)},expression:"configCheck.binlogFormat"}})],1),e("FormItem",{attrs:{label:"binlogVersion1  [SHOULD BE: OFF]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogVersion1,callback:function(a){t.$set(t.configCheck,"binlogVersion1",a)},expression:"configCheck.binlogVersion1"}})],1),e("FormItem",{attrs:{label:"BTD [SHOULD BE: writeSet]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogTransactionDependency,callback:function(a){t.$set(t.configCheck,"binlogTransactionDependency",a)},expression:"configCheck.binlogTransactionDependency"}})],1),e("FormItem",{attrs:{label:"BinlogRowImage [SHOULD BE: FULL]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogRowImage,callback:function(a){t.$set(t.configCheck,"binlogRowImage",a)},expression:"configCheck.binlogRowImage"}})],1),e("FormItem",{attrs:{label:"BTDHS [SHOULD BE: 100k]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.binlogTransactionDependencyHistorySize,callback:function(a){t.$set(t.configCheck,"binlogTransactionDependencyHistorySize",a)},expression:"configCheck.binlogTransactionDependencyHistorySize"}})],1),e("FormItem",{attrs:{label:"GTID_MODE [SHOULD BE: ON]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.gtidMode,callback:function(a){t.$set(t.configCheck,"gtidMode",a)},expression:"configCheck.gtidMode"}})],1),e("FormItem",{attrs:{label:"DRC系统表数量 [SHOULD BE: 1/2]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.drcTables,callback:function(a){t.$set(t.configCheck,"drcTables",a)},expression:"configCheck.drcTables"}})],1),e("FormItem",{attrs:{label:"自增步长"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.autoIncrementStep,callback:function(a){t.$set(t.configCheck,"autoIncrementStep",a)},expression:"configCheck.autoIncrementStep"}})],1),e("FormItem",{attrs:{label:"自增offSet"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.autoIncrementOffset,callback:function(a){t.$set(t.configCheck,"autoIncrementOffset",a)},expression:"configCheck.autoIncrementOffset"}})],1),e("FormItem",{attrs:{label:"DRC3对帐号 [SHOULD BE: three accounts ready]"}},[e("Input",{attrs:{readonly:""},model:{value:t.configCheck.drcAccounts,callback:function(a){t.$set(t.configCheck,"drcAccounts",a)},expression:"configCheck.drcAccounts"}})],1)],1)],1),e("Modal",{attrs:{title:"表检验",width:"1000px"},model:{value:t.tablesCheckModal,callback:function(a){t.tablesCheckModal=a},expression:"tablesCheckModal"}},[e("Card",[e("div",{attrs:{slot:"title"},slot:"title"},[e("span",[t._v("相关表")])]),e("Table",{attrs:{stripe:"",columns:t.columns,data:t.dataWithPage,border:""}}),e("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[e("Page",{attrs:{transfer:!0,total:t.tableData.length,current:t.current,"page-size-opts":t.pageSizeOpts,"page-size":this.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(a){t.current=a},"on-page-size-change":t.handleChangeSize}})],1)],1)],1)],1)},p=[],g=(e("fb6a"),e("2909")),f={name:"preCheckV2",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String,env:String},data:function(){return{srcMha:{mhaName:this.srcMhaName,nameFilter:""},dstMha:{mhaName:this.dstMhaName,nameFilter:""},configCheck:{binlogMode:"",binlogFormat:"",binlogVersion1:"",binlogTransactionDependency:"",binlogRowImage:"",binlogTransactionDependencyHistorySize:0,gtidMode:"",drcTables:0,autoIncrementStep:0,autoIncrementOffset:0,drcAccounts:"",modal:!1},tablesCheckModal:!1,tableData:[],columns:[{title:"序号",width:75,align:"center",fixed:"left",render:function(t,a){return t("span",a.index+1)}},{title:"库名",key:"schema"},{title:"表名",key:"table"},{title:"无OnUpdate字段",key:"noOnUpdateColumn",width:100,align:"center",render:function(t,a){var e=a.row,s=e.noOnUpdateColumn?"True":"";return t("span",s)}},{title:"无OnUpdate字段索引",key:"noOnUpdateKey",width:100,align:"center",render:function(t,a){var e=a.row,s=e.noOnUpdateKey?"True":"";return t("span",s)}},{title:"无PkUk",key:"noPkUk",width:100,align:"center",render:function(t,a){var e=a.row,s=e.noPkUk?"True":"";return t("span",s)}},{title:"支持Truncate",key:"approveTruncate",width:100,align:"center",render:function(t,a){var e=a.row,s=e.approveTruncate?"True":"";return t("span",s)}},{title:"存在DefaultTime为0",key:"timeDefaultZero",width:100,align:"center",render:function(t,a){var e=a.row,s=e.timeDefaultZero?"True":"";return t("span",s)}},{title:"结果",width:100,align:"center",render:function(t,a){var e=a.row,s=e.noOnUpdateColumn||e.noOnUpdateKey||e.noPkUk||e.approveTruncate||e.timeDefaultZero,r=s?"volcano":"green",i=s?"错误":"正常";return t("Tag",{props:{color:r}},i)}}],total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}},computed:{dataWithPage:function(){var t=this.tableData,a=this.current*this.size-this.size,e=a+this.size;return Object(g["a"])(t).slice(a,e)}},methods:{checkMySqlConfig:function(t){var a=this;this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{size:18}}),t("div","检测中，请稍等...")])}}),this.axios.get("/api/drc/v2/mysql/preCheckMySqlConfig?mha="+t.mhaName).then((function(t){console.log(t);var e=t.data.data;console.log(e),a.configCheck.binlogMode=e.binlogMode,a.configCheck.binlogFormat=e.binlogFormat,a.configCheck.binlogVersion1=e.binlogVersion1,a.configCheck.binlogTransactionDependency=e.binlogTransactionDependency,a.configCheck.binlogRowImage=e.binlogRowImage,a.configCheck.binlogTransactionDependencyHistorySize=e.binlogTransactionDependencyHistorySize,a.configCheck.gtidMode=e.gtidMode,a.configCheck.drcTables=e.drcTables,a.configCheck.autoIncrementStep=e.autoIncrementStep,a.configCheck.autoIncrementOffset=e.autoIncrementOffset,a.configCheck.drcAccounts=e.drcAccounts,a.$Spin.hide(),a.configCheck.modal=!0}))},checkMySqlTables:function(t){var a=this;this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{size:18}}),t("div","检测中，请稍等...")])}}),setTimeout((function(){a.$Spin.hide()}),8e4),this.axios.get("/api/drc/v2/mysql/preCheckMySqlTables?mha="+t.mhaName+"&nameFilter="+t.nameFilter).then((function(t){a.tableData=t.data.data,a.$Spin.hide(),a.tablesCheckModal=!0}))},handleChangeSize:function(t){this.size=t}}},b=f,M=Object(d["a"])(b,m,p,!1,null,"50d16dbc",null),v=M.exports,I=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[t.hasResp?e("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:t.status,"show-icon":""}},[t._v(" "+t._s(t.title)+" "),e("span",{attrs:{slot:"desc"},domProps:{innerHTML:t._s(t.message)},slot:"desc"})]):t._e(),e("Row",[e("i-col",{attrs:{span:"12"}},[e("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.srcBuildParam,rules:t.ruleDrc,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源集群名",prop:"srcMhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeSrcMha},model:{value:t.srcBuildParam.mhaName,callback:function(a){t.$set(t.srcBuildParam,"mhaName",a)},expression:"srcBuildParam.mhaName"}})],1),e("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[e("Select",{staticStyle:{width:"250px"},attrs:{multiple:"",placeholder:"选择源集群Replicator"},model:{value:t.srcBuildParam.replicatorIps,callback:function(a){t.$set(t.srcBuildParam,"replicatorIps",a)},expression:"srcBuildParam.replicatorIps"}},t._l(t.replicatorList.src,(function(a){return e("Option",{key:a.ip,attrs:{value:a.ip}},[t._v(t._s(a.ip)+" —— "+t._s(a.az)+" ")])})),1),t._v("   "),e("Button",{attrs:{type:"success"},on:{click:t.autoConfigSrcReplicator}},[t._v("自动录入")])],1),e("FormItem",{attrs:{label:"选择Applier",prop:"applier"}},[e("Select",{staticStyle:{width:"250px"},attrs:{multiple:"",placeholder:"选择源集群Applier"},model:{value:t.srcBuildParam.applierIps,callback:function(a){t.$set(t.srcBuildParam,"applierIps",a)},expression:"srcBuildParam.applierIps"}},t._l(t.applierList.src,(function(a){return e("Option",{key:a.ip,attrs:{value:a.ip}},[t._v(t._s(a.ip)+" —— "+t._s(a.az)+" ")])})),1),t._v("   "),e("Button",{attrs:{type:"success"},on:{click:t.autoConfigSrcApplier}},[t._v("自动录入")])],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始拉取位点R"}},[e("Input",{attrs:{placeholder:"变更replicator机器时,请输入binlog拉取位点"},model:{value:t.srcBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.srcBuildParam,"replicatorInitGtid",a)},expression:"srcBuildParam.replicatorInitGtid"}}),e("Row",[e("Col",{attrs:{span:"12"}},[e("Button",{on:{click:t.querySrcMhaMachineGtid}},[t._v("查询mha位点")]),t.hasTest1?e("span",[e("Icon",{attrs:{type:t.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess1?"green":"red"}}),t._v(" "+t._s(t.testSuccess1?"查询实时位点成功":"连接查询失败")+" ")],1):t._e()],1),e("Col",{attrs:{span:"12"}},[e("Button",{attrs:{type:"success"},on:{click:t.querySrcMhaGtidCheckRes}},[t._v("位点校验")])],1)],1)],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始同步位点A"}},[e("Input",{attrs:{placeholder:"请输入DRC同步起始位点"},model:{value:t.srcBuildParam.applierInitGtid,callback:function(a){t.$set(t.srcBuildParam,"applierInitGtid",a)},expression:"srcBuildParam.applierInitGtid"}})],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"同步配置"}},[e("Button",{attrs:{type:"primary",ghost:""},on:{click:t.getSrcDbReplications}},[t._v("同步表管理")])],1)],1)],1),e("i-col",{attrs:{span:"12"}},[e("Form",{ref:"drc1",staticStyle:{float:"left","margin-top":"50px"},attrs:{model:t.dstBuildParam,rules:t.ruleDrc,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"目标集群名",prop:"dstMhaName"}},[e("Input",{attrs:{placeholder:"请输入目标集群名"},on:{input:t.changeDstMha},model:{value:t.dstBuildParam.mhaName,callback:function(a){t.$set(t.dstBuildParam,"mhaName",a)},expression:"dstBuildParam.mhaName"}})],1),e("FormItem",{attrs:{label:"选择Replicator",prop:"replicator"}},[e("Select",{staticStyle:{width:"250px"},attrs:{multiple:"",placeholder:"选择目标集群Replicator"},model:{value:t.dstBuildParam.replicatorIps,callback:function(a){t.$set(t.dstBuildParam,"replicatorIps",a)},expression:"dstBuildParam.replicatorIps"}},t._l(t.replicatorList.dst,(function(a){return e("Option",{key:a.ip,attrs:{value:a.ip}},[t._v(t._s(a.ip)+" —— "+t._s(a.az)+" ")])})),1),t._v("   "),e("Button",{attrs:{type:"success"},on:{click:t.autoConfigDstReplicator}},[t._v("自动录入")])],1),e("FormItem",{attrs:{label:"选择Applier",prop:"applier"}},[e("Select",{staticStyle:{width:"250px"},attrs:{multiple:"",placeholder:"选择目标集群Applier"},model:{value:t.dstBuildParam.applierIps,callback:function(a){t.$set(t.dstBuildParam,"applierIps",a)},expression:"dstBuildParam.applierIps"}},t._l(t.applierList.dst,(function(a){return e("Option",{key:a.ip,attrs:{value:a.ip}},[t._v(t._s(a.ip)+" —— "+t._s(a.az)+" ")])})),1),t._v("   "),e("Button",{attrs:{type:"success"},on:{click:t.autoConfigDstApplier}},[t._v("自动录入")])],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始拉取位点R"}},[e("Input",{attrs:{placeholder:"变更replicator机器时,请输入binlog拉取位点"},model:{value:t.dstBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.dstBuildParam,"replicatorInitGtid",a)},expression:"dstBuildParam.replicatorInitGtid"}}),e("Row",[e("Col",{attrs:{span:"12"}},[e("Button",{on:{click:t.queryDstMhaMachineGtid}},[t._v("查询mha位点")]),t.hasTest1?e("span",[e("Icon",{attrs:{type:t.testSuccess1?"ios-checkmark-circle":"ios-close-circle",color:t.testSuccess1?"green":"red"}}),t._v(" "+t._s(t.testSuccess1?"查询实时位点成功":"连接查询失败")+" ")],1):t._e()],1),e("Col",{attrs:{span:"12"}},[e("Button",{attrs:{type:"success"},on:{click:t.queryDstMhaGtidCheckRes}},[t._v("位点校验")])],1)],1)],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"初始同步位点A"}},[e("Input",{attrs:{placeholder:"请输入DRC同步起始位点"},model:{value:t.dstBuildParam.applierInitGtid,callback:function(a){t.$set(t.dstBuildParam,"applierInitGtid",a)},expression:"dstBuildParam.applierInitGtid"}})],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"同步配置"}},[e("Button",{attrs:{type:"primary",ghost:""},on:{click:t.getDstDbReplications}},[t._v("同步表管理")])],1)],1)],1)],1),e("Form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":250}},[e("FormItem",[e("br"),e("Button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(a){t.preCheckConfigure()}}},[t._v("提交")])],1),e("Modal",{attrs:{title:"确认配置信息",width:"900px"},on:{"on-ok":t.submitConfig},model:{value:t.reviewModal,callback:function(a){t.reviewModal=a},expression:"reviewModal"}},[e("Row",{attrs:{gutter:5}},[e("i-col",{attrs:{span:"12"}},[e("Form",{staticStyle:{width:"80%"}},[e("FormItem",{attrs:{label:"源集群名"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.mhaName,callback:function(a){t.$set(t.srcBuildParam,"mhaName",a)},expression:"srcBuildParam.mhaName"}})],1),e("FormItem",{attrs:{label:"源集群端Replicator"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.replicatorIps,callback:function(a){t.$set(t.srcBuildParam,"replicatorIps",a)},expression:"srcBuildParam.replicatorIps"}})],1),e("FormItem",{attrs:{label:"源集群端Applier"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.applierIps,callback:function(a){t.$set(t.srcBuildParam,"applierIps",a)},expression:"srcBuildParam.applierIps"}})],1),e("FormItem",{attrs:{label:"源集群端R位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.srcBuildParam,"replicatorInitGtid",a)},expression:"srcBuildParam.replicatorInitGtid"}})],1),e("FormItem",{attrs:{label:"源集群端A位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.srcBuildParam.applierInitGtid,callback:function(a){t.$set(t.srcBuildParam,"applierInitGtid",a)},expression:"srcBuildParam.applierInitGtid"}})],1)],1)],1),e("i-col",{attrs:{span:"12"}},[e("Form",{staticStyle:{width:"80%"}},[e("FormItem",{attrs:{label:"目标集群名"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.mhaName,callback:function(a){t.$set(t.dstBuildParam,"mhaName",a)},expression:"dstBuildParam.mhaName"}})],1),e("FormItem",{attrs:{label:"目标集群端Replicator"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.replicatorIps,callback:function(a){t.$set(t.dstBuildParam,"replicatorIps",a)},expression:"dstBuildParam.replicatorIps"}})],1),e("FormItem",{attrs:{label:"目标集群端Applier"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.applierIps,callback:function(a){t.$set(t.dstBuildParam,"applierIps",a)},expression:"dstBuildParam.applierIps"}})],1),e("FormItem",{attrs:{label:"目标集群端R位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.replicatorInitGtid,callback:function(a){t.$set(t.dstBuildParam,"replicatorInitGtid",a)},expression:"dstBuildParam.replicatorInitGtid"}})],1),e("FormItem",{attrs:{label:"目标集群端A位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.dstBuildParam.applierInitGtid,callback:function(a){t.$set(t.dstBuildParam,"applierInitGtid",a)},expression:"dstBuildParam.applierInitGtid"}})],1)],1)],1)],1)],1),e("Modal",{attrs:{title:"配置结果",width:"1200px"},model:{value:t.resultModal,callback:function(a){t.resultModal=a},expression:"resultModal"}},[e("Form",{staticStyle:{width:"100%"}},[e("FormItem",{attrs:{label:"集群配置"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.result,callback:function(a){t.result=a},expression:"result"}})],1)],1)],1),e("Modal",{attrs:{title:"gitd位点校验结果",width:"900px"},model:{value:t.gtidCheck.modal,callback:function(a){t.$set(t.gtidCheck,"modal",a)},expression:"gtidCheck.modal"}},[e("Form",{staticStyle:{width:"80%"}},[e("FormItem",{attrs:{label:"校验结果"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.legal,callback:function(a){t.$set(t.gtidCheck.resVo,"legal",a)},expression:"gtidCheck.resVo.legal"}})],1),e("FormItem",{attrs:{label:"当前Mha"}},[e("Input",{attrs:{autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.mha,callback:function(a){t.$set(t.gtidCheck.resVo,"mha",a)},expression:"gtidCheck.resVo.mha"}})],1),e("FormItem",{attrs:{label:"配置位点"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.configGtid,callback:function(a){t.$set(t.gtidCheck.resVo,"configGtid",a)},expression:"gtidCheck.resVo.configGtid"}})],1),e("FormItem",{attrs:{label:"purgedGtid"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:t.gtidCheck.resVo.purgedGtid,callback:function(a){t.$set(t.gtidCheck.resVo,"purgedGtid",a)},expression:"gtidCheck.resVo.purgedGtid"}})],1)],1)],1)],1)],1)},k=[],y=(e("4160"),e("159b"),e("53ca")),S={name:"drcBuildV2",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String,env:String},data:function(){return{result:"",status:"",title:"",message:"",hasResp:!1,hasTest1:!1,testSuccess1:!1,hasTest2:!1,testSuccess2:!1,hasTest3:!1,testSuccess3:!1,hasTest4:!1,testSuccess4:!1,reviewModal:!1,resultModal:!1,replicatorList:{src:[],dst:[]},applierList:{src:[],dst:[]},srcBuildParam:{mhaName:this.srcMhaName,replicatorIps:[],applierIps:[],replicatorInitGtid:"",applierInitGtid:""},dstBuildParam:{mhaName:this.dstMhaName,replicatorIps:[],applierIps:[],replicatorInitGtid:"",applierInitGtid:""},gtidCheck:{modal:!1,resVo:{mha:"",legal:"",configGtid:"",purgedGtid:""}},ruleDrc:{oldClusterName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],newClusterName:[{required:!0,message:"新集群名不能为空",trigger:"blur"}],env:[{required:!0,message:"环境不能为空",trigger:"blur"}],replicator:[{required:!0,message:"replicator不能为空",trigger:"blur"}],applier:[{required:!0,message:"applier不能为空",trigger:"blur"}]}}},computed:{dataWithPage:function(){var t=this.nameFilterCheck.tableData,a=this.nameFilterCheck.current*this.nameFilterCheck.size-this.nameFilterCheck.size,e=a+this.nameFilterCheck.size;return Object(g["a"])(t).slice(a,e)}},methods:{flattenObj:function(t){var a={};for(var e in t)if("object"!==Object(y["a"])(t[e])||Array.isArray(t[e]))a[e]=t[e];else{var s=this.flattenObj(t[e]);for(var r in s)a[e+"."+r]=s[r]}return a},autoConfigSrcReplicator:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.srcBuildParam.mhaName+"&type=0&selectedIps="+this.srcBuildParam.replicatorIps).then((function(a){console.log(a.data),t.srcBuildParam.replicatorIps=[],a.data.data.forEach((function(a){return t.srcBuildParam.replicatorIps.push(a.ip)}))}))},autoConfigSrcApplier:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.srcBuildParam.mhaName+"&type=1&selectedIps="+this.srcBuildParam.applierIps).then((function(a){console.log(a.data),t.srcBuildParam.applierIps=[],a.data.data.forEach((function(a){return t.srcBuildParam.applierIps.push(a.ip)}))}))},autoConfigDstReplicator:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.dstBuildParam.mhaName+"&type=0&selectedIps="+this.dstBuildParam.replicatorIps).then((function(a){console.log(a.data),t.dstBuildParam.replicatorIps=[],a.data.data.forEach((function(a){return t.dstBuildParam.replicatorIps.push(a.ip)}))}))},autoConfigDstApplier:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/auto?mhaName="+this.dstBuildParam.mhaName+"&type=1&selectedIps="+this.dstBuildParam.applierIps).then((function(a){console.log(a.data),t.dstBuildParam.applierIps=[],a.data.data.forEach((function(a){return t.dstBuildParam.applierIps.push(a.ip)}))}))},getSrcMhaResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.srcBuildParam.mhaName+"&type=0").then((function(a){console.log(a.data),t.replicatorList.src=a.data.data})),this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.srcBuildParam.mhaName+"&type=1").then((function(a){console.log(a.data),t.applierList.src=a.data.data}))},getDstMhaResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.dstBuildParam.mhaName+"&type=0").then((function(a){console.log(a.data),t.replicatorList.dst=a.data.data})),this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.dstBuildParam.mhaName+"&type=1").then((function(a){console.log(a.data),t.applierList.dst=a.data.data}))},getSrcMhaReplicatorsInUse:function(){var t=this;this.axios.get("/api/drc/v2/mha/replicator?mhaName="+this.srcBuildParam.mhaName).then((function(a){t.srcBuildParam.replicatorIps=a.data.data}))},getDstMhaReplicatorsInUse:function(){var t=this;this.axios.get("/api/drc/v2/mha/replicator?mhaName="+this.dstBuildParam.mhaName).then((function(a){console.log(a.data),t.dstBuildParam.replicatorIps=a.data.data}))},getSrcMhaAppliersInUse:function(){var t=this;this.axios.get("/api/drc/v2/config/mha/applier?srcMhaName="+this.dstBuildParam.mhaName+"&dstMhaName="+this.srcBuildParam.mhaName).then((function(a){console.log(a.data),t.srcBuildParam.applierIps=a.data.data})),this.axios.get("/api/drc/v2/config/mha/applierGtid?srcMhaName="+this.dstBuildParam.mhaName+"&dstMhaName="+this.srcBuildParam.mhaName).then((function(a){console.log(a.data),t.srcBuildParam.applierInitGtid=a.data.data}))},getDstMhaAppliersInUse:function(){var t=this;this.axios.get("/api/drc/v2/config/mha/applier?srcMhaName="+this.srcBuildParam.mhaName+"&dstMhaName="+this.dstBuildParam.mhaName).then((function(a){t.dstBuildParam.applierIps=a.data.data})),this.axios.get("/api/drc/v2/config/mha/applierGtid?srcMhaName="+this.srcBuildParam.mhaName+"&dstMhaName="+this.dstBuildParam.mhaName).then((function(a){console.log(a.data),t.dstBuildParam.applierInitGtid=a.data.data}))},querySrcMhaMachineGtid:function(){var t=this,a=this;a.axios.get("/api/drc/v2/mha/gtid/executed?mha="+this.srcBuildParam.mhaName).then((function(a){t.hasTest1=!0,0===a.data.status?(t.srcBuildParam.replicatorInitGtid=a.data.data,t.testSuccess1=!0):t.testSuccess1=!1}))},querySrcMhaGtidCheckRes:function(){var t=this;if(null!=this.srcBuildParam.replicatorInitGtid&&""!==this.srcBuildParam.replicatorInitGtid){var a=this;a.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+this.srcBuildParam.mhaName+"&configGtid="+this.srcBuildParam.replicatorInitGtid).then((function(a){0===a.data.status?(t.gtidCheck.resVo={mha:t.srcBuildParam.mhaName,legal:!0===a.data.data.legal?"合理位点":"binlog已经被purge",configGtid:t.srcBuildParam.replicatorInitGtid,purgedGtid:a.data.data.purgedGtid},t.gtidCheck.modal=!0):alert("位点校验失败!")}))}else alert("位点为空！")},queryDstMhaMachineGtid:function(){var t=this,a=this;a.axios.get("/api/drc/v2/mha/gtid/executed?mha="+this.dstBuildParam.mhaName).then((function(a){t.hasTest2=!0,0===a.data.status?(t.dstBuildParam.replicatorInitGtid=a.data.data,t.testSuccess2=!0):t.testSuccess2=!1}))},queryDstMhaGtidCheckRes:function(){var t=this;if(null!=this.dstBuildParam.replicatorInitGtid&&""!==this.dstBuildParam.replicatorInitGtid){var a=this;a.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+this.dstBuildParam.mhaName+"&configGtid="+this.dstBuildParam.replicatorInitGtid).then((function(a){0===a.data.status?(t.gtidCheck.resVo={mha:t.dstBuildParam.mhaName,legal:!0===a.data.data.legal?"合理位点":"binlog已经被purge",configGtid:t.dstBuildParam.replicatorInitGtid,purgedGtid:a.data.data.purgedGtid},t.gtidCheck.modal=!0):alert("位点校验失败!")}))}else alert("位点为空！")},getSrcDc:function(){var t=this;this.axios.get("/api/drc/v2/mha/dc?mhaName="+this.srcBuildParam.mhaName).then((function(a){t.srcDc=a.data.data}))},getDstDc:function(){var t=this;this.axios.get("/api/drc/v2/mha/dc?mhaName="+this.dstBuildParam.mhaName).then((function(a){t.dstDc=a.data.data}))},changeSrcMha:function(){this.$emit("srcMhaNameChanged",this.srcBuildParam.mhaName),this.getSrcMhaResources(),this.getSrcMhaReplicatorsInUse(),this.getSrcMhaAppliersInUse(),this.getDstMhaAppliersInUse(),this.getSrcDc()},changeDstMha:function(){this.$emit("dstMhaNameChanged",this.dstBuildParam.mhaName),this.getDstMhaResources(),this.getDstMhaReplicatorsInUse(),this.getDstMhaAppliersInUse(),this.getSrcMhaAppliersInUse(),this.getDstDc()},start:function(){this.$Loading.start()},finish:function(){this.$Loading.finish()},error:function(){this.$Loading.error()},changeModal:function(t){var a=this;this.$refs[t].validate((function(t){t?a.drc.reviewModal=!0:a.$Message.error("仍有必填项未填!")}))},preCheckConfigure:function(){this.reviewModal=!0},reviewConfigure:function(){this.drc.reviewModal=!0},submitConfig:function(){var t=this,a=this;this.axios.post("/api/drc/v2/config/",{srcBuildParam:this.srcBuildParam,dstBuildParam:this.dstBuildParam}).then((function(e){console.log(e.data),a.result=e.data,a.reviewModal=!1,a.resultModal=!0,t.refresh()}))},getSrcDbReplications:function(){this.$router.push({path:"/dbTables",query:{srcMhaName:this.dstBuildParam.mhaName,dstMhaName:this.srcBuildParam.mhaName,srcDc:this.dstDc,dstDc:this.srcDc,order:!0}})},getDstDbReplications:function(){this.$router.push({path:"/dbTables",query:{srcMhaName:this.srcBuildParam.mhaName,dstMhaName:this.dstBuildParam.mhaName,srcDc:this.srcDc,dstDc:this.dstDc,order:!0}})},handleChangeSize:function(t){this.size=t},refresh:function(){this.getSrcMhaReplicatorsInUse(),this.getDstMhaReplicatorsInUse(),this.getSrcMhaAppliersInUse(),this.getDstMhaAppliersInUse(),this.getSrcDc(),this.getDstDc()}},created:function(){this.getSrcMhaResources(),this.getDstMhaResources(),this.refresh()}},x=S,N=(e("3719"),Object(d["a"])(x,I,k,!1,null,"105469cd",null)),B=N.exports,D=e("e537"),C={components:{mhaBuild:i["default"],mhaConfigV2:h,preCheckV2:v,drcBuildV2:B,complete:D["a"]},props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String,env:String},data:function(){return{current:0,clusterPair:{srcMhaName:"",dstMhaName:"",env:"",srcDc:"",dstDc:""}}},methods:{jumpTo:function(t){this.current=t,this.hasResp=!1},next:function(){this.current=this.current+1,this.hasResp=!1},prev:function(){this.current=this.current-1,this.hasResp=!1},updateSrcMha:function(t){this.clusterPair.srcMhaName=t},updateDstMha:function(t){this.clusterPair.dstMhaName=t},updateSrcDc:function(t){this.clusterPair.srcDc=t},updateDstDc:function(t){this.clusterPair.dstDc=t},updateEnv:function(t){this.clusterPair.env=t}},created:function(){var t=this.$route.query.step;"undefined"===typeof t?console.log("curStep undefined, do nothing"):this.jumpTo(Number(t));var a=this.$route.query.order;null==a?(console.log("order is null, do nothing"),this.clusterPair.srcMhaName=this.$route.query.srcMhaName,this.clusterPair.dstMhaName=this.$route.query.dstMhaName,this.clusterPair.srcDc=this.$route.query.srcDc,this.clusterPair.dstDc=this.$route.query.dstDc):a?(this.clusterPair.srcMhaName=this.$route.query.srcMhaName,this.clusterPair.dstMhaName=this.$route.query.dstMhaName,this.clusterPair.srcDc=this.$route.query.srcDc,this.clusterPair.dstDc=this.$route.query.dstDc):(this.clusterPair.srcMhaName=this.$route.query.dstMhaName,this.clusterPair.dstMhaName=this.$route.query.srcMhaName)}},P=C,w=Object(d["a"])(P,s,r,!1,null,"fe531e22",null);a["default"]=w.exports},"9b5c":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[t.hasResp?e("Alert",{staticStyle:{width:"65%","margin-left":"250px"},attrs:{type:t.status,"show-icon":""}},[t._v(" "+t._s(t.title)+" "),e("span",{attrs:{slot:"desc"},domProps:{innerHTML:t._s(t.message)},slot:"desc"})]):t._e(),e("Form",{ref:"build",staticStyle:{"margin-top":"50px"},attrs:{model:t.build,rules:t.ruleBuild,"label-width":250}},[e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"源Mha集群名",prop:"srcMhaName"}},[e("Input",{attrs:{placeholder:"请输入源集群名"},on:{input:t.changeSrcMha},model:{value:t.build.srcMhaName,callback:function(a){t.$set(t.build,"srcMhaName",a)},expression:"build.srcMhaName"}})],1),e("FormItem",{attrs:{label:"源集群机房区域",prop:"srcDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:t.changeSrcDc},model:{value:t.build.srcDc,callback:function(a){t.$set(t.build,"srcDc",a)},expression:"build.srcDc"}},t._l(t.build.drcZoneList,(function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"新Mha集群名",prop:"dstMhaName"}},[e("Input",{attrs:{placeholder:"请输入新集群名"},on:{input:t.changeDstMha},model:{value:t.build.dstMhaName,callback:function(a){t.$set(t.build,"dstMhaName",a)},expression:"build.dstMhaName"}})],1),e("FormItem",{attrs:{label:"新集群机房区域",prop:"dstDc"}},[e("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择机房区域"},on:{input:t.changeDstDc},model:{value:t.build.dstDc,callback:function(a){t.$set(t.build,"dstDc",a)},expression:"build.dstDc"}},t._l(t.build.drcZoneList,(function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{staticStyle:{width:"600px"},attrs:{label:"BU名",prop:"buName"}},[e("Input",{attrs:{placeholder:"请输入BU名，自动绑定route策略"},on:{input:t.changeBu},model:{value:t.build.buName,callback:function(a){t.$set(t.build,"buName",a)},expression:"build.buName"}})],1),e("FormItem",[e("Button",{on:{click:function(a){return t.handleReset("build")}}},[t._v("重置")]),e("Button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(a){return t.changeModal("build")}}},[t._v("新建DRC同步集群")]),e("Modal",{attrs:{title:"创建DRC"},on:{"on-ok":function(a){return t.postBuild("build")}},model:{value:t.build.modal,callback:function(a){t.$set(t.build,"modal",a)},expression:"build.modal"}},[e("p",[t._v('确定创建新DRC "'+t._s(t.build.srcMhaName+t.build.dstMhaName)+'" 吗？')])])],1)],1)],1)},r=[],i={name:"mhaBuild",props:{srcMhaName:String,dstMhaName:String,srcDc:String,dstDc:String},data:function(){return{status:"",title:"",message:"",hasResp:!1,build:{modal:!1,srcMhaName:this.srcMhaName,dstMhaName:this.dstMhaName,buName:"",srcDc:this.srcDc,dstDc:this.dstDc,drcZoneList:this.constant.dcList},ruleBuild:{srcMhaName:[{required:!0,message:"源集群名不能为空",trigger:"blur"}],dstMhaName:[{required:!0,message:"目标集群名不能为空",trigger:"blur"}],srcDc:[{required:!0,message:"选择源集群区域",trigger:"change"}],dstDc:[{required:!0,message:"选择目标集群区域",trigger:"change"}],buName:[{required:!0,message:"BU名不能为空",trigger:"blur"}]}}},methods:{postBuild:function(t){var a=this,e=this;e.$refs[t].validate((function(t){t?(a.hasResp=!1,e.axios.post("/api/drc/v2/config/mha",{buName:a.build.buName,srcMhaName:a.build.srcMhaName,dstMhaName:a.build.dstMhaName,srcDc:a.build.srcDc,dstDc:a.build.dstDc}).then((function(t){e.hasResp=!0,0===t.data.status?(e.status="success",e.title="集群创建完成!",e.message=t.data.message):(e.status="error",e.title="集群创建失败!",e.message=t.data.message)}))):e.$Message.error("仍有必填项未填!")}))},handleReset:function(t){this.$refs[t].resetFields()},changeSrcMha:function(){this.$emit("srcMhaNameChanged",this.build.srcMhaName)},changeDstMha:function(){this.$emit("dstMhaNameChanged",this.build.dstMhaName)},changeSrcDc:function(){this.$emit("srcDcChanged",this.build.srcDc)},changeDstDc:function(){this.$emit("dstDcChanged",this.build.dstDc)},changeBu:function(){this.$emit("buNameChanged",this.build.buName)},changeModal:function(t){var a=this;this.$refs[t].validate((function(t){t?a.build.modal=!0:a.$Message.error("仍有必填项未填!")}))}}},c=i,l=e("2877"),n=Object(l["a"])(c,s,r,!1,null,"12ac2bcf",null);a["default"]=n.exports}}]);
//# sourceMappingURL=chunk-867755aa.2fc5ccd3.js.map