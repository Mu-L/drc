(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-454401fe"],{1276:function(e,t,a){"use strict";var r=a("d784"),n=a("44e7"),o=a("825a"),i=a("1d80"),s=a("4840"),l=a("8aa5"),c=a("50c4"),m=a("14c3"),u=a("9263"),d=a("d039"),f=[].push,g=Math.min,p=4294967295,h=!d((function(){return!RegExp(p,"y")}));r("split",2,(function(e,t,a){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,a){var r=String(i(this)),o=void 0===a?p:a>>>0;if(0===o)return[];if(void 0===e)return[r];if(!n(e))return t.call(r,e,o);var s,l,c,m=[],d=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),g=0,h=new RegExp(e.source,d+"g");while(s=u.call(h,r)){if(l=h.lastIndex,l>g&&(m.push(r.slice(g,s.index)),s.length>1&&s.index<r.length&&f.apply(m,s.slice(1)),c=s[0].length,g=l,m.length>=o))break;h.lastIndex===s.index&&h.lastIndex++}return g===r.length?!c&&h.test("")||m.push(""):m.push(r.slice(g)),m.length>o?m.slice(0,o):m}:"0".split(void 0,0).length?function(e,a){return void 0===e&&0===a?[]:t.call(this,e,a)}:t,[function(t,a){var n=i(this),o=void 0==t?void 0:t[e];return void 0!==o?o.call(t,n,a):r.call(String(n),t,a)},function(e,n){var i=a(r,e,this,n,r!==t);if(i.done)return i.value;var u=o(e),d=String(this),f=s(u,RegExp),b=u.unicode,w=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(h?"y":"g"),v=new f(h?u:"^(?:"+u.source+")",w),I=void 0===n?p:n>>>0;if(0===I)return[];if(0===d.length)return null===m(v,d)?[d]:[];var R=0,x=0,C=[];while(x<d.length){v.lastIndex=h?x:0;var y,F=m(v,h?d:d.slice(x));if(null===F||(y=g(c(v.lastIndex+(h?0:x)),d.length))===R)x=l(d,x,b);else{if(C.push(d.slice(R,x)),C.length===I)return C;for(var N=1;N<=F.length-1;N++)if(C.push(F[N]),C.length===I)return C;x=R=y}}return C.push(d.slice(R)),C}]}),!h)},"21df":function(e,t,a){"use strict";a("5084")},3835:function(e,t,a){"use strict";function r(e){if(Array.isArray(e))return e}a.d(t,"a",(function(){return i}));a("a4d3"),a("e01a"),a("d28b"),a("e260"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0");function n(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],r=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0)if(a.push(i.value),t&&a.length===t)break}catch(l){n=!0,o=l}finally{try{r||null==s["return"]||s["return"]()}finally{if(n)throw o}}return a}}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){return r(e)||n(e,t)||o()}},"498a":function(e,t,a){"use strict";var r=a("23e7"),n=a("58a8").trim,o=a("c8d2");r({target:"String",proto:!0,forced:o("trim")},{trim:function(){return n(this)}})},5084:function(e,t,a){},"666c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/v2/dbDrcBuildV2"}},[e._v("DB粒度 DRC 同步")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 111px 185px",zIndex:"1"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"18"}},[a("Form",{staticStyle:{"margin-right":"20px","margin-top":"10px"},attrs:{model:e.formItem,"label-width":100}},[a("FormItem",{attrs:{label:"数据库",required:!0}},[a("Select",{attrs:{filterable:"",disabled:e.meta.fixDb,placeholder:"请搜索数据库信息","remote-method":e.getExistDb,loading:e.dataLoading},on:{"on-change":e.selectDb},model:{value:e.meta.dbName,callback:function(t){e.$set(e.meta,"dbName",t)},expression:"meta.dbName"}},e._l(e.meta.dbOptions,(function(t,r){return a("Option",{key:r,attrs:{value:t.dbName}},[e._v(" "+e._s(t.dbName)+" ")])})),1)],1),a("FormItem",{attrs:{label:"同步方向",required:!0}},[a("RadioGroup",{attrs:{"button-style":"solid"},on:{"on-change":e.afterSelectExistReplication},model:{value:e.selectedExistReplication,callback:function(t){e.selectedExistReplication=t},expression:"selectedExistReplication"}},e._l(e.meta.existReplicationRegionOptions,(function(t){return a("Radio",{key:t.srcRegionName+" -> "+t.dstRegionName,attrs:{label:t.srcRegionName+" -> "+t.dstRegionName,border:""}},[e._v(" "+e._s(t.srcRegionName+" -> "+t.dstRegionName)+" ")])})),1),a("Button",{attrs:{type:"primary",icon:"md-add",ghost:""},on:{click:e.goToCreateReplication}},[e._v("新增")]),a("Modal",{attrs:{width:"1200px","footer-hide":!0,title:"创建同步"},model:{value:e.createModal.open,callback:function(t){e.$set(e.createModal,"open",t)},expression:"createModal.open"}},[e.createModal.open?a("mha-preview",{attrs:{"db-name":e.meta.dbName,"exist-replication-region-options":e.meta.existReplicationRegionOptions},on:{updated:e.getDrcConfig}}):e._e()],1)],1),a("Divider",{attrs:{orientation:"left"}},[e._v("同步表")]),a("Card",{staticStyle:{width:"100%"}},[a("tables",{attrs:{"table-data":e.drcConfig.logicTableSummaryDtos,"data-loading":e.configDataLoading,"src-region":e.meta.srcRegionName,"dst-region":e.meta.dstRegionName,"db-name":e.meta.dbName,"db-names":e.drcConfig.dbNames},on:{updated:e.getDrcConfig}})],1),a("Divider",{attrs:{orientation:"left"}},[e._v("同步DB")]),a("Card",{staticStyle:{width:"100%"}},[a("mha-replication-panel",{attrs:{"mha-replications":e.drcConfig.mhaReplications}})],1)],1)],1)],1)],1)],1)},n=[],o=(a("d3b7"),a("ac1f"),a("5319"),a("1276"),a("498a"),a("53ca")),i=(a("96cf"),a("1da1")),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Table",{ref:"multipleTable",staticStyle:{"margin-top":"20px"},attrs:{stripe:"",columns:e.columns,data:e.tableData,loading:e.dataLoading,border:""},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.row,n=t.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goToUpdateConfig(r,n)}}},[e._v("修改 ")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(t){return e.goToDeleteConfig(r,n)}}},[e._v("删除 ")])]}}])}),a("br"),a("Button",{attrs:{type:"success",icon:"md-add"},on:{click:e.goToInsertConfig}},[e._v(" 新增 ")]),a("Modal",{attrs:{width:"1200px","footer-hide":!0,title:e.actionTitle},model:{value:e.editModal.open,callback:function(t){e.$set(e.editModal,"open",t)},expression:"editModal.open"}},[e.editModal.open?a("db-replication-config",{ref:"dbReplicationConfigComponent",attrs:{"config-data":e.selectedRow,"src-region":e.srcRegion,"dst-region":e.dstRegion,"db-names":e.dbNames,"form-action":e.action},on:{finished:e.finishConfig}}):e._e()],1)],1)},l=[],c=(a("4ec9"),a("3ca3"),a("ddb0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"13"}},[a("Form",{staticStyle:{"margin-right":"20px","margin-top":"10px"},attrs:{model:e.formItem,disabled:"delete"===e.formAction,"label-width":100}},[e.alertInfo.show?a("Alert",{attrs:{type:"warning","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),e.alertInfo.successShow?a("Alert",{attrs:{type:"success","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),a("FormItem",{attrs:{prop:"dbName",label:"库名",required:!0}},[a("Input",{attrs:{type:"textarea",autosize:!0,readonly:!0,border:!1,placeholder:"请输入库名（支持正则）"},model:{value:e.formItem.dbName,callback:function(t){e.$set(e.formItem,"dbName",t)},expression:"formItem.dbName"}})],1),a("FormItem",{attrs:{label:"同步表",required:!0}},[a("Input",{attrs:{placeholder:"请输入正则表达式"},on:{"on-keydown":function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"]))return null;t.preventDefault()},"on-blur":e.afterEnterTableName},model:{value:e.formItem.tableName,callback:function(t){e.$set(e.formItem,"tableName",t)},expression:"formItem.tableName"}})],1),a("FormItem",{attrs:{label:"行过滤"}},[a("i-switch",{attrs:{size:"large"},scopedSlots:e._u([{key:"open",fn:function(){return[a("span",[e._v("On")])]},proxy:!0},{key:"close",fn:function(){return[a("span",[e._v("Off")])]},proxy:!0}]),model:{value:e.formItem.switch.rowsFilter,callback:function(t){e.$set(e.formItem.switch,"rowsFilter",t)},expression:"formItem.switch.rowsFilter"}})],1),e.formItem.switch.rowsFilter?a("Card",{staticStyle:{"margin-left":"100px"},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"md-settings"}}),e._v(" 行过滤配置 "),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{icon:"ios-refresh",size:"small",type:"primary",loading:e.commonColumnLoading},on:{click:e.getCommonColumns}},[e._v("获取公共字段 ")])]},proxy:!0}],null,!1,571298879)},[a("FormItem",{attrs:{label:"模式"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择行过滤模式"},model:{value:e.formItem.rowsFilterCreateParam.mode,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"mode",t)},expression:"formItem.rowsFilterCreateParam.mode"}},e._l(e.formItem.constants.rowsFilter.modes,(function(t){return a("Option",{key:t.mode,attrs:{value:t.mode}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),e.useTripUdlOrUidMode?a("div",[e.fillContextByRegion?a("FormItem",{attrs:{label:"规则内容"}},[a("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"Region 选择"},model:{value:e.formItem.rowsFilter.configInTripUid.regionsChosen,callback:function(t){e.$set(e.formItem.rowsFilter.configInTripUid,"regionsChosen",t)},expression:"formItem.rowsFilter.configInTripUid.regionsChosen"}},e._l(e.formItem.constants.rowsFilter.regionsForChose,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1):e._e(),e.showUdlConfigDetail?a("div",[a("Divider",[e._v("UDL配置")]),a("FormItem",{attrs:{label:"UDL字段"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",disabled:e.commonColumnLoading,placeholder:"不选默认则无UDL配置"},model:{value:e.formItem.rowsFilterCreateParam.udlColumns,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"udlColumns",t)},expression:"formItem.rowsFilterCreateParam.udlColumns"}},e._l(e.formItem.constants.columnsForChose,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t)+" ")])})),1)],1),e.hasUdlColumn?a("FormItem",{attrs:{label:"DRC UDL策略id"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"请选择ucs策略id"},model:{value:e.formItem.rowsFilterCreateParam.drcStrategyId,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"drcStrategyId",t)},expression:"formItem.rowsFilterCreateParam.drcStrategyId"}},e._l(e.formItem.constants.rowsFilter.drcStrategyIdsForChose,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t)+" ")])})),1)],1):e._e()],1):e._e(),e.showUidConfigDetail?a("div",[a("Divider",[e._v("UID配置")]),a("FormItem",{attrs:{label:"UID字段"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",disabled:e.commonColumnLoading,placeholder:"不选默认则无UID配置"},model:{value:e.formItem.rowsFilterCreateParam.columns,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"columns",t)},expression:"formItem.rowsFilterCreateParam.columns"}},e._l(e.formItem.constants.columnsForChose,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t)+" ")])})),1)],1),e.hasUidColumn?a("FormItem",{attrs:{label:"fetchMode"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择"},on:{"on-change":function(t){return e.fetchModeChange()}},model:{value:e.formItem.rowsFilterCreateParam.fetchMode,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"fetchMode",t)},expression:"formItem.rowsFilterCreateParam.fetchMode"}},e._l(e.formItem.constants.rowsFilter.fetchModeForChose,(function(t){return a("Option",{key:t.k,attrs:{value:t.v}},[e._v(" "+e._s(t.k)+" ")])})),1)],1):e._e(),e.hasUidColumn?a("FormItem",{attrs:{label:"空处理"}},[a("Checkbox",{model:{value:e.formItem.rowsFilterCreateParam.illegalArgument,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"illegalArgument",t)},expression:"formItem.rowsFilterCreateParam.illegalArgument"}},[e._v("【字段为空时】同步")])],1):e._e()],1):e._e()],1):a("div",[a("FormItem",{attrs:{label:"规则内容"}},[a("Input",{staticStyle:{width:"250px"},attrs:{type:"textarea",placeholder:"请输入行过滤内容"},model:{value:e.formItem.rowsFilterCreateParam.context,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"context",t)},expression:"formItem.rowsFilterCreateParam.context"}})],1),a("FormItem",{attrs:{label:"相关字段"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"选择相关字段"},model:{value:e.formItem.rowsFilterCreateParam.columns,callback:function(t){e.$set(e.formItem.rowsFilterCreateParam,"columns",t)},expression:"formItem.rowsFilterCreateParam.columns"}},e._l(e.formItem.constants.columnsForChose,(function(e){return a("Option",{key:e,attrs:{value:e,lable:e}})})),1)],1)],1)],1):e._e(),a("FormItem",{attrs:{label:"列过滤"}},[a("i-switch",{attrs:{size:"large"},scopedSlots:e._u([{key:"open",fn:function(){return[a("span",[e._v("On")])]},proxy:!0},{key:"close",fn:function(){return[a("span",[e._v("Off")])]},proxy:!0}]),model:{value:e.formItem.switch.colsFilter,callback:function(t){e.$set(e.formItem.switch,"colsFilter",t)},expression:"formItem.switch.colsFilter"}})],1),e.formItem.switch.colsFilter?a("Card",{staticStyle:{"margin-left":"100px"},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"md-settings"}}),e._v(" 列过滤配置 "),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{icon:"ios-refresh",size:"small",type:"primary",loading:e.commonColumnLoading},on:{click:e.getCommonColumns}},[e._v("获取公共字段 ")])]},proxy:!0}],null,!1,2228726756)},[a("FormItem",{attrs:{label:"模式"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择字段过滤模式"},model:{value:e.formItem.columnsFilterCreateParam.mode,callback:function(t){e.$set(e.formItem.columnsFilterCreateParam,"mode",t)},expression:"formItem.columnsFilterCreateParam.mode"}},e._l(e.formItem.constants.colsFilter.modes,(function(t){return a("Option",{key:t.mode,attrs:{value:t.mode}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("FormItem",{attrs:{label:"字段"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"选择相关的字段",disabled:e.commonColumnLoading},on:{"on-create":e.handleCreateColumn},model:{value:e.formItem.columnsFilterCreateParam.columns,callback:function(t){e.$set(e.formItem.columnsFilterCreateParam,"columns",t)},expression:"formItem.columnsFilterCreateParam.columns"}},e._l(e.formItem.constants.columnsForChose,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t)+" ")])})),1)],1)],1):e._e(),a("br"),a("Row",[a("Col",{attrs:{span:"6",offset:"8"}}),a("Col",{attrs:{span:"6",offset:"4"}})],1)],1)],1),a("Col",{attrs:{span:"11"}},[a("db-tables-preview",{attrs:{"src-region-name":e.srcRegion,"dst-region-name":e.dstRegion,"db-name":e.formItem.dbName,"table-names":e.formItem.tableName,mode:e.formItem.buildMode}})],1)],1),a("Divider"),a("Button",{staticStyle:{"margin-left":"50px"},attrs:{type:e.buttonTypeMap.get(e.formAction),loading:e.dataLoading||e.commonColumnLoading},on:{click:e.submitAll}},[e._v(e._s(e.buttonTextMap.get(e.formAction))+" ")])],1)}),m=[],u=(a("caad"),a("a15b"),a("fb6a"),a("b0c0"),a("2532"),a("2909")),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Divider",{staticStyle:{"margin-top":"50px"}},[e._v("预览：同步表")]),a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.dbTableLoading},on:{click:e.getTableInfo}},[e._v(" 检查同步表 ")]),a("Table",{attrs:{size:"small",loading:e.dbTableLoading,stripe:"",columns:e.table.dbTableColumn,data:e.preCheckTablePage,border:""}}),a("div",[a("Page",{attrs:{transfer:!0,total:e.checkTableDataList.length,current:e.table.dbTablePage.current,"page-size-opts":e.table.dbTablePage.pageSizeOpts,"page-size":e.table.dbTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbTablePage,"current",t)},"on-change":function(t){e.table.dbTablePage.current=t},"on-page-size-change":function(t){e.table.dbTablePage.size=t}}})],1)],1)},f=[],g=(a("a4d3"),a("e01a"),a("d28b"),a("a9e3"),a("3835")),p={name:"dbTablesPreview",props:{mode:Number,dbName:String,srcRegionName:String,dstRegionName:String,tableNames:String},emits:["updated"],data:function(){return{checkTableDataList:[],dbTableLoading:!1,table:{dbTableColumn:[{title:"序",width:50,key:"indexForShow"},{title:"库名",key:"schema",resizable:!0},{title:"表名",key:"table",resizable:!0},{title:"结果",align:"center",render:function(e,t){var a=t.row,r="ok"!==a.res?"volcano":"green",n=a.res;return e("Tag",{props:{color:r}},n)}}],dbTablePage:{total:0,current:1,size:10,pageSizeOpts:[5,10,20,100]}}}},methods:{getTableInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.checkTableDataList=[],e.table.dbTablePage.current=1,1!==e.mode){t.next=8;break}if(e.dalClusterName){t.next=6;break}return e.$Message.warning("请先填写 dalcluster"),t.abrupt("return");case 6:t.next=11;break;case 8:if(e.dbName){t.next=11;break}return e.$Message.warning("请先填写数据库"),t.abrupt("return");case 11:if(e.srcRegionName&&e.dstRegionName){t.next=14;break}return e.$Message.warning("请先填写同步方向"),t.abrupt("return");case 14:if(e.tableNames){t.next=17;break}return e.$Message.warning("请先填写表名"),t.abrupt("return");case 17:return e.dbTableLoading=!0,t.next=20,e.axios.get("/api/drc/v2/autoconfig/preCheckTable",{params:e.flattenObj({mode:e.mode,dbName:e.dbName,srcRegionName:e.srcRegionName,dstRegionName:e.dstRegionName,tblsFilterDetail:{tableNames:e.tableNames}})}).then((function(t){var a=t.data.data;if(a){var r=!0,n=!1,o=void 0;try{for(var i,s=a.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=Object(g["a"])(i.value,2),c=l[0],m=l[1];m.indexForShow=c}}catch(u){n=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}e.checkTableDataList=a,e.$Message.success("同步表检测成功, 共找到 "+a.length+" 个表")}else e.$Message.warning("同步表检测失败："+t.data.message)})).catch((function(t){e.$Message.error("查询dalcluster异常: "+t)})).finally((function(){e.dbTableLoading=!1}));case 20:case"end":return t.stop()}}),t)})))()},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var r=this.flattenObj(e[a]);for(var n in r)t[a+"."+n]=r[n]}return t}},computed:{preCheckTablePage:function(){var e=this.checkTableDataList,t=(this.table.dbTablePage.current-1)*this.table.dbTablePage.size,a=t+this.table.dbTablePage.size;return Object(u["a"])(e).slice(t,a)}},created:function(){this.tableNames&&this.tableNames.trim().length>0&&this.getTableInfo()}},h=p,b=a("2877"),w=Object(b["a"])(h,d,f,!1,null,"4164dffe",null),v=w.exports,I={components:{DbTablesPreview:v},FORM_ACTION_OPTION:{CREATE:"create",EDIT:"edit",DELETE:"delete"},name:"dbReplicationConfig",props:{configData:{},srcRegion:String,dstRegion:String,dbNames:Array,formAction:String},emits:["finished"],data:function(){return{meta:{rowsFilterId:null,colsFilterId:null,dbReplicationIds:[],originLogicTableConfig:{}},formItem:{buildMode:2,dbName:null,tableName:null,rowsFilterCreateParam:this.rowsFilterCreateParamInit(),columnsFilterCreateParam:this.columnsFilterCreateParamInit(),rowsFilter:{configInTripUid:{regionsChosen:[]}},switch:{rowsFilter:!1,colsFilter:!1},constants:{rowsFilter:{filterMode:{JAVA_REGEX:0,TRIP_UDL:1,AVIATOR_REGEX:3,CUSTOM:4,TRIP_UDL_UID:5},fetchMode:{RPC:0,BlackList:1,WhiteList:2,BlackList_Global:3},modes:[{name:"trip_udl",mode:1},{name:"java_regex",mode:0},{name:"aviator_regex",mode:3},{name:"custom",mode:4},{name:"trip_udl_uid",mode:5}],regionsForChose:["SIN","SH","FRA"],drcStrategyIdsForChose:[2000000002],fetchModeForChose:[{k:"RPC调用",v:0},{k:"BlackList",v:1},{k:"WhiteList",v:2},{k:"BlackListGlobal",v:3}]},colsFilter:{modes:[{name:"exclude",mode:0},{name:"include",mode:1},{name:"regex",mode:2}]},columnsForChose:[]}},checkTableDataList:[],table:{dbMhaTableLoading:!1,dbMhaTableColumn:[{title:"DB名",key:"dbName"},{title:"源集群",key:"srcMhaName",render:function(e,t){var a=t.row,r=a.srcMha;if(null!=r)return e("div",[e("span",r.name),e("span",{style:{float:"right",color:"#ababab"}},r.regionName+"("+r.dcName+")")])}},{title:"目标集群",key:"dstMhaName",render:function(e,t){var a=t.row,r=a.dstMha;if(null!=r)return e("div",[e("span",r.name),e("span",{style:{float:"right",color:"#ababab"}},r.regionName+"("+r.dcName+")")])}}],dbMhaTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]},dbTableLoading:!1,dbTableColumn:[{title:"序号",width:75,align:"center",fixed:"left",render:function(e,t){return e("span",t.index+1)}},{title:"库名",key:"schema",resizable:!0},{title:"表名",key:"table",resizable:!0},{title:"结果",align:"center",render:function(e,t){var a=t.row,r="ok"!==a.res?"volcano":"green",n=a.res;return e("Tag",{props:{color:r}},n)}}],dbTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}},alertInfo:{show:!1,successShow:!1,title:null,message:null},buttonTextMap:new Map([["create","新增表同步"],["edit","更新表同步"],["delete","删除表同步"]]),buttonTypeMap:new Map([["create","success"],["edit","primary"],["delete","error"]]),dataLoading:!1,successSubmit:!1,commonColumnLoading:!1}},methods:{getParams:function(){var e={};return e.buName=this.formItem.buName,e.tag=this.formItem.tag,e.mode=this.formItem.buildMode,e.srcRegionName=this.srcRegion,e.dstRegionName=this.dstRegion,this.gtidConfigurable&&(e.gtidInit=this.formItem.gtidInit),e.tblsFilterDetail={tableNames:this.formItem.tableName},e.dbName=this.formItem.dbName,e},getEditParams:function(){var e={};return e.dbReplicationIds=this.meta.dbReplicationIds,e.dbNames=this.dbNames,e.srcRegionName=this.srcRegion,e.dstRegionName=this.dstRegion,e.logicTableConfig={logicTable:this.formItem.tableName,rowsFilterId:this.formItem.switch.rowsFilter?this.meta.rowsFilterId:null,colsFilterId:this.formItem.switch.colsFilter?this.meta.colsFilterId:null},e.originLogicTableConfig=this.meta.originLogicTableConfig,this.formItem.switch.rowsFilter&&(this.useTripUdlOrUidMode&&(this.fillContextByRegion?this.formItem.rowsFilterCreateParam.context=this.formItem.rowsFilter.configInTripUid.regionsChosen.join(","):this.formItem.rowsFilterCreateParam.context="//filter by config"),e.openRowsFilterConfig=!0,e.rowsFilterCreateParam=this.formItem.rowsFilterCreateParam),this.formItem.switch.colsFilter&&(e.openColsFilterConfig=!0,e.columnsFilterCreateParam=this.formItem.columnsFilterCreateParam),console.log(e),e},getRowsFilterConfig:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios.get("/api/drc/v2/autoconfig/getRowsFilterView?rowsFilterId="+e.meta.rowsFilterId).then((function(t){if(1===t.data.status)e.$Message.error("查询行过滤配置失败!");else{var a=t.data.data;null==a||(e.formItem.switch.rowsFilter=!0,e.formItem.rowsFilterCreateParam.context=a.context,e.formItem.rowsFilterCreateParam.mode=a.mode,e.useTripUdlOrUidMode?e.formItem.rowsFilter.configInTripUid.regionsChosen=a.context.split(","):e.formItem.rowsFilter.configInTripUid={regionsChosen:[]},e.formItem.rowsFilterCreateParam.columns=null===a.columns?[]:a.columns,null!==a.udlColumns&&(e.formItem.rowsFilterCreateParam.udlColumns=a.udlColumns),e.formItem.rowsFilterCreateParam.drcStrategyId=0===a.drcStrategyId?null:a.drcStrategyId,e.formItem.rowsFilterCreateParam.routeStrategyId=a.routeStrategyId,e.formItem.rowsFilterCreateParam.illegalArgument=a.illegalArgument,e.formItem.rowsFilterCreateParam.fetchMode=a.fetchMode)}}));case 2:case"end":return t.stop()}}),t)})))()},getColsFilterConfig:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios.get("/api/drc/v2/autoconfig/getColsFilterView?colsFilterId="+e.meta.colsFilterId).then((function(t){if(1===t.data.status)e.$Message.error("查询字段过滤配置失败!");else{var a=t.data.data;null==a||(e.formItem.switch.colsFilter=!0,e.formItem.columnsFilterCreateParam.mode=a.mode,e.formItem.columnsFilterCreateParam.columns=a.columns)}}));case 2:case"end":return t.stop()}}),t)})))()},getCommonColumns:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.getParams(),e.formItem.constants.columnsForChose=[],e.commonColumnLoading=!0,t.next=5,e.axios.get("/api/drc/v2/autoconfig/commonColumns",{params:e.flattenObj(a)}).then((function(t){1===t.data.status?e.$Message.error("查询公共列名失败，请手动添加："+t.data.message):(e.formItem.constants.columnsForChose=t.data.data,e.$Message.info("查询公共列名数："+t.data.data.length))})).catch((function(t){e.$Message.error("查询公共列名异常: "+t)})).finally((function(){e.commonColumnLoading=!1}));case 5:case"end":return t.stop()}}),t)})))()},handleCreateColumn:function(e){this.contains(this.formItem.constants.columnsForChose,e)?alert("已有项禁止创建"):""!==e&&void 0!==e&&null!==e?this.formItem.constants.columnsForChose.push(e):alert("字段不能为空")},afterEnterTableName:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getTableInfo();case 2:case"end":return t.stop()}}),t)})))()},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var r=this.flattenObj(e[a]);for(var n in r)t[a+"."+n]=r[n]}return t},refresh:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.formItem.dbName=e.dbNames.join(","),!e.configData){t.next=25;break}if(console.log("edit panel"),e.formItem.tableName=e.configData.config.logicTable,e.meta.rowsFilterId=e.configData.config.rowsFilterId,e.meta.colsFilterId=e.configData.config.colsFilterId,e.getCommonColumns(),!e.meta.rowsFilterId){t.next=12;break}return t.next=10,e.getRowsFilterConfig(e.meta.rowsFilterId);case 10:t.next=14;break;case 12:e.formItem.switch.rowsFilter=!1,e.formItem.rowsFilterCreateParam=e.rowsFilterCreateParamInit();case 14:if(!e.meta.colsFilterId){t.next=19;break}return t.next=17,e.getColsFilterConfig(e.meta.colsFilterId);case 17:t.next=21;break;case 19:e.formItem.switch.colsFilter=!1,e.formItem.columnsFilterCreateParam=e.columnsFilterCreateParamInit();case 21:e.meta.dbReplicationIds=e.configData.dbReplicationIds,e.meta.originLogicTableConfig=e.configData.config,t.next=26;break;case 25:console.log("insert new config");case 26:case"end":return t.stop()}}),t)})))()},submitAll:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,a.dataLoading=!0,a.alertInfo.show=!1,a.alertInfo.successShow=!1,a.successSubmit=!1,r=e.getEditParams(),t.next=8,a.axios.post("/api/drc/v2/autoconfig/dbReplication/"+e.formAction,r).then((function(e){var t=e.data,r=0===t.status;r?(a.$Message.success("提交成功"),a.successSubmit=!0,a.alertInfo.successShow=!0,a.alertInfo.message=null,a.alertInfo.title="提交成功",a.$emit("finished")):(a.$Message.warning("提交失败: "+t.message),a.alertInfo.show=!0,a.alertInfo.title="提交失败",a.alertInfo.message=t.message)})).catch((function(e){a.$Message.error("提交异常: "+e)})).finally((function(){a.dataLoading=!1}));case 8:case"end":return t.stop()}}),t)})))()},rowsFilterCreateParamInit:function(){return{mode:1,drcStrategyId:2000000002,routeStrategyId:0,udlColumns:[],columns:[],context:"",illegalArgument:!1,fetchMode:0}},columnsFilterCreateParamInit:function(){return{mode:null,columns:[]}}},computed:{preCheckTablePage:function(){var e=this.checkTableDataList,t=this.table.dbTablePage.current*this.table.dbTablePage.size-this.table.dbTablePage.size,a=t+this.table.dbTablePage.size;return Object(u["a"])(e).slice(t,a)},useTripUdlOrUidMode:function(){return[this.formItem.constants.rowsFilter.filterMode.TRIP_UDL,this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID].includes(this.formItem.rowsFilterCreateParam.mode)},hasUdlColumn:function(){return 0!==this.formItem.rowsFilterCreateParam.udlColumns.length},fillContextByRegion:function(){return this.formItem.rowsFilterCreateParam.fetchMode===this.formItem.constants.rowsFilter.fetchMode.RPC},hasUidColumn:function(){return 0!==this.formItem.rowsFilterCreateParam.columns.length},showUdlConfigDetail:function(){return this.formItem.rowsFilterCreateParam.mode===this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID||this.hasUdlLegalConfig||!this.hasUidLegalConfig},showUidConfigDetail:function(){return this.formItem.rowsFilterCreateParam.mode===this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID||this.hasUidLegalConfig||!this.hasUdlLegalConfig},hasUdlLegalConfig:function(){return 0!==this.formItem.rowsFilterCreateParam.udlColumns.length&&null!=this.formItem.rowsFilterCreateParam.drcStrategyId&&this.formItem.rowsFilterCreateParam.drcStrategyId>0},hasUidLegalConfig:function(){return this.hasUidColumn}},created:function(){this.refresh()}},R=I,x=Object(b["a"])(R,c,m,!1,null,"1e6eeea7",null),C=x.exports,y={name:"tables",components:{DbReplicationConfig:C},props:{dbName:String,dbNames:Array,srcRegion:String,dstRegion:String,tableData:Array,dataLoading:Boolean},emits:["updated"],data:function(){return{selectedRow:{},action:null,actionTitleMap:new Map([["create","新增 表同步"],["edit","更新 表同步"],["delete","⚠️删除 表同步"]]),editModal:{open:!1},columns:[{title:"表名",key:"config",minWidth:300,render:function(e,t){var a=t.row;return e("div",a.config.logicTable)}},{title:"过滤规则",key:"filterTypes",minWidth:100,render:function(e,t){var a=t.row,r=a.config.rowsFilterId,n=a.config.colsFilterId;return r||n?e("div",[r&&e("Tag",{props:{color:"blue"}},"行过滤"),n&&e("Tag",{props:{color:"green"}},"字段过滤")]):e("Tag",{props:{color:"red"}},"无")}},{title:"操作",minWidth:100,slot:"action",align:"center",fixed:"right"}]}},methods:{goToInsertConfig:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.selectedRow=null,e.action=C.FORM_ACTION_OPTION.CREATE,e.editModal.open=!0;case 3:case"end":return t.stop()}}),t)})))()},goToUpdateConfig:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a.selectedRow=e,a.action=C.FORM_ACTION_OPTION.EDIT,a.editModal.open=!0;case 3:case"end":return t.stop()}}),t)})))()},goToDeleteConfig:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a.selectedRow=e,a.action=C.FORM_ACTION_OPTION.DELETE,a.editModal.open=!0;case 3:case"end":return t.stop()}}),t)})))()},finishConfig:function(){this.selectedRow=null,this.editModal.open=!1,this.$emit("updated")}},computed:{actionTitle:function(){return this.actionTitleMap.get(this.action)}},created:function(){}},F=y,N=Object(b["a"])(F,s,l,!1,null,"6250ec54",null),k=N.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Collapse",{model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.mhaReplications,(function(t,r){return a("Panel",{key:t.srcMha.name+"->"+t.dstMha.name,attrs:{name:String(r)},scopedSlots:e._u([{key:"content",fn:function(){return[a("Button",{staticStyle:{"margin-bottom":"10px"},attrs:{icon:"ios-open-outline"},on:{click:function(t){return e.openModal(r)}}},[e._v(" 打开详情")]),a("mha-db-replication-panel",{attrs:{"mha-db-replications":t.mhaDbReplications}}),a("Modal",{attrs:{width:"1500px","footer-hide":!0},model:{value:e.openDetailModal[r],callback:function(t){e.$set(e.openDetailModal,r,t)},expression:"openDetailModal[index]"}},[e.openDetailModal[r]?a("drc-build-v2",{ref:"dbReplicationConfigComponent",refInFor:!0,attrs:{"src-mha-name":t.srcMha.name,"src-dc":t.srcMha.dcName,"dst-mha-name":t.dstMha.name,"dst-dc":t.dstMha.dcName}}):e._e()],1)]},proxy:!0}],null,!0)},[e._v(" "+e._s(t.srcMha.name+" -> "+t.dstMha.name)+" ")])})),1)},M=[],T=(a("cb29"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Table",{attrs:{stripe:"",border:"",columns:e.columns,data:e.mhaDbReplications}})}),D=[],P=(a("4de4"),a("4160"),a("d81d"),a("159b"),a("a3b8")),S=a.n(P),O={name:"mhaDbReplicationPanel",props:{mhaDbReplications:Array},data:function(){var e=this;return{value:["1"],delayDataLoading:!1,columns:[{title:"类型",width:80,render:function(t,a){var r=a.row,n="none",o="error",i=!1;switch(r.transmissionType){case"simplex":n="单",o="info";break;case"duplex":n="双",o="success";break;default:n="无",i=!0;break}return t("Button",{props:{type:o,size:"small",disabled:i},on:{click:function(){e.showModal(r)}}},n)}},{title:"延迟",key:"drcStatus",width:100,align:"center",renderHeader:function(t,a){return t("span",[t("span","延迟"),e.replicationIds&&0!==e.replicationIds.length&&t("Button",{on:{click:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDelay();case 2:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}()},props:{loading:e.delayDataLoading,size:"small",shape:"circle",type:"default",icon:"md-refresh"}})])},render:function(e,t){var a,r,n=t.row;return!0===n.drcStatus?null!=n.delay?(console.log(n.delay),r=S()(n.delay,{compact:!0}),a=n.delay>1e4?"warning":"success"):(r="已接入",a="blue"):(r="未接入",a="default"),e("Tag",{props:{color:a}},r)}},{title:"DB 名",key:"srcDbName",render:function(e,t){return e("p",t.row.src.dbName)}}]}},methods:{showModal:function(e){console.log("show modal"),this.$Message.info("还未上线，敬请期待")},getDelay:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a={replicationIds:e.replicationIds},0!==a.replicationIds.length){t.next=4;break}return console.log("skip delay search"),t.abrupt("return");case 4:e.delayDataLoading=!0,e.axios.get("/api/drc/v2/replication/db/delay",{params:a}).then((function(t){var a=t.data.data,r=null==a||!Array.isArray(a)||0===a.length;if(!r){var n=new Map(a.map((function(e){return[e.srcMha+"->"+e.dstMha+"->"+e.dbName,e.delay]})));e.mhaDbReplications.forEach((function(t){e.$set(t,"delay",n.get(t.src.mhaName+"->"+t.dst.mhaName+"->"+t.src.dbName))})),console.log("replications",e.mhaDbReplications)}})).catch((function(t){console.log(t),e.$Message.error("查询延迟异常: "+t)})).finally((function(){e.delayDataLoading=!1}));case 6:case"end":return t.stop()}}),t)})))()}},computed:{replicationIds:function(){return this.mhaDbReplications.filter((function(e){return!0===e.drcStatus})).map((function(e){return e.id})).join(",")}},created:function(){this.getDelay()}},L=O,$=Object(b["a"])(L,T,D,!1,null,"f9dd2f80",null),j=$.exports,E=a("471e"),U=a("a345"),A={name:"mhaReplicationPanel",components:{DrcBuildV2:E["a"],MhaDbReplicationPanel:j},props:{mhaReplications:Array},data:function(){return{value:["0"],openDetailModal:[]}},methods:{openModal:function(e){this.$set(this.openDetailModal,e,!0)}},created:function(){this.openDetailModal=Array(U["default"].length).fill(!1)}},z=A,B=Object(b["a"])(z,_,M,!1,null,"a380256a",null),q=B.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:{padding:"1px 1px",height:"100%"}},[a("Row",[e.alertInfo.show?a("Alert",{attrs:{type:"warning","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),e.alertInfo.successShow?a("Alert",{attrs:{type:"success","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),a("Col",{attrs:{span:"12"}},[a("Row",{staticStyle:{"margin-right":"20px"}},[a("Divider",[e._v("1. 选择同步方向")]),a("Col",{attrs:{span:"11"}},[a("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"ios-pin"}}),e._v(" 源 region ")]},proxy:!0}])},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.srcRegionName,callback:function(t){e.$set(e.formItem,"srcRegionName",t)},expression:"formItem.srcRegionName"}},e._l(e.meta.regionOptions,(function(t){return a("Option",{key:t,attrs:{value:t,label:t}},[e._v(" "+e._s(t)+" ")])})),1)],1)],1),a("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[a("Button",{attrs:{size:"small",shape:"circle",type:"default",loading:e.dataLoading},on:{click:e.getRegionOptions}},[e._v(" -> ")])],1),a("Col",{attrs:{span:"11"}},[a("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[a("Icon",{attrs:{type:"ios-pin"}}),e._v(" 目标 region ")]},proxy:!0}])},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.dstRegionName,callback:function(t){e.$set(e.formItem,"dstRegionName",t)},expression:"formItem.dstRegionName"}},e._l(e.meta.regionOptions,(function(t){return a("Option",{key:t,attrs:{value:t,label:t}},[e._v(" "+e._s(t)+" ")])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"12"}},[a("Row",[a("Divider",[e._v("2. 预览：同步集群")]),a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.table.dbMhaTableLoading},on:{click:e.getDalInfo}},[e._v(" 检查同步集群 ")]),a("Table",{attrs:{size:"small",loading:e.table.dbMhaTableLoading,stripe:"",columns:e.table.dbMhaTableColumn,data:e.preCheckMhaReplicationPage,border:""}}),a("div",[a("Page",{attrs:{transfer:!0,total:e.previewDataList.length,current:e.table.dbMhaTablePage.current,"page-size-opts":e.table.dbMhaTablePage.pageSizeOpts,"page-size":e.table.dbMhaTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbMhaTablePage,"current",t)},"on-page-size-change":function(t){e.table.dbMhaTablePage.size=t}}})],1)],1)],1)],1),a("Divider"),a("Button",{attrs:{loading:e.dataLoading,type:"primary"},on:{click:e.createReplication}},[e._v("提交")])],1)},G=[],W=(a("c975"),{name:"mhaPreview",components:{},props:{dbName:String,existReplicationRegionOptions:Array},emits:["updated"],data:function(){return{meta:{regionOptions:[],existReplicationRegionOptions:[]},alertInfo:{show:!1,successShow:!1,title:null,message:null},formItem:{srcRegionName:null,dstRegionName:null},dataLoading:!1,constants:{DAL_CLUSTER_MODE:1},previewDataList:[],table:{dbMhaTableLoading:!1,dbMhaTableColumn:[{title:"DB名",key:"dbName"},{title:"源集群",key:"srcMhaName",render:function(e,t){var a=t.row,r=a.srcMha;if(null!=r)return e("div",[e("span",r.name),e("span",{style:{float:"right",color:"#ababab"}},r.regionName+"("+r.dcName+")")])}},{title:"目标集群",key:"dstMhaName",render:function(e,t){var a=t.row,r=a.dstMha;if(null!=r)return e("div",[e("span",r.name),e("span",{style:{float:"right",color:"#ababab"}},r.regionName+"("+r.dcName+")")])}}],dbMhaTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}}}},methods:{getRegionOptions:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dataLoading=!0,e.meta.regionOptions=[],t.next=4,e.axios.get("/api/drc/v2/autoconfig/regionOptions",{params:{mode:e.constants.DAL_CLUSTER_MODE,dbName:e.dbName}}).then((function(t){var a=t.data.data,r=a&&0===t.data.status;r?(e.meta.regionOptions=a,-1===a.indexOf(e.formItem.srcRegionName)&&(e.formItem.srcRegionName=null),-1===a.indexOf(e.formItem.dstRegionName)&&(e.formItem.dstRegionName=null)):(e.formItem.srcRegionName=null,e.formItem.dstRegionName=null,e.$Message.warning("查询可选地域失败"))})).catch((function(t){e.$Message.error("查询可选地域失败: "+t)})).finally((function(){e.dataLoading=!1}));case 4:case"end":return t.stop()}}),t)})))()},getDalInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.previewDataList=[],e.table.dbMhaTablePage.current=1,e.table.dbMhaTableLoading=!0,t.next=5,e.axios.get("/api/drc/v2/autoconfig/preCheck",{params:{mode:e.constants.DAL_CLUSTER_MODE,dbName:e.dbName,srcRegionName:e.formItem.srcRegionName,dstRegionName:e.formItem.dstRegionName}}).then((function(t){var a=t.data.data,r=a&&0===t.data.status;r?(e.previewDataList=a,console.log("total: "+e.previewDataList.length),e.$Message.success("同步集群检测成功, 共找到 "+a.length+" 个DB")):e.$Message.warning("同步集群检测失败："+t.data.message)})).catch((function(t){e.$Message.error("查询dalcluster异常: "+t)})).finally((function(){e.table.dbMhaTableLoading=!1}));case 5:case"end":return t.stop()}}),t)})))()},createReplication:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={srcRegionName:e.formItem.srcRegionName,dstRegionName:e.formItem.dstRegionName,dbName:e.dbName},e.alertInfo.show=!1,e.alertInfo.successShow=!1,e.dataLoading=!0,t.next=6,e.axios.post("/api/drc/v2/autoconfig/mhaDbReplication/create",a).then((function(t){var a=t.data,r=0===a.status;r?(e.alertInfo.successShow=!0,e.alertInfo.message=null,e.alertInfo.title="提交成功",e.$emit("updated")):(e.alertInfo.show=!0,e.alertInfo.title="提交失败",e.alertInfo.message=a.message,e.$Message.warning("提交失败: "+a.message))})).catch((function(t){e.$Message.error("提交异常: "+t)})).finally((function(){e.dataLoading=!1}));case 6:case"end":return t.stop()}}),t)})))()},afterSwitchRegion:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},computed:{preCheckMhaReplicationPage:function(){var e=this.previewDataList,t=this.table.dbMhaTablePage.current*this.table.dbMhaTablePage.size-this.table.dbMhaTablePage.size,a=t+this.table.dbMhaTablePage.size;return Object(u["a"])(e).slice(t,a)}},created:function(){this.getRegionOptions()}}),J=W,H=Object(b["a"])(J,V,G,!1,null,"3043c002",null),X=H.exports,K={components:{MhaPreview:X,MhaReplicationPanel:q,tables:k},data:function(){return{createModal:{open:!1},dataLoading:!1,configDataLoading:!1,selectedExistReplication:this.$route.query.srcRegionName+" -> "+this.$route.query.dstRegionName,formItem:{srcRegionName:null,dstRegionName:null},drcConfig:{},meta:{dbName:this.$route.query.dbName,srcRegionName:this.$route.query.srcRegionName,dstRegionName:this.$route.query.dstRegionName,fixDb:this.$route.query.fixDb,regionOptions:[],dbOptions:[],existReplicationRegionOptions:[]}}},methods:{getParams:function(){var e={};return e.dbName=this.meta.dbName,e.srcRegionName=this.meta.srcRegionName,e.dstRegionName=this.meta.dstRegionName,e},getExistDb:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!(null===e||null===e.length||e.length<=0)){a.next=2;break}return a.abrupt("return",[]);case 2:return r=t,r.dataLoading=!0,a.next=6,r.axios.get("/api/drc/v2/autoconfig/getExistDb",{params:{dbName:e}}).then((function(e){var t=e.data.data;t?r.meta.dbOptions=t:r.$Message.warning("查询DB失败")})).catch((function(e){r.$Message.error("查询DB异常: "+e)})).finally((function(){r.dataLoading=!1}));case 6:case"end":return a.stop()}}),a)})))()},selectDb:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getExistReplicationRegionOptions();case 2:return t.next=4,e.getDrcConfig();case 4:case"end":return t.stop()}}),t)})))()},getDrcConfig:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.createModal.open=!1,e.resetPath(),a=e.getParams(),e.drcConfig={},a.dbName){t.next=7;break}return e.$Message.warning("请先填写数据库"),t.abrupt("return");case 7:if(a.srcRegionName&&a.dstRegionName){t.next=9;break}return t.abrupt("return");case 9:if(a.srcRegionName!==a.dstRegionName){t.next=11;break}return t.abrupt("return");case 11:return e.configDataLoading=!0,t.next=14,e.axios.get("/api/drc/v2/autoconfig/getDbDrcConfig",{params:{dbName:a.dbName,srcRegionName:a.srcRegionName,dstRegionName:a.dstRegionName}}).then((function(t){var a=t.data.data,r=a&&0===t.data.status;r?(e.drcConfig=a,e.$Message.success("查询DRC配置成功 ")):e.$Message.warning("查询失败："+t.data.message)})).catch((function(t){e.$Message.error("查询异常: "+t)})).finally((function(){e.configDataLoading=!1}));case 14:case"end":return t.stop()}}),t)})))()},afterSelectExistReplication:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("afterSelectExistReplication ",e.selectedExistReplication),a=e.selectedExistReplication.split("->"),e.meta.srcRegionName=a[0].trim(),e.meta.dstRegionName=a[1].trim(),e.getDrcConfig();case 5:case"end":return t.stop()}}),t)})))()},getExistReplicationRegionOptions:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,a.dataLoading=!0,a.meta.existReplicationRegionOptions=[],r=e.getParams(),t.next=6,a.axios.get("/api/drc/v2/autoconfig/getExistDbReplicationDirections",{params:{dbName:r.dbName}}).then((function(e){var t=e.data.data,r=t&&0===e.data.status;r?(a.meta.existReplicationRegionOptions=t,a.meta.existReplicationRegionOptions.length>0&&a.$Message.success("查询到 "+a.meta.existReplicationRegionOptions.length+" 个可选同步方向")):(a.meta.srcRegionName=null,a.meta.dstRegionName=null,a.$Message.warning("查询可选地域失败"))})).catch((function(e){a.$Message.error("查询可选地域失败: "+e)})).finally((function(){a.dataLoading=!1}));case 6:case"end":return t.stop()}}),t)})))()},goToCreateReplication:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.createModal.open=!0;case 1:case"end":return t.stop()}}),t)})))()},resetPath:function(){this.$router.replace({query:{dbName:this.meta.dbName,srcRegionName:this.meta.srcRegionName,dstRegionName:this.meta.dstRegionName,fixDb:this.meta.fixDb}}).catch((function(){}))},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var r=this.flattenObj(e[a]);for(var n in r)t[a+"."+n]=r[n]}return t}},computed:{},created:function(){var e=this;this.axios.get("/api/drc/v2/permission/meta/mhaReplication/modify").then((function(t){403!==t.data.status?e.meta.dbName&&(e.getExistReplicationRegionOptions(),e.getDrcConfig()):e.$router.push("/nopermission")}))}},Q=K,Y=(a("21df"),Object(b["a"])(Q,r,n,!1,null,null,null));t["default"]=Y.exports},"81d5":function(e,t,a){"use strict";var r=a("7b0b"),n=a("23cb"),o=a("50c4");e.exports=function(e){var t=r(this),a=o(t.length),i=arguments.length,s=n(i>1?arguments[1]:void 0,a),l=i>2?arguments[2]:void 0,c=void 0===l?a:n(l,a);while(c>s)t[s++]=e;return t}},c8d2:function(e,t,a){var r=a("d039"),n=a("5899"),o="​᠎";e.exports=function(e){return r((function(){return!!n[e]()||o[e]()!=o||n[e].name!==e}))}},cb29:function(e,t,a){var r=a("23e7"),n=a("81d5"),o=a("44d2");r({target:"Array",proto:!0},{fill:n}),o("fill")}}]);
//# sourceMappingURL=chunk-454401fe.e286a8c4.js.map