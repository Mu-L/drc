(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-45452e14"],{a15b:function(t,e,a){"use strict";var i=a("23e7"),n=a("44ad"),s=a("fc6a"),r=a("a640"),o=[].join,c=n!=Object,l=r("join",",");i({target:"Array",proto:!0,forced:c||!l},{join:function(t){return o.call(s(this),void 0===t?",":t)}})},d81d:function(t,e,a){"use strict";var i=a("23e7"),n=a("b727").map,s=a("1dde"),r=a("ae40"),o=s("map"),c=r("map");i({target:"Array",proto:!0,forced:!o||!c},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},fda7:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/v2/messengersV2"}},[t._v("Messenger 同步")]),a("BreadcrumbItem",{attrs:{to:{path:"/v2/buildMessengerV2",query:{step:3,mhaName:t.initInfo.mhaName}}}},[t._v("Messenger 配置 ")]),a("BreadcrumbItem",[t._v("Db messenger")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("Row",[a("Col",{attrs:{span:"4"}},[a("Button",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.batchAutoConfigure()}}},[t._v("批量配置 applier ")])],1),a("Col",{attrs:{span:"2"}},[t.submitted?t._e():a("Button",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{loading:t.dataLoading,type:"primary",ghost:""},on:{click:function(e){return t.submitDbAppliers()}}},[t._v("提交 ")])],1)],1),a("div",{style:{padding:"1px 1px",height:"100%"}},[[a("Table",{ref:"multipleTable",staticStyle:{"margin-top":"20px"},attrs:{stripe:"",columns:t.columns,data:t.tableData,loading:t.dataLoading,border:""},on:{"on-selection-change":t.changeSelection},scopedSlots:t._u([{key:"applier",fn:function(e){var i=e.row,n=e.index;return[a("Select",{staticStyle:{width:"250px"},attrs:{transfer:!0,multiple:"",placeholder:"选择源集群Applier"},model:{value:t.tableData[n].ips,callback:function(e){t.$set(t.tableData[n],"ips",e)},expression:"tableData[index].ips"}},t._l(t.applierResourceList,(function(e){return a("Option",{key:e.ip,attrs:{value:e.ip}},[t._v(t._s(e.ip)+" —— "+t._s(e.az)+" ")])})),1),a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.autoConfigApplier(i,n)}}},[t._v("自动录入")])]}},{key:"gtidInit",fn:function(e){e.row;var i=e.index;return[a("Input",{attrs:{border:!1,placeholder:"请输入binlog拉取位点"},model:{value:t.tableData[i].gtidInit,callback:function(e){t.$set(t.tableData[i],"gtidInit",e)},expression:"tableData[index].gtidInit"}})]}}])})]],2)],1)],1)},n=[],s=a("c7eb"),r=a("1da1"),o=a("53ca"),c=(a("a15b"),a("d81d"),a("d3b7"),a("159b"),a("2b0e")),l={name:"tables",data:function(){return{initInfo:{mhaName:this.$route.query.mhaName},dataLoading:!1,submitted:!1,applierResourceList:[],batchDeleteModal:!1,deleteData:[],filterMap:{0:"行过滤",1:"字段过滤"},columns:[{title:"库名",key:"dbName",width:200},{title:"Applier",slot:"applier"},{title:"gtidInit",slot:"gtidInit"}],propertiesJson:{},tableData:[],total:0,size:5,pageSizeOpts:[5,10,20,100]}},methods:{getFilterText:function(t){},changeSelection:function(t){this.initInfo.multiData=t,console.log(this.initInfo.multiData)},buildApplierDto:function(t){return this.flattenObj([{ips:t.ips,gtidInit:t.gtidInit,dbName:t.dbName}])},flattenObj:function(t){var e={};for(var a in t)if("object"!==Object(o["a"])(t[a])||Array.isArray(t[a]))e[a]=t[a];else{var i=this.flattenObj(t[a]);for(var n in i)e[a+"."+n]=i[n]}return e},autoConfigApplier:function(t,e){var a=this;return Object(r["a"])(Object(s["a"])().mark((function i(){return Object(s["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:a.axios.get("/api/drc/v2/resource/db/auto",{params:{dstMhaName:a.initInfo.mhaName,type:1,selectedIps:t.ips?t.ips.join(","):null}}).then((function(i){t.ips=[],i.data.data.forEach((function(e){return t.ips.push(e.ip)})),c["default"].set(a.tableData,e,t),a.tableData[e]=t}));case 1:case"end":return i.stop()}}),i)})))()},submitDbAppliers:function(){var t=this,e={mhaName:this.initInfo.mhaName,dbApplierDtos:this.tableData};this.dataLoading=!0,this.axios.post("/api/drc/v2/config/db/messenger",e).then((function(e){var a=e.data,i=1!==a.status;i?(t.submitted=!0,t.$Message.success("提交成功")):t.$Message.warning("提交失败: "+a.message)})).catch((function(e){t.$Message.error("提交异常: "+e)})).finally((function(){t.dataLoading=!1}))},batchAutoConfigure:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.tableData.map((function(e,a){return t.autoConfigApplier(e,a)}));case 1:case"end":return e.stop()}}),e)})))()},getResources:function(){var t=this;this.axios.get("/api/drc/v2/resource/mha/all?mhaName="+this.initInfo.mhaName+"&type=1").then((function(e){console.log(e.data),t.applierResourceList=e.data.data}))},getDbAppliers:function(){var t=this;this.dataLoading=!0,this.axios.get("/api/drc/v2/config/mha/dbMessenger",{params:{mhaName:this.initInfo.mhaName}}).then((function(e){1===e.data.status?t.$Message.error("查询 db applier 失败!"):t.tableData=e.data.data})).finally((function(){t.dataLoading=!1}))},clearDeleteDbReplication:function(t,e){this.deleteData=[],this.batchDeleteModal=!1},deleteDbReplication:function(){var t=this,e=[];this.deleteData.forEach((function(t){return e.push(t.dbReplicationId)})),this.axios.delete("/api/drc/v2/config/dbReplications?dbReplicationIds="+e).then((function(e){1===e.data.status?t.$Message.error("删除失败!"+e.data.message):(t.$Message.success("删除成功!"),t.getDbAppliers(),t.initInfo.multiData=[])}))}},created:function(){var t=this;this.axios.get("/api/drc/v2/permission/meta/mhaReplication/modify").then((function(e){403!==e.data.status?(t.initInfo={mhaName:t.$route.query.mhaName},console.log("initInfo:"),console.log(t.initInfo),t.getResources(),t.getDbAppliers()):t.$router.push("/nopermission")}))}},p=l,u=a("2877"),d=Object(u["a"])(p,i,n,!1,null,"24e2971e",null);e["default"]=d.exports}}]);
//# sourceMappingURL=chunk-45452e14.4fa9be0e.js.map