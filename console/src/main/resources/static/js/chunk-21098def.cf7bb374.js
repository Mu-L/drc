(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21098def"],{"25f0":function(e,t,n){"use strict";var a=n("6eeb"),r=n("825a"),o=n("d039"),s=n("ad6d"),i="toString",c=RegExp.prototype,l=c[i],u=o((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),d=l.name!=i;(u||d)&&a(RegExp.prototype,i,(function(){var e=r(this),t=String(e.source),n=e.flags,a=String(void 0===n&&e instanceof RegExp&&!("flags"in c)?s.call(e):n);return"/"+t+"/"+a}),{unsafe:!0})},2909:function(e,t,n){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}n.d(t,"a",(function(){return s}));n("a4d3"),n("e01a"),n("d28b"),n("a630"),n("e260"),n("d3b7"),n("25f0"),n("3ca3"),n("ddb0");function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function s(e){return a(e)||r(e)||o()}},"3b13":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-component",[n("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[n("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),n("BreadcrumbItem",[e._v("Messenger 集群")])],1),n("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[n("div",{staticStyle:{padding:"1px 1px"}},[n("Row",{attrs:{gutter:10,align:"middle"}},[n("Col",{attrs:{span:"2"}},[n("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("DB 相关")]},proxy:!0}])},[n("Input",{attrs:{prefix:"ios-search",placeholder:"DB 名↵"},on:{"on-enter":function(t){return e.getAllMessengerVos()}},model:{value:e.dbNames,callback:function(t){e.dbNames=t},expression:"dbNames"}})],1)],1),n("Col",{attrs:{span:"2"}},[n("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" topic ")]},proxy:!0}])},[n("Input",{attrs:{prefix:"ios-search",placeholder:"topic"},on:{"on-enter":function(t){return e.getAllMessengerVos()}},model:{value:e.topic,callback:function(t){e.topic=t},expression:"topic"}})],1)],1),n("Col",{attrs:{span:"14"}},[n("Row",{attrs:{gutter:10,align:"middle"}},[n("Col",{attrs:{span:"24"}},[n("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("相关 MHA")]},proxy:!0}])},[n("Row",{attrs:{gutter:10}},[n("Col",{attrs:{span:"14"}},[n("Input",{attrs:{prefix:"ios-search",placeholder:"集群名↵"},on:{"on-enter":function(t){return e.getAllMessengerVos()}},model:{value:e.mha.name,callback:function(t){e.$set(e.mha,"name",t)},expression:"mha.name"}})],1),n("Col",{attrs:{span:"5"}},[n("Select",{attrs:{filterable:"",prefix:"ios-home",clearable:"",placeholder:"部门"},on:{"on-change":function(t){return e.getAllMessengerVos()}},model:{value:e.mha.buId,callback:function(t){e.$set(e.mha,"buId",t)},expression:"mha.buId"}},e._l(e.bus,(function(t){return n("Option",{key:t.buName,attrs:{value:t.id}},[e._v(e._s(t.buName))])})),1)],1),n("Col",{attrs:{span:"5"}},[n("Select",{attrs:{filterable:"",prefix:"ios-pin",clearable:"",placeholder:"地域"},on:{"on-change":function(t){return e.getAllMessengerVos()}},model:{value:e.mha.regionId,callback:function(t){e.$set(e.mha,"regionId",t)},expression:"mha.regionId"}},e._l(e.regions,(function(t){return n("Option",{key:t.regionName,attrs:{value:t.id}},[e._v(e._s(t.regionName)+" ")])})),1)],1)],1)],1)],1)],1)],1),n("Col",{attrs:{span:"4"}},[n("Row",{attrs:{gutter:10,align:"middle"}},[n("Button",{attrs:{type:"primary",icon:"ios-search",loading:e.dataLoading},on:{click:function(t){return e.getAllMessengerVos()}}},[e._v("查询")])],1),n("Row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:10,align:"middle"}},[n("Button",{attrs:{icon:"md-refresh",loading:e.dataLoading},on:{click:e.resetParam}},[e._v("重置")])],1)],1)],1),n("br"),n("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[n("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[n("Dropdown",{attrs:{placement:"bottom-start"},scopedSlots:e._u([{key:"list",fn:function(){return[n("DropdownMenu",[n("DropdownItem",{nativeOn:{click:function(t){return function(){e.$router.push({path:"/v2/buildMessengerV2"})}.apply(null,arguments)}}},[e._v("新建Messenger配置")]),n("DropdownItem",{nativeOn:{click:function(t){return function(){e.$router.push({path:"/v2/dbMqBuildV2"})}.apply(null,arguments)}}},[e._v("新建Messenger配置（DB维度）")])],1)]},proxy:!0}])},[n("Button",{attrs:{type:"default",icon:"ios-hammer"}},[e._v(" 新建配置 "),n("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1)],1)],1),n("Table",{attrs:{loading:e.dataLoading,stripe:"",columns:e.columns,data:e.dataWithPage,border:""},scopedSlots:e._u([{key:"action",fn:function(t){var a=t.row,r=t.index;return[n("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(t){return e.checkConfig(a,r)}}},[e._v("查看 ")]),n("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goToLink(a,r)}}},[e._v("修改")]),n("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(t){return e.previewRemoveConfig(a,r)}}},[e._v(" 删除 ")])]}}])}),n("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[n("Page",{attrs:{transfer:!0,total:e.total,current:e.current,"page-size":e.size,"page-size-opts":[1e3],"show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-page-size-change":e.handleChangeSize}})],1)],1),n("Drawer",{attrs:{title:"DRC配置",width:"80",closable:!0},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" 查看详情 "),n("div",{staticStyle:{float:"right","margin-right":"100px"}},[e._v(" 自动换行 "),n("i-switch",{model:{value:e.cluster.drawer.lineWrap,callback:function(t){e.$set(e.cluster.drawer,"lineWrap",t)},expression:"cluster.drawer.lineWrap"}}),e._v(" 黑夜模式 "),n("i-switch",{model:{value:e.cluster.drawer.darkMode,callback:function(t){e.$set(e.cluster.drawer,"darkMode",t)},expression:"cluster.drawer.darkMode"}})],1)]},proxy:!0}]),model:{value:e.cluster.drawer.show,callback:function(t){e.$set(e.cluster.drawer,"show",t)},expression:"cluster.drawer.show"}},[n("div",{attrs:{id:"xmlCode"}},[n("codemirror",{staticClass:"code",attrs:{options:{mode:"xml",theme:e.cluster.drawer.darkMode?"monokai":"default",autofocus:!0,lineWrapping:e.cluster.drawer.lineWrap,readOnly:!0,lineNumbers:!0,foldGutter:!0,styleActiveLine:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}},model:{value:e.cluster.drawer.data,callback:function(t){e.$set(e.cluster.drawer,"data",t)},expression:"cluster.drawer.data"}})],1)]),n("Modal",{attrs:{title:"删除DRC配置",width:"1200px"},on:{"on-ok":e.removeConfig,"on-cancel":e.clearRemoveConfig},model:{value:e.cluster.modal.remove,callback:function(t){e.$set(e.cluster.modal,"remove",t)},expression:"cluster.modal.remove"}},[n("Form",{staticStyle:{width:"100%"}},[n("FormItem",{attrs:{label:"确认删除改Messenger吗？"}},[n("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.cluster.config,callback:function(t){e.$set(e.cluster,"config",t)},expression:"cluster.config"}})],1)],1)],1)],1)],1)},r=[],o=(n("fb6a"),n("d3b7"),n("53ca")),s=n("2909"),i=(n("7a7a"),n("d5e0"),n("697e"),n("cbc8"),{name:"messengers",data:function(){var e=this;return{cluster:{modal:{remove:!1,show:!1,data:""},drawer:{lineWrap:!1,darkMode:!0,show:!1,data:""},mhaToBeRemoved:""},dbNames:null,topic:null,mha:{name:this.$route.query.mhaName,buId:null,regionId:null},total:0,current:1,size:1e3,tableData:[],bus:[],regions:[],switchOneInfo:{},columns:[{title:"序号",width:75,align:"center",render:function(t,n){return t("span",n.index+1+(e.current-1)*e.size)}},{title:"集群名",key:"mhaName"},{title:"部门",key:"bu",width:100,render:function(e,t){var n=t.row,a="blue",r=n.bu;return e("Tag",{props:{color:a}},r)}},{title:"监控",key:"monitorSwitch",width:100,align:"center",render:function(t,n){var a=n.row;return t("i-switch",{props:{size:"large",value:1===a.monitorSwitch,beforeChange:e.handleBeforeChange},scopedSlots:{open:function(){return t("span","开启")},close:function(){return t("span","关闭")}},on:{"on-change":function(){e.switchMonitor(a)}},nativeOn:{mousedown:function(){e.switchOneInfo={monitorSwitch:a.monitorSwitch}}}})}},{title:"操作",slot:"action",align:"center"}],dataLoading:!1}},computed:{dataWithPage:function(){var e=this.tableData,t=this.current*this.size-this.size,n=t+this.size;return Object(s["a"])(e).slice(t,n)}},methods:{getBus:function(){var e=this;this.axios.get("/api/drc/v2/meta/bus/all").then((function(t){e.bus=t.data.data}))},getRegions:function(){var e=this;this.axios.get("/api/drc/v2/meta/regions/all").then((function(t){e.regions=t.data.data}))},flattenObj:function(e){var t={};for(var n in e)if("object"!==Object(o["a"])(e[n])||Array.isArray(e[n]))t[n]=e[n];else{var a=this.flattenObj(e[n]);for(var r in a)t[n+"."+r]=a[r]}return t},resetParam:function(){this.mha={name:null,buId:null,regionId:null},this.dbNames=null,this.getAllMessengerVos()},getParams:function(){var e={mha:this.mha,dbNames:this.dbNames,topic:this.topic};return this.flattenObj(e)},getAllMessengerVos:function(){var e=this;this.dataLoading=!0;var t=this.getParams();this.axios.get("/api/drc/v2/messenger/query",{params:t}).then((function(t){1!==t.data.status?(e.tableData=t.data.data,e.total=e.tableData.length,e.$Message.success("查询成功")):e.$Message.error("查询失败："+t.message)})).catch((function(t){e.$Message.error("查询异常: "+t)})).finally((function(){e.dataLoading=!1}))},handleChangeSize:function(e){this.size=e},goToLink:function(e,t){console.log("go to change messenger config for "+e.mhaName),this.$router.push({path:"/v2/buildMessengerV2",query:{step:"3",mhaName:e.mhaName}})},checkConfig:function(e,t){var n=this;console.log(e.mhaName),this.dataLoading=!0,this.axios.get("/api/drc/v2/meta/queryConfig/mhaMessenger",{params:{mhaName:e.mhaName}}).then((function(e){1!==e.data.status?(n.cluster.drawer.data=e.data.data,n.cluster.drawer.show=!0,n.$Message.success("查询成功")):n.$Message.error("查询失败："+e.message)})).catch((function(e){n.$Message.error("查询异常: "+e)})).finally((function(){n.dataLoading=!1}))},previewRemoveConfig:function(e,t){var n=this;this.cluster.mhaToBeRemoved=e.mhaName,console.log(e.mhaName),this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.get("/api/drc/v2/meta/queryConfig/mhaMessenger",{params:{mhaName:e.mhaName}}).then((function(e){var t=e.data.data;console.log(t),n.cluster.config=t,n.$Spin.hide(),n.cluster.modal.remove=!0}))},removeConfig:function(){var e=this;console.log("mhaToBeRemoved",this.cluster.mhaToBeRemoved),this.$Spin.show({render:function(e){return e("div",[e("Icon",{class:"demo-spin-icon-load",props:{size:18}}),e("div","请稍等...")])}}),this.axios.delete("/api/drc/v2/messenger/deleteMha/?mhaName="+this.cluster.mhaToBeRemoved).then((function(t){0===t.data.status?location.reload():alert("删除失败: "+t.data.message),e.$Spin.hide()})),this.clearRemoveConfig()},clearRemoveConfig:function(){this.cluster.mhaToBeRemoved=""},handleBeforeChange:function(){var e=this;return console.log("handleBeforeChange:",this.switchOneInfo),new Promise((function(t){e.$Modal.confirm({title:"切换确认",content:"您确认要切换开关状态吗？",onOk:function(){t()}})}))},switchMonitor:function(e){var t=0===e.monitorSwitch?"on":"off";this.switchMonitors(e.mhaName,t)},switchMonitors:function(e,t){var n=this;console.log(e),this.axios.post("/api/drc/v2/monitor/switch/"+e+"/"+t).then((function(e){0===e.data.status?(console.log(t),"on"===t?n.$Message.success("监控开启成功"):n.$Message.success("监控关闭成功")):n.$Message.warning("监控操作失败"),n.getAllMessengerVos()}))}},created:function(){var e=this;this.axios.get("/api/drc/v2/permission/meta/mqReplication/query").then((function(t){403!==t.data.status?(e.getRegions(),e.getBus(),e.getAllMessengerVos()):e.$router.push("/nopermission")}))}}),c=i,l=(n("affc"),n("2877")),u=Object(l["a"])(c,a,r,!1,null,"b5c44fe2",null);t["default"]=u.exports},"4df4":function(e,t,n){"use strict";var a=n("0366"),r=n("7b0b"),o=n("9bdd"),s=n("e95a"),i=n("50c4"),c=n("8418"),l=n("35a1");e.exports=function(e){var t,n,u,d,f,m,h=r(e),p="function"==typeof this?this:Array,g=arguments.length,v=g>1?arguments[1]:void 0,b=void 0!==v,w=l(h),y=0;if(b&&(v=a(v,g>2?arguments[2]:void 0,2)),void 0==w||p==Array&&s(w))for(t=i(h.length),n=new p(t);t>y;y++)m=b?v(h[y],y):h[y],c(n,y,m);else for(d=w.call(h),f=d.next,n=new p;!(u=f.call(d)).done;y++)m=b?o(d,v,[u.value,y],!0):u.value,c(n,y,m);return n.length=y,n}},8418:function(e,t,n){"use strict";var a=n("c04e"),r=n("9bf2"),o=n("5c6c");e.exports=function(e,t,n){var s=a(t);s in e?r.f(e,s,o(0,n)):e[s]=n}},"94de":function(e,t,n){},a630:function(e,t,n){var a=n("23e7"),r=n("4df4"),o=n("1c7e"),s=!o((function(e){Array.from(e)}));a({target:"Array",stat:!0,forced:s},{from:r})},affc:function(e,t,n){"use strict";n("94de")},fb6a:function(e,t,n){"use strict";var a=n("23e7"),r=n("861d"),o=n("e8b5"),s=n("23cb"),i=n("50c4"),c=n("fc6a"),l=n("8418"),u=n("b622"),d=n("1dde"),f=n("ae40"),m=d("slice"),h=f("slice",{ACCESSORS:!0,0:0,1:2}),p=u("species"),g=[].slice,v=Math.max;a({target:"Array",proto:!0,forced:!m||!h},{slice:function(e,t){var n,a,u,d=c(this),f=i(d.length),m=s(e,f),h=s(void 0===t?f:t,f);if(o(d)&&(n=d.constructor,"function"!=typeof n||n!==Array&&!o(n.prototype)?r(n)&&(n=n[p],null===n&&(n=void 0)):n=void 0,n===Array||void 0===n))return g.call(d,m,h);for(a=new(void 0===n?Array:n)(v(h-m,0)),u=0;m<h;m++,u++)m in d&&l(a,u,d[m]);return a.length=u,a}})}}]);
//# sourceMappingURL=chunk-21098def.cf7bb374.js.map