(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fa5695a"],{"53ca":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("a4d3"),a("e01a"),a("d28b"),a("e260"),a("d3b7"),a("3ca3"),a("ddb0");function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}},f6df:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),a("BreadcrumbItem",[e._v("DRC审批")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("div",{staticStyle:{padding:"1px 1px"}},[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"20"}},[a("Card",{attrs:{padding:5},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("查询条件")]},proxy:!0}])},[a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"3"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"源region"},model:{value:e.queryParam.srcRegion,callback:function(t){e.$set(e.queryParam,"srcRegion",t)},expression:"queryParam.srcRegion"}},e._l(e.regions,(function(t){return a("Option",{key:t.regionName,attrs:{value:t.regionName}},[e._v(" "+e._s(t.regionName)+" ")])})),1)],1),a("Col",{attrs:{span:"3"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"目标region"},model:{value:e.queryParam.dstRegion,callback:function(t){e.$set(e.queryParam,"dstRegion",t)},expression:"queryParam.dstRegion"}},e._l(e.regions,(function(t){return a("Option",{key:t.regionName,attrs:{value:t.regionName}},[e._v(" "+e._s(t.regionName)+" ")])})),1)],1),a("Col",{attrs:{span:"6"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"库名"},on:{"on-enter":e.getData},model:{value:e.queryParam.dbName,callback:function(t){e.$set(e.queryParam,"dbName",t)},expression:"queryParam.dbName"}})],1),a("Col",{attrs:{span:"6"}},[a("Input",{attrs:{prefix:"ios-search",placeholder:"表名"},on:{"on-enter":e.getData},model:{value:e.queryParam.tableName,callback:function(t){e.$set(e.queryParam,"tableName",t)},expression:"queryParam.tableName"}})],1),a("Col",{attrs:{span:"3"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"过滤类型"},on:{"on-change":e.getData},model:{value:e.queryParam.filterType,callback:function(t){e.$set(e.queryParam,"filterType",t)},expression:"queryParam.filterType"}},e._l(e.filterTypeOpts,(function(t){return a("Option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.val))])})),1)],1),a("Col",{attrs:{span:"3"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"审批结果"},on:{"on-change":e.getData},model:{value:e.queryParam.approvalResult,callback:function(t){e.$set(e.queryParam,"approvalResult",t)},expression:"queryParam.approvalResult"}},e._l(e.approvalResultOpts,(function(t){return a("Option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.name))])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{type:"primary",icon:"ios-search",loading:e.dataLoading},on:{click:e.getData}},[e._v("查询")]),a("Button",{staticStyle:{"margin-top":"20px"},attrs:{icon:"md-refresh"},on:{click:e.resetParam}},[e._v("重置 ")])],1)],1),a("br"),a("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[a("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[a("Button",{attrs:{type:"default",icon:"md-create"},on:{click:e.applicationBuild}},[e._v(" 申请DRC ")])],1)],1),a("Table",{attrs:{stripe:"",border:"",columns:e.columns,data:e.tableData},scopedSlots:e._u([{key:"action",fn:function(t){var n=t.row,r=t.index;return[a("Dropdown",{attrs:{transfer:!0,placement:"bottom-start"},scopedSlots:e._u([{key:"list",fn:function(){return[a("DropdownMenu",[a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.getDetail(n,r)}}},[e._v(" 详情 ")])],1),a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(t){return e.copy(n,r)}}},[e._v(" 复制 ")])],1),a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(t){return e.preDelete(n,r)}}},[e._v(" 废弃 ")])],1),a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",size:"small"},on:{click:function(t){return e.sendEmail(n,r)}}},[e._v(" 发送邮件 ")])],1),a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"info",size:"small"},on:{click:function(t){return e.preUpdateApplicant(n,r)}}},[e._v(" 修改申请人 ")])],1)],1)]},proxy:!0}],null,!0)},[a("Button",{attrs:{type:"default",icon:"ios-hammer"}},[e._v(" 操作 "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1)]}}])}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:e.total,current:e.current,"page-size-opts":[10,20,50,100],"page-size":10,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){e.current=t},"on-change":e.getData,"on-page-size-change":e.handleChangeSize}})],1),a("Modal",{attrs:{title:"确认删除以下申请单",width:"800px"},on:{"on-ok":e.deleteForm,"on-cancel":e.clearDeleteInfo},model:{value:e.deleteInfo.deleteModal,callback:function(t){e.$set(e.deleteInfo,"deleteModal",t)},expression:"deleteInfo.deleteModal"}},[a("p",[e._v("同步DB: "+e._s(e.deleteInfo.dbName))]),a("p",[e._v("同步表: "+e._s(e.deleteInfo.tableName))]),a("p",[e._v("同步方向: "+e._s(e.deleteInfo.srcRegion)+" => "+e._s(e.deleteInfo.dstRegion))])]),a("Modal",{attrs:{title:"修改申请人",width:"800px"},on:{"on-cancel":e.clearUpdateInfo,"on-ok":e.updateApplicant},model:{value:e.updateInfo.updateModal,callback:function(t){e.$set(e.updateInfo,"updateModal",t)},expression:"updateInfo.updateModal"}},[a("Form",{staticStyle:{width:"100%"},attrs:{"label-position":"right"}},[a("FormItem",{attrs:{label:"申请人"}},[a("Input",{staticStyle:{width:"500px"},model:{value:e.updateInfo.applicant,callback:function(t){e.$set(e.updateInfo,"applicant",t)},expression:"updateInfo.applicant"}})],1)],1)],1)],1)])],1)},r=[],o=a("53ca"),i=(a("a4d3"),a("e01a"),a("d3b7"),{name:"applicationForm",data:function(){return{updateInfo:{updateModal:!1,applicant:"",applicationFormId:null},deleteInfo:{deleteModal:!1,dbName:null,tableName:null,srcRegion:null,dstRegion:null,applicationFormId:null},editable:!1,clearable:!1,dataLoading:!1,regions:[],queryParam:{dbName:null,tableName:null,srcRegion:null,dstRegion:null,approvalResult:null,filterType:null},tableData:[],columns:[{title:"同步DB",key:"dbName",tooltip:!0,width:200},{title:"同步表",key:"tableName",tooltip:!0},{title:"BU",key:"buName",width:150,align:"center"},{title:"同步方向",key:"region",width:150,align:"center",render:function(e,t){var a=t.row,n=a.srcRegion+"->"+a.dstRegion;return e("Tag",{props:{color:"blue"}},n)}},{title:"过滤方式",key:"filterType",width:150,align:"center",render:function(e,t){var a="blue",n=t.row.filterType;return"ALL"===n?a="blue":"UDL"===n&&(a="volcano"),e("Tag",{props:{color:a}},n)}},{title:"是否刷存量",key:"flushExistingData",width:150,align:"center",render:function(e,t){var a=t.row.flushExistingData,n="blue",r="";return 0===a?(n="blue",r="否"):1===a&&(n="volcano",r="是"),e("Tag",{props:{color:n}},r)}},{title:"是否使用给定位点",key:"useGivenGtid",width:150,align:"center",render:function(e,t){var a=t.row.useGivenGtid,n="",r="";return 0===a?(n="blue",r="否"):1===a&&(n="volcano",r="是"),e("Tag",{props:{color:n}},r)}},{title:"提交时间",key:"createTime",width:200,sortable:!0},{title:"审批结果",key:"approvalResult",width:150,align:"center",render:function(e,t){var a=t.row.approvalResult,n="cyan",r="";return 1===a?(n="green",r="通过"):2===a?(n="volcano",r="未通过"):3===a?(n="blue",r="未审批"):0===a&&(r="审批中"),e("Tag",{props:{color:n}},r)}},{title:"操作",slot:"action",width:200,align:"center"}],total:0,current:1,size:10,pageSizeOpts:[10,20,50,100],approvalResultOpts:[{name:"审批中",val:0},{name:"通过",val:1},{name:"未通过",val:2},{name:"未审批",val:3}],filterTypeOpts:[{val:"ALL"},{val:"UDL"}]}},methods:{preUpdateApplicant:function(e,t){this.updateInfo.applicant=e.applicant,this.updateInfo.applicationFormId=e.applicationFormId,this.updateInfo.updateModal=!0},updateApplicant:function(){var e=this;this.axios.post("/api/drc/v2/application/applicant?applicationFormId="+this.updateInfo.applicationFormId+"&applicant="+this.updateInfo.applicant).then((function(t){var a=t.data;!1===a.data?e.$Message.error("修改申请人失败！"):(e.$Message.success("修改申请人成功"),e.getData())}))},clearUpdateInfo:function(){this.updateInfo={updateModal:!1,applicant:"",applicationFormId:null}},sendEmail:function(e,t){var a=this;this.axios.post("/api/drc/v2/application/email?applicationFormId="+e.applicationFormId).then((function(e){var t=e.data;!1===t.data?a.$Message.error("发送邮件失败！"):a.$Message.success("发送邮件成功")}))},preDelete:function(e,t){this.deleteInfo={deleteModal:!0,dbName:e.dbName,tableName:e.tableName,srcRegion:e.srcRegion,dstRegion:e.dstRegion,applicationFormId:e.applicationFormId}},clearDeleteInfo:function(){this.deleteInfo={deleteModal:!1,dbName:null,tableName:null,srcRegion:null,dstRegion:null,applicationFormId:null}},deleteForm:function(){var e=this;this.axios.delete("/api/drc/v2/application/?applicationFormId="+this.deleteInfo.applicationFormId).then((function(t){var a=t.data;1===a.status?e.$Message.error("操作失败！"+a.message):e.getData()}))},applicationBuild:function(){var e=this.$router.resolve({path:"/applicationBuild"});window.open(e.href,"_blank")},getData:function(){var e=this,t={dbName:this.queryParam.dbName,tableName:this.queryParam.tableName,srcRegion:this.queryParam.srcRegion,dstRegion:this.queryParam.dstRegion,approvalResult:this.queryParam.approvalResult,filterType:this.queryParam.filterType,pageReq:{pageSize:this.size,pageIndex:this.current}},a=this.flattenObj(t);this.dataLoading=!0,this.axios.get("/api/drc/v2/application/list",{params:a}).then((function(t){var a=t.data,n=a.pageReq;1===a.status?e.$Message.error("查询失败"):0===a.data.length||0===n.totalCount?(e.total=0,e.current=1,e.tableData=a.data,e.$Message.warning("查询结果为空")):(e.total=n.totalCount,e.current=n.pageIndex,e.tableData=a.data,e.$Message.success("查询成功"))})).finally((function(){e.dataLoading=!1}))},flattenObj:function(e){var t={};for(var a in e)if("object"!==Object(o["a"])(e[a])||Array.isArray(e[a]))t[a]=e[a];else{var n=this.flattenObj(e[a]);for(var r in n)t[a+"."+r]=n[r]}return t},resetParam:function(){this.queryParam={dbName:null,tableName:null,srcRegion:null,dstRegion:null,approvalResult:null,filterType:null}},getDetail:function(e,t){var a=this.$router.resolve({path:"/applicationBuild",query:{applicationFormId:e.applicationFormId,showDetail:!0,dbName:e.dbName,tableName:e.tableName,srcRegion:e.srcRegion,dstRegion:e.dstRegion,filterType:e.filterType,buName:e.buName,tps:e.tps,description:e.description,disruptionImpact:e.disruptionImpact,tag:e.tag,flushExistingData:e.flushExistingData,orderRelated:e.orderRelated,gtidInit:e.gtidInit,remark:e.remark,applicant:e.applicant}});window.open(a.href,"_blank")},copy:function(e,t){var a=this.$router.resolve({path:"/applicationBuild",query:{dbName:e.dbName,tableName:e.tableName,srcRegion:e.srcRegion,dstRegion:e.dstRegion,filterType:e.filterType,buName:e.buName,tps:e.tps,description:e.description,disruptionImpact:e.disruptionImpact,tag:e.tag,flushExistingData:e.flushExistingData,orderRelated:e.orderRelated,remark:e.remark,applicant:e.applicant,applicationFormId:e.applicationFormId}});window.open(a.href,"_blank")},handleChangeSize:function(e){var t=this;this.size=e,this.$nextTick((function(){t.getData()}))},getRegions:function(){var e=this;this.axios.get("/api/drc/v2/meta/regions/all").then((function(t){e.regions=t.data.data}))}},created:function(){var e=this;this.axios.get("/api/drc/v2/permission/approval/drc").then((function(t){403!==t.data.status?(e.getRegions(),e.getData()):e.$router.push("/nopermission")}))}}),l=i,s=a("2877"),p=Object(s["a"])(l,n,r,!1,null,"33c3168e",null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-0fa5695a.083847ce.js.map