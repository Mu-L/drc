(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e109684"],{"159b":function(t,e,a){var o=a("da84"),r=a("fdbc"),s=a("17c2"),i=a("9112");for(var l in r){var n=o[l],c=n&&n.prototype;if(c&&c.forEach!==s)try{i(c,"forEach",s)}catch(u){c.forEach=s}}},"17c2":function(t,e,a){"use strict";var o=a("b727").forEach,r=a("a640"),s=a("ae40"),i=r("forEach"),l=s("forEach");t.exports=i&&l?[].forEach:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}},4160:function(t,e,a){"use strict";var o=a("23e7"),r=a("17c2");o({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},4904:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("base-component",[a("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[a("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),a("BreadcrumbItem",{attrs:{to:"/proxyRouteCluster"}},[t._v("路由列表")])],1),a("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[a("div",{staticStyle:{padding:"1px 1px"}},[a("Card",[a("Row",{attrs:{gutter:10,align:"middle"}},[a("Col",{attrs:{span:"16"}},[a("Card",{attrs:{padding:5},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("查询条件")]},proxy:!0}])},[a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"6"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"BU"},on:{"on-change":t.getRoutes},model:{value:t.queryParam.buId,callback:function(e){t.$set(t.queryParam,"buId",e)},expression:"queryParam.buId"}},t._l(t.bus,(function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.buName))])})),1)],1),a("Col",{attrs:{span:"6"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"源端（Applier）机房"},on:{"on-change":t.getRoutes},model:{value:t.queryParam.srcDcName,callback:function(e){t.$set(t.queryParam,"srcDcName",e)},expression:"queryParam.srcDcName"}},t._l(t.drcZoneList,(function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1),a("Col",{attrs:{span:"6"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"目标（Replicator）机房"},on:{"on-change":t.getRoutes},model:{value:t.queryParam.dstDcName,callback:function(e){t.$set(t.queryParam,"dstDcName",e)},expression:"queryParam.dstDcName"}},t._l(t.drcZoneList,(function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1),a("Col",{attrs:{span:"3"}},[a("Select",{attrs:{filterable:"",clearable:"",placeholder:"tag"},on:{"on-change":t.getRoutes},model:{value:t.queryParam.tag,callback:function(e){t.$set(t.queryParam,"tag",e)},expression:"queryParam.tag"}},t._l(t.tags,(function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),a("Col",{attrs:{span:"3"}},[a("Select",{attrs:{filterable:"",placeholder:"是否全局生效"},on:{"on-change":t.getRoutes},model:{value:t.queryParam.globalActive,callback:function(e){t.$set(t.queryParam,"globalActive",e)},expression:"queryParam.globalActive"}},t._l(t.globalActiveList,(function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label)+" ")])})),1)],1)],1)],1)],1),a("Col",{attrs:{span:"1"}},[a("Button",{attrs:{type:"primary",icon:"ios-search",loading:t.dataLoading},on:{click:t.getRoutes}},[t._v("查询")]),a("Button",{staticStyle:{"margin-top":"20px"},attrs:{icon:"md-refresh",loading:t.dataLoading},on:{click:t.resetParam}},[t._v("重置 ")])],1)],1),a("br"),a("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[a("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[a("Button",{attrs:{type:"default",icon:"ios-hammer"},on:{click:t.goToAddRoute}},[t._v(" 添加路由 ")])],1)],1),a("Table",{attrs:{stripe:"",columns:t.columns,data:t.dataWithPage},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row,r=e.index;return[a("Dropdown",{attrs:{transfer:!0,placement:"bottom-start"},scopedSlots:t._u([{key:"list",fn:function(){return[a("DropdownMenu",[a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.goToUpdate(o,r)}}},[t._v(" 修改 ")])],1),a("DropdownItem",[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"},on:{click:function(e){return t.goToDelete(o,r)}}},[t._v(" 删除 ")])],1),a("DropdownItem",[a("Tooltip",{attrs:{transfer:!0,content:"修改路由全局生效状态,请谨慎操作!"}},[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",size:"small"},on:{click:function(e){return t.preChangeRouteActive(o,r)}}},[t._v(" 修改全局生效状态 ")])],1)],1)],1)]},proxy:!0}],null,!0)},[a("Button",{attrs:{type:"default",icon:"ios-hammer"}},[t._v(" 操作 "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1)]}}])}),a("div",{staticStyle:{"text-align":"center",margin:"16px 0"}},[a("Page",{attrs:{transfer:!0,total:t.routes.length,current:t.current,"show-sizer":"","show-elevator":""},on:{"update:current":function(e){t.current=e},"on-page-size-change":t.handleChangeSize}})],1)],1),a("Modal",{attrs:{title:"关联db",width:"1000px",scrollable:!0,draggable:!0},on:{"on-cancel":t.clearDbSelection,"on-ok":t.clearDbSelection},model:{value:t.dbModal,callback:function(e){t.dbModal=e},expression:"dbModal"}},[a("Table",{attrs:{stripe:"",border:"",columns:t.dbColumns,data:t.dbData},on:{"on-selection-change":t.changeDbSelection}}),a("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[a("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.deleteDbRoutes()}}},[t._v(" 删除关联db链路 ")])],1)],1)],1),a("Modal",{attrs:{title:"关联mha",width:"800px",scrollable:!0,draggable:!0},on:{"on-cancel":t.clearMhaSelection,"on-ok":t.clearMhaSelection},model:{value:t.mhaModal,callback:function(e){t.mhaModal=e},expression:"mhaModal"}},[a("Table",{attrs:{stripe:"",border:"",columns:t.mhaColumns,data:t.dbData},on:{"on-selection-change":t.changeMhaSelection}}),a("Row",{staticStyle:{background:"#fdfdff",border:"1px solid #e8eaec"}},[a("Col",{staticStyle:{display:"flex",float:"left",margin:"5px"},attrs:{span:"2"}},[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.deleteMhaRoutes()}}},[t._v(" 删除关联mha ")])],1)],1)],1),a("Modal",{attrs:{title:"修改路由规则全局状态",width:"800px",scrollable:!0,draggable:!0},on:{"on-ok":t.changeRouteActive},model:{value:t.activeModal,callback:function(e){t.activeModal=e},expression:"activeModal"}},[a("Card",{attrs:{padding:5}},[a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("是否全局生效：")])]),a("Col",{attrs:{span:"6"}},[a("label",[t._v(t._s(t.activeRow.activeText))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("关联db数：")])]),a("Col",{attrs:{span:"6"}},[a("label",[t._v(t._s(t.activeRow.relatedNum))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("BU：")])]),a("Col",{attrs:{span:"6"}},[a("label",[t._v(t._s(t.activeRow.routeOrgName))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("Applier源机房：")])]),a("Col",{attrs:{span:"14"}},[a("label",[t._v(t._s(t.activeRow.srcDcName))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("Replicator目标机房：")])]),a("Col",{attrs:{span:"14"}},[a("label",[t._v(t._s(t.activeRow.dstDcName))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("源端Proxy：")])]),a("Col",{attrs:{span:"14"}},[a("label",[t._v(t._s(t.activeRow.srcProxyUris))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("目标Proxy：")])]),a("Col",{attrs:{span:"14"}},[a("label",[t._v(t._s(t.activeRow.dstProxyUris))])])],1),a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("label",[t._v("中继Proxy：")])]),a("Col",{attrs:{span:"14"}},[a("label",[t._v(t._s(t.activeRow.relayProxyUris))])])],1)],1)],1)],1)])],1)},r=[],s=(a("4160"),a("fb6a"),a("d3b7"),a("159b"),a("53ca")),i=a("2909"),l={name:"proxyRouteCluster",data:function(){var t=this;return{bus:[],drcZoneList:this.constant.dcList,tags:this.constant.routeTags,globalActiveList:[{value:1,label:"是"},{value:0,label:"否"}],dataLoading:!1,dbModal:!1,mhaModal:!1,activeModal:!1,activeRow:{id:null,relatedNum:null,routeOrgName:"",srcDcName:"",dstDcName:"",srcProxyUris:"",dstProxyUris:"",relayProxyUris:"",globalActive:"",activeText:""},dbData:[],multiData:[],multiDbData:[],multiMhaData:[],deleteMhaModal:!1,deleteDbModal:!1,selectedRow:null,mhaColumns:[{type:"selection",width:60,align:"center"},{title:"序号",width:75,align:"center",render:function(t,e){return t("span",e.index+1)}},{title:"mha",key:"srcMhaName",render:function(e,a){var o=a.row,r=o.srcMhaName;return e("a",{props:{type:"info",size:"small",disabled:!1},on:{click:function(){t.toMhaReplication(o)}}},r)}}],dbColumns:[{type:"selection",width:60,align:"center"},{title:"序号",width:75,align:"center",render:function(t,e){return t("span",e.index+1)}},{title:"db",key:"dbName",width:300},{title:"同步链路",key:"relatedId",render:function(e,a){var o=a.row,r=o.srcMhaName+"("+o.srcDcName+") => "+o.dstMhaName+"("+o.dstDcName+")";return e("a",{props:{type:"info",size:"small",disabled:!1},on:{click:function(){t.toMhaDbReplication(o)}}},r)}}],columns:[{title:"关联链路数",key:"relatedNum",width:150,sortable:!0,render:function(e,a){var o=a.row,r=o.relatedNum,s="meta"===o.tag?"success":"warning",i=!1;return null===o.relatedNum&&(i=!0,r=0),e("Button",{props:{type:s,size:"small",disabled:i},on:{click:function(){t.showRelatedModal(o)}}},r)}},{title:"BU",key:"routeOrgName",width:80,sortable:!0},{title:"Applier源端机房",key:"srcDcName",width:200,sortable:!0},{title:"Replicator目标机房",key:"dstDcName",width:200,sortable:!0},{title:"源端Proxy",key:"srcProxyUris"},{title:"目标Proxy",key:"dstProxyUris"},{title:"中继Proxy",key:"relayProxyUris"},{title:"tag",key:"tag",width:100,sortable:!0,render:function(t,e){var a=e.row,o="meta"===a.tag?"success":"warning",r=a.tag;return t("Tag",{props:{color:o}},r)}},{title:"是否全局生效",key:"globalActive",align:"center",width:140,sortable:!0,resizable:!0,render:function(t,e){var a=e.row,o=1===a.globalActive?"blue":"volcano",r=1===a.globalActive?"是":"否";return t("Tag",{props:{color:o}},r)}},{title:"操作",slot:"action",align:"center",width:200}],queryParam:{buId:0,srcDcName:"",dstDcName:"",tag:"",globalActive:1},routes:[],total:0,current:1,size:10,searchOption:{deleteOptions:[{value:0,key:"inUse"},{value:1,key:"discard"}]}}},computed:{dataWithPage:function(){var t=this.routes,e=this.current*this.size-this.size,a=e+this.size;return Object(i["a"])(t).slice(e,a)}},methods:{clearDbSelection:function(){this.selectedRow=null,this.multiDbData=[],this.getRoutes()},clearMhaSelection:function(){this.selectedRow=null,this.multiMhaData=[],this.getRoutes()},changeDbSelection:function(t){this.multiDbData=t,console.log(this.multiDbData)},changeMhaSelection:function(t){this.multiMhaData=t,console.log(this.multiMhaData)},changeSelection:function(t){this.multiData=t,console.log(this.multiData)},deleteMhaRoutes:function(){var t=this;if(0!==this.multiMhaData.length){var e=[];this.multiMhaData.forEach((function(t){return e.push(t.relatedId)}));var a={routeId:this.selectedRow.id,mhaIds:e,mhaDbReplicationIds:[]};console.log(a),this.deleteMhaModal=!0,this.axios.delete("/api/drc/v2/meta/routeMappings/mha",{data:a}).then((function(e){1===e.data.status?t.$Message.error("删除mha关联链路失败: "+e.data.message):t.$Message.success("删除mha关联链路成功")})).catch((function(e){t.$Message.error("删除mha关联链路失败: "+e)})).finally((function(){t.getRelatedMha(t.selectedRow.id),t.deleteMhaModal=!0,t.multiMhaData=[]}))}else alert("请勾选关联mha！")},deleteDbRoutes:function(){var t=this;if(0!==this.multiDbData.length){var e=[];this.multiDbData.forEach((function(t){return e.push(t.relatedId)}));var a={routeId:this.selectedRow.id,mhaDbReplicationIds:e};this.deleteDbModal=!0,this.axios.delete("/api/drc/v2/meta/routeMappings",{data:a}).then((function(e){1===e.data.status?t.$Message.error("删除db关联链路失败: "+e.data.message):t.$Message.success("删除db关联链路成功")})).catch((function(e){t.$Message.error("删除db关联链路失败: "+e)})).finally((function(){t.getRelatedDb(t.selectedRow.id),t.deleteDbModal=!0,t.multiMhaData=[]}))}else alert("请勾选关联db！")},toMhaDbReplication:function(t){var e=this.$router.resolve({path:"/v2/mhaDbReplications",query:{srcMhaName:t.srcMhaName,dstMhaName:t.dstMhaName,preciseSearchMode:!0,relatedDbName:t.dbName}});window.open(e.href,"_blank")},toMhaReplication:function(t){var e=this.$router.resolve({path:"/v2/mhaDbReplications",query:{relatedMhaName:t.srcMhaName,preciseSearchMode:!1}});window.open(e.href,"_blank")},showDbModal:function(t){this.getRelatedDb(t.id),this.dbModal=!0,this.selectedRow=t},showMhaModal:function(t){this.getRelatedMha(t.id),this.mhaModal=!0,this.selectedRow=t},getRelatedDb:function(t){var e=this;this.dbData=[],this.axios.get("/api/drc/v2/meta/routeMapping/dbs?routeId="+t).then((function(t){e.dbData=t.data.data}))},getRelatedMha:function(t){var e=this;this.dbData=[],this.axios.get("/api/drc/v2/meta/routeMapping/mhas?routeId="+t).then((function(t){e.dbData=t.data.data}))},showRelatedModal:function(t){"meta"===t.tag?this.showDbModal(t):"console"===t.tag&&this.showMhaModal(t)},resetParam:function(){this.queryParam={buId:0,srcDcName:"",dstDcName:"",tag:"",globalActive:1}},getRoutes:function(){var t=this,e={buId:this.queryParam.buId,srcDcName:this.queryParam.srcDcName,dstDcName:this.queryParam.dstDcName,tag:this.queryParam.tag,globalActive:this.queryParam.globalActive},a=this.flattenObj(e);this.dataLoading=!0,this.axios.get("/api/drc/v2/meta/routes",{params:a}).then((function(e){t.total=e.data.data.length,t.routes=e.data.data,t.dataLoading=!1}))},handleChangeSize:function(t){this.size=t},goToUpdate:function(t,e){console.log("go to manage route for"+t.routeOrgName+"-"+t.tag+", from "+t.srcDcName+" to "+t.dstDcName),this.$router.push({path:"/proxyRouteManagement",query:{updateStatus:"true",routeId:t.id}})},preChangeRouteActive:function(t,e){this.activeRow=t,1===t.globalActive?this.activeRow.activeText="是":this.activeRow.activeText="否",this.activeModal=!0},changeRouteActive:function(){var t,e=this;0===this.activeRow.globalActive?t="/api/drc/v2/meta/activeRoute?routeId="+this.activeRow.id:1===this.activeRow.globalActive&&(t="/api/drc/v2/meta/deactivateRoute?routeId="+this.activeRow.id),this.axios.post(t).then((function(t){0===t.data.status?e.$Message.success("修改路由全局生效状态成功"):e.$Message.success("修改路由全局生效状态失败"),e.getRoutes()}))},goToDelete:function(t,e){var a=this;this.axios.delete("/api/drc/v2/meta/route?routeId="+t.id).then((function(t){0===t.data.status?a.$Message.success("下线成功"):a.$Message.success("下线失败"),a.getRoutes()}))},goToRecover:function(t,e){var a=this;0===t.deleted?alert("正在使用中无需回滚！"):this.axios.post("/api/drc/v1/meta/routes",{id:0,routeOrgName:t.routeOrgName,srcDcName:t.srcDcName,dstDcName:t.dstDcName,srcProxyUris:t.srcProxyUris,relayProxyUris:t.relayProxyUris,dstProxyUris:t.dstProxyUris,tag:t.tag,deleted:0}).then((function(t){console.log(t.data),console.log(t.data.data),0===t.data.status?(alert("回滚成功！"),a.queryParam.deleted=0,a.getRoutes()):alert("操作失败！")}))},goToAddRoute:function(){console.log("go to manage route"),this.$router.push({path:"/proxyRouteManagement",query:{updateStatus:"false",srcProxyUris:[],relayProxyUris:[],dstProxyUris:[]}})},getBus:function(){var t=this;this.axios.get("/api/drc/v2/meta/bus/all").then((function(e){t.bus=e.data.data}))},flattenObj:function(t){var e={};for(var a in t)if("object"!==Object(s["a"])(t[a])||Array.isArray(t[a]))e[a]=t[a];else{var o=this.flattenObj(t[a]);for(var r in o)e[a+"."+r]=o[r]}return e}},created:function(){var t=this;this.axios.get("/api/drc/v2/permission/resource/route").then((function(e){403!==e.data.status?(t.getRoutes(),t.getBus()):t.$router.push("/nopermission")}))}},n=l,c=a("2877"),u=Object(c["a"])(n,o,r,!1,null,"e76096aa",null);e["default"]=u.exports},"53ca":function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));a("a4d3"),a("e01a"),a("d28b"),a("e260"),a("d3b7"),a("3ca3"),a("ddb0");function o(t){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}},a640:function(t,e,a){"use strict";var o=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&o((function(){a.call(null,e||function(){throw 1},1)}))}},fb6a:function(t,e,a){"use strict";var o=a("23e7"),r=a("861d"),s=a("e8b5"),i=a("23cb"),l=a("50c4"),n=a("fc6a"),c=a("8418"),u=a("b622"),d=a("1dde"),h=a("ae40"),p=d("slice"),m=h("slice",{ACCESSORS:!0,0:0,1:2}),g=u("species"),b=[].slice,f=Math.max;o({target:"Array",proto:!0,forced:!p||!m},{slice:function(t,e){var a,o,u,d=n(this),h=l(d.length),p=i(t,h),m=i(void 0===e?h:e,h);if(s(d)&&(a=d.constructor,"function"!=typeof a||a!==Array&&!s(a.prototype)?r(a)&&(a=a[g],null===a&&(a=void 0)):a=void 0,a===Array||void 0===a))return b.call(d,p,m);for(o=new(void 0===a?Array:a)(f(m-p,0)),u=0;p<m;p++,u++)p in d&&c(o,u,d[p]);return o.length=u,o}})}}]);
//# sourceMappingURL=chunk-2e109684.4a591488.js.map