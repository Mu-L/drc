(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5760a37e"],{"5fb7":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("base-component",[i("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[i("BreadcrumbItem",{attrs:{to:"/home"}},[t._v("首页")]),i("BreadcrumbItem",{attrs:{to:"/rowsFilterConfigs"}},[t._v("行过滤配置")])],1),i("Content",{staticClass:"content",style:{padding:"10px",background:"#fff",margin:"50px 0 1px 185px",zIndex:"1"}},[i("span",{staticStyle:{"margin-right":"5px",color:"#464c5b","font-weight":"600"}},[t._v(t._s(t.drc.srcMha)+"("+t._s(t.drc.srcDc)+")==>"+t._s(t.drc.destMha)+"("+t._s(t.drc.destDc)+")")]),i("div",{style:{padding:"1px 1px",height:"100%"}},[t.display.rowsFilterConfigs?[i("Table",{staticStyle:{"margin-top":"20px"},attrs:{stripe:"",columns:t.columns,data:t.rowsFilterConfigsData,border:""},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row,r=e.index;return[i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.goToShowConfig(o,r)}}},[t._v("查看")]),i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.goToUpdateConfig(o,r)}}},[t._v("修改")]),i("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"error",size:"small"},on:{click:function(e){return t.deleteConfig(o,r)}}},[t._v("删除")])]}}],null,!1,89673703)}),i("Button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.goToAddRowsFilter}},[t._v("添加")])]:t._e()],2)]),i("Modal",{attrs:{title:"行过滤配置",width:"1000px"},scopedSlots:t._u([{key:"footer",fn:function(){return[i("Button",{attrs:{type:"text",size:"large"},on:{click:t.cancelSubmit}},[t._v("取消")]),i("Button",{attrs:{type:"primary"},on:{click:t.submitConfig}},[t._v("提交")])]},proxy:!0}]),model:{value:t.display.rowsFilterModal,callback:function(e){t.$set(t.display,"rowsFilterModal",e)},expression:"display.rowsFilterModal"}},[i("Row",{attrs:{gutter:10}},[i("Col",{attrs:{span:"12"}},[i("Card",[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",[t._v("配置")])]),i("Form",{ref:"rowsFilterConfig",staticStyle:{"margin-top":"10px"},attrs:{model:t.rowsFilterConfig,"label-width":100}},[i("FormItem",{attrs:{label:"数据源"}},[i("Input",{staticStyle:{width:"200px"},attrs:{readonly:""},model:{value:t.rowsFilterConfig.dataMediaSourceName,callback:function(e){t.$set(t.rowsFilterConfig,"dataMediaSourceName",e)},expression:"rowsFilterConfig.dataMediaSourceName"}})],1),i("FormItem",{attrs:{label:"库名"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"支持正则"},model:{value:t.rowsFilterConfig.namespace,callback:function(e){t.$set(t.rowsFilterConfig,"namespace",e)},expression:"rowsFilterConfig.namespace"}})],1),i("FormItem",{attrs:{label:"表名"}},[i("Row",[i("Col",{attrs:{span:"16"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入逻辑表名，支持正则"},model:{value:t.rowsFilterConfig.name,callback:function(e){t.$set(t.rowsFilterConfig,"name",e)},expression:"rowsFilterConfig.name"}})],1),i("Col",{attrs:{span:"4"}},[i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.checkTable}},[t._v("匹配")])],1)],1)],1),i("FormItem",{attrs:{label:"规则名"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"行过滤规则名"},model:{value:t.rowsFilterConfig.rowsFilterName,callback:function(e){t.$set(t.rowsFilterConfig,"rowsFilterName",e)},expression:"rowsFilterConfig.rowsFilterName"}})],1),i("FormItem",{attrs:{label:"模式"}},[i("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择行过滤模式"},model:{value:t.rowsFilterConfig.mode,callback:function(e){t.$set(t.rowsFilterConfig,"mode",e)},expression:"rowsFilterConfig.mode"}},t._l(t.modesForChose,(function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),i("FormItem",{attrs:{label:"选择列名"}},[i("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"选择相关列"},model:{value:t.rowsFilterConfig.columns,callback:function(e){t.$set(t.rowsFilterConfig,"columns",e)},expression:"rowsFilterConfig.columns"}},t._l(t.columnsForChose,(function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),i("FormItem",{attrs:{label:"添加列名"}},[i("Row",[i("Col",{attrs:{span:"16"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"手动添加列名"},model:{value:t.columnForAdd,callback:function(e){t.columnForAdd=e},expression:"columnForAdd"}})],1),i("Col",{attrs:{span:"4"}},[i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.addColumn}},[t._v("添加")])],1)],1)],1),i("FormItem",{attrs:{label:"默认过滤"}},[i("Checkbox",{model:{value:t.rowsFilterConfig.illegalArgument,callback:function(e){t.$set(t.rowsFilterConfig,"illegalArgument",e)},expression:"rowsFilterConfig.illegalArgument"}},[t._v("过滤【字段为空时】")])],1),i("FormItem",{attrs:{label:"规则内容"}},["trip_uid"!==t.rowsFilterConfig.mode?i("Input",{staticStyle:{width:"250px"},attrs:{type:"textarea",placeholder:"请输入行过滤内容"},model:{value:t.rowsFilterConfig.context,callback:function(e){t.$set(t.rowsFilterConfig,"context",e)},expression:"rowsFilterConfig.context"}}):t._e(),"trip_uid"===t.rowsFilterConfig.mode?i("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"Region 选择"},model:{value:t.rowsFilterConfig.context,callback:function(e){t.$set(t.rowsFilterConfig,"context",e)},expression:"rowsFilterConfig.context"}},t._l(t.regionsForChose,(function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1):t._e()],1)],1)],1)],1),i("Col",{attrs:{span:"12"}},[i("Card",[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",[t._v("相关表")])]),i("Table",{attrs:{stripe:"",columns:t.columnsForTableCheck,data:t.tableData,border:""}})],1)],1)],1)],1)],1)},r=[],s=(i("b0c0"),{name:"rowsFilterConfigs",data:function(){return{display:{rowsFilterConfigs:!0,rowsFilterModal:!1,showOnly:!1},drc:{srcMha:this.$route.query.srcMha,destMha:this.$route.query.destMha,srcDc:"",destDc:"",applierGroupId:0},columns:[{title:"序号",width:75,align:"center",fixed:"left",render:function(t,e){return t("span",e.index+1)}},{title:"库名",key:"namespace",width:300},{title:"表名",key:"name",width:300},{title:"规则名",key:"rowsFilterName",width:200},{title:"模式",key:"mode",width:120},{title:"默认过滤",key:"illegalArgument",width:100},{title:"相关列",key:"columns",width:200},{title:"内容",key:"context",width:300},{title:"操作",slot:"action",align:"center",width:200,fixed:"right"}],rowsFilterConfigsData:[],tableData:[],columnsForTableCheck:[{title:"序号",width:75,align:"center",render:function(t,e){return t("span",e.index+1)}},{title:"库名",key:"schema"},{title:"表名",key:"name"}],rowsFilterConfig:{mappingId:0,dataMediaId:0,namespace:"",name:"",dataMediaSourceId:0,dataMediaSourceName:"",rowsFilterId:0,rowsFilterName:"",mode:"trip_uid",columns:[],context:"",illegalArgument:!1},modesForChose:["aviator_regex","java_regex","trip_uid","custom"],columnsForChose:["UID"],regionsForChose:["SIN","SH"],columnForAdd:"",forceCommit:!1}},methods:{getOrInitSimplexDrc:function(){var t=this;console.log(this.drc.srcMha+"/"+this.drc.destMha),this.axios.post("/api/drc/v1/build/simplexDrc/"+this.drc.srcMha+"/"+this.drc.destMha).then((function(e){if(1===e.data.status)window.alert("获取或创建该方向同步!");else{var i=e.data.data;t.drc.srcDc=i.srcDc,t.drc.destDc=i.destDc,t.drc.applierGroupId=i.destApplierGroupId,t.getRowsFilterConfigs()}}))},getRowsFilterConfigs:function(){var t=this;console.log(this.drc.applierGroupId),this.axios.get("/api/drc/v1/build/rowsFilterMappings/"+this.drc.applierGroupId).then((function(e){1===e.data.status?window.alert("查询行过滤配置失败!"):t.rowsFilterConfigsData=e.data.data}))},goToShowConfig:function(t,e){this.rowsFilterConfigInitFormRow(t,e),this.checkTable(),this.columnsForChose=t.columns,this.display.rowsFilterModal=!0,this.display.showOnly=!0},goToUpdateConfig:function(t,e){this.rowsFilterConfigInitFormRow(t,e),this.columnsForChose=t.columns,this.forceCommit=!1,this.display.showOnly=!1,this.display.rowsFilterModal=!0},deleteConfig:function(t,e){var i=this;this.axios.delete("/api/drc/v1/build/rowsFilterConfig/"+t.id).then((function(t){console.log(t.data),console.log(t.data.data),0===t.data.status?(alert("删除成功！"),i.getRowsFilterConfigs()):alert("操作失败！")}))},goToAddRowsFilter:function(){this.rowsFilterConfigInit(),this.checkTable(),this.columnsForChose=["UID"],this.forceCommit=!1,this.display.showOnly=!1,this.display.rowsFilterModal=!0},rowsFilterConfigInitFormRow:function(t,e){this.rowsFilterConfig={mappingId:t.id,dataMediaId:t.dataMediaId,namespace:t.namespace,name:t.name,dataMediaSourceId:t.dataMediaSourceId,dataMediaSourceName:this.drc.srcMha,rowsFilterId:t.rowsFilterId,rowsFilterName:t.rowsFilterName,mode:t.mode,columns:t.columns,context:t.context,illegalArgument:t.illegalArgument},this.tableData=[]},rowsFilterConfigInit:function(){this.rowsFilterConfig={mappingId:0,dataMediaId:0,namespace:".*",name:".*",dataMediaSourceId:0,dataMediaSourceName:this.drc.srcMha,rowsFilterId:0,rowsFilterName:"",mode:"trip_uid",columns:[],context:"",illegalArgument:!1},this.tableData=[]},submitConfig:function(){var t=this;this.display.showOnly?window.alert("查看时 禁止提交！"):""===this.rowsFilterConfig.namespace||""===this.rowsFilterConfig.name||""===this.rowsFilterConfig.mode||""===this.rowsFilterConfig.rowsFilterName||0===this.rowsFilterConfig.columns.length||""===this.rowsFilterConfig.context?alert("缺少配置 禁止提交！"):0!==this.tableData.length||this.forceCommit?this.axios.post("/api/drc/v1/build/rowsFilterConfig",{id:0===this.rowsFilterConfig.mappingId?null:this.rowsFilterConfig.mappingId,applierGroupId:this.drc.applierGroupId,namespace:""===this.rowsFilterConfig.namespace?null:this.rowsFilterConfig.namespace,name:""===this.rowsFilterConfig.name?null:this.rowsFilterConfig.name,type:0,dataMediaSourceId:0===this.rowsFilterConfig.dataMediaSourceId?null:this.rowsFilterConfig.dataMediaSourceId,dataMediaSourceName:this.drc.srcMha,rowsFilterId:0===this.rowsFilterConfig.rowsFilterId?null:this.rowsFilterConfig.rowsFilterId,rowsFilterName:""===this.rowsFilterConfig.rowsFilterName?null:this.rowsFilterConfig.rowsFilterName,mode:this.rowsFilterConfig.mode,columns:this.rowsFilterConfig.columns===[]?null:this.rowsFilterConfig.columns,illegalArgument:this.rowsFilterConfig.illegalArgument,context:""===this.rowsFilterConfig.context?null:this.rowsFilterConfig.context}).then((function(e){1===e.data.status?window.alert("提交失败!"+e.data.data):(window.alert("提交成功!"+e.data.data),t.display.rowsFilterModal=!1,t.getRowsFilterConfigs())})):(this.forceCommit=!0,alert("无匹配表 下一次提交将强制执行！！"))},cancelSubmit:function(){this.display.rowsFilterModal=!1},checkTable:function(){var t=this;""!==this.rowsFilterConfig.namespace&&""!==this.rowsFilterConfig.name?(this.axios.get("/api/drc/v1/build/dataMedia/check/"+this.rowsFilterConfig.namespace+"/"+this.rowsFilterConfig.name+"/"+this.drc.srcDc+"/"+this.drc.srcMha+"/0").then((function(e){1===e.data.status?window.alert("查询匹配表失败"):(console.log(e.data.data),t.tableData=e.data.data,0===t.tableData.length&&window.alert("无匹配表 或 查询匹配表失败"))})),this.axios.get("/api/drc/v1/build/rowsFilter/commonColumns/"+this.drc.srcDc+"/"+this.drc.srcMha+"/"+this.rowsFilterConfig.namespace+"/"+this.rowsFilterConfig.name).then((function(e){1===e.data.status?window.alert("查询公共列名失败，请手动添加！"):(console.log(e.data.data),t.columnsForChose=e.data.data)}))):window.alert("库名表名不能为空！")},addColumn:function(){this.columnsForChose.push(this.columnForAdd),this.rowsFilterConfig.columns.push(this.columnForAdd),this.columnForAdd=""}},created:function(){console.log(this.$route.query.srcMha),console.log(this.$route.query.destMha),this.drc.srcMha=this.$route.query.srcMha,this.drc.destMha=this.$route.query.destMha,this.getOrInitSimplexDrc()}}),a=s,l=i("2877"),n=Object(l["a"])(a,o,r,!1,null,"65d13529",null);e["default"]=n.exports},b0c0:function(t,e,i){var o=i("83ab"),r=i("9bf2").f,s=Function.prototype,a=s.toString,l=/^\s*function ([^ (]*)/,n="name";!o||n in s||r(s,n,{configurable:!0,get:function(){try{return a.call(this).match(l)[1]}catch(t){return""}}})}}]);
//# sourceMappingURL=chunk-5760a37e.0aa22389.js.map