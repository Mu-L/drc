(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e52595a"],{"159b":function(e,a,t){var n=t("da84"),s=t("fdbc"),i=t("17c2"),o=t("9112");for(var r in s){var c=n[r],l=c&&c.prototype;if(l&&l.forEach!==i)try{o(l,"forEach",i)}catch(h){l.forEach=i}}},"17c2":function(e,a,t){"use strict";var n=t("b727").forEach,s=t("a640"),i=t("ae40"),o=s("forEach"),r=i("forEach");e.exports=o&&r?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},6062:function(e,a,t){"use strict";var n=t("6d61"),s=t("6566");e.exports=n("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),s)},7252:function(e,a,t){"use strict";e.exports=function(e){if("number"!==typeof e)throw new TypeError("Expected a number");var a=e>0?Math.floor:Math.ceil;return{days:a(e/864e5),hours:a(e/36e5)%24,minutes:a(e/6e4)%60,seconds:a(e/1e3)%60,milliseconds:a(e)%1e3}}},"857a":function(e,a,t){var n=t("1d80"),s=/"/g;e.exports=function(e,a,t,i){var o=String(n(e)),r="<"+a;return""!==t&&(r+=" "+t+'="'+String(i).replace(s,"&quot;")+'"'),r+">"+o+"</"+a+">"}},"86aa":function(e){e.exports=JSON.parse('{"addendum":"addenda","aircraft":"aircraft","alga":"algae","alumna":"alumnae","alumnus":"alumni","amoeba":"amoebae","analysis":"analyses","antenna":"antennae","antithesis":"antitheses","apex":"apices","appendix":"appendices","automaton":"automata","axis":"axes","bacillus":"bacilli","bacterium":"bacteria","barracks":"barracks","basis":"bases","beau":"beaux","bison":"bison","buffalo":"buffalo","bureau":"bureaus","cactus":"cacti","calf":"calves","carp":"carp","census":"censuses","chassis":"chassis","cherub":"cherubim","child":"children","château":"châteaus","cod":"cod","codex":"codices","concerto":"concerti","corpus":"corpora","crisis":"crises","criterion":"criteria","curriculum":"curricula","datum":"data","deer":"deer","diagnosis":"diagnoses","die":"dice","dwarf":"dwarfs","echo":"echoes","elf":"elves","elk":"elk","ellipsis":"ellipses","embargo":"embargoes","emphasis":"emphases","erratum":"errata","faux pas":"faux pas","fez":"fezes","firmware":"firmware","fish":"fish","focus":"foci","foot":"feet","formula":"formulae","fungus":"fungi","gallows":"gallows","genus":"genera","goose":"geese","graffito":"graffiti","grouse":"grouse","half":"halves","hero":"heroes","hoof":"hooves","hovercraft":"hovercraft","hypothesis":"hypotheses","index":"indices","kakapo":"kakapo","knife":"knives","larva":"larvae","leaf":"leaves","libretto":"libretti","life":"lives","loaf":"loaves","locus":"loci","louse":"lice","man":"men","matrix":"matrices","means":"means","medium":"media","memorandum":"memoranda","millennium":"millennia","minutia":"minutiae","moose":"moose","mouse":"mice","nebula":"nebulae","nemesis":"nemeses","neurosis":"neuroses","news":"news","nucleus":"nuclei","oasis":"oases","offspring":"offspring","opus":"opera","ovum":"ova","ox":"oxen","paralysis":"paralyses","parenthesis":"parentheses","person":"people","phenomenon":"phenomena","phylum":"phyla","pike":"pike","polyhedron":"polyhedra","potato":"potatoes","prognosis":"prognoses","quiz":"quizzes","radius":"radii","referendum":"referenda","salmon":"salmon","scarf":"scarves","self":"selves","series":"series","sheep":"sheep","shelf":"shelves","shrimp":"shrimp","spacecraft":"spacecraft","species":"species","spectrum":"spectra","squid":"squid","stimulus":"stimuli","stratum":"strata","swine":"swine","syllabus":"syllabi","symposium":"symposia","synopsis":"synopses","synthesis":"syntheses","tableau":"tableaus","that":"those","thesis":"theses","thief":"thieves","this":"these","tomato":"tomatoes","tooth":"teeth","trout":"trout","tuna":"tuna","vertebra":"vertebrae","vertex":"vertices","veto":"vetoes","vita":"vitae","vortex":"vortices","watercraft":"watercraft","wharf":"wharves","wife":"wives","wolf":"wolves","woman":"women"}')},9911:function(e,a,t){"use strict";var n=t("23e7"),s=t("857a"),i=t("af03");n({target:"String",proto:!0,forced:i("link")},{link:function(e){return s(this,"a","href",e)}})},a15b:function(e,a,t){"use strict";var n=t("23e7"),s=t("44ad"),i=t("fc6a"),o=t("a640"),r=[].join,c=s!=Object,l=o("join",",");n({target:"Array",proto:!0,forced:c||!l},{join:function(e){return r.call(i(this),void 0===e?",":e)}})},a3b8:function(e,a,t){"use strict";const n=t("7252"),s=t("afa5");e.exports=(e,a)=>{if(!Number.isFinite(e))throw new TypeError("Expected a finite number");if(a=a||{},e<1e3){const t="number"===typeof a.msDecimalDigits?a.msDecimalDigits:0;return(t?e.toFixed(t):Math.ceil(e))+(a.verbose?" "+s("millisecond",Math.ceil(e)):"ms")}const t=[],i=(e,n,i,o)=>{if(0===e)return;const r=a.verbose?" "+s(n,e):i;t.push((o||e)+r)},o=n(e);if(i(Math.trunc(o.days/365),"year","y"),i(o.days%365,"day","d"),i(o.hours,"hour","h"),i(o.minutes,"minute","m"),a.compact)return i(o.seconds,"second","s"),"~"+t[0];const r=e/1e3%60,c="number"===typeof a.secDecimalDigits?a.secDecimalDigits:1,l=r.toFixed(c).replace(/\.0$/,"");return i(r,"second","s",l),t.join(" ")}},a640:function(e,a,t){"use strict";var n=t("d039");e.exports=function(e,a){var t=[][e];return!!t&&n((function(){t.call(null,a||function(){throw 1},1)}))}},af03:function(e,a,t){var n=t("d039");e.exports=function(e){return n((function(){var a=""[e]('"');return a!==a.toLowerCase()||a.split('"').length>3}))}},afa5:function(e,a,t){"use strict";var n=t("86aa");e.exports=function(e,a,t){return"number"===typeof a&&(t=a),e in n?a=n[e]:"string"!==typeof a&&(a=(e.replace(/(?:s|x|z|ch|sh)$/i,"$&e").replace(/([^aeiou])y$/i,"$1ie")+"s").replace(/i?e?s$/i,(function(a){var t=e.slice(-1)===e.slice(-1).toLowerCase();return t?a.toLowerCase():a.toUpperCase()}))),1===t?e:a}},b79c:function(e,a,t){},c7cd:function(e,a,t){"use strict";var n=t("23e7"),s=t("857a"),i=t("af03");n({target:"String",proto:!0,forced:i("fixed")},{fixed:function(){return s(this,"tt","","")}})},d81d:function(e,a,t){"use strict";var n=t("23e7"),s=t("b727").map,i=t("1dde"),o=t("ae40"),r=i("map"),c=o("map");n({target:"Array",proto:!0,forced:!r||!c},{map:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},d9fd:function(e,a,t){"use strict";t("b79c")},fcc1:function(e,a,t){"use strict";t.r(a);var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("Row",{attrs:{gutter:10}},[t("Col",{attrs:{span:"10"}},[t("Input",{attrs:{prefix:"ios-search",placeholder:"请输入集群名"},on:{"on-enter":function(a){return e.showMore([e.queryParam.mhaNames],!0)}},model:{value:e.queryParam.mhaNames,callback:function(a){e.$set(e.queryParam,"mhaNames",a)},expression:"queryParam.mhaNames"}})],1),t("Col",{attrs:{span:"10"}},[t("Col",{attrs:{span:"3"}},[t("Button",{attrs:{type:"primary",icon:"ios-search",loading:e.dataLoading},on:{click:function(a){return e.showMore([e.queryParam.mhaNames],!0)}}},[e._v("查询所有")])],1)],1)],1),t("div",{ref:"myPage",staticStyle:{height:"calc(100vh - 35vh)",width:"calc(100vw - 20vw)"},on:{click:function(a){e.graphData.isShowNodeMenuPanel=!1,e.graphData.isShowNodeTipsPanel=!1,e.graphData.nodeMenuPanelPosition.fixed=!1}}},[t("RelationGraph",{ref:"seeksRelationGraph",attrs:{options:e.graphOptions,"on-node-click":e.onNodeClick,"on-line-click":e.onLineClick},scopedSlots:e._u([{key:"node",fn:function(a){var n=a.node;return t("div",{},[t("Tag",{staticStyle:{position:"absolute",width:"auto",height:"25px","margin-top":"-10px","margin-left":"15px","text-align":"center","font-size":"15px"},attrs:{color:"success"}},[e._v(e._s(n.data.mha.regionName))]),t("div",{staticStyle:{"font-weight":"bold",position:"absolute",width:"auto",height:"auto",left:"50%",top:"50%","-webkit-transform":"translate(-50%, -50%)",transform:"translate(-50%, -50%)","text-align":"center"}},[e._v(e._s(n.data.mha.name))])],1)}}])})],1),e.graphData.isShowNodeTipsPanel?t("div",{staticStyle:{"z-index":"999",padding:"10px","background-color":"#ffffff",border:"#eeeeee solid 1px","box-shadow":"0px 0px 8px #cccccc",position:"absolute"},style:{left:e.graphData.nodeMenuPanelPosition.x+"px",top:e.graphData.nodeMenuPanelPosition.y+"px"}},[t("div",{staticClass:"c-node-menu-item"},[e._v("名称: "+e._s(e.current.node.mha.name))]),t("div",{staticClass:"c-node-menu-item"},[e._v("部门: "+e._s(e.current.node.mha.buName))]),t("div",{staticClass:"c-node-menu-item"},[e._v("地域: "+e._s(e.current.node.mha.regionName))])]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.graphData.isShowNodeMenuPanel,expression:"graphData.isShowNodeMenuPanel"}],staticStyle:{"z-index":"999",padding:"10px","background-color":"#ffffff",border:"#eeeeee solid 1px","box-shadow":"0px 0px 8px #cccccc",position:"absolute"},style:{left:e.graphData.linkMenuPanelPosition.x+"px",top:e.graphData.linkMenuPanelPosition.y+"px"}},[t("div",{staticStyle:{"line-height":"25px","padding-left":"10px",color:"#888888","font-size":"12px"}},[e._v(e._s(e.current.link.srcMha.name+" -> "+e.current.link.dstMha.name))]),t("div",{staticStyle:{"line-height":"25px","padding-left":"10px",color:"#888888","font-size":"12px"}},[e._v("操作:")]),t("div",{attrs:{id:"operationsDiv"}},e._l(e.operations,(function(a,n){return t("div",{key:n},[t("div",{staticClass:"c-node-menu-item",on:{click:function(t){return t.stopPropagation(),a.method(e.current.link.srcMha.name,e.current.link.dstMha.name,e.current.link.replicationId)}}},[e._v(e._s(a.text))])])})),0)])],1)},s=[],i=(t("4de4"),t("a15b"),t("d81d"),t("b0c0"),t("4ec9"),t("d3b7"),t("6062"),t("3ca3"),t("c7cd"),t("9911"),t("159b"),t("ddb0"),t("a3b8")),o=t.n(i),r={name:"MhaGraph",components:{},props:{mhaIdList:Array,mhaNameList:Array,operations:Array},data:function(){return{dataLoading:!1,graphData:{graphInit:!1,graph:null,currentLink:null,mhaNameRequested:new Set,mhaNameShown:new Set,replicationIdShown:new Set,isShowNodeMenuPanel:!1,isShowNodeTipsPanel:!1,nodeMenuPanelPosition:{x:0,y:0,fixed:!1},linkMenuPanelPosition:{x:0,y:0},rootId:"",nodes:[],lines:[],clear:function(){this.nodes=[],this.lines=[]},reset:function(){this.graphInit=!1,this.mhaNameRequested.clear(),this.mhaNameShown.clear(),this.replicationIdShown.clear(),this.nodes=[],this.lines=[]},isEmpty:function(){return null==this.nodes||null==this.lines||0===this.nodes.length||0===this.lines.length},appendNode:function(e){this.mhaNameShown.has(e.name+"")||(this.mhaNameShown.add(e.name+""),this.nodes.push({id:e.id+"",text:e.name+"\n"+e.regionName,data:{mha:e},width:100,height:100,styleClass:"c-g-center"}))},appendLine:function(e){this.replicationIdShown.has(e.replicationId+"")||(this.replicationIdShown.add(e.replicationId+""),this.lines.push({from:e.srcMha.id+"",to:e.dstMha.id+"",selected:!0,color:"#2c2c2c",styleClass:"node-line",data:{replication:e}}))},appendDataToGraph:function(e){var a=this,t=this.graph;this.graphInit?t.appendJsonData(this,(function(e){console.log("refresh graph success")})):(this.graphInit=!0,t.setJsonData(this,(function(t){a.deepenClickedNode(null,e),console.log("init graph success")})))},hasShow:function(e){return!!this.mhaNameRequested.has(e)||(this.mhaNameRequested.add(e),!1)},deepenClickedNode:function(e,a){var t=this,n="rgb(0,166,81)";if(null!=e)e.color=n;else{var s=this.graph.getNodes();s.forEach((function(e){(a||t.mhaNameRequested.has(e.data.mha.name))&&(e.color=n)}))}}},graphOptions:{defaultLineColor:"#333333",defaultLineWidth:1,defaultNodeBorderWidth:1,defaultNodeShape:0,defaultNodeBorderColor:"rgb(194,194,194)",defaultNodeColor:"rgba(66,66,66)",allowSwitchLineShape:!0,allowSwitchNodeShape:!0,checkedLineColor:"rgba(30, 144, 255, 1)",defaultLineShape:1,moveToCenterWhenRefresh:!0,useAnimationWhenRefresh:!0,layouts:[{label:"自动布局",layoutName:"force",layoutClassName:"seeks-layout-force"}],defaultJunctionPoint:"border"},current:{node:{mha:{}},link:{srcMha:{},dstMha:{},replicationId:0}},queryParam:{mhaNames:""}}},mounted:function(){var e=this.mhaIdList,a=this.mhaNameList;console.log("mount mhaId: "+e),this.graphData.graph=this.$refs.seeksRelationGraph,this.graphData.rootId=e[0],this.showMore(a,!1)},methods:{showMore:function(e,a){var t=this;a?this.graphData.reset():this.graphData.clear();var n=e.filter((function(e){return!t.graphData.hasShow(e)}));if(null!=n&&0!==n.length){var s={relatedMhaNames:n.join(","),queryAll:a};this.dataLoading=!0,this.axios.get("/api/drc/v2/replication/queryMhaRelatedByNames",{params:s}).then((function(e){var n=e.data.data,s=null==n||!Array.isArray(n)||0===n.length;s?t.$Message.info("结果为空"):(n.forEach((function(e){t.graphData.appendNode(e.srcMha),t.graphData.appendNode(e.dstMha),t.graphData.appendLine(e)})),t.graphData.isEmpty()||(a&&t.$Message.success("查询成功"),t.graphData.appendDataToGraph(a),t.getDelay(n)))})).catch((function(e){console.log(e),t.$Message.error("查询异常: "+e)})).finally((function(){t.dataLoading=!1}))}},getDelay:function(e){var a=this,t={replicationIds:e.map((function(e){return e.replicationId})).join(",")};console.log(t),this.axios.get("/api/drc/v2/replication/delay",{params:t}).then((function(e){var t=e.data.data,n=null==t||!Array.isArray(t)||0===t.length;if(!n){var s=new Map(t.map((function(e){return[e.srcMha+"-"+e.dstMha,e.delay]}))),i=a.graphData.graph.getLinks();console.log(i),i.forEach((function(e){e.relations.forEach((function(e){var a=e.data.replication,t=s.get(a.srcMha.name+"-"+a.dstMha.name),n="rgb(3,119,63)",i=null;null!=t&&(console.log(t),i=o()(t,{compact:!0}),t>1e4&&(n="rgb(238,0,0)"),e.text=i,e.color=n)}))})),a.graphData.graph.getInstance().dataUpdated()}})).catch((function(e){console.log(e),a.$Message.error("查询延迟异常: "+e)}))},onNodeClick:function(e,a){var t=this;console.log("onNodeClick:",e,a),this.showMore([e.data.mha.name],!1),this.graphData.deepenClickedNode(e);var n=e.data.mha.name;this.$copyText(n).then((function(e){t.$Message.success("已复制 mha 名称: "+e.text),console.log(e)})),this.showNodeTips(e,a),this.graphData.nodeMenuPanelPosition.fixed=!0},onLineClick:function(e,a,t){console.log(e);var n=e.data.replication;this.current.link={srcMha:n.srcMha,dstMha:n.dstMha,replicationId:n.replicationId},this.showLineMenus(e,t)},showLineMenus:function(e,a){var t=this;if(null!=this.operations.length&&0!==this.operations.length){var n=this.$refs.myPage.getBoundingClientRect();this.graphData.linkMenuPanelPosition.x=a.clientX-n.x,this.graphData.linkMenuPanelPosition.y=a.clientY-n.y+30,console.log("showLineMenus:",a,n),setTimeout((function(){t.graphData.isShowNodeMenuPanel=!0}),10)}},showNodeTips:function(e,a){console.log("showNodeMenus:",e,a),this.current.node.mha=e.data.mha;var t=this.$refs.myPage.getBoundingClientRect();this.graphData.isShowNodeTipsPanel=!0,this.graphData.nodeMenuPanelPosition.x=a.clientX-t.x,this.graphData.nodeMenuPanelPosition.y=a.clientY-t.y+30},hideNodeTips:function(e,a){console.log("hideNodeTips:",e,a),this.graphData.nodeMenuPanelPosition.fixed||(this.graphData.isShowNodeTipsPanel=!1)}}},c=r,l=(t("d9fd"),t("2877")),h=Object(l["a"])(c,n,s,!1,null,"732eec18",null);a["default"]=h.exports}}]);
//# sourceMappingURL=chunk-5e52595a.313b81c1.js.map