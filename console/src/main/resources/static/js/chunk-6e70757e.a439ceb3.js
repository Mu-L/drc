(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e70757e"],{"00b4":function(e,t,r){"use strict";r("ac1f");var a=r("23e7"),n=r("c65b"),o=r("1626"),i=r("825a"),s=r("577e"),l=function(){var e=!1,t=/[ac]/;return t.exec=function(){return e=!0,/./.exec.apply(this,arguments)},!0===t.test("abc")&&e}(),c=/./.test;a({target:"RegExp",proto:!0,forced:!l},{test:function(e){var t=i(this),r=s(e),a=t.exec;if(!o(a))return n(c,t,r);var l=n(a,t,r);return null!==l&&(i(l),!0)}})},"06c5":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("a630"),r("fb6a"),r("b0c0"),r("d3b7"),r("ac1f"),r("00b4"),r("25f0"),r("3ca3");var a=r("6b75");function n(e,t){if(e){if("string"==typeof e)return Object(a["a"])(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Object(a["a"])(e,t):void 0}}},"0c47":function(e,t,r){"use strict";var a=r("cfe9"),n=r("d44e");n(a.JSON,"JSON",!0)},"107c":function(e,t,r){"use strict";var a=r("d039"),n=r("cfe9"),o=n.RegExp;e.exports=a((function(){var e=o("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},"131a":function(e,t,r){"use strict";var a=r("23e7"),n=r("d2bb");a({target:"Object",stat:!0},{setPrototypeOf:n})},"159b":function(e,t,r){"use strict";var a=r("cfe9"),n=r("fdbc"),o=r("785a"),i=r("17c2"),s=r("9112"),l=function(e){if(e&&e.forEach!==i)try{s(e,"forEach",i)}catch(t){e.forEach=i}};for(var c in n)n[c]&&l(a[c]&&a[c].prototype);l(o)},"17c2":function(e,t,r){"use strict";var a=r("b727").forEach,n=r("a640"),o=n("forEach");e.exports=o?[].forEach:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}},"1da1":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("d3b7");function a(e,t,r,a,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function s(e){a(i,n,o,s,l,"next",e)}function l(e){a(i,n,o,s,l,"throw",e)}s(void 0)}))}}},"1f68":function(e,t,r){"use strict";var a=r("83ab"),n=r("edd0"),o=r("861d"),i=r("1787"),s=r("7b0b"),l=r("1d80"),c=Object.getPrototypeOf,u=Object.setPrototypeOf,m=Object.prototype,d="__proto__";if(a&&c&&u&&!(d in m))try{n(m,d,{configurable:!0,get:function(){return c(s(this))},set:function(e){var t=l(this);i(e)&&o(t)&&u(t,e)}})}catch(f){}},"23dc":function(e,t,r){"use strict";var a=r("d44e");a(Math,"Math",!0)},2532:function(e,t,r){"use strict";var a=r("23e7"),n=r("e330"),o=r("5a34"),i=r("1d80"),s=r("577e"),l=r("ab13"),c=n("".indexOf);a({target:"String",proto:!0,forced:!l("includes")},{includes:function(e){return!!~c(s(i(this)),s(o(e)),arguments.length>1?arguments[1]:void 0)}})},"25f0":function(e,t,r){"use strict";var a=r("5e77").PROPER,n=r("cb2d"),o=r("825a"),i=r("577e"),s=r("d039"),l=r("90d8"),c="toString",u=RegExp.prototype,m=u[c],d=s((function(){return"/a/b"!==m.call({source:"a",flags:"b"})})),f=a&&m.name!==c;(d||f)&&n(u,c,(function(){var e=o(this),t=i(e.source),r=i(l(e));return"/"+t+"/"+r}),{unsafe:!0})},2909:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var a=r("6b75");function n(e){if(Array.isArray(e))return Object(a["a"])(e)}r("a4d3"),r("e01a"),r("d28b"),r("a630"),r("d3b7"),r("3ca3"),r("ddb0");function o(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var i=r("06c5");r("d9e2");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return n(e)||o(e)||Object(i["a"])(e)||s()}},3410:function(e,t,r){"use strict";var a=r("23e7"),n=r("d039"),o=r("7b0b"),i=r("e163"),s=r("e177"),l=n((function(){i(1)}));a({target:"Object",stat:!0,forced:l,sham:!s},{getPrototypeOf:function(e){return i(o(e))}})},"44e7":function(e,t,r){"use strict";var a=r("861d"),n=r("c6b6"),o=r("b622"),i=o("match");e.exports=function(e){var t;return a(e)&&(void 0!==(t=e[i])?!!t:"RegExp"===n(e))}},"4df4":function(e,t,r){"use strict";var a=r("0366"),n=r("c65b"),o=r("7b0b"),i=r("9bdd"),s=r("e95a"),l=r("68ee"),c=r("07fa"),u=r("8418"),m=r("9a1f"),d=r("35a1"),f=Array;e.exports=function(e){var t=o(e),r=l(this),h=arguments.length,g=h>1?arguments[1]:void 0,p=void 0!==g;p&&(g=a(g,h>2?arguments[2]:void 0));var b,v,I,y,w,x,C=d(t),k=0;if(!C||this===f&&s(C))for(b=c(t),v=r?new this(b):f(b);b>k;k++)x=p?g(t[k],k):t[k],u(v,k,x);else for(v=r?new this:[],y=m(t,C),w=y.next;!(I=n(w,y)).done;k++)x=p?i(y,g,[I.value,k],!0):I.value,u(v,k,x);return v.length=k,v}},"53ca":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("a4d3"),r("e01a"),r("d28b"),r("d3b7"),r("3ca3"),r("ddb0");function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}},"5a34":function(e,t,r){"use strict";var a=r("44e7"),n=TypeError;e.exports=function(e){if(a(e))throw new n("The method doesn't accept regular expressions");return e}},"6b75":function(e,t,r){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}r.d(t,"a",(function(){return a}))},"70f4":function(e,t,r){"use strict";r.r(t);r("b0c0");var a=function(){var e=this,t=e._self._c;return t("base-component",[t("Breadcrumb",{style:{margin:"15px 0 15px 185px",position:"fixed"}},[t("BreadcrumbItem",{attrs:{to:"/home"}},[e._v("首页")]),t("BreadcrumbItem",{attrs:{to:"/applicationForm"}},[e._v("DRC审批")]),t("BreadcrumbItem",{attrs:{to:"/v2/dbDrcBuild"}},[e._v("建立 DRC 同步")])],1),t("Content",{staticClass:"content",style:{padding:"10px",background:"#ffffff",margin:"50px 0 111px 185px",zIndex:"1"}},[t("Collapse",[t("Panel",{scopedSlots:e._u([{key:"content",fn:function(){return[t("Table",{attrs:{border:"",stripe:"",loading:e.mysqlConfig.dataLoading,columns:e.mysqlConfig.columns,data:e.mysqlConfig.data}})]},proxy:!0}])},[e._v(" mha配置预检测："),t("Tag",{attrs:{loading:e.mysqlConfig.dataLoading,type:e.mysqlConfig.result?"success":"volcano"},on:{click:e.preCheckMysqlConfig}},[e._v(e._s(e.mysqlConfig.resultStr))])],1)],1),t("Row",{attrs:{gutter:10,align:"middle"}},[t("Col",{attrs:{span:"13"}},[t("Form",{staticStyle:{"margin-right":"20px","margin-top":"10px"},attrs:{model:e.formItem,"label-width":100}},[t("FormItem",{attrs:{label:"配置模式",required:!0}},[t("Select",{attrs:{clearable:"",placeholder:"模式"},model:{value:e.formItem.buildMode,callback:function(t){e.$set(e.formItem,"buildMode",t)},expression:"formItem.buildMode"}},[t("Option",{attrs:{value:0}},[e._v("单库")]),t("Option",{attrs:{value:1}},[e._v("分库")]),t("Option",{attrs:{value:2}},[e._v("自定义多库")])],1)],1),0===e.formItem.buildMode?t("div",[t("FormItem",{attrs:{label:"数据库",required:!0}},[t("Select",{attrs:{filterable:"",placeholder:"请搜索数据库信息","remote-method":e.getExistDb,loading:e.dataLoading},on:{"on-change":e.selectDb},model:{value:e.formItem.dbName,callback:function(t){e.$set(e.formItem,"dbName",t)},expression:"formItem.dbName"}},e._l(e.meta.dbOptions,(function(r,a){return t("Option",{key:a,attrs:{value:r.dbName}},[e._v(" "+e._s(r.dbName)+" ")])})),1)],1)],1):e._e(),1===e.formItem.buildMode?t("div",[t("FormItem",{attrs:{label:"dalcluster",required:!0}},[t("Input",{attrs:{placeholder:"请输入 dalCluster 名称"},on:{"on-keydown":function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"]))return null;t.preventDefault()},"on-blur":e.afterEnterDalCluster},model:{value:e.formItem.dalClusterModeOption.dalClusterName,callback:function(t){e.$set(e.formItem.dalClusterModeOption,"dalClusterName",t)},expression:"formItem.dalClusterModeOption.dalClusterName"}})],1)],1):e._e(),2===e.formItem.buildMode?t("div",[t("FormItem",{attrs:{label:"数据库列表",required:!0}},[t("Input",{attrs:{placeholder:"请输入数据库列表，英文逗号分隔"},on:{"on-keydown":function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"]))return null;t.preventDefault()},"on-blur":e.afterEnterDalCluster},model:{value:e.formItem.dbName,callback:function(t){e.$set(e.formItem,"dbName",t)},expression:"formItem.dbName"}})],1)],1):e._e(),t("FormItem",{attrs:{label:"同步方向",required:!0}},[t("Row",[t("Col",{attrs:{span:"11"}},[t("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[t("Icon",{attrs:{type:"ios-pin"}}),e._v(" 源 region ")]},proxy:!0}])},[t("FormItem",[t("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.srcRegionName,callback:function(t){e.$set(e.formItem,"srcRegionName",t)},expression:"formItem.srcRegionName"}},e._l(e.meta.regionOptions,(function(r){return t("Option",{key:r,attrs:{value:r,label:r}},[e._v(" "+e._s(r)+" ")])})),1)],1)],1)],1),t("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[t("Button",{attrs:{size:"small",shape:"circle",type:"default",loading:e.dataLoading},on:{click:e.getRegionOptions}},[e._v(" -> ")])],1),t("Col",{attrs:{span:"11"}},[t("Card",{attrs:{bordered:!0},scopedSlots:e._u([{key:"title",fn:function(){return[t("Icon",{attrs:{type:"ios-pin"}}),e._v(" 目标 region ")]},proxy:!0}])},[t("FormItem",[t("Select",{attrs:{filterable:"",clearable:"",placeholder:"地域"},on:{"on-change":e.afterSwitchRegion},model:{value:e.formItem.dstRegionName,callback:function(t){e.$set(e.formItem,"dstRegionName",t)},expression:"formItem.dstRegionName"}},e._l(e.meta.regionOptions,(function(r){return t("Option",{key:r,attrs:{value:r,label:r}},[e._v(" "+e._s(r)+" ")])})),1)],1)],1)],1)],1)],1),t("FormItem",{attrs:{label:"同步表",required:!0}},[t("Input",{attrs:{placeholder:"请输入正则表达式"},on:{"on-keydown":function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"]))return null;t.preventDefault()},"on-blur":e.afterEnterTableName},model:{value:e.formItem.tableName,callback:function(t){e.$set(e.formItem,"tableName",t)},expression:"formItem.tableName"}})],1),t("FormItem",{attrs:{label:"行过滤"}},[t("i-switch",{attrs:{size:"large"},scopedSlots:e._u([{key:"open",fn:function(){return[t("span",[e._v("On")])]},proxy:!0},{key:"close",fn:function(){return[t("span",[e._v("Off")])]},proxy:!0}]),model:{value:e.formItem.switch.rowsFilter,callback:function(t){e.$set(e.formItem.switch,"rowsFilter",t)},expression:"formItem.switch.rowsFilter"}})],1),e.formItem.switch.rowsFilter?t("Card",{staticStyle:{"margin-left":"100px"},scopedSlots:e._u([{key:"title",fn:function(){return[t("Icon",{attrs:{type:"md-settings"}}),e._v(" 行过滤配置 "),t("Button",{staticStyle:{"margin-left":"50px"},attrs:{icon:"ios-refresh",size:"small",type:"primary",loading:e.commonColumnLoading},on:{click:e.getCommonColumns}},[e._v("获取公共字段 ")])]},proxy:!0}],null,!1,571298879)},[t("FormItem",{attrs:{label:"模式"}},[t("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择行过滤模式"},model:{value:e.formItem.rowsFilterDetail.mode,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"mode",t)},expression:"formItem.rowsFilterDetail.mode"}},e._l(e.formItem.constants.rowsFilter.modes,(function(r){return t("Option",{key:r.mode,attrs:{value:r.mode}},[e._v(" "+e._s(r.name)+" ")])})),1)],1),e.useTripUdlOrUidMode?t("div",[e.fillContextByRegion?t("FormItem",{attrs:{label:"规则内容"}},[t("Select",{staticStyle:{width:"200px"},attrs:{multiple:"",placeholder:"Region 选择"},model:{value:e.formItem.constants.rowsFilter.configInTripUid.regionsChosen,callback:function(t){e.$set(e.formItem.constants.rowsFilter.configInTripUid,"regionsChosen",t)},expression:"formItem.constants.rowsFilter.configInTripUid.regionsChosen"}},e._l(e.formItem.constants.rowsFilter.regionsForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(" "+e._s(r)+" ")])})),1)],1):e._e(),e.showUdlConfigDetail?t("div",[t("Divider",[e._v("UDL配置")]),t("FormItem",{attrs:{label:"UDL字段"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"不选默认则无UDL配置"},model:{value:e.formItem.rowsFilterDetail.udlColumns,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"udlColumns",t)},expression:"formItem.rowsFilterDetail.udlColumns"}},e._l(e.formItem.constants.columnsForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r)+" ")])})),1)],1),e.hasUdlColumn?t("FormItem",{attrs:{label:"DRC UDL策略id"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"请选择ucs策略id"},model:{value:e.formItem.rowsFilterDetail.drcStrategyId,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"drcStrategyId",t)},expression:"formItem.rowsFilterDetail.drcStrategyId"}},e._l(e.formItem.constants.rowsFilter.drcStrategyIdsForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r)+" ")])})),1)],1):e._e()],1):e._e(),e.showUidConfigDetail?t("div",[t("Divider",[e._v("UID配置")]),t("FormItem",{attrs:{label:"UID字段"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"不选默认则无UID配置"},model:{value:e.formItem.rowsFilterDetail.columns,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"columns",t)},expression:"formItem.rowsFilterDetail.columns"}},e._l(e.formItem.constants.columnsForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r)+" ")])})),1)],1),e.hasUidColumn?t("FormItem",{attrs:{label:"fetchMode"}},[t("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择"},on:{"on-change":function(t){return e.fetchModeChange()}},model:{value:e.formItem.rowsFilterDetail.fetchMode,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"fetchMode",t)},expression:"formItem.rowsFilterDetail.fetchMode"}},e._l(e.formItem.constants.rowsFilter.fetchModeForChose,(function(r){return t("Option",{key:r.k,attrs:{value:r.v}},[e._v(" "+e._s(r.k)+" ")])})),1)],1):e._e(),e.hasUidColumn?t("FormItem",{attrs:{label:"空处理"}},[t("Checkbox",{model:{value:e.formItem.rowsFilterDetail.illegalArgument,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"illegalArgument",t)},expression:"formItem.rowsFilterDetail.illegalArgument"}},[e._v("【字段为空时】同步")])],1):e._e()],1):e._e()],1):e.useCustomSoaMode?t("div",[t("FormItem",{attrs:{label:"相关字段"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"选择相关字段"},on:{"on-create":e.handleCreateColumn},model:{value:e.formItem.rowsFilterDetail.columns,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"columns",t)},expression:"formItem.rowsFilterDetail.columns"}},e._l(e.formItem.constants.columnsForChose,(function(e){return t("Option",{key:e,attrs:{value:e,lable:e}})})),1)],1),t("FormItem",{attrs:{label:"ServiceCode"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"请选择soaServiceCode"},on:{"on-create":e.handleCreateSoaServiceCode},model:{value:e.formItem.rowsFilterDetail.drcStrategyId,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"drcStrategyId",t)},expression:"formItem.rowsFilterDetail.drcStrategyId"}},e._l(e.formItem.constants.serviceCodeForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r)+" ")])})),1)],1),t("FormItem",{attrs:{label:"服务名"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"请选择服务名"},on:{"on-create":e.handleCreateSoaServiceName},model:{value:e.formItem.rowsFilterDetail.context,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"context",t)},expression:"formItem.rowsFilterDetail.context"}},e._l(e.formItem.constants.serviceNameForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r)+" ")])})),1)],1)],1):t("div",[t("FormItem",{attrs:{label:"规则内容"}},[t("Input",{staticStyle:{width:"250px"},attrs:{type:"textarea",placeholder:"请输入行过滤内容"},model:{value:e.formItem.rowsFilterDetail.context,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"context",t)},expression:"formItem.rowsFilterDetail.context"}})],1),t("FormItem",{attrs:{label:"相关字段"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"选择相关字段"},model:{value:e.formItem.rowsFilterDetail.columns,callback:function(t){e.$set(e.formItem.rowsFilterDetail,"columns",t)},expression:"formItem.rowsFilterDetail.columns"}},e._l(e.formItem.constants.columnsForChose,(function(e){return t("Option",{key:e,attrs:{value:e,lable:e}})})),1)],1)],1)],1):e._e(),t("FormItem",{attrs:{label:"列过滤"}},[t("i-switch",{attrs:{size:"large"},scopedSlots:e._u([{key:"open",fn:function(){return[t("span",[e._v("On")])]},proxy:!0},{key:"close",fn:function(){return[t("span",[e._v("Off")])]},proxy:!0}]),model:{value:e.formItem.switch.colsFilter,callback:function(t){e.$set(e.formItem.switch,"colsFilter",t)},expression:"formItem.switch.colsFilter"}})],1),e.formItem.switch.colsFilter?t("Card",{staticStyle:{"margin-left":"100px"},scopedSlots:e._u([{key:"title",fn:function(){return[t("Icon",{attrs:{type:"md-settings"}}),e._v(" 列过滤配置 "),t("Button",{staticStyle:{"margin-left":"50px"},attrs:{icon:"ios-refresh",size:"small",type:"primary",loading:e.commonColumnLoading},on:{click:e.getCommonColumns}},[e._v("获取公共字段 ")])]},proxy:!0}],null,!1,2228726756)},[t("FormItem",{attrs:{label:"模式"}},[t("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择字段过滤模式"},model:{value:e.formItem.colsFilterDetail.mode,callback:function(t){e.$set(e.formItem.colsFilterDetail,"mode",t)},expression:"formItem.colsFilterDetail.mode"}},e._l(e.formItem.constants.colsFilter.modes,(function(r){return t("Option",{key:r.mode,attrs:{value:r.mode}},[e._v(" "+e._s(r.name)+" ")])})),1)],1),t("FormItem",{attrs:{label:"字段"}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"选择相关的字段"},on:{"on-create":e.handleCreateColumn},model:{value:e.formItem.colsFilterDetail.columns,callback:function(t){e.$set(e.formItem.colsFilterDetail,"columns",t)},expression:"formItem.colsFilterDetail.columns"}},e._l(e.formItem.constants.columnsForChose,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r)+" ")])})),1)],1)],1):e._e(),t("FormItem",{attrs:{label:"业务部门",required:!0}},[t("Select",{attrs:{filterable:"",prefix:"ios-home",clearable:"",placeholder:"部门"},on:{"on-change":e.autoSetTag},model:{value:e.formItem.buName,callback:function(t){e.$set(e.formItem,"buName",t)},expression:"formItem.buName"}},e._l(e.meta.bus,(function(r){return t("Option",{key:r.buName,attrs:{value:r.buName}},[e._v(e._s(r.buName))])})),1)],1),t("FormItem",{attrs:{label:"Tag",prop:"tag",required:!0}},[t("Select",{staticStyle:{width:"200px"},attrs:{filterable:"","allow-create":"",placeholder:"选择tag"},on:{"on-create":e.handleCreateTag},model:{value:e.formItem.tag,callback:function(t){e.$set(e.formItem,"tag",t)},expression:"formItem.tag"}},e._l(e.meta.tags,(function(r){return t("Option",{key:r,attrs:{value:r}},[e._v(e._s(r))])})),1)],1),e.gtidConfigurable?t("FormItem",{attrs:{label:"初始同步位点",prop:"gtidInit"}},[t("Input",{staticStyle:{width:"80%","margin-right":"10px"},attrs:{border:!1,placeholder:"请输入binlog拉取位点"},model:{value:e.formItem.gtidInit,callback:function(t){e.$set(e.formItem,"gtidInit",t)},expression:"formItem.gtidInit"}}),t("Button",{attrs:{type:"success"},on:{click:e.querySrcMhaGtidCheckRes}},[e._v("位点校验")])],1):e._e(),t("FormItem",[t("Button",{attrs:{type:"primary",loading:e.dataLoading,disabled:0===e.previewDataList.length||!e.formItem.tableName},on:{click:e.beforeSubmit}},[e._v("提交 ")])],1)],1)],1),t("Col",{attrs:{span:"11"}},[t("Divider",[e._v("预览：同步集群")]),t("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.table.dbMhaTableLoading},on:{click:e.getDalInfo}},[e._v(" 检查同步集群 ")]),t("Table",{attrs:{size:"small",loading:e.table.dbMhaTableLoading,stripe:"",columns:e.table.dbMhaTableColumn,data:e.preCheckMhaReplicationPage,border:""}}),t("div",[t("Page",{attrs:{transfer:!0,total:e.previewDataList.length,current:e.table.dbMhaTablePage.current,"page-size-opts":e.table.dbMhaTablePage.pageSizeOpts,"page-size":e.table.dbMhaTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbMhaTablePage,"current",t)},"on-page-size-change":function(t){e.table.dbMhaTablePage.size=t}}})],1),t("Divider",{staticStyle:{"margin-top":"50px"}},[e._v("预览：同步表")]),t("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",loading:e.table.dbTableLoading},on:{click:e.getTableInfo}},[e._v(" 检查同步表 ")]),t("Table",{attrs:{size:"small",loading:e.table.dbTableLoading,stripe:"",columns:e.table.dbTableColumn,data:e.preCheckTablePage,border:""}}),t("div",[t("Page",{attrs:{transfer:!0,total:e.checkTableDataList.length,current:e.table.dbTablePage.current,"page-size-opts":e.table.dbTablePage.pageSizeOpts,"page-size":e.table.dbTablePage.size,"show-total":"","show-sizer":"","show-elevator":""},on:{"update:current":function(t){return e.$set(e.table.dbTablePage,"current",t)},"on-page-size-change":function(t){e.table.dbTablePage=t}}})],1)],1)],1),t("Modal",{attrs:{title:"gitd位点校验结果",width:"900px"},model:{value:e.gtidCheck.modal,callback:function(t){e.$set(e.gtidCheck,"modal",t)},expression:"gtidCheck.modal"}},[t("Form",{staticStyle:{width:"80%"}},[t("FormItem",{attrs:{label:"校验结果"}},[t("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.legal,callback:function(t){e.$set(e.gtidCheck.resVo,"legal",t)},expression:"gtidCheck.resVo.legal"}})],1),t("FormItem",{attrs:{label:"当前Mha"}},[t("Input",{attrs:{autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.mha,callback:function(t){e.$set(e.gtidCheck.resVo,"mha",t)},expression:"gtidCheck.resVo.mha"}})],1),t("FormItem",{attrs:{label:"配置位点"}},[t("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.configGtid,callback:function(t){e.$set(e.gtidCheck.resVo,"configGtid",t)},expression:"gtidCheck.resVo.configGtid"}})],1),t("FormItem",{attrs:{label:"purgedGtid"}},[t("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:30},readonly:""},model:{value:e.gtidCheck.resVo.purgedGtid,callback:function(t){e.$set(e.gtidCheck.resVo,"purgedGtid",t)},expression:"gtidCheck.resVo.purgedGtid"}})],1)],1)],1),t("Drawer",{attrs:{title:"请确认同步信息",width:"80","mask-closable":!1},model:{value:e.drawer.show,callback:function(t){e.$set(e.drawer,"show",t)},expression:"drawer.show"}},[e.alertInfo.show?t("Alert",{attrs:{type:"warning","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),e.alertInfo.successShow?t("Alert",{attrs:{type:"success","show-icon":"",closable:""},scopedSlots:e._u([{key:"desc",fn:function(){return[e._v(e._s(e.alertInfo.message))]},proxy:!0}],null,!1,3041357252)},[e._v(" "+e._s(e.alertInfo.title)+" ")]):e._e(),t("Table",{attrs:{size:"small",loading:e.dataLoading,stripe:"",border:"",columns:e.drawer.tableColumns,data:e.finalBuildParam}}),t("div",{staticClass:"drawer-footer"},[t("Divider"),t("Button",{staticStyle:{"margin-right":"8px"},on:{click:function(t){e.drawer.show=!1}}},[e._v("关闭")]),t("Button",{directives:[{name:"show",rawName:"v-show",value:!e.successSubmit,expression:"!successSubmit"}],attrs:{type:"primary",loading:e.dataLoading},on:{click:e.submitAll}},[e._v("审批通过")])],1)],1)],1)],1)},n=[],o=r("2909"),i=r("53ca"),s=r("c7eb"),l=r("1da1"),c=(r("4de4"),r("caad"),r("a15b"),r("d81d"),r("14d9"),r("fb6a"),r("d3b7"),r("2532"),r("159b"),{data:function(){var e=this;return{mhaAccountInited:!1,mysqlConfig:{dataLoading:!1,result:!1,resultStr:"",data:[],columns:[{title:"集群名",key:"mha"},{title:"BINLOG_MODE [ON]",key:"binlogMode"},{title:"BINLOG_FORMAT [ROW]",key:"binlogFormat"},{title:"BINLOG_VERSION [OFF]",key:"binlogVersion1"},{title:"BTD [WRITESET]",key:"binlogTransactionDependency"},{title:"BTDHS [100000]",key:"binlogTransactionDependencyHistorySize"},{title:"BINLOG_ROW_IMAGE [FULL]",key:"binlogRowImage"},{title:"GTID_MODE [ON]",key:"gtidMode"},{title:"AUTO_INCREMENT_STEP",key:"autoIncrementStep"},{title:"AUTO_INCREMENT_OFFSET",key:"autoIncrementOffset"},{title:"DRC_ACCOUNT [three accounts ready]",key:"drcAccounts"},{title:"结果",key:"result",render:function(e,t){var r=t.row,a=r.result?"green":"volcano",n=r.result?"合格":"不合格";return e("Tag",{props:{color:a}},n)}}]},applicationFormId:null,formItem:{buildMode:0,srcRegionName:null,dstRegionName:null,dbName:null,dalClusterModeOption:{dalClusterName:null},buName:null,tag:"COMMON",tableName:null,rowsFilterDetail:{mode:1,drcStrategyId:0,routeStrategyId:0,udlColumns:[],columns:[],context:"",illegalArgument:!1,fetchMode:0},colsFilterDetail:{mode:null,columns:[]},gtidInit:"",textarea:"",switch:{rowsFilter:!1,colsFilter:!1},constants:{rowsFilter:{configInTripUid:{regionsChosen:[]},filterMode:{JAVA_REGEX:0,TRIP_UDL:1,AVIATOR_REGEX:3,TRIP_UDL_UID:5,CUSTOM_SOA:6},fetchMode:{RPC:0,BlackList:1,WhiteList:2,BlackList_Global:3},modes:[{name:"trip_udl",mode:1},{name:"java_regex",mode:0},{name:"aviator_regex",mode:3},{name:"trip_udl_uid",mode:5},{name:"custom_soa",mode:6}],regionsForChose:["SGP","SIN","SH","FRA"],drcStrategyIdsForChose:[2000000002],fetchModeForChose:[{k:"RPC调用",v:0},{k:"BlackList",v:1},{k:"WhiteList",v:2},{k:"BlackListGlobal",v:3}]},colsFilter:{modes:[{name:"exclude",mode:0},{name:"include",mode:1},{name:"regex",mode:2}]},columnsForChose:[],serviceCodeForChose:[32578],serviceNameForChose:["DataSyncService","FilterRowService"]}},gtidCheck:{modal:!1,resVo:{mha:"",legal:"",configGtid:"",purgedGtid:""}},meta:{bus:[],regions:[],regionOptions:[],dbOptions:[],tags:this.constant.tagList,selectedDb:{}},drawer:{show:!1,tableColumns:[{title:"状态（点击查看详情）",key:"status",width:200,align:"center",render:function(t,r){var a,n,o=r.row,i=o.viewOnlyInfo.drcStatus,c=-1===i;return 1===i?(n="已接入",a="primary"):(n="未接入",a="default"),t("div",[t("Button",{on:{click:function(){var t=Object(l["a"])(Object(s["a"])().mark((function t(){var r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.$router.resolve({path:"/drcV2",query:{step:3,srcMhaName:o.srcMhaName,dstMhaName:o.dstMhaName}}),window.open(r.href,"_blank");case 2:case"end":return t.stop()}}),t)})));function r(){return t.apply(this,arguments)}return r}()},props:{type:a,disabled:c,icon:"ios-open-outline"}},n)])}},{title:"源集群",key:"srcMhaName",render:function(e,t){var r=t.row,a=r.srcMhaName,n=r.srcDcName;return e("div",[e("span",a),e("span",{style:{float:"right",color:"#ababab"}},n)])}},{title:"目标集群",key:"srcMhaName",render:function(e,t){var r=t.row,a=r.dstMhaName,n=r.dstDcName;return e("div",[e("span",a),e("span",{style:{float:"right",color:"#ababab"}},n)])}},{title:"BU",key:"buName"},{title:"表过滤",key:"tableFilter"},{title:"DB名",key:"dbName",render:function(e,t){var r=t.row,a=r.dbName.join("\r\n");return e("div",{style:{"white-space":"pre-wrap"}},a)}}]},alertInfo:{show:!1,successShow:!1,title:null,message:null},dbClusterInfoList:[],finalBuildParam:[],previewDataList:[],checkTableDataList:[],table:{dbMhaTableLoading:!1,dbMhaTableColumn:[{title:"DB名",key:"dbName"},{title:"源集群",key:"srcMhaName",render:function(e,t){var r=t.row,a=r.srcMha;if(null!=a)return e("div",[e("span",a.name),e("span",{style:{float:"right",color:"#ababab"}},a.regionName+"("+a.dcName+")")])}},{title:"目标集群",key:"dstMhaName",render:function(e,t){var r=t.row,a=r.dstMha;if(null!=a)return e("div",[e("span",a.name),e("span",{style:{float:"right",color:"#ababab"}},a.regionName+"("+a.dcName+")")])}}],dbMhaTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]},dbTableLoading:!1,dbTableColumn:[{title:"序号",width:75,align:"center",fixed:"left",render:function(e,t){return e("span",t.index+1)}},{title:"库名",key:"schema",resizable:!0},{title:"表名",key:"table",resizable:!0},{title:"结果",align:"center",render:function(e,t){var r=t.row,a="ok"!==r.res?"volcano":"green",n=r.res;return e("Tag",{props:{color:a}},n)}}],dbTablePage:{total:0,current:1,size:5,pageSizeOpts:[5,10,20,100]}},dataLoading:!1,successSubmit:!1,commonColumnLoading:!1}},methods:{getBus:function(){var e=this;this.axios.get("/api/drc/v2/meta/bus/all").then((function(t){e.meta.bus=t.data.data}))},getRegions:function(){var e=this;this.axios.get("/api/drc/v2/meta/regions/all").then((function(t){e.meta.regions=t.data.data.map((function(e){return e.regionName})),e.meta.regionOptions=e.meta.regions}))},getParams:function(){var e={};return e.applicationFormId=this.applicationFormId,e.buName=this.formItem.buName,e.tag=this.formItem.tag,e.mode=this.formItem.buildMode,e.srcRegionName=this.formItem.srcRegionName,e.dstRegionName=this.formItem.dstRegionName,this.gtidConfigurable&&(e.gtidInit=this.formItem.gtidInit),e.tblsFilterDetail={tableNames:this.formItem.tableName},0===this.formItem.buildMode?e.dbName=this.formItem.dbName:1===this.formItem.buildMode?e.dalClusterName=this.formItem.dalClusterModeOption.dalClusterName:2===this.formItem.buildMode&&(e.dbName=this.formItem.dbName),this.formItem.switch.rowsFilter&&(this.useTripUdlOrUidMode&&(this.fillContextByRegion?this.formItem.rowsFilterDetail.context=this.formItem.constants.rowsFilter.configInTripUid.regionsChosen.join(","):this.formItem.rowsFilterDetail.context="//filter by config"),e.openRowsFilterConfig=!0,e.rowsFilterDetail=this.formItem.rowsFilterDetail),this.formItem.switch.colsFilter&&(e.openColsFilterConfig=!0,e.colsFilterDetail=this.formItem.colsFilterDetail),e},submitAll:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e,r.dataLoading=!0,r.alertInfo.show=!1,r.alertInfo.successShow=!1,r.successSubmit=!1,a=e.getParams(),e.checkParam(a)){t.next=8;break}return t.abrupt("return");case 8:return console.log(a),t.next=11,r.axios.post("/api/drc/v2/autoconfig/applicationForm/submit",a).then((function(t){var a=t.data,n=1!==a.status;n?(r.$Message.success("提交成功"),e.preCheckBuildParam(),r.successSubmit=!0,r.alertInfo.successShow=!0,r.alertInfo.message=null,r.alertInfo.title="提交成功"):(r.$Message.warning("提交失败: "+a.message),r.alertInfo.show=!0,r.alertInfo.title="提交失败",r.alertInfo.message=a.message)})).catch((function(e){r.$Message.error("提交异常: "+e)})).finally((function(){r.dataLoading=!1}));case 11:case"end":return t.stop()}}),t)})))()},selectDb:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.formItem.dbName,console.log(r),e.meta.selectedDb=e.meta.dbOptions.filter((function(e){return e.dbName===r}))[0],console.log("selected",e.meta.selectedDb),e.formItem.buName=e.meta.selectedDb.buCode,console.log("selected",e.formItem.tableName),e.autoSetTag(),t.next=9,e.getRegionOptions();case 9:if(!e.formItem.srcRegionName||!e.formItem.dstRegionName){t.next=12;break}return t.next=12,e.getDalInfo();case 12:case"end":return t.stop()}}),t)})))()},autoSetTag:function(){"FLT"===this.formItem.buName?this.formItem.tag="FLT":"HTL"===this.formItem.buName?this.formItem.tag="HTL":this.formItem.tag="COMMON"},getDalInfo:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.getParams(),a=e,a.previewDataList=[],a.table.dbMhaTablePage.current=1,a.table.dbMhaTableLoading=!0,t.next=7,a.mhaInitBeforeBuild();case 7:if(e.necessaryParamsCheck()){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,a.axios.get("/api/drc/v2/autoconfig/preCheck",{params:{mode:r.mode,dbName:r.dbName,dalClusterName:r.dalClusterName,srcRegionName:r.srcRegionName,dstRegionName:r.dstRegionName}}).then((function(t){var r=t.data.data,n=r&&0===t.data.status;n?(a.previewDataList=r,console.log("total: "+a.previewDataList.length),a.$Message.success("同步集群检测成功, 共找到 "+r.length+" 个DB"),e.preCheckMysqlConfig()):a.$Message.warning("同步集群检测失败："+t.data.message)})).catch((function(e){a.$Message.error("查询dalcluster异常: "+e)})).finally((function(){a.table.dbMhaTableLoading=!1}));case 11:case"end":return t.stop()}}),t)})))()},getTableInfo:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.getParams(),a=e,a.checkTableDataList=[],a.table.dbTablePage.current=1,r.tblsFilterDetail.tableNames){t.next=8;break}return console.log(r),e.$Message.warning("请先填写表名"),t.abrupt("return");case 8:if(e.necessaryParamsCheck()){t.next=10;break}return t.abrupt("return");case 10:return a.table.dbTableLoading=!0,t.next=13,a.axios.get("/api/drc/v2/autoconfig/preCheckTable",{params:e.flattenObj({mode:r.mode,dbName:r.dbName,dalClusterName:r.dalClusterName,srcRegionName:r.srcRegionName,dstRegionName:r.dstRegionName,tblsFilterDetail:r.tblsFilterDetail})}).then((function(e){var t=e.data.data;t?(a.checkTableDataList=t,console.log("total: "+a.checkTableDataList.length),a.$Message.success("同步表检测成功, 共找到 "+t.length+" 个表")):a.$Message.warning("同步表检测失败："+e.data.message)})).catch((function(e){a.$Message.error("查询dalcluster异常: "+e)})).finally((function(){a.table.dbTableLoading=!1}));case 13:case"end":return t.stop()}}),t)})))()},preCheckBuildParam:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.getParams(),e.checkParam(r)){t.next=3;break}return t.abrupt("return");case 3:return a=e,a.dataLoading=!0,a.finalBuildParam=[],a.alertInfo.show=!1,a.alertInfo.successShow=!1,a.successSubmit=!1,console.log("precheckParam",r),t.next=12,a.axios.post("/api/drc/v2/autoconfig/preCheckBuildParam",r).then((function(e){var t=e.data.data;t?(a.drawer.show=!0,a.finalBuildParam=t,a.$Message.success("预检测成功, 共 "+t.length+" 个集群")):(a.drawer.show=!1,a.$Message.warning("预检测失败: "+e.data.message))})).catch((function(e){a.$Message.error("查询dalcluster异常: "+e)})).finally((function(){a.dataLoading=!1}));case 12:case"end":return t.stop()}}),t)})))()},afterSwitchRegion:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.getParams(),r.srcRegionName&&r.dstRegionName){t.next=3;break}return t.abrupt("return");case 3:return e.mhaAccountInited=!1,t.next=6,e.mhaInitBeforeBuild();case 6:e.getDalInfo();case 7:case"end":return t.stop()}}),t)})))()},afterEnterTableName:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getTableInfo();case 2:case"end":return t.stop()}}),t)})))()},afterEnterDalCluster:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getRegionOptions();case 2:case"end":return t.stop()}}),t)})))()},getRegionOptions:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,r.dataLoading=!0,r.previewDataList=[],r.meta.regionOptions=[],a=e.getParams(),t.next=7,r.axios.get("/api/drc/v2/autoconfig/regionOptions",{params:{mode:a.mode,dbName:a.dbName,dalClusterName:a.dalClusterName}}).then((function(e){var t=e.data.data,a=t&&0===e.data.status;a?(r.meta.regionOptions=t,-1===t.indexOf(r.formItem.srcRegionName)&&(r.formItem.srcRegionName=null),-1===t.indexOf(r.formItem.dstRegionName)&&(r.formItem.dstRegionName=null),r.$Message.success("查询到 "+r.meta.regionOptions.length+" 个可选区域"),console.log("total selectable region: "+r.meta.regionOptions.length)):(r.formItem.srcRegionName=null,r.formItem.dstRegionName=null,r.$Message.warning("查询可选地域失败"))})).catch((function(e){r.$Message.error("查询可选地域失败: "+e)})).finally((function(){r.dataLoading=!1}));case 7:return t.next=9,e.getDalInfo();case 9:case"end":return t.stop()}}),t)})))()},getExistDb:function(e){var t=this;return Object(l["a"])(Object(s["a"])().mark((function r(){var a;return Object(s["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(null===e||null===e.length||e.length<=4)){r.next=2;break}return r.abrupt("return",[]);case 2:return a=t,a.dataLoading=!0,a.dbClusterInfoList=[],r.next=7,a.axios.get("/api/drc/v2/autoconfig/getExistDb",{params:{dbName:e}}).then((function(e){var t=e.data.data;t?a.meta.dbOptions=t:a.$Message.warning("查询DB失败")})).catch((function(e){a.$Message.error("查询DB异常: "+e)})).finally((function(){a.dataLoading=!1}));case 7:case"end":return r.stop()}}),r)})))()},fetchModeChange:function(){this.formItem.rowsFilterDetail.illegalArgument=1===this.formItem.rowsFilterDetail.fetchMode||3===this.formItem.rowsFilterDetail.fetchMode},beforeSubmit:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.preCheckBuildParam();case 2:case"end":return t.stop()}}),t)})))()},mhaInitBeforeBuild:function(){var e=this;return Object(l["a"])(Object(s["a"])().mark((function t(){var r,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.getParams(),a=e,e.mhaAccountInited=!1,0!==r.mode){t.next=9;break}if(r.dbName){t.next=7;break}return e.$Message.warning("请先填写数据库"),t.abrupt("return");case 7:t.next=13;break;case 9:if(1!==r.mode){t.next=13;break}if(r.dalClusterName){t.next=13;break}return e.$Message.warning("请先填写 dalcluster"),t.abrupt("return");case 13:if(r.srcRegionName&&r.dstRegionName){t.next=16;break}return e.$Message.warning("请先填写同步方向"),t.abrupt("return");case 16:return t.next=18,a.axios.post("/api/drc/v2/autoconfig/mhaInitBeforeBuild",r).then((function(t){var r=0===t.data.status;console.log("mhaInitBeforeBuild",r),r?(e.mhaAccountInited=!0,a.$Message.success("MySQL集群账号初始化成功")):(e.mhaAccountInited=!1,a.$Message.warning("MySQL集群账号初始化失败："+t.data.message))})).catch((function(e){a.$Message.error("查询DB异常: "+e)})).finally((function(){}));case 18:case"end":return t.stop()}}),t)})))()},getCommonColumns:function(e){var t=this,r=this.getParams();if(!r.tblsFilterDetail.tableNames)return console.log(r),void this.$Message.warning("请先填写表名");this.necessaryParamsCheck()&&(r.rowsFilterDetail&&(r.rowsFilterDetail.columns=[],r.rowsFilterDetail.udlColumns=[]),r.colsFilterDetail&&(r.colsFilterDetail.columns=[]),console.log(r),this.formItem.constants.columnsForChose=[],this.commonColumnLoading=!0,this.axios.get("/api/drc/v2/autoconfig/commonColumns",{params:this.flattenObj(r)}).then((function(r){1===r.data.status?t.$Message.error("查询公共列名失败，请手动添加："+r.data.message):(console.log(r.data.data),t.formItem.constants.columnsForChose=r.data.data,t.$Message.info("查询公共列名数："+r.data.data.length),"UDL"===e&&(t.formItem.constants.columnsForChose.includes("userdata_location")?(t.formItem.rowsFilterDetail.udlColumns=["userdata_location"],t.formItem.constants.rowsFilter.configInTripUid.regionsChosen="SGP",t.formItem.rowsFilterDetail.drcStrategyId=t.formItem.constants.rowsFilter.drcStrategyIdsForChose[0]):t.$Message.warning("公共列不包含userdata_location字段")))})).catch((function(e){t.$Message.error("查询公共列名异常: "+e)})).finally((function(){t.commonColumnLoading=!1})))},querySrcMhaGtidCheckRes:function(){var e=this,t=this.formItem.gtidInit,r=this.previewDataList[0].srcMha.name;null!=t&&""!==t?(console.log(r),this.axios.get("/api/drc/v2/mha/gtid/checkResult?mha="+r+"&configGtid="+t).then((function(a){0===a.data.status?(e.gtidCheck.resVo={mha:r,legal:!0===a.data.data.legal?"合理位点":"binlog已经被purge",configGtid:t,purgedGtid:a.data.data.purgedGtid},e.gtidCheck.modal=!0):alert("位点校验失败!")}))):alert("位点为空！")},handleCreateColumn:function(e){this.contains(this.formItem.constants.columnsForChose,e)?alert("已有项禁止创建"):""!==e&&void 0!==e&&null!==e?this.formItem.constants.columnsForChose.push(e):alert("字段不能为空")},handleCreateSoaServiceCode:function(e){this.contains(this.formItem.constants.serviceCodeForChose,e)?alert("已有项禁止创建"):""!==e&&void 0!==e&&null!==e&&0!==e?this.formItem.constants.serviceCodeForChose.push(e):alert("serviceCode不能为空")},handleCreateSoaServiceName:function(e){this.contains(this.formItem.constants.serviceNameForChose,e)?alert("已有项禁止创建"):""!==e&&void 0!==e&&null!==e?this.formItem.constants.serviceNameForChose.push(e):alert("serviceName不能为空")},handleCreateTag:function(e){this.meta.tags.push(e)},flattenObj:function(e){var t={};for(var r in e)if("object"!==Object(i["a"])(e[r])||Array.isArray(e[r]))t[r]=e[r];else{var a=this.flattenObj(e[r]);for(var n in a)t[r+"."+n]=a[n]}return t},checkParam:function(e){if(!0===e.openRowsFilterConfig){var t=e.rowsFilterDetail;if(console.log("rowsFilterConfig",t),[this.formItem.constants.rowsFilter.filterMode.TRIP_UDL,this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID].includes(t.mode)){if(0===t.columns.length&&0===t.udlColumns.length)return this.$Message.warning("行过滤检测失败：uid 与 uld字段不能同时为空！"),!1;if(0!==t.udlColumns.length&&!t.drcStrategyId)return this.$Message.warning("行过滤检测失败：UDL策略不可为空！"),!1;if(0===t.fetchMode&&(""===t.context||void 0===t.context||"//filter by config"===t.context))return this.$Message.warning("行过滤检测失败：context 不能为空！"),!1}else if(""===t.mode||void 0===t.mode||0===t.columns.length)return this.$Message.warning("缺少行过滤配置 禁止提交"),!1}return!0},preCheckMysqlConfig:function(){var e=this;this.mysqlConfig.dataLoading=!0;var t=[];if(console.log("previewDataList:"),console.log(this.previewDataList),this.previewDataList.forEach((function(e){t.push(e.srcMha.name),t.push(e.dstMha.name)})),0===t.length)return this.$Message.warning("mha配置校验失败: 请先配置mha"),void(this.mysqlConfig.dataLoading=!1);this.necessaryParamsCheck()?(console.log("mhaList:"),console.log(t),this.axios.get("/api/drc/v2/autoconfig/preCheckMysqlConfig?mhaList="+t).then((function(t){if(0===t.data.status){var r=t.data.data;e.mysqlConfig.data=r.configs,e.mysqlConfig.result=r.result,r.result?e.mysqlConfig.resultStr="合格":e.mysqlConfig.resultStr="不合格"}else e.$Message.warning("mha配置校验失败: "+t.data.message)})),this.mysqlConfig.dataLoading=!1,this.mysqlConfig.modal=!0):this.mysqlConfig.dataLoading=!1},necessaryParamsCheck:function(){var e=this.getParams();if(0===e.mode){if(!e.dbName)return this.$Message.warning("请先填写数据库"),!1}else if(1===e.mode&&!e.dalClusterName)return this.$Message.warning("请先填写 dalcluster"),!1;return e.srcRegionName&&e.dstRegionName?!!this.mhaAccountInited||(this.$Message.warning("相关mha账号未初始化，请刷新或 点击 检查同步集群重试！"),!1):(this.$Message.warning("请先填写同步方向"),!1)},init:function(){var e=this;null!==this.applicationFormId&&(this.formItem.buildMode=1,this.formItem.dalClusterModeOption.dalClusterName=this.$route.query.dalClusterName,this.formItem.srcRegionName=this.$route.query.srcRegion,this.formItem.dstRegionName=this.$route.query.dstRegion,this.formItem.gtidInit=this.$route.query.gtidInit,this.formItem.tableName=this.$route.query.tableName,this.formItem.tag=this.$route.query.tag,this.formItem.buName=this.$route.query.buName,this.formItem.switch.rowsFilter="UDL"===this.$route.query.filterType,this.getRegionOptions().then((function(){e.getTableInfo(),e.formItem.switch.rowsFilter&&e.getCommonColumns("UDL")})))}},computed:{useTripUdlOrUidMode:function(){return[this.formItem.constants.rowsFilter.filterMode.TRIP_UDL,this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID].includes(this.formItem.rowsFilterDetail.mode)},useCustomSoaMode:function(){return[this.formItem.constants.rowsFilter.filterMode.CUSTOM_SOA].includes(this.formItem.rowsFilterDetail.mode)},hasUdlColumn:function(){return 0!==this.formItem.rowsFilterDetail.udlColumns.length},fillContextByRegion:function(){return this.formItem.rowsFilterDetail.fetchMode===this.formItem.constants.rowsFilter.fetchMode.RPC},hasUidColumn:function(){return 0!==this.formItem.rowsFilterDetail.columns.length},showUdlConfigDetail:function(){return this.formItem.rowsFilterDetail.mode===this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID||this.hasUdlLegalConfig||!this.hasUidLegalConfig},showUidConfigDetail:function(){return this.formItem.rowsFilterDetail.mode===this.formItem.constants.rowsFilter.filterMode.TRIP_UDL_UID||this.hasUidLegalConfig||!this.hasUdlLegalConfig},hasUdlLegalConfig:function(){return 0!==this.formItem.rowsFilterDetail.udlColumns.length&&null!=this.formItem.rowsFilterDetail.drcStrategyId&&this.formItem.rowsFilterDetail.drcStrategyId>0},hasUidLegalConfig:function(){return this.hasUidColumn},gtidConfigurable:function(){return null!==this.previewDataList&&1===this.previewDataList.length&&0===this.formItem.buildMode&&1!==this.previewDataList[0].drcStatus},preCheckTablePage:function(){var e=this.checkTableDataList,t=this.table.dbTablePage.current*this.table.dbTablePage.size-this.table.dbTablePage.size,r=t+this.table.dbTablePage.size;return Object(o["a"])(e).slice(t,r)},preCheckMhaReplicationPage:function(){var e=this.previewDataList,t=this.table.dbMhaTablePage.current*this.table.dbMhaTablePage.size-this.table.dbMhaTablePage.size,r=t+this.table.dbMhaTablePage.size;return Object(o["a"])(e).slice(t,r)}},created:function(){var e=this;this.axios.get("/api/drc/v2/permission/meta/mhaReplication/modify").then((function(t){403!==t.data.status?e.getBus():e.$router.push("/nopermission")})),this.applicationFormId=this.$route.query.applicationFormId,this.init()}}),u=c,m=(r("aaed"),r("2877")),d=Object(m["a"])(u,a,n,!1,null,null,null);t["default"]=d.exports},8533:function(e,t,r){},"90d8":function(e,t,r){"use strict";var a=r("c65b"),n=r("1a2d"),o=r("3a9b"),i=r("ad6d"),s=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||n(e,"flags")||!o(s,e)?t:a(i,e)}},9263:function(e,t,r){"use strict";var a=r("c65b"),n=r("e330"),o=r("577e"),i=r("ad6d"),s=r("9f7f"),l=r("5692"),c=r("7c73"),u=r("69f3").get,m=r("fce3"),d=r("107c"),f=l("native-string-replace",String.prototype.replace),h=RegExp.prototype.exec,g=h,p=n("".charAt),b=n("".indexOf),v=n("".replace),I=n("".slice),y=function(){var e=/a/,t=/b*/g;return a(h,e,"a"),a(h,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),w=s.BROKEN_CARET,x=void 0!==/()??/.exec("")[1],C=y||x||w||m||d;C&&(g=function(e){var t,r,n,s,l,m,d,C=this,k=u(C),F=o(e),_=k.raw;if(_)return _.lastIndex=C.lastIndex,t=a(g,_,F),C.lastIndex=_.lastIndex,t;var O=k.groups,D=w&&C.sticky,S=a(i,C),N=C.source,M=0,L=F;if(D&&(S=v(S,"y",""),-1===b(S,"g")&&(S+="g"),L=I(F,C.lastIndex),C.lastIndex>0&&(!C.multiline||C.multiline&&"\n"!==p(F,C.lastIndex-1))&&(N="(?: "+N+")",L=" "+L,M++),r=new RegExp("^(?:"+N+")",S)),x&&(r=new RegExp("^"+N+"$(?!\\s)",S)),y&&(n=C.lastIndex),s=a(h,D?r:C,L),D?s?(s.input=I(s.input,M),s[0]=I(s[0],M),s.index=C.lastIndex,C.lastIndex+=s[0].length):C.lastIndex=0:y&&s&&(C.lastIndex=C.global?s.index+s[0].length:n),x&&s&&s.length>1&&a(f,s[0],r,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(s[l]=void 0)})),s&&O)for(s.groups=m=c(null),l=0;l<O.length;l++)d=O[l],m[d[0]]=s[d[1]];return s}),e.exports=g},"944a":function(e,t,r){"use strict";var a=r("d066"),n=r("e065"),o=r("d44e");n("toStringTag"),o(a("Symbol"),"Symbol")},"9bdd":function(e,t,r){"use strict";var a=r("825a"),n=r("2a62");e.exports=function(e,t,r,o){try{return o?t(a(r)[0],r[1]):t(r)}catch(i){n(e,"throw",i)}}},"9f7f":function(e,t,r){"use strict";var a=r("d039"),n=r("cfe9"),o=n.RegExp,i=a((function(){var e=o("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),s=i||a((function(){return!o("a","y").sticky})),l=i||a((function(){var e=o("^r","gy");return e.lastIndex=2,null!==e.exec("str")}));e.exports={BROKEN_CARET:l,MISSED_STICKY:s,UNSUPPORTED_Y:i}},a15b:function(e,t,r){"use strict";var a=r("23e7"),n=r("e330"),o=r("44ad"),i=r("fc6a"),s=r("a640"),l=n([].join),c=o!==Object,u=c||!s("join",",");a({target:"Array",proto:!0,forced:u},{join:function(e){return l(i(this),void 0===e?",":e)}})},a630:function(e,t,r){"use strict";var a=r("23e7"),n=r("4df4"),o=r("1c7e"),i=!o((function(e){Array.from(e)}));a({target:"Array",stat:!0,forced:i},{from:n})},a640:function(e,t,r){"use strict";var a=r("d039");e.exports=function(e,t){var r=[][e];return!!r&&a((function(){r.call(null,t||function(){return 1},1)}))}},aaed:function(e,t,r){"use strict";r("8533")},ab13:function(e,t,r){"use strict";var a=r("b622"),n=a("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(a){}}return!1}},ac1f:function(e,t,r){"use strict";var a=r("23e7"),n=r("9263");a({target:"RegExp",proto:!0,forced:/./.exec!==n},{exec:n})},ad6d:function(e,t,r){"use strict";var a=r("825a");e.exports=function(){var e=a(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},b636:function(e,t,r){"use strict";var a=r("e065");a("asyncIterator")},c7eb:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("a4d3"),r("e01a"),r("b636"),r("d28b"),r("944a"),r("d9e2"),r("14d9"),r("fb6a"),r("b0c0"),r("0c47"),r("23dc"),r("3410"),r("1f68"),r("131a"),r("d3b7"),r("3ca3"),r("159b"),r("ddb0");var a=r("53ca");function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
n=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function m(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{m({},"")}catch(e){m=function(e,t,r){return e[t]=r}}function d(e,t,r,a){var n=t&&t.prototype instanceof I?t:I,o=Object.create(n.prototype),s=new L(a||[]);return i(o,"_invoke",{value:D(e,r,s)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",g="suspendedYield",p="executing",b="completed",v={};function I(){}function y(){}function w(){}var x={};m(x,l,(function(){return this}));var C=Object.getPrototypeOf,k=C&&C(C(T([])));k&&k!==r&&o.call(k,l)&&(x=k);var F=w.prototype=I.prototype=Object.create(x);function _(e){["next","throw","return"].forEach((function(t){m(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(n,i,s,l){var c=f(e[n],e,i);if("throw"!==c.type){var u=c.arg,m=u.value;return m&&"object"==Object(a["a"])(m)&&o.call(m,"__await")?t.resolve(m.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(m).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,l)}))}l(c.arg)}var n;i(this,"_invoke",{value:function(e,a){function o(){return new t((function(t,n){r(e,a,t,n)}))}return n=n?n.then(o,o):o()}})}function D(t,r,a){var n=h;return function(o,i){if(n===p)throw Error("Generator is already running");if(n===b){if("throw"===o)throw i;return{value:e,done:!0}}for(a.method=o,a.arg=i;;){var s=a.delegate;if(s){var l=S(s,a);if(l){if(l===v)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(n===h)throw n=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n=p;var c=f(t,r,a);if("normal"===c.type){if(n=a.done?b:g,c.arg===v)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(n=b,a.method="throw",a.arg=c.arg)}}}function S(t,r){var a=r.method,n=t.iterator[a];if(n===e)return r.delegate=null,"throw"===a&&t.iterator["return"]&&(r.method="return",r.arg=e,S(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),v;var o=f(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(Object(a["a"])(t)+" is not iterable")}return y.prototype=w,i(F,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:y,configurable:!0}),y.displayName=m(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,m(e,u,"GeneratorFunction")),e.prototype=Object.create(F),e},t.awrap=function(e){return{__await:e}},_(O.prototype),m(O.prototype,c,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,a,n,o){void 0===o&&(o=Promise);var i=new O(d(e,r,a,n),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(F),m(F,u,"Generator"),m(F,l,(function(){return this})),m(F,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=T,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(a,n){return s.type="throw",s.arg=t,r.next=a,n&&(r.method="next",r.arg=e),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;M(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:T(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),v}},t}},d81d:function(e,t,r){"use strict";var a=r("23e7"),n=r("b727").map,o=r("1dde"),i=o("map");a({target:"Array",proto:!0,forced:!i},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},fce3:function(e,t,r){"use strict";var a=r("d039"),n=r("cfe9"),o=n.RegExp;e.exports=a((function(){var e=o(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)}))}}]);
//# sourceMappingURL=chunk-6e70757e.a439ceb3.js.map